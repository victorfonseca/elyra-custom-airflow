{"version":3,"file":"971.2bac2e149450f52a7569.js?v=2bac2e149450f52a7569","mappings":"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AKuY,QAAQrQ,MAAM,GACnB,IAEHoI,MAAMnR,QAAQC,MAfjBY,KAAKqY,OAAOO,OACV,GAAGR,0DAgBT,CAEA,SAAIS,GACF,OAAO7Y,KAAKqY,OAAOS,OACrB,CAEA,aAAIC,GACF,OAAO/Y,KAAK2Y,SAASI,SACvB,CAEA,GAAAvS,CAAIwS,EAAkB7U,GACpBnE,KAAK2Y,SAASnS,IAAIwS,EAAmB7U,GAAOmM,MAAMnR,QAAQC,KAC5D,GD3EF,SAAYkY,GACV,qBACA,yBACA,iCACA,kBACD,CALD,CAAYA,KAAAA,GAAkB,KAO9B,SAAYC,GACV,iCACA,8BACD,CAHD,CAAYA,KAAAA,GAAa,KAKzB,SAAYC,GACV,8BACD,CAFD,CAAYA,KAAAA,GAAS,KAIrB,SAAYC,GACV,8BACD,CAFD,CAAYA,KAAAA,GAAiB,KAI7B,SAAYC,GACV,mBACA,uBACA,2BACA,iCACA,qBACA,2BACA,qBACA,6BACA,uBACA,4BACA,oBACA,sBACA,oBACA,0BACA,0BACA,sBACA,oBACA,8BACA,wBACA,gCACA,4BACA,wBACA,sBACA,4BACA,qCACD,CA1BD,CAAYA,KAAAA,GAAkB,KA4B9B,SAAYC,GACV,mBACA,mBACA,oBACD,CAJD,CAAYA,KAAAA,GAAqB,KAMjC,SAAYC,GACV,yBACA,2CACA,wEACD,CAJD,CAAYA,KAAAA,GAAqB,KAMjC,SAAYC,GACV,mCACD,CAFD,CAAYA,KAAAA,GAAgC,KAc5C,SAAYC,GACV,cACA,oBACA,kBACA,oBACA,8BACA,QACA,YACA,cACA,YACA,cACA,cACA,0BACA,kBACA,kBACA,cACA,+BACA,+BACA,UACA,kBACA,0BACA,cACA,YACA,cACA,0BACA,qCACA,cACA,gBACA,cACA,YACA,sBACA,sBACA,+BACA,mCACA,cACA,iBACA,YACA,0BACA,aACA,kBACA,QACA,yBACA,cACA,cACA,4CACA,gCACA,gBACA,wBACA,oCACA,YACA,gBACA,0BACA,qCACA,YACA,oBACA,YACA,YACA,aACD,CA1DD,CAAYA,KAAAA,GAAS,KEpEd,MAAMmB,GACX,gBAAOC,CAA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","sources":["webpack://@jupyter-lsp/jupyterlab-lsp/./style/console.css","webpack://@jupyter-lsp/jupyterlab-lsp/./style/diagnostics_listing.css","webpack://@jupyter-lsp/jupyterlab-lsp/./style/highlight.css","webpack://@jupyter-lsp/jupyterlab-lsp/./style/index.css","webpack://@jupyter-lsp/jupyterlab-lsp/./style/signature.css","webpack://@jupyter-lsp/jupyterlab-lsp/./style/statusbar.css","webpack://@jupyter-lsp/jupyterlab-lsp/./style/tooltip.css","webpack://@jupyter-lsp/jupyterlab-lsp/./style/variables/base.css","webpack://@jupyter-lsp/jupyterlab-lsp/./style/variables/cm-themes.css","webpack://@jupyter-lsp/jupyterlab-lsp/./style/variables/jupyterlab-dark.css","webpack://@jupyter-lsp/jupyterlab-lsp/./style/variables/jupyterlab-light.css","webpack://@jupyter-lsp/jupyterlab-lsp/./src/tokens.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/extractors/regexp.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/overrides/tokens.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./style/index.css?f019","webpack://@jupyter-lsp/jupyterlab-lsp/./src/overrides/maps.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/virtual/document.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/adapters/fileeditor.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/adapters/notebook.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./style/statusbar.css?6208","webpack://@jupyter-lsp/jupyterlab-lsp/./src/errors.tsx","webpack://@jupyter-lsp/jupyterlab-lsp/./src/components/icons.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/components/utils.tsx","webpack://@jupyter-lsp/jupyterlab-lsp/./src/components/statusbar.tsx","webpack://@jupyter-lsp/jupyterlab-lsp/./src/lsp.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/feature.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/converter.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/completion/overrides.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./style/console.css?11c0","webpack://@jupyter-lsp/jupyterlab-lsp/./src/virtual/console.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/completion/item.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/completion/model.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/completion/renderer.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/completion/provider.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/completion/tokens.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/completion/index.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/context.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/utils.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/jump_to.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./style/diagnostics_listing.css?d3bd","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/diagnostics/listing.tsx","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/diagnostics/diagnostics.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/diagnostics/underline.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/diagnostics/feature.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/diagnostics/index.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/marks.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/highlights.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/components/free_tooltip.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/hover.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/edits.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/diagnostics/tokens.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/rename.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/signature.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/symbol.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/features/syntax_highlighting.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/overrides/index.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/components/serverSettings.tsx","webpack://@jupyter-lsp/jupyterlab-lsp/./src/settings.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/transclusions/ipython/extractors.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/transclusions/ipython/overrides.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/transclusions/ipython/index.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/transclusions/ipython-bigquery/extractors.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/transclusions/ipython-bigquery/index.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/transclusions/ipython-rpy2/rpy2.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/transclusions/ipython-rpy2/extractors.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/transclusions/ipython-rpy2/overrides.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/transclusions/ipython-rpy2/index.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/transclusions/ipython-sql/extractors.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/transclusions/ipython-sql/index.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/transclusions/defaults.ts","webpack://@jupyter-lsp/jupyterlab-lsp/./src/index.ts"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.lsp-floating-console {\n  position: absolute;\n  width: 600px;\n  min-height: 350px;\n  height: 25%;\n  right: 0;\n  bottom: 0;\n  background: rgba(255, 255, 255, 0.8);\n  border: 3px solid rgba(204, 204, 204, 0.7);\n  font-size: 12px;\n  overflow-y: auto;\n  margin: 0;\n  list-style-type: none;\n  padding: 5px;\n  z-index: 100;\n}\n\n.lsp-code {\n  font-family: monospace;\n  background: #eee;\n  border-radius: 2px;\n  padding: 2px 5px;\n}\n\n.lsp-kind {\n  padding: 2px 5px;\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./style/console.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,kBAAkB;EAClB,YAAY;EACZ,iBAAiB;EACjB,WAAW;EACX,QAAQ;EACR,SAAS;EACT,oCAAoC;EACpC,0CAA0C;EAC1C,eAAe;EACf,gBAAgB;EAChB,SAAS;EACT,qBAAqB;EACrB,YAAY;EACZ,YAAY;AACd;;AAEA;EACE,sBAAsB;EACtB,gBAAgB;EAChB,kBAAkB;EAClB,gBAAgB;AAClB;;AAEA;EACE,gBAAgB;AAClB\",\"sourcesContent\":[\".lsp-floating-console {\\n  position: absolute;\\n  width: 600px;\\n  min-height: 350px;\\n  height: 25%;\\n  right: 0;\\n  bottom: 0;\\n  background: rgba(255, 255, 255, 0.8);\\n  border: 3px solid rgba(204, 204, 204, 0.7);\\n  font-size: 12px;\\n  overflow-y: auto;\\n  margin: 0;\\n  list-style-type: none;\\n  padding: 5px;\\n  z-index: 100;\\n}\\n\\n.lsp-code {\\n  font-family: monospace;\\n  background: #eee;\\n  border-radius: 2px;\\n  padding: 2px 5px;\\n}\\n\\n.lsp-kind {\\n  padding: 2px 5px;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.lsp-diagnostics-panel-content {\n  overflow-y: auto;\n}\n\n.lsp-diagnostics-placeholder {\n  padding: 8px;\n  color: var(--jp-content-font-color2);\n  text-align: center;\n}\n\n.lsp-diagnostics-placeholder > h3 {\n  margin-bottom: var(--jp-content-heading-margin-bottom);\n}\n\n.lsp-diagnostics-listing {\n  color: var(--jp-ui-font-color1);\n  background: var(--jp-layout-color1);\n  font-size: var(--jp-ui-font-size1);\n  border-spacing: 0;\n  /* required to preserve borders of \\`<th>\\` when using position:sticky */\n  border-collapse: separate;\n  width: 100%;\n}\n\n.lsp-diagnostics-listing thead {\n  box-shadow: var(--jp-toolbar-box-shadow);\n}\n\n.lsp-diagnostics-listing tbody {\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n\n.lsp-diagnostics-listing th,\n.lsp-diagnostics-listing td {\n  padding: 4px 12px 2px 12px;\n  height: 18px;\n}\n\n.lsp-diagnostics-listing th {\n  font-weight: 500;\n  text-align: left;\n  border-bottom: var(--jp-border-width) solid var(--jp-border-color1);\n  background: var(--jp-layout-color1);\n  position: sticky;\n  top: 0;\n  z-index: 2;\n  white-space: nowrap;\n  user-select: none;\n}\n\n.lsp-diagnostics-listing th:not(:first-child) {\n  border-left: var(--jp-border-width) solid var(--jp-border-color2);\n}\n\n.lsp-diagnostics-listing th:hover {\n  background: var(--jp-layout-color2);\n}\n\n.lsp-diagnostics-listing tbody tr:hover {\n  background: var(--jp-layout-color2);\n}\n\n.lsp-diagnostics-listing thead th > div {\n  flex-direction: row;\n  display: flex;\n}\n\n.lsp-diagnostics-listing thead th > div > label {\n  flex: 1;\n  text-overflow: ellipsis;\n}\n\n.lsp-sort-icon {\n  flex: 0;\n  height: var(--jp-ui-font-size1);\n  width: var(--jp-ui-font-size1);\n}\n\n.lsp-sort-icon svg {\n  display: inline;\n  height: auto;\n}\n\n.lsp-diagnostics-listing thead th:not(.lsp-sorted-header) .lsp-sort-icon {\n  opacity: 0;\n}\n\n.lsp-diagnostics-listing thead th:not(.lsp-sorted-header):hover .lsp-sort-icon {\n  opacity: 0.5;\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./style/diagnostics_listing.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,gBAAgB;AAClB;;AAEA;EACE,YAAY;EACZ,oCAAoC;EACpC,kBAAkB;AACpB;;AAEA;EACE,sDAAsD;AACxD;;AAEA;EACE,+BAA+B;EAC/B,mCAAmC;EACnC,kCAAkC;EAClC,iBAAiB;EACjB,sEAAsE;EACtE,yBAAyB;EACzB,WAAW;AACb;;AAEA;EACE,wCAAwC;AAC1C;;AAEA;EACE,gBAAgB;EAChB,kBAAkB;AACpB;;AAEA;;EAEE,0BAA0B;EAC1B,YAAY;AACd;;AAEA;EACE,gBAAgB;EAChB,gBAAgB;EAChB,mEAAmE;EACnE,mCAAmC;EACnC,gBAAgB;EAChB,MAAM;EACN,UAAU;EACV,mBAAmB;EACnB,iBAAiB;AACnB;;AAEA;EACE,iEAAiE;AACnE;;AAEA;EACE,mCAAmC;AACrC;;AAEA;EACE,mCAAmC;AACrC;;AAEA;EACE,mBAAmB;EACnB,aAAa;AACf;;AAEA;EACE,OAAO;EACP,uBAAuB;AACzB;;AAEA;EACE,OAAO;EACP,+BAA+B;EAC/B,8BAA8B;AAChC;;AAEA;EACE,eAAe;EACf,YAAY;AACd;;AAEA;EACE,UAAU;AACZ;;AAEA;EACE,YAAY;AACd\",\"sourcesContent\":[\".lsp-diagnostics-panel-content {\\n  overflow-y: auto;\\n}\\n\\n.lsp-diagnostics-placeholder {\\n  padding: 8px;\\n  color: var(--jp-content-font-color2);\\n  text-align: center;\\n}\\n\\n.lsp-diagnostics-placeholder > h3 {\\n  margin-bottom: var(--jp-content-heading-margin-bottom);\\n}\\n\\n.lsp-diagnostics-listing {\\n  color: var(--jp-ui-font-color1);\\n  background: var(--jp-layout-color1);\\n  font-size: var(--jp-ui-font-size1);\\n  border-spacing: 0;\\n  /* required to preserve borders of `<th>` when using position:sticky */\\n  border-collapse: separate;\\n  width: 100%;\\n}\\n\\n.lsp-diagnostics-listing thead {\\n  box-shadow: var(--jp-toolbar-box-shadow);\\n}\\n\\n.lsp-diagnostics-listing tbody {\\n  overflow-y: auto;\\n  overflow-x: hidden;\\n}\\n\\n.lsp-diagnostics-listing th,\\n.lsp-diagnostics-listing td {\\n  padding: 4px 12px 2px 12px;\\n  height: 18px;\\n}\\n\\n.lsp-diagnostics-listing th {\\n  font-weight: 500;\\n  text-align: left;\\n  border-bottom: var(--jp-border-width) solid var(--jp-border-color1);\\n  background: var(--jp-layout-color1);\\n  position: sticky;\\n  top: 0;\\n  z-index: 2;\\n  white-space: nowrap;\\n  user-select: none;\\n}\\n\\n.lsp-diagnostics-listing th:not(:first-child) {\\n  border-left: var(--jp-border-width) solid var(--jp-border-color2);\\n}\\n\\n.lsp-diagnostics-listing th:hover {\\n  background: var(--jp-layout-color2);\\n}\\n\\n.lsp-diagnostics-listing tbody tr:hover {\\n  background: var(--jp-layout-color2);\\n}\\n\\n.lsp-diagnostics-listing thead th > div {\\n  flex-direction: row;\\n  display: flex;\\n}\\n\\n.lsp-diagnostics-listing thead th > div > label {\\n  flex: 1;\\n  text-overflow: ellipsis;\\n}\\n\\n.lsp-sort-icon {\\n  flex: 0;\\n  height: var(--jp-ui-font-size1);\\n  width: var(--jp-ui-font-size1);\\n}\\n\\n.lsp-sort-icon svg {\\n  display: inline;\\n  height: auto;\\n}\\n\\n.lsp-diagnostics-listing thead th:not(.lsp-sorted-header) .lsp-sort-icon {\\n  opacity: 0;\\n}\\n\\n.lsp-diagnostics-listing thead th:not(.lsp-sorted-header):hover .lsp-sort-icon {\\n  opacity: 0.5;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_AT_RULE_IMPORT_0___ from \"-!../../../node_modules/css-loader/dist/cjs.js!./variables/base.css\";\nimport ___CSS_LOADER_AT_RULE_IMPORT_1___ from \"-!../../../node_modules/css-loader/dist/cjs.js!./variables/cm-themes.css\";\nimport ___CSS_LOADER_AT_RULE_IMPORT_2___ from \"-!../../../node_modules/css-loader/dist/cjs.js!./variables/jupyterlab-dark.css\";\nimport ___CSS_LOADER_AT_RULE_IMPORT_3___ from \"-!../../../node_modules/css-loader/dist/cjs.js!./variables/jupyterlab-light.css\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_0___);\n___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_1___);\n___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_2___);\n___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_3___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.cm-lsp-diagnostic-tag-Unnecessary {\n  /*\n   * LSP: \"Clients are allowed to render diagnostics with this tag faded out instead of having an error squiggle.\"\n   */\n  filter: grayscale(1);\n  opacity: 0.7;\n  text-decoration: none !important;\n}\n\n.cm-lsp-diagnostic-tag-Deprecated {\n  /*\n   * LSP: \"Clients are allowed to rendered diagnostics with this tag strike through.\"\n   */\n  text-decoration: line-through !important;\n}\n\n/* hover */\n.cm-lsp-hover-available {\n  text-decoration: var(--jp-editor-mirror-lsp-hover-decoration-style);\n  text-decoration-color: var(--jp-editor-mirror-lsp-hover-decoration-color);\n  text-decoration-line: underline;\n  text-decoration-skip-ink: none;\n}\n\n/* highlight */\n.cm-lsp-highlight-Read {\n  /* highlight on places where variable is accessed, e.g. \\`print(var)\\` */\n  background-color: var(--jp-editor-mirror-lsp-highlight-background-color);\n  outline: 1px solid var(--jp-editor-mirror-lsp-highlight-background-color);\n}\n\n.cm-lsp-highlight-Write {\n  /* highlight on places where variable is defined, e.g. \\`var = 1\\` */\n  background-color: var(--jp-editor-mirror-lsp-highlight-background-color);\n  outline: 1px solid var(--jp-editor-mirror-lsp-highlight-border-color);\n}\n\n.cm-lsp-highlight-Text {\n  /* highlight on places where variable was matched based on text rather than semantics */\n  background-color: var(--jp-editor-mirror-lsp-highlight-background-color);\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./style/highlight.css\"],\"names\":[],\"mappings\":\"AAKA;EACE;;IAEE;EACF,oBAAoB;EACpB,YAAY;EACZ,gCAAgC;AAClC;;AAEA;EACE;;IAEE;EACF,wCAAwC;AAC1C;;AAEA,UAAU;AACV;EACE,mEAAmE;EACnE,yEAAyE;EACzE,+BAA+B;EAC/B,8BAA8B;AAChC;;AAEA,cAAc;AACd;EACE,sEAAsE;EACtE,wEAAwE;EACxE,yEAAyE;AAC3E;;AAEA;EACE,kEAAkE;EAClE,wEAAwE;EACxE,qEAAqE;AACvE;;AAEA;EACE,uFAAuF;EACvF,wEAAwE;AAC1E\",\"sourcesContent\":[\"@import url('./variables/base.css');\\n@import url('./variables/cm-themes.css');\\n@import url('./variables/jupyterlab-dark.css');\\n@import url('./variables/jupyterlab-light.css');\\n\\n.cm-lsp-diagnostic-tag-Unnecessary {\\n  /*\\n   * LSP: \\\"Clients are allowed to render diagnostics with this tag faded out instead of having an error squiggle.\\\"\\n   */\\n  filter: grayscale(1);\\n  opacity: 0.7;\\n  text-decoration: none !important;\\n}\\n\\n.cm-lsp-diagnostic-tag-Deprecated {\\n  /*\\n   * LSP: \\\"Clients are allowed to rendered diagnostics with this tag strike through.\\\"\\n   */\\n  text-decoration: line-through !important;\\n}\\n\\n/* hover */\\n.cm-lsp-hover-available {\\n  text-decoration: var(--jp-editor-mirror-lsp-hover-decoration-style);\\n  text-decoration-color: var(--jp-editor-mirror-lsp-hover-decoration-color);\\n  text-decoration-line: underline;\\n  text-decoration-skip-ink: none;\\n}\\n\\n/* highlight */\\n.cm-lsp-highlight-Read {\\n  /* highlight on places where variable is accessed, e.g. `print(var)` */\\n  background-color: var(--jp-editor-mirror-lsp-highlight-background-color);\\n  outline: 1px solid var(--jp-editor-mirror-lsp-highlight-background-color);\\n}\\n\\n.cm-lsp-highlight-Write {\\n  /* highlight on places where variable is defined, e.g. `var = 1` */\\n  background-color: var(--jp-editor-mirror-lsp-highlight-background-color);\\n  outline: 1px solid var(--jp-editor-mirror-lsp-highlight-border-color);\\n}\\n\\n.cm-lsp-highlight-Text {\\n  /* highlight on places where variable was matched based on text rather than semantics */\\n  background-color: var(--jp-editor-mirror-lsp-highlight-background-color);\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_AT_RULE_IMPORT_0___ from \"-!../../../node_modules/css-loader/dist/cjs.js!./highlight.css\";\nimport ___CSS_LOADER_AT_RULE_IMPORT_1___ from \"-!../../../node_modules/css-loader/dist/cjs.js!./tooltip.css\";\nimport ___CSS_LOADER_AT_RULE_IMPORT_2___ from \"-!../../../node_modules/css-loader/dist/cjs.js!./signature.css\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_0___);\n___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_1___);\n___CSS_LOADER_EXPORT___.i(___CSS_LOADER_AT_RULE_IMPORT_2___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.lsp-document-locator:hover {\n  cursor: pointer;\n}\n\n.lsp-document-locator span:not(:last-child)::after {\n  content: ' > ';\n}\n\n.lsp-icon-flip-x {\n  transform: scaleX(-1);\n  transform-origin: center center;\n}\n\n.lsp-external-link {\n  color: var(--jp-content-link-color);\n}\n\n.lsp-ServerSettings-list {\n  grid-area: listing;\n  min-width: 175px;\n}\n\n.lsp-ServerSettings-list ul {\n  list-style: none;\n  margin: 0;\n  padding: 0;\n}\n\n.lsp-ServerSettings-list li {\n  text-overflow: ellipsis;\n  overflow-x: hidden;\n  white-space: nowrap;\n  padding: 3px 0;\n  border-left: 3px solid transparent;\n  padding-left: 4px;\n}\n\n.lsp-ServerSettings-title {\n  font-size: var(--jp-content-font-size2);\n  color: var(--jp-ui-font-color0);\n  font-weight: 300;\n  margin: 0;\n  padding: 0;\n}\n\n.lsp-ServerSettings-list-group {\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 1px;\n  font-size: var(--jp-ui-font-size0);\n  padding: 8px 8px 8px 12px;\n  margin: 10px;\n  border-bottom: var(--jp-border-width) solid var(--jp-border-color2);\n  border-top: var(--jp-border-width) solid var(--jp-border-color2);\n  color: var(--jp-content-font-color1);\n}\n\n.lsp-ServerSettings-list li.lsp-selected {\n  border-color: var(--jp-brand-color1);\n}\n\n.lsp-ServerSettings-list li:hover {\n  background-color: var(--jp-layout-color2);\n  transition: background-color 100ms ease-in-out;\n}\n\n.lsp-ServerSettings-content {\n  grid-area: content;\n  min-width: 0;\n  width: 100%;\n  overflow-y: scroll;\n  max-height: 1000px;\n}\n\n.lsp-ServerSettings-content-name {\n  font-size: var(--jp-content-font-size2);\n  color: var(--jp-ui-font-color0);\n  font-weight: normal;\n  margin: 1em;\n}\n\n.lsp-ServerSettings-content-specOverrides {\n  margin: 1em;\n}\n\n.lsp-ServerSettings-content > .form-group {\n  padding-top: 0;\n}\n\n.lsp-ServerSettings-content .lsp-server-links-list {\n  margin: 0;\n}\n\n.lsp-ServerSettings-tabs {\n  display: grid;\n  grid-template: 'listing content';\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./style/index.css\"],\"names\":[],\"mappings\":\"AAIA;EACE,eAAe;AACjB;;AAEA;EACE,cAAc;AAChB;;AAEA;EACE,qBAAqB;EACrB,+BAA+B;AACjC;;AAEA;EACE,mCAAmC;AACrC;;AAEA;EACE,kBAAkB;EAClB,gBAAgB;AAClB;;AAEA;EACE,gBAAgB;EAChB,SAAS;EACT,UAAU;AACZ;;AAEA;EACE,uBAAuB;EACvB,kBAAkB;EAClB,mBAAmB;EACnB,cAAc;EACd,kCAAkC;EAClC,iBAAiB;AACnB;;AAEA;EACE,uCAAuC;EACvC,+BAA+B;EAC/B,gBAAgB;EAChB,SAAS;EACT,UAAU;AACZ;;AAEA;EACE,gBAAgB;EAChB,yBAAyB;EACzB,mBAAmB;EACnB,kCAAkC;EAClC,yBAAyB;EACzB,YAAY;EACZ,mEAAmE;EACnE,gEAAgE;EAChE,oCAAoC;AACtC;;AAEA;EACE,oCAAoC;AACtC;;AAEA;EACE,yCAAyC;EACzC,8CAA8C;AAChD;;AAEA;EACE,kBAAkB;EAClB,YAAY;EACZ,WAAW;EACX,kBAAkB;EAClB,kBAAkB;AACpB;;AAEA;EACE,uCAAuC;EACvC,+BAA+B;EAC/B,mBAAmB;EACnB,WAAW;AACb;;AAEA;EACE,WAAW;AACb;;AAEA;EACE,cAAc;AAChB;;AAEA;EACE,SAAS;AACX;;AAEA;EACE,aAAa;EACb,gCAAgC;AAClC\",\"sourcesContent\":[\"@import url('./highlight.css');\\n@import url('./tooltip.css');\\n@import url('./signature.css');\\n\\n.lsp-document-locator:hover {\\n  cursor: pointer;\\n}\\n\\n.lsp-document-locator span:not(:last-child)::after {\\n  content: ' > ';\\n}\\n\\n.lsp-icon-flip-x {\\n  transform: scaleX(-1);\\n  transform-origin: center center;\\n}\\n\\n.lsp-external-link {\\n  color: var(--jp-content-link-color);\\n}\\n\\n.lsp-ServerSettings-list {\\n  grid-area: listing;\\n  min-width: 175px;\\n}\\n\\n.lsp-ServerSettings-list ul {\\n  list-style: none;\\n  margin: 0;\\n  padding: 0;\\n}\\n\\n.lsp-ServerSettings-list li {\\n  text-overflow: ellipsis;\\n  overflow-x: hidden;\\n  white-space: nowrap;\\n  padding: 3px 0;\\n  border-left: 3px solid transparent;\\n  padding-left: 4px;\\n}\\n\\n.lsp-ServerSettings-title {\\n  font-size: var(--jp-content-font-size2);\\n  color: var(--jp-ui-font-color0);\\n  font-weight: 300;\\n  margin: 0;\\n  padding: 0;\\n}\\n\\n.lsp-ServerSettings-list-group {\\n  font-weight: 600;\\n  text-transform: uppercase;\\n  letter-spacing: 1px;\\n  font-size: var(--jp-ui-font-size0);\\n  padding: 8px 8px 8px 12px;\\n  margin: 10px;\\n  border-bottom: var(--jp-border-width) solid var(--jp-border-color2);\\n  border-top: var(--jp-border-width) solid var(--jp-border-color2);\\n  color: var(--jp-content-font-color1);\\n}\\n\\n.lsp-ServerSettings-list li.lsp-selected {\\n  border-color: var(--jp-brand-color1);\\n}\\n\\n.lsp-ServerSettings-list li:hover {\\n  background-color: var(--jp-layout-color2);\\n  transition: background-color 100ms ease-in-out;\\n}\\n\\n.lsp-ServerSettings-content {\\n  grid-area: content;\\n  min-width: 0;\\n  width: 100%;\\n  overflow-y: scroll;\\n  max-height: 1000px;\\n}\\n\\n.lsp-ServerSettings-content-name {\\n  font-size: var(--jp-content-font-size2);\\n  color: var(--jp-ui-font-color0);\\n  font-weight: normal;\\n  margin: 1em;\\n}\\n\\n.lsp-ServerSettings-content-specOverrides {\\n  margin: 1em;\\n}\\n\\n.lsp-ServerSettings-content > .form-group {\\n  padding-top: 0;\\n}\\n\\n.lsp-ServerSettings-content .lsp-server-links-list {\\n  margin: 0;\\n}\\n\\n.lsp-ServerSettings-tabs {\\n  display: grid;\\n  grid-template: 'listing content';\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.lsp-signature-help code {\n  font-size: var(--jp-code-font-size);\n}\n\n.lsp-signature-help code > mark {\n  color: var(--jp-lsp-signature-mark-color);\n  background: var(--jp-lsp-signature-mark-background);\n}\n\n.lsp-signature-help code > mark > span {\n  /* override syntax highlight colour to ensure contrast */\n  color: var(--jp-lsp-signature-mark-color) !important;\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./style/signature.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,mCAAmC;AACrC;;AAEA;EACE,yCAAyC;EACzC,mDAAmD;AACrD;;AAEA;EACE,wDAAwD;EACxD,oDAAoD;AACtD\",\"sourcesContent\":[\".lsp-signature-help code {\\n  font-size: var(--jp-code-font-size);\\n}\\n\\n.lsp-signature-help code > mark {\\n  color: var(--jp-lsp-signature-mark-color);\\n  background: var(--jp-lsp-signature-mark-background);\\n}\\n\\n.lsp-signature-help code > mark > span {\\n  /* override syntax highlight colour to ensure contrast */\\n  color: var(--jp-lsp-signature-mark-color) !important;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.lsp-popover {\n  /* jupyterlab Menu */\n  z-index: 10000;\n  padding: 4px 0px;\n  background: var(--jp-layout-color0);\n  color: var(--jp-ui-font-color1);\n  border: var(--jp-border-width) solid var(--jp-border-color1);\n  font-size: var(--jp-ui-font-size1);\n  box-shadow: var(--jp-elevation-z6);\n}\n\n.lsp-popover-content {\n  padding: 5px 10px;\n}\n\n.lsp-servers-title {\n  margin-bottom: 5px;\n}\n\n.lsp-servers-menu {\n  height: 350px;\n  overflow-y: auto;\n}\n\n.lsp-server-status,\n.lsp-missing-server,\n.lsp-documents-by-language {\n  margin-left: 20px;\n}\n\nh5 .lsp-language-server-name {\n  color: var(--jp-ui-font-color2);\n}\n\n.lsp-documents-by-language ul,\n.lsp-server-status ul {\n  margin: 0;\n  padding-left: 25px;\n}\n\n.lsp-servers-menu h5 {\n  font-weight: normal;\n  font-size: 100%;\n  white-space: nowrap;\n}\n\n.lsp-servers-lists {\n  margin-left: 5px;\n}\n\n.lsp-popover-status {\n  padding-top: 5px;\n  border-top: 1px solid var(--jp-border-color1);\n}\n\n.lsp-popover-status a {\n  color: var(--jp-content-link-color);\n}\n\n.lsp-servers-menu h3,\nh4,\nh5 {\n  margin: 0;\n}\n\n.lsp-documents-by-language li {\n  width: 100%;\n  display: flex;\n  justify-content: space-between;\n}\n\n.lsp-document-status {\n  float: right;\n  padding-left: 15px;\n}\n\n.lsp-document-status-icon {\n  margin-left: 5px;\n  position: relative;\n  top: 3px;\n}\n\n.lsp-collapsible-list h4 {\n  cursor: pointer;\n}\n\n.lsp-collapsible-list .lsp-caret-icon {\n  position: relative;\n  top: 3px;\n}\n\n.lsp-collapsible-list.lsp-collapsed div {\n  display: none;\n}\n\n.lsp-statusbar-item {\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.lsp-status-icon.ready svg g {\n  fill: var(--jp-success-color0);\n}\n\n.lsp-status-icon.preparing svg g {\n  fill: var(--jp-warn-color0);\n}\n\n.lsp-status-icon.error svg g {\n  fill: var(--jp-error-color0);\n}\n\n.lsp-status-icon.inactive svg g {\n  fill: var(--jp-layout-color3);\n}\n\n.lsp-status-message {\n  user-select: none;\n}\n\nbody[data-jp-theme-light='false'] .lsp-status-icon.ready svg g {\n  fill: var(--jp-success-color1);\n}\n\n.lsp-statusbar-item.jp-mod-clicked .jp-icon-selectable[fill] {\n  fill: #fff;\n}\n\n.jp-ToolbarButton .lsp-status-icon svg {\n  top: 5px;\n}\n\n.lsp-help-button {\n  background: var(--jp-layout-color2);\n  border: 1px solid var(--jp-brand-color0);\n  float: right;\n}\n\n.lsp-help-button:hover {\n  background: var(--jp-layout-color3);\n}\n\n.lsp-server-links-list a {\n  color: var(--jp-content-link-color);\n}\n\n.lsp-troubleshoot-section {\n  white-space: pre-wrap;\n  margin: 10px 0;\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./style/statusbar.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,oBAAoB;EACpB,cAAc;EACd,gBAAgB;EAChB,mCAAmC;EACnC,+BAA+B;EAC/B,4DAA4D;EAC5D,kCAAkC;EAClC,kCAAkC;AACpC;;AAEA;EACE,iBAAiB;AACnB;;AAEA;EACE,kBAAkB;AACpB;;AAEA;EACE,aAAa;EACb,gBAAgB;AAClB;;AAEA;;;EAGE,iBAAiB;AACnB;;AAEA;EACE,+BAA+B;AACjC;;AAEA;;EAEE,SAAS;EACT,kBAAkB;AACpB;;AAEA;EACE,mBAAmB;EACnB,eAAe;EACf,mBAAmB;AACrB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,gBAAgB;EAChB,6CAA6C;AAC/C;;AAEA;EACE,mCAAmC;AACrC;;AAEA;;;EAGE,SAAS;AACX;;AAEA;EACE,WAAW;EACX,aAAa;EACb,8BAA8B;AAChC;;AAEA;EACE,YAAY;EACZ,kBAAkB;AACpB;;AAEA;EACE,gBAAgB;EAChB,kBAAkB;EAClB,QAAQ;AACV;;AAEA;EACE,eAAe;AACjB;;AAEA;EACE,kBAAkB;EAClB,QAAQ;AACV;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,gBAAgB;EAChB,mBAAmB;AACrB;;AAEA;EACE,8BAA8B;AAChC;;AAEA;EACE,2BAA2B;AAC7B;;AAEA;EACE,4BAA4B;AAC9B;;AAEA;EACE,6BAA6B;AAC/B;;AAEA;EACE,iBAAiB;AACnB;;AAEA;EACE,8BAA8B;AAChC;;AAEA;EACE,UAAU;AACZ;;AAEA;EACE,QAAQ;AACV;;AAEA;EACE,mCAAmC;EACnC,wCAAwC;EACxC,YAAY;AACd;;AAEA;EACE,mCAAmC;AACrC;;AAEA;EACE,mCAAmC;AACrC;;AAEA;EACE,qBAAqB;EACrB,cAAc;AAChB\",\"sourcesContent\":[\".lsp-popover {\\n  /* jupyterlab Menu */\\n  z-index: 10000;\\n  padding: 4px 0px;\\n  background: var(--jp-layout-color0);\\n  color: var(--jp-ui-font-color1);\\n  border: var(--jp-border-width) solid var(--jp-border-color1);\\n  font-size: var(--jp-ui-font-size1);\\n  box-shadow: var(--jp-elevation-z6);\\n}\\n\\n.lsp-popover-content {\\n  padding: 5px 10px;\\n}\\n\\n.lsp-servers-title {\\n  margin-bottom: 5px;\\n}\\n\\n.lsp-servers-menu {\\n  height: 350px;\\n  overflow-y: auto;\\n}\\n\\n.lsp-server-status,\\n.lsp-missing-server,\\n.lsp-documents-by-language {\\n  margin-left: 20px;\\n}\\n\\nh5 .lsp-language-server-name {\\n  color: var(--jp-ui-font-color2);\\n}\\n\\n.lsp-documents-by-language ul,\\n.lsp-server-status ul {\\n  margin: 0;\\n  padding-left: 25px;\\n}\\n\\n.lsp-servers-menu h5 {\\n  font-weight: normal;\\n  font-size: 100%;\\n  white-space: nowrap;\\n}\\n\\n.lsp-servers-lists {\\n  margin-left: 5px;\\n}\\n\\n.lsp-popover-status {\\n  padding-top: 5px;\\n  border-top: 1px solid var(--jp-border-color1);\\n}\\n\\n.lsp-popover-status a {\\n  color: var(--jp-content-link-color);\\n}\\n\\n.lsp-servers-menu h3,\\nh4,\\nh5 {\\n  margin: 0;\\n}\\n\\n.lsp-documents-by-language li {\\n  width: 100%;\\n  display: flex;\\n  justify-content: space-between;\\n}\\n\\n.lsp-document-status {\\n  float: right;\\n  padding-left: 15px;\\n}\\n\\n.lsp-document-status-icon {\\n  margin-left: 5px;\\n  position: relative;\\n  top: 3px;\\n}\\n\\n.lsp-collapsible-list h4 {\\n  cursor: pointer;\\n}\\n\\n.lsp-collapsible-list .lsp-caret-icon {\\n  position: relative;\\n  top: 3px;\\n}\\n\\n.lsp-collapsible-list.lsp-collapsed div {\\n  display: none;\\n}\\n\\n.lsp-statusbar-item {\\n  overflow: hidden;\\n  white-space: nowrap;\\n}\\n\\n.lsp-status-icon.ready svg g {\\n  fill: var(--jp-success-color0);\\n}\\n\\n.lsp-status-icon.preparing svg g {\\n  fill: var(--jp-warn-color0);\\n}\\n\\n.lsp-status-icon.error svg g {\\n  fill: var(--jp-error-color0);\\n}\\n\\n.lsp-status-icon.inactive svg g {\\n  fill: var(--jp-layout-color3);\\n}\\n\\n.lsp-status-message {\\n  user-select: none;\\n}\\n\\nbody[data-jp-theme-light='false'] .lsp-status-icon.ready svg g {\\n  fill: var(--jp-success-color1);\\n}\\n\\n.lsp-statusbar-item.jp-mod-clicked .jp-icon-selectable[fill] {\\n  fill: #fff;\\n}\\n\\n.jp-ToolbarButton .lsp-status-icon svg {\\n  top: 5px;\\n}\\n\\n.lsp-help-button {\\n  background: var(--jp-layout-color2);\\n  border: 1px solid var(--jp-brand-color0);\\n  float: right;\\n}\\n\\n.lsp-help-button:hover {\\n  background: var(--jp-layout-color3);\\n}\\n\\n.lsp-server-links-list a {\\n  color: var(--jp-content-link-color);\\n}\\n\\n.lsp-troubleshoot-section {\\n  white-space: pre-wrap;\\n  margin: 10px 0;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.lsp-tooltip .jp-RenderedHTMLCommon {\n  /* Reduce the default padding from 20px to 0px */\n  padding-right: 0px;\n}\n\n.lsp-tooltip .jp-RenderedHTMLCommon > *:last-child {\n  /* Reduce the default margin */\n  margin-bottom: 0;\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./style/tooltip.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,gDAAgD;EAChD,kBAAkB;AACpB;;AAEA;EACE,8BAA8B;EAC9B,gBAAgB;AAClB\",\"sourcesContent\":[\".lsp-tooltip .jp-RenderedHTMLCommon {\\n  /* Reduce the default padding from 20px to 0px */\\n  padding-right: 0px;\\n}\\n\\n.lsp-tooltip .jp-RenderedHTMLCommon > *:last-child {\\n  /* Reduce the default margin */\\n  margin-bottom: 0;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `:root {\n  /* highlight */\n  --jp-editor-mirror-lsp-highlight-background-color: color-mix(\n    in srgb,\n    var(--jp-layout-color3) 25%,\n    transparent\n  );\n  --jp-editor-mirror-lsp-highlight-border-color: var(--jp-layout-color3);\n  /* diagnostics */\n  --jp-editor-mirror-lsp-diagnostic-decoration-style: dashed;\n  --jp-editor-mirror-lsp-diagnostic-error-decoration-color: var(\n    --jp-error-color1\n  );\n  --jp-editor-mirror-lsp-diagnostic-warning-decoration-color: var(\n    --jp-warn-color1\n  );\n  --jp-editor-mirror-lsp-diagnostic-information-decoration-color: var(\n    --jp-info-color1\n  );\n  --jp-editor-mirror-lsp-diagnostic-hint-decoration-color: var(\n    --jp-success-color1\n  );\n  /* hover */\n  --jp-editor-mirror-lsp-hover-decoration-style: dotted;\n  --jp-editor-mirror-lsp-hover-decoration-color: var(--jp-brand-color1);\n  /* signature */\n  --jp-lsp-signature-mark-color: black;\n  --jp-lsp-signature-mark-background: yellow;\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./style/variables/base.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,cAAc;EACd;;;;GAIC;EACD,sEAAsE;EACtE,gBAAgB;EAChB,0DAA0D;EAC1D;;GAEC;EACD;;GAEC;EACD;;GAEC;EACD;;GAEC;EACD,UAAU;EACV,qDAAqD;EACrD,qEAAqE;EACrE,cAAc;EACd,oCAAoC;EACpC,0CAA0C;AAC5C\",\"sourcesContent\":[\":root {\\n  /* highlight */\\n  --jp-editor-mirror-lsp-highlight-background-color: color-mix(\\n    in srgb,\\n    var(--jp-layout-color3) 25%,\\n    transparent\\n  );\\n  --jp-editor-mirror-lsp-highlight-border-color: var(--jp-layout-color3);\\n  /* diagnostics */\\n  --jp-editor-mirror-lsp-diagnostic-decoration-style: dashed;\\n  --jp-editor-mirror-lsp-diagnostic-error-decoration-color: var(\\n    --jp-error-color1\\n  );\\n  --jp-editor-mirror-lsp-diagnostic-warning-decoration-color: var(\\n    --jp-warn-color1\\n  );\\n  --jp-editor-mirror-lsp-diagnostic-information-decoration-color: var(\\n    --jp-info-color1\\n  );\\n  --jp-editor-mirror-lsp-diagnostic-hint-decoration-color: var(\\n    --jp-success-color1\\n  );\\n  /* hover */\\n  --jp-editor-mirror-lsp-hover-decoration-style: dotted;\\n  --jp-editor-mirror-lsp-hover-decoration-color: var(--jp-brand-color1);\\n  /* signature */\\n  --jp-lsp-signature-mark-color: black;\\n  --jp-lsp-signature-mark-background: yellow;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.cm-s-abcdef {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(144, 199, 255, 0.2);\n}\n\n.cm-s-base16-dark {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-base16-light {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(186, 192, 161, 0.1);\n}\n\n.cm-s-default {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-hopscotch {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(207, 18, 255, 0.2);\n}\n\n.cm-s-material {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 255, 58, 0.2);\n}\n\n.cm-s-mbo {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-material {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-mdn-like {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-seti {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n\n.cm-s-solarized {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-the-matrix {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.1);\n}\n\n.cm-s-xq-light {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n\n.cm-s-zenburn {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./style/variables/cm-themes.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,2EAA2E;AAC7E;;AAEA;EACE,2EAA2E;AAC7E;;AAEA;EACE,2EAA2E;AAC7E;;AAEA;EACE,yEAAyE;AAC3E;;AAEA;EACE,0EAA0E;AAC5E;;AAEA;EACE,yEAAyE;AAC3E;;AAEA;EACE,2EAA2E;AAC7E;;AAEA;EACE,2EAA2E;AAC7E;;AAEA;EACE,yEAAyE;AAC3E;;AAEA;EACE,2EAA2E;AAC7E;;AAEA;EACE,yEAAyE;AAC3E;;AAEA;EACE,2EAA2E;AAC7E;;AAEA;EACE,yEAAyE;AAC3E;;AAEA;EACE,2EAA2E;AAC7E\",\"sourcesContent\":[\".cm-s-abcdef {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(144, 199, 255, 0.2);\\n}\\n\\n.cm-s-base16-dark {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\\n}\\n\\n.cm-s-base16-light {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(186, 192, 161, 0.1);\\n}\\n\\n.cm-s-default {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\\n}\\n\\n.cm-s-hopscotch {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(207, 18, 255, 0.2);\\n}\\n\\n.cm-s-material {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 255, 58, 0.2);\\n}\\n\\n.cm-s-mbo {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\\n}\\n\\n.cm-s-material {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\\n}\\n\\n.cm-s-mdn-like {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\\n}\\n\\n.cm-s-seti {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\\n}\\n\\n.cm-s-solarized {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\\n}\\n\\n.cm-s-the-matrix {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.1);\\n}\\n\\n.cm-s-xq-light {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\\n}\\n\\n.cm-s-zenburn {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(239, 231, 171, 0.2);\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `body[data-jp-theme-light='false'] .cm-s-jupyter {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(151, 173, 255, 0.3);\n}\n\nbody[data-jp-theme-light='false'] {\n  --jp-lsp-signature-mark-color: white;\n  --jp-lsp-signature-mark-background: #607e01;\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./style/variables/jupyterlab-dark.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,2EAA2E;AAC7E;;AAEA;EACE,oCAAoC;EACpC,2CAA2C;AAC7C\",\"sourcesContent\":[\"body[data-jp-theme-light='false'] .cm-s-jupyter {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(151, 173, 255, 0.3);\\n}\\n\\nbody[data-jp-theme-light='false'] {\\n  --jp-lsp-signature-mark-color: white;\\n  --jp-lsp-signature-mark-background: #607e01;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `body[data-jp-theme-light='true'] .cm-s-jupyter {\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\n}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./style/variables/jupyterlab-light.css\"],\"names\":[],\"mappings\":\"AAAA;EACE,yEAAyE;AAC3E\",\"sourcesContent\":[\"body[data-jp-theme-light='true'] .cm-s-jupyter {\\n  --jp-editor-mirror-lsp-highlight-background-color: rgba(18, 69, 255, 0.1);\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","import { Token } from '@lumino/coreutils';\n\nimport { LanguageServer1 as LSPLanguageServerSettings } from './_plugin';\nimport * as SCHEMA from './_schema';\n\nexport type TLanguageId = string;\n\n/**\n * Example server keys==ids that are expected. The list is not exhaustive.\n * Custom server keys are allowed. Constraining the values helps avoid errors,\n * but at runtime any value is allowed.\n */\nexport type TLanguageServerId =\n  | 'pylsp'\n  | 'bash-language-server'\n  | 'dockerfile-language-server-nodejs'\n  | 'javascript-typescript-langserver'\n  | 'unified-language-server'\n  | 'vscode-css-languageserver-bin'\n  | 'vscode-html-languageserver-bin'\n  | 'vscode-json-languageserver-bin'\n  | 'yaml-language-server'\n  | 'r-languageserver';\nexport type TServerKeys = TLanguageServerId;\n\nexport type TLanguageServerSpec = SCHEMA.LanguageServerSpec;\nexport type TSessionMap = Map<TServerKeys, SCHEMA.LanguageServerSession>;\nexport type TSpecsMap = Map<TServerKeys, SCHEMA.LanguageServerSpec>;\n\nexport type TLanguageServerConfigurations = Partial<\n  Record<TServerKeys, LSPLanguageServerSettings>\n>;\n\nexport interface ILogConsoleCore {\n  debug(...args: any[]): void;\n  log(...args: any[]): void;\n  warn(...args: any[]): void;\n  error(...args: any[]): void;\n}\n\nexport interface ILSPLogConsole extends ILogConsoleCore {\n  scope(scope: string): ILSPLogConsole;\n}\n\nexport const PLUGIN_ID = '@jupyter-lsp/jupyterlab-lsp';\n\nexport const ILSPLogConsole = new Token<ILSPLogConsole>(\n  PLUGIN_ID + ':ILSPLogConsole'\n);\n","import { CodeEditor } from '@jupyterlab/codeeditor';\nimport {\n  positionAtOffset,\n  IExtractedCode,\n  IForeignCodeExtractor\n} from '@jupyterlab/lsp';\n\nimport { replacer } from '../overrides/tokens';\n\nexport function getIndexOfCaptureGroup(\n  expression: RegExp,\n  matchedString: string,\n  valueOfCapturedGroup: string\n): number {\n  // TODO: use https://github.com/tc39/proposal-regexp-match-indices once supported in >95% of browsers\n  //  (probably around 2025)\n\n  // get index of the part that is being extracted to foreign document\n  let capturedGroups = expression.exec(matchedString);\n\n  if (capturedGroups == null) {\n    console.warn(\n      `No capture group found for ${expression} in ${matchedString}`\n    );\n    return -1;\n  }\n\n  let offsetInMatch = 0;\n\n  // first element is a full match\n  let fullMatched = capturedGroups[0];\n\n  for (let group of capturedGroups.slice(1)) {\n    if (typeof group === 'undefined') {\n      continue;\n    }\n\n    if (group === valueOfCapturedGroup) {\n      offsetInMatch += fullMatched.indexOf(group);\n      break;\n    }\n\n    let groupEndOffset = fullMatched.indexOf(group) + group.length;\n\n    fullMatched = fullMatched.slice(groupEndOffset);\n    offsetInMatch += groupEndOffset;\n  }\n\n  return offsetInMatch;\n}\n\nexport class RegExpForeignCodeExtractor implements IForeignCodeExtractor {\n  options: RegExpForeignCodeExtractor.IOptions;\n  language: string;\n  globalExpression: RegExp;\n  testExpression: RegExp;\n  expression: RegExp;\n  standalone: boolean;\n  fileExtension: string;\n  cellType: string[] = ['code'];\n\n  constructor(options: RegExpForeignCodeExtractor.IOptions) {\n    this.language = options.language;\n    this.options = options;\n    this.globalExpression = new RegExp(options.pattern, 'g');\n    this.testExpression = new RegExp(options.pattern, 'g');\n    this.expression = new RegExp(options.pattern);\n    this.standalone = this.options.isStandalone;\n    this.fileExtension = this.options.fileExtension;\n  }\n\n  hasForeignCode(code: string): boolean {\n    const result = this.testExpression.test(code);\n    this.testExpression.lastIndex = 0;\n    return result;\n  }\n\n  extractForeignCode(code: string): IExtractedCode[] {\n    const lines = code.split('\\n');\n\n    const extracts = new Array<IExtractedCode>();\n\n    let startedFrom = this.globalExpression.lastIndex;\n    let match: RegExpExecArray | null = this.globalExpression.exec(code);\n    let hostCodeFragment: string;\n\n    let chosenReplacer: string | replacer;\n    let isNewApiReplacer: boolean = false;\n\n    if (typeof this.options.foreignReplacer !== 'undefined') {\n      chosenReplacer = this.options.foreignReplacer;\n      isNewApiReplacer = true;\n    } else if (typeof this.options.foreignCaptureGroups !== 'undefined') {\n      chosenReplacer = '$' + this.options.foreignCaptureGroups.join('$');\n      isNewApiReplacer = true;\n    } else if (this.options.extractToForeign) {\n      chosenReplacer = this.options.extractToForeign;\n    } else {\n      console.warn(\n        `Foreign replacer not defined for extractor: {this.expression} - this is deprecated; use 'foreignReplacer' to define it`\n      );\n      return [];\n    }\n\n    while (match != null) {\n      let matchedString = match[0];\n      let positionShift: CodeEditor.IPosition | null = null;\n\n      let foreignCodeFragment = matchedString.replace(\n        this.expression,\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        chosenReplacer\n      );\n      let prefix = '';\n      if (typeof this.options.extractArguments !== 'undefined') {\n        prefix = matchedString.replace(\n          this.expression,\n          // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n          // @ts-ignore\n          this.options.extractArguments\n        );\n        positionShift = positionAtOffset(prefix.length, prefix.split('\\n'));\n      }\n\n      // NOTE:\n      // match.index + matchedString.length === this.sticky_expression.lastIndex\n\n      let endIndex = this.globalExpression.lastIndex;\n\n      if (this.options.keepInHost || this.options.keepInHost == null) {\n        hostCodeFragment = code.substring(startedFrom, endIndex);\n      } else {\n        if (startedFrom === match.index) {\n          hostCodeFragment = '';\n        } else {\n          hostCodeFragment = code.substring(startedFrom, match.index) + '\\n';\n        }\n      }\n\n      let foreignCodeGroupValue = foreignCodeFragment;\n\n      if (isNewApiReplacer) {\n        foreignCodeGroupValue = matchedString.replace(\n          this.expression,\n          '$' + Math.min(...this.options.foreignCaptureGroups!)\n        );\n      }\n\n      const foreignGroupIndexInMatch = getIndexOfCaptureGroup(\n        this.expression,\n        matchedString,\n        foreignCodeGroupValue\n      );\n\n      let startOffset = match.index + foreignGroupIndexInMatch;\n\n      let start = positionAtOffset(startOffset, lines);\n      let end = positionAtOffset(\n        startOffset + foreignCodeFragment.length,\n        lines\n      );\n\n      extracts.push({\n        hostCode: hostCodeFragment,\n        foreignCode: prefix + foreignCodeFragment,\n        range: { start, end },\n        virtualShift: positionShift\n      });\n\n      startedFrom = this.globalExpression.lastIndex;\n      match = this.globalExpression.exec(code);\n    }\n\n    if (startedFrom !== code.length) {\n      let finalHostCodeFragment = code.substring(startedFrom, code.length);\n      extracts.push({\n        hostCode: finalHostCodeFragment,\n        foreignCode: null,\n        range: null,\n        virtualShift: null\n      });\n    }\n\n    return extracts;\n  }\n}\n\nnamespace RegExpForeignCodeExtractor {\n  export interface IOptions {\n    /**\n     * The foreign language.\n     */\n    language: string;\n    /**\n     * String giving regular expression to test cells for the foreign language presence.\n     *\n     * For example:\n     *   - `%%R( (.*))?\\n(.*)` will match R cells of rpy2\n     *   - `(.*)'<html>(.*)</html>'(.*)` will match html documents in strings of any language using single ticks\n     */\n    pattern: string;\n    /**\n     * Array of numbers specifying match groups to be extracted from the regular expression match,\n     * for the use in virtual document of the foreign language.\n     * For the R example this should be `3`. Please not that these are 1-based, as the 0th index is the full match.\n     * If multiple groups are given, those will be concatenated.\n     *\n     * If additional code is needed in between the groups, use `foreignReplacer` in addition to\n     * `foreignCaptureGroups` (but not instead!).\n     *\n     * `foreignCaptureGroups` is required for proper offset calculation and will no longer be optional in 4.0.\n     */\n    foreignCaptureGroups?: number[];\n    /**\n     * Function to compose the foreign document code, in case if using a capture group alone is not sufficient;\n     * If specified, `foreign_capture_group` should be specified as well, so that it points to the first occurrence\n     * of the foreign code. When both are specified, `foreignReplacer` takes precedence.\n     *\n     * See:\n     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace#specifying_a_function_as_a_parameter\n     */\n    foreignReplacer?: replacer;\n    /**\n     * @deprecated `extractToForeign` will be removed in 4.0; use `foreign_capture_group` or `foreignReplacer` instead\n     */\n    extractToForeign?: string | replacer;\n    /**\n     * If arguments from the cell or line magic are to be extracted and prepended before the extracted code,\n     * set extractArguments to a replacer function taking the code and returning the string to be prepended.\n     */\n    extractArguments?: replacer;\n    /**\n     * Boolean if everything (true, default) or nothing (false) should be kept in the host document.\n     *\n     * For the R example this should be empty if we wish to ignore the cell,\n     * but usually a better option is to retain the foreign code and use language\n     * specific overrides to suppress the magic in a more controlled way, providing\n     * dummy python code to handle cell input/output.\n     *\n     * Setting to false is DEPRECATED as it breaks the edit feature (while it could be fixed,\n     * it would make the code considerably more complex).\n     *\n     * @deprecated `keepInHost` will be removed in 4.0\n     */\n    keepInHost?: boolean;\n    /**\n     * Should the foreign code be appended (False) to the previously established virtual document of the same language,\n     * or is it standalone snippet which requires separate connection?\n     */\n    isStandalone: boolean;\n    fileExtension: string;\n  }\n}\n","import { Token } from '@lumino/coreutils';\n\nimport { LanguageIdentifier } from '../lsp';\nimport { PLUGIN_ID } from '../tokens';\n\nexport type replacer = (...args: string[]) => string;\n\nexport type OverrideScope =\n  | /**\n   * Overrides for kernel-specific constructs contained to a single cell, such as cell magics in IPython.\n   * If a match for expresion in the key is found at the beginning of a cell, the entire cell is replaced with the value.\n   */\n  'cell'\n  /**\n   * Overrides for kernel-specific constructs contained to a single line, such as line magics in IPython.\n   * If a match for expresion in the key is found against a line, the line is replaced with the value.\n   */\n  | 'line';\n\n/**\n * The expressions will be tested in the order of definition\n */\nexport interface ICodeOverride {\n  pattern: string;\n  replacement: string | replacer;\n  reverse?: this;\n}\n\nexport interface ICodeOverridesRegistry {\n  [language: string]: {\n    cell: ICodeOverride[];\n    line: ICodeOverride[];\n  };\n}\n\nexport interface IScopedCodeOverride extends ICodeOverride {\n  scope: OverrideScope;\n}\n\n/**\n * Interactive kernels often provide additional functionality invoked by so-called magics,\n * which use distinctive syntax. This features may however not be interpreted correctly by\n * the general purpose language linters. To avoid false-positives making the linter useless\n * for any specific language when magics are used, regular expressions can be used to replace\n * the magics with linter-friendly substitutes; this will be made user configurable.\n */\nexport interface ILSPCodeOverridesManager {\n  readonly registry: ICodeOverridesRegistry;\n  /**\n   * Register a code override to replace code fragments in documents of specified language.\n   */\n  register(override: IScopedCodeOverride, language: LanguageIdentifier): void;\n}\n\nexport const ILSPCodeOverridesManager = new Token<ILSPCodeOverridesManager>(\n  PLUGIN_ID + ':ILSPCodeOverridesManager'\n);\n","\n      import API from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../node_modules/css-loader/dist/cjs.js!./index.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../node_modules/css-loader/dist/cjs.js!./index.css\";\n       export default content && content.locals ? content.locals : undefined;\n","import { ICodeOverride, replacer } from './tokens';\n\nabstract class OverridesMap extends Map<RegExp, string | replacer> {\n  protected constructor(magicOverrides: ICodeOverride[]) {\n    super(magicOverrides.map(m => [new RegExp(m.pattern), m.replacement]));\n  }\n\n  abstract overrideFor(code: string): string | null;\n\n  protected _overrideFor(code: string): string | null {\n    for (let [key, value] of this) {\n      if (code.match(key)) {\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        return code.replace(key, value);\n      }\n    }\n    return null;\n  }\n}\n\nexport class ReversibleOverridesMap extends OverridesMap {\n  private overrides: ICodeOverride[];\n\n  constructor(magicOverrides: ICodeOverride[]) {\n    super(magicOverrides);\n    this.overrides = magicOverrides;\n  }\n\n  get reverse(): OverridesMap {\n    return this.type(\n      this.overrides\n        .filter(override => override.reverse != null)\n        .map(override => override.reverse!)\n    );\n  }\n\n  type(overrides: ICodeOverride[]) {\n    return new ReversibleOverridesMap(overrides);\n  }\n\n  overrideFor(cell: string): string | null {\n    return super._overrideFor(cell);\n  }\n\n  replaceAll(\n    rawLines: string[],\n    map: OverridesMap = this\n  ): { lines: string[]; skipInspect: boolean[] } {\n    let substitutedLines = new Array<string>();\n    let skipInspect = new Array<boolean>();\n\n    for (let i = 0; i < rawLines.length; i++) {\n      let line = rawLines[i];\n      let override = map.overrideFor(line);\n      substitutedLines.push(override == null ? line : override);\n      skipInspect.push(override != null);\n    }\n    return {\n      lines: substitutedLines,\n      skipInspect: skipInspect\n    };\n  }\n\n  reverseReplaceAll(rawLines: string[]): string[] {\n    return this.replaceAll(rawLines, this.reverse).lines;\n  }\n}\n","// TODO: develop a better API upstream\nimport { CodeEditor } from '@jupyterlab/codeeditor';\nimport type {\n  IVirtualPosition,\n  IRootPosition,\n  Document,\n  ForeignDocumentsMap\n} from '@jupyterlab/lsp';\nimport { VirtualDocument as VirtualDocumentBase } from '@jupyterlab/lsp';\n\nimport { ReversibleOverridesMap } from '../overrides/maps';\nimport { ICodeOverridesRegistry } from '../overrides/tokens';\n\nexport namespace VirtualDocument {\n  export interface IOptions extends VirtualDocumentBase.IOptions {\n    overridesRegistry: ICodeOverridesRegistry;\n  }\n}\n\nexport class VirtualDocument extends VirtualDocumentBase {\n  private cellMagicsOverrides: ReversibleOverridesMap;\n  private lineMagicsOverrides: ReversibleOverridesMap;\n\n  constructor(options: VirtualDocument.IOptions) {\n    super(options);\n    const overrides =\n      this.language in options.overridesRegistry\n        ? options.overridesRegistry[this.language]\n        : null;\n    this.cellMagicsOverrides = new ReversibleOverridesMap(\n      overrides ? overrides.cell : []\n    );\n    this.lineMagicsOverrides = new ReversibleOverridesMap(\n      overrides ? overrides.line : []\n    );\n  }\n\n  // TODO: this could be moved out\n  decodeCodeBlock(rawCode: string): string {\n    // TODO: add back previously extracted foreign code\n    const cellOverride = this.cellMagicsOverrides.reverse.overrideFor(rawCode);\n    if (cellOverride != null) {\n      return cellOverride;\n    } else {\n      let lines = this.lineMagicsOverrides.reverseReplaceAll(\n        rawCode.split('\\n')\n      );\n      return lines.join('\\n');\n    }\n  }\n\n  /**\n   * Extends parent method to hook cell magics overrides.\n   */\n  prepareCodeBlock(\n    block: Document.ICodeBlockOptions,\n    editorShift: CodeEditor.IPosition = { line: 0, column: 0 }\n  ) {\n    let lines: Array<string>;\n    let skipInspect: Array<Array<VirtualDocumentBase.idPath>>;\n\n    let { cellCodeKept, foreignDocumentsMap } = this.extractForeignCode(\n      block,\n      editorShift\n    );\n    const cellCode = cellCodeKept;\n\n    // cell magics are replaced if requested and matched\n    const cellOverride = this.cellMagicsOverrides.overrideFor(cellCode);\n    if (cellOverride != null) {\n      lines = cellOverride.split('\\n');\n      skipInspect = lines.map(_line => [this.idPath]);\n    } else {\n      // otherwise, we replace line magics - if any\n      let result = this.lineMagicsOverrides.replaceAll(cellCode.split('\\n'));\n      lines = result.lines;\n      skipInspect = result.skipInspect.map(skip => (skip ? [this.idPath] : []));\n    }\n\n    return { lines, foreignDocumentsMap, skipInspect };\n  }\n\n  appendCodeBlock(\n    block: Document.ICodeBlockOptions,\n    editorShift: CodeEditor.IPosition = { line: 0, column: 0 },\n    virtualShift?: CodeEditor.IPosition\n  ): void {\n    let cellCode = block.value;\n    let ceEditor = block.ceEditor;\n\n    if (this.isDisposed) {\n      console.warn('Cannot append code block: document disposed');\n      return;\n    }\n    let sourceCellLines = cellCode.split('\\n');\n    let { lines, foreignDocumentsMap, skipInspect } = this.prepareCodeBlock(\n      block,\n      editorShift\n    );\n\n    for (let i = 0; i < lines.length; i++) {\n      this.virtualLines.set(this.lastVirtualLine + i, {\n        skipInspect: skipInspect[i],\n        editor: ceEditor,\n        // TODO this is incorrect, wont work if something was extracted\n        sourceLine: this.lastSourceLine + i\n      });\n    }\n    for (let i = 0; i < sourceCellLines.length; i++) {\n      this.sourceLines.set(this.lastSourceLine + i, {\n        editorLine: i,\n        editorShift: {\n          line: editorShift.line - (virtualShift?.line || 0),\n          column: i === 0 ? editorShift.column - (virtualShift?.column || 0) : 0\n        },\n        // TODO: move those to a new abstraction layer (DocumentBlock class)\n        editor: ceEditor,\n        foreignDocumentsMap,\n        // TODO this is incorrect, wont work if something was extracted\n        virtualLine: this.lastVirtualLine + i\n      });\n    }\n\n    this.lastVirtualLine += lines.length;\n\n    // one empty line is necessary to separate code blocks, next 'n' lines are to silence linters;\n    // the final cell does not get the additional lines (thanks to the use of join, see below)\n\n    this.lineBlocks.push(lines.join('\\n') + '\\n');\n\n    // adding the virtual lines for the blank lines\n    for (let i = 0; i < this.blankLinesBetweenCells; i++) {\n      this.virtualLines.set(this.lastVirtualLine + i, {\n        skipInspect: [this.idPath],\n        editor: ceEditor,\n        sourceLine: null\n      });\n    }\n\n    this.lastVirtualLine += this.blankLinesBetweenCells;\n    this.lastSourceLine += sourceCellLines.length;\n  }\n\n  /**\n   * @experimental\n   */\n  transformVirtualToRoot(position: IVirtualPosition): IRootPosition | null {\n    let editor = this.virtualLines.get(position.line)!.editor;\n    let editorPosition = this.transformVirtualToEditor(position);\n    // only root holds the full editor mapping\n    return this.root.transformFromEditorToRoot(editor, editorPosition!);\n  }\n\n  /**\n   * @experimental\n   */\n  getForeignDocuments(editorAccessor: Document.IEditor): ForeignDocumentsMap[] {\n    let maps = new Set<ForeignDocumentsMap>();\n    for (let line of this.sourceLines.values()) {\n      if (line.editor === editorAccessor) {\n        maps.add(line.foreignDocumentsMap);\n      }\n    }\n    return [...maps.values()];\n  }\n}\n","import {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\nimport { IDocumentWidget } from '@jupyterlab/docregistry';\nimport {\n  FileEditorAdapter as UpstreamFileEditorAdapter,\n  FileEditor,\n  IFileEditorAdapterOptions,\n  IEditorTracker\n} from '@jupyterlab/fileeditor';\nimport {\n  ILSPCodeExtractorsManager,\n  ILSPFeatureManager,\n  ILSPDocumentConnectionManager,\n  IEditorChangedData\n} from '@jupyterlab/lsp';\n\nimport { ILSPCodeOverridesManager } from '../overrides/tokens';\nimport { VirtualDocument } from '../virtual/document';\n\ninterface IAdapterOptions extends IFileEditorAdapterOptions {\n  codeOverridesManager: ILSPCodeOverridesManager;\n}\n\nexport class FileEditorAdapter extends UpstreamFileEditorAdapter {\n  constructor(\n    public editorWidget: IDocumentWidget<FileEditor>,\n    protected options: IAdapterOptions\n  ) {\n    super(editorWidget, options);\n    // Workaround to ensure `_editorAdded` is not called twice once upstream\n    // adopts patch https://github.com/jupyterlab/jupyterlab/pull/15873\n    let emitted = false;\n    const emit = this._editorAdded.emit;\n    this._editorAdded.emit = (args: IEditorChangedData) => {\n      if (emitted) {\n        return;\n      }\n      emitted = true;\n      emit.call(this._editorAdded, args);\n    };\n  }\n\n  protected async initOnceReady(): Promise<void> {\n    await super.initOnceReady();\n    // Workaround for\n    // https://github.com/jupyterlab/jupyterlab/issues/15868\n    // remove once fixed upstream\n    this._editorAdded.emit({\n      editor: this.activeEditor\n    });\n  }\n\n  /**\n   * Generate the virtual document associated with the document.\n   */\n  createVirtualDocument(): VirtualDocument {\n    return new VirtualDocument({\n      language: this.language,\n      foreignCodeExtractors: this.options.foreignCodeExtractorsManager,\n      path: this.documentPath,\n      fileExtension: this.languageFileExtension,\n      // notebooks are continuous, each cell is dependent on the previous one\n      standalone: true,\n      // notebooks are not supported by LSP servers\n      hasLspSupportedFile: true,\n      overridesRegistry: this.options.codeOverridesManager.registry\n    });\n  }\n}\n\n/**\n * Activate the language server for file editor.\n */\nfunction activateFileEditorLanguageServer(\n  app: JupyterFrontEnd,\n  editors: IEditorTracker,\n  connectionManager: ILSPDocumentConnectionManager,\n  featureManager: ILSPFeatureManager,\n  extractorManager: ILSPCodeExtractorsManager,\n  codeOverridesManager: ILSPCodeOverridesManager\n): void {\n  editors.widgetAdded.connect(async (_, editor) => {\n    const adapter = new FileEditorAdapter(editor, {\n      connectionManager,\n      featureManager,\n      foreignCodeExtractorsManager: extractorManager,\n      docRegistry: app.docRegistry,\n      codeOverridesManager\n    });\n    connectionManager.registerAdapter(editor.context.path, adapter);\n  });\n}\n\nexport const FILEEDITOR_ADAPTER_PLUGIN: JupyterFrontEndPlugin<void> = {\n  id: '@jupyter-lsp/fileeditor-adapter',\n  description: 'Adds language server capability to the notebooks.',\n  requires: [\n    IEditorTracker,\n    ILSPDocumentConnectionManager,\n    ILSPFeatureManager,\n    ILSPCodeExtractorsManager,\n    ILSPCodeOverridesManager\n  ],\n  activate: activateFileEditorLanguageServer,\n  autoStart: true\n};\n","import {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\nimport {\n  IAdapterOptions as IUpstreamIAdapterOptions,\n  ILSPCodeExtractorsManager,\n  ILSPFeatureManager,\n  ILSPDocumentConnectionManager,\n  Document\n} from '@jupyterlab/lsp';\nimport {\n  NotebookAdapter as UpstreamNotebookAdapter,\n  INotebookTracker,\n  NotebookPanel\n} from '@jupyterlab/notebook';\n\nimport { ILSPCodeOverridesManager } from '../overrides/tokens';\nimport { VirtualDocument } from '../virtual/document';\n\ninterface IAdapterOptions extends IUpstreamIAdapterOptions {\n  codeOverridesManager: ILSPCodeOverridesManager;\n}\n\nexport class NotebookAdapter extends UpstreamNotebookAdapter {\n  constructor(\n    public editorWidget: NotebookPanel,\n    protected options: IAdapterOptions\n  ) {\n    super(editorWidget, options);\n  }\n\n  /**\n   * Generate the virtual document associated with the document.\n   */\n  createVirtualDocument(): VirtualDocument {\n    return new VirtualDocument({\n      language: this.language,\n      foreignCodeExtractors: this.options.foreignCodeExtractorsManager,\n      path: this.documentPath,\n      fileExtension: this.languageFileExtension,\n      // notebooks are continuous, each cell is dependent on the previous one\n      standalone: false,\n      // notebooks are not supported by LSP servers\n      hasLspSupportedFile: false,\n      overridesRegistry: this.options.codeOverridesManager.registry\n    });\n  }\n\n  protected async onForeignDocumentOpened(\n    virtualDocument: VirtualDocument,\n    context: Document.IForeignContext\n  ): Promise<void> {\n    /*\n    Opening a standalone foreign document can result in an infinite loop,\n    as a new connection gets opened for these, and once that is ready\n    `updateDocuments()` gets called.\n\n    To avoid the problem, `updateDocuments()` gets suppressed for standalone\n    documents. It does not affect non-standalone documents, because no new\n    connection gets opened for these.\n\n    https://github.com/jupyter-lsp/jupyterlab-lsp/issues/959\n    */\n    try {\n      this._blockUpdates = true;\n      await super.onForeignDocumentOpened(virtualDocument, context);\n    } finally {\n      this._blockUpdates = false;\n    }\n  }\n\n  updateDocuments(): Promise<void> {\n    if (this._blockUpdates) {\n      return Promise.resolve();\n    }\n    return super.updateDocuments();\n  }\n  private _blockUpdates = false;\n}\n\n/**\n * Activate the language server for notebook.\n */\nfunction activateNotebookLanguageServer(\n  app: JupyterFrontEnd,\n  notebooks: INotebookTracker,\n  connectionManager: ILSPDocumentConnectionManager,\n  featureManager: ILSPFeatureManager,\n  codeExtractorManager: ILSPCodeExtractorsManager,\n  codeOverridesManager: ILSPCodeOverridesManager\n): void {\n  notebooks.widgetAdded.connect(async (_, notebook) => {\n    const adapter = new NotebookAdapter(notebook, {\n      connectionManager,\n      featureManager,\n      foreignCodeExtractorsManager: codeExtractorManager,\n      codeOverridesManager\n    });\n    connectionManager.registerAdapter(notebook.context.path, adapter);\n  });\n}\n\nexport const NOTEBOOK_ADAPTER_PLUGIN: JupyterFrontEndPlugin<void> = {\n  id: '@jupyter-lsp/notebook-adapter',\n  description: 'Adds language server capability to the notebooks.',\n  requires: [\n    INotebookTracker,\n    ILSPDocumentConnectionManager,\n    ILSPFeatureManager,\n    ILSPCodeExtractorsManager,\n    ILSPCodeOverridesManager\n  ],\n  activate: activateNotebookLanguageServer,\n  autoStart: true\n};\n","\n      import API from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../node_modules/css-loader/dist/cjs.js!./statusbar.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../node_modules/css-loader/dist/cjs.js!./statusbar.css\";\n       export default content && content.locals ? content.locals : undefined;\n","import React from 'react';\n\nfunction externalLink(url: string, label: string) {\n  return (\n    <a\n      href={url}\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      className=\"lsp-external-link\"\n    >\n      {label}\n    </a>\n  );\n}\n\nconst migrationGuideUrl =\n  'https://jupyter-server.readthedocs.io/en/latest/operators/migrate-from-nbserver.html';\nconst jupyterHubMigrationUrl =\n  'https://github.com/jupyterhub/jupyterhub/pull/3329/files';\n\nexport const SERVER_EXTENSION_404 = (\n  <div>\n    <p>\n      It appears that the required Jupyter server extension (\n      <code>jupyter-lsp</code>) is not installed (or not enabled) in this\n      environment.\n    </p>\n    <h3>What are the likely reasons?</h3>\n    <ul>\n      <li>\n        It might be that you just installed it and need to restart JupyterLab to\n        make it available on startup.\n      </li>\n      <li>\n        Alternatively, you may be using an older <code>notebook</code> server\n        instead of the new <code>jupyter_server</code>; please refer to the{' '}\n        {externalLink(migrationGuideUrl, 'migration guide')} or if you are a\n        JupyterHub user please ensure that you start the JupyterLab using{' '}\n        <code>jupyter_server</code> and not the old <code>notebook</code>, as\n        documented in{' '}\n        {externalLink(jupyterHubMigrationUrl, 'this pull request')}.\n      </li>\n      <li>\n        There may be schema errors or language server errors preventing the\n        extension from loading - please check the logs of JupyterLab (in the\n        console where you execute <code>jupyter lab</code>\n      </li>\n    </ul>\n    <h3>How do I check if the extension is installed?</h3>\n    <p>\n      Please ensure that <code>jupyter server extension list</code> includes\n      jupyter-lsp and that it is enabled. If it is enabled please try to restart\n      JupyterLab. If the server extension is installed but not enabled and all\n      other suggestions listed above failed try the following:\n      <code>jupyter server extension enable --user --py jupyter_lsp</code>\n    </p>\n  </div>\n);\n","import { LabIcon } from '@jupyterlab/ui-components';\n\nimport codeCheckSvg from '../../style/icons/code-check.svg';\nimport codeClock from '../../style/icons/code-clock.svg';\nimport codeWarning from '../../style/icons/code-warning.svg';\n\nexport const codeWarningIcon = new LabIcon({\n  name: 'lsp:codeWarning',\n  svgstr: codeWarning\n});\nexport const codeClockIcon = new LabIcon({\n  name: 'lsp:codeClock',\n  svgstr: codeClock\n});\n\nexport const codeCheckIcon = new LabIcon({\n  name: 'lsp:codeCheck',\n  svgstr: codeCheckSvg\n});\n","import { IDocumentWidget } from '@jupyterlab/docregistry';\nimport { VirtualDocument, WidgetLSPAdapter, Document } from '@jupyterlab/lsp';\nimport { nullTranslator, TranslationBundle } from '@jupyterlab/translation';\nimport React from 'react';\n\nimport { TLanguageServerSpec } from '../tokens';\n\nexport function getBreadcrumbs(\n  document: VirtualDocument,\n  adapter: WidgetLSPAdapter<IDocumentWidget>,\n  trans?: TranslationBundle,\n  collapse = true\n): JSX.Element[] {\n  if (!trans) {\n    trans = nullTranslator.load('');\n  }\n  return document.ancestry.map((document: VirtualDocument) => {\n    if (!document.parent) {\n      let path = document.path;\n      if (\n        !document.hasLspSupportedFile &&\n        document.fileExtension &&\n        path.endsWith(document.fileExtension)\n      ) {\n        path = path.slice(0, -document.fileExtension.length - 1);\n      }\n      const fullPath = path;\n      if (collapse) {\n        let parts = path.split('/');\n        if (parts.length > 2) {\n          path = parts[0] + '/.../' + parts[parts.length - 1];\n        }\n      }\n      return (\n        <span key={document.uri} title={fullPath}>\n          {path}\n        </span>\n      );\n    }\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    const virtualLines = document.virtualLines;\n\n    if (!virtualLines.size) {\n      return <span key={document.uri}>Empty document</span>;\n    }\n    try {\n      if (adapter.hasMultipleEditors) {\n        let firstLine = virtualLines.get(0)!;\n        let lastLine = virtualLines.get(document.lastVirtualLine - 1)!;\n\n        let firstCell = adapter.getEditorIndex(firstLine.editor);\n        let lastCell = adapter.getEditorIndex(lastLine.editor);\n\n        let cellLocator =\n          firstCell === lastCell\n            ? trans!.__('cell %1', firstCell + 1)\n            : trans!.__('cells: %1-%2', firstCell + 1, lastCell + 1);\n\n        return (\n          <span key={document.uri}>\n            {document.language} ({cellLocator})\n          </span>\n        );\n      }\n    } catch (e) {\n      console.warn('LSP: could not display document cell location', e);\n    }\n    return <span key={document.uri}>{document.language}</span>;\n  });\n}\n\nasync function focusEditor(accessor: Document.IEditor) {\n  if (!accessor) {\n    return;\n  }\n  await accessor.reveal();\n  const editor = accessor.getEditor();\n  editor!.focus();\n}\n\nexport function DocumentLocator(props: {\n  document: VirtualDocument;\n  adapter: WidgetLSPAdapter<any>;\n  trans?: TranslationBundle;\n}) {\n  let { document, adapter } = props;\n  let target: Document.IEditor | null = null;\n  if (adapter.hasMultipleEditors) {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    let firstLine = document.virtualLines.get(0);\n    if (firstLine) {\n      target = firstLine.editor;\n    } else {\n      console.warn('Could not get first line of ', document);\n    }\n  }\n  let breadcrumbs = getBreadcrumbs(document, adapter, props.trans);\n  return (\n    <div\n      className={'lsp-document-locator'}\n      onClick={() => (target ? focusEditor(target) : null)}\n    >\n      {breadcrumbs}\n    </div>\n  );\n}\n\nexport function ServerLinksList(props: { specification: TLanguageServerSpec }) {\n  return (\n    <ul className={'lsp-server-links-list'}>\n      {Object.entries(props.specification?.urls || {}).map(([name, url]) => (\n        <li key={props.specification.serverId + '-url-' + name}>\n          {name}:{' '}\n          <a href={url} target=\"_blank\" rel=\"noreferrer\">\n            {url}\n          </a>\n        </li>\n      ))}\n    </ul>\n  );\n}\n","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\n// Based on the @jupyterlab/codemirror-extension statusbar\n\nimport { JupyterFrontEnd } from '@jupyterlab/application';\nimport {\n  VDomModel,\n  VDomRenderer,\n  Dialog,\n  showDialog\n} from '@jupyterlab/apputils';\nimport { DocumentRegistry, IDocumentWidget } from '@jupyterlab/docregistry';\nimport {\n  ILSPConnection,\n  collectDocuments,\n  ILSPDocumentConnectionManager,\n  VirtualDocument,\n  WidgetLSPAdapter,\n  ILanguageServerManager\n} from '@jupyterlab/lsp';\nimport { INotebookModel, NotebookPanel } from '@jupyterlab/notebook';\nimport { GroupItem, Popup, TextItem, showPopup } from '@jupyterlab/statusbar';\nimport { TranslationBundle } from '@jupyterlab/translation';\nimport {\n  LabIcon,\n  caretDownIcon,\n  caretUpIcon,\n  circleEmptyIcon,\n  circleIcon,\n  stopIcon\n} from '@jupyterlab/ui-components';\nimport React from 'react';\n\nimport '../../style/statusbar.css';\nimport * as SCHEMA from '../_schema';\nimport { SERVER_EXTENSION_404 } from '../errors';\nimport { TSessionMap, TLanguageServerId, TSpecsMap } from '../tokens';\n\nimport { codeCheckIcon, codeClockIcon, codeWarningIcon } from './icons';\nimport { DocumentLocator, ServerLinksList } from './utils';\n\nimport okButton = Dialog.okButton;\n\ninterface IServerStatusProps {\n  server: SCHEMA.LanguageServerSession;\n}\n\nfunction ServerStatus(props: IServerStatusProps) {\n  let list = props.server.spec.languages!.map((language, i) => (\n    <li key={i}>{language}</li>\n  ));\n  return (\n    <div className={'lsp-server-status'}>\n      <h5>{props.server.spec.display_name}</h5>\n      <ul>{list}</ul>\n    </div>\n  );\n}\n\nexport interface IListProps {\n  /**\n   * A title to display.\n   */\n  title: string;\n  list: any[];\n  /**\n   * By default the list will be expanded; to change the initial state to collapsed, set to true.\n   */\n  startCollapsed?: boolean;\n}\n\nexport interface ICollapsibleListStates {\n  isCollapsed: boolean;\n}\n\nclass CollapsibleList extends React.Component<\n  IListProps,\n  ICollapsibleListStates\n> {\n  constructor(props: IListProps) {\n    super(props);\n    this.state = { isCollapsed: props.startCollapsed || false };\n  }\n\n  handleClick = () => {\n    this.setState(state => ({\n      isCollapsed: !state.isCollapsed\n    }));\n  };\n\n  render() {\n    const collapseExpandIcon = !this.state.isCollapsed\n      ? caretUpIcon\n      : caretDownIcon;\n    return (\n      <div\n        className={\n          'lsp-collapsible-list ' +\n          (this.state.isCollapsed ? 'lsp-collapsed' : '')\n        }\n      >\n        <h4 onClick={this.handleClick}>\n          <collapseExpandIcon.react tag=\"span\" className=\"lsp-caret-icon\" />\n          {this.props.title}: {this.props.list.length}\n        </h4>\n        <div>{this.props.list}</div>\n      </div>\n    );\n  }\n}\n\ninterface IHelpButtonProps {\n  language: string;\n  servers: TSpecsMap;\n  trans: TranslationBundle;\n}\n\ninterface ILanguageServerInfo {\n  serverId: TLanguageServerId;\n  specs: SCHEMA.LanguageServerSpec;\n  trans: TranslationBundle;\n}\n\nclass LanguageServerInfo extends React.Component<ILanguageServerInfo, any> {\n  render() {\n    const specification = this.props.specs;\n    const trans = this.props.trans;\n    return (\n      <div>\n        <h3>{specification.display_name}</h3>\n        <div>\n          <ServerLinksList specification={specification} />\n          <h4>{trans.__('Troubleshooting')}</h4>\n          <p className={'lsp-troubleshoot-section'}>\n            {specification.troubleshoot\n              ? specification.troubleshoot\n              : trans.__(\n                  'In case of issues with installation feel welcome to ask a question on GitHub.'\n                )}\n          </p>\n          <h4>{trans.__('Installation')}</h4>\n          <ul>\n            {specification?.install\n              ? Object.entries(specification?.install || {}).map(\n                  ([name, command]) => (\n                    <li key={this.props.serverId + '-install-' + name}>\n                      {name}: <code>{command}</code>\n                    </li>\n                  )\n                )\n              : trans.__(\n                  'No installation instructions were provided with this specification.'\n                )}\n          </ul>\n        </div>\n      </div>\n    );\n  }\n}\n\nclass HelpButton extends React.Component<IHelpButtonProps, any> {\n  handleClick = () => {\n    const trans = this.props.trans;\n\n    showDialog({\n      title: trans.__(\n        'No language server for %1 detected',\n        this.props.language\n      ),\n      body: (\n        <div>\n          {this.props.servers.size ? (\n            <div>\n              <p>\n                {trans._n(\n                  'There is %1 language server you can easily install that supports %2.',\n                  'There are %1 language servers you can easily install that supports %2.',\n                  this.props.servers.size,\n                  this.props.language\n                )}\n              </p>\n              {[...this.props.servers.entries()].map(([key, specification]) => (\n                <LanguageServerInfo\n                  specs={specification}\n                  serverId={key}\n                  key={key}\n                  trans={trans}\n                />\n              ))}\n            </div>\n          ) : (\n            <div>\n              <p>\n                {trans.__(\n                  'We do not have an auto-detection ready for a language servers supporting %1 yet.',\n                  this.props.language\n                )}\n              </p>\n              <p>\n                {trans.__(\n                  'You may contribute a specification for auto-detection as described in our '\n                )}{' '}\n                <a\n                  href={\n                    'https://jupyterlab-lsp.readthedocs.io/en/latest/Contributing.html#specs'\n                  }\n                >\n                  {trans.__('documentation')}\n                </a>\n              </p>\n            </div>\n          )}\n        </div>\n      ),\n      buttons: [okButton()]\n    }).catch(console.warn);\n  };\n\n  render() {\n    return (\n      <button\n        type={'button'}\n        className={'jp-Button lsp-help-button'}\n        onClick={this.handleClick}\n      >\n        ?\n      </button>\n    );\n  }\n}\n\nclass LSPPopup extends VDomRenderer<LSPStatus.Model> {\n  constructor(model: LSPStatus.Model) {\n    super(model);\n    this.addClass('lsp-popover');\n  }\n  render() {\n    if (!this.model?.connectionManager) {\n      return null;\n    }\n    const serversAvailable = this.model.serversAvailableNotInUse.map(\n      (session, i) => <ServerStatus key={i} server={session} />\n    );\n\n    let runningServers = new Array<any>();\n    let key = -1;\n    for (let [\n      session,\n      documentsByLanguage\n    ] of this.model.documentsByServer.entries()) {\n      key += 1;\n      let documentsHtml = new Array<any>();\n      for (let [language, documents] of documentsByLanguage) {\n        // TODO: stop button\n        // TODO: add a config buttons next to the language header\n        let list = documents.map((document, i) => {\n          let connection = this.model.connectionManager.connections.get(\n            document.uri\n          );\n\n          let status = '';\n          if (connection?.isInitialized) {\n            status = 'initialized';\n          } else if (connection?.isConnected) {\n            status = 'connected';\n          } else {\n            status = 'not connected';\n          }\n\n          const icon = status === 'initialized' ? circleIcon : circleEmptyIcon;\n\n          return (\n            <li key={i}>\n              <DocumentLocator\n                document={document}\n                adapter={this.model.adapter!}\n              />\n              <span className={'lsp-document-status'}>\n                {this.model.trans.__(status)}\n                <icon.react\n                  tag=\"span\"\n                  className=\"lsp-document-status-icon\"\n                  elementSize={'small'}\n                />\n              </span>\n            </li>\n          );\n        });\n\n        documentsHtml.push(\n          <div key={key} className={'lsp-documents-by-language'}>\n            <h5>\n              {language}{' '}\n              <span className={'lsp-language-server-name'}>\n                ({session.spec.display_name})\n              </span>\n            </h5>\n            <ul>{list}</ul>\n          </div>\n        );\n      }\n\n      runningServers.push(<div key={key}>{documentsHtml}</div>);\n    }\n\n    const missingLanguages = this.model.missingLanguages.map((language, i) => {\n      const specsForMissing = this.model.languageServerManager.getMatchingSpecs(\n        { language }\n      );\n      return (\n        <div key={i} className={'lsp-missing-server'}>\n          {language}\n          {specsForMissing.size ? (\n            <HelpButton\n              language={language}\n              servers={specsForMissing}\n              trans={this.model.trans}\n            />\n          ) : (\n            ''\n          )}\n        </div>\n      );\n    });\n    const trans = this.model.trans;\n    return (\n      <div className={'lsp-popover-content'}>\n        <div className={'lsp-servers-menu'}>\n          <h3 className={'lsp-servers-title'}>{trans.__('LSP servers')}</h3>\n          <div className={'lsp-servers-lists'}>\n            {serversAvailable.length ? (\n              <CollapsibleList\n                key={'available'}\n                title={trans.__('Available')}\n                list={serversAvailable}\n                startCollapsed={true}\n              />\n            ) : (\n              ''\n            )}\n            {runningServers.length ? (\n              <CollapsibleList\n                key={'running'}\n                title={trans.__('Running')}\n                list={runningServers}\n              />\n            ) : (\n              ''\n            )}\n            {missingLanguages.length ? (\n              <CollapsibleList\n                key={'missing'}\n                title={trans.__('Missing')}\n                list={missingLanguages}\n              />\n            ) : (\n              ''\n            )}\n          </div>\n        </div>\n        <div className={'lsp-popover-status'}>\n          {trans.__('Documentation:')}{' '}\n          <a\n            href={\n              'https://jupyterlab-lsp.readthedocs.io/en/latest/Language%20Servers.html'\n            }\n            target=\"_blank\"\n            rel=\"noreferrer\"\n          >\n            {trans.__('Language Servers')}\n          </a>\n        </div>\n      </div>\n    );\n  }\n}\n\n/**\n * StatusBar item.\n */\nexport class LSPStatus extends VDomRenderer<LSPStatus.Model> {\n  protected _popup: Popup | null = null;\n  private trans: TranslationBundle;\n  /**\n   * Construct a new VDomRenderer for the status item.\n   */\n  constructor(\n    protected displayText: boolean = true,\n    shell: JupyterFrontEnd.IShell,\n    trans: TranslationBundle\n  ) {\n    super(new LSPStatus.Model(shell, trans));\n    this.addClass('jp-mod-highlighted');\n    this.addClass('lsp-statusbar-item');\n    this.trans = trans;\n    this.title.caption = this.trans.__('LSP status');\n  }\n\n  /**\n   * Render the status item.\n   */\n  render() {\n    const { model } = this;\n\n    if (model == null) {\n      return null;\n    }\n\n    return (\n      <GroupItem\n        spacing={this.displayText ? 2 : 0}\n        title={model.longMessage}\n        onClick={this.handleClick}\n        className={'lsp-status-group'}\n      >\n        <model.statusIcon.react\n          top={'2px'}\n          stylesheet={'statusBar'}\n          title={this.trans.__('LSP Code Intelligence')}\n        />\n        {this.displayText ? (\n          <TextItem\n            className={'lsp-status-message'}\n            source={model.shortMessage}\n          />\n        ) : (\n          <></>\n        )}\n      </GroupItem>\n    );\n  }\n\n  handleClick = () => {\n    if (this._popup) {\n      this._popup.dispose();\n    }\n    if (this.model.status.status == 'noServerExtension') {\n      showDialog({\n        title: this.trans.__('LSP server extension not found'),\n        body: SERVER_EXTENSION_404,\n        buttons: [okButton()]\n      }).catch(console.warn);\n    } else {\n      this._popup = showPopup({\n        body: new LSPPopup(this.model),\n        anchor: this,\n        align: 'left',\n        hasDynamicSize: true\n      });\n    }\n  };\n}\n\nexport class StatusButtonExtension\n  implements DocumentRegistry.IWidgetExtension<NotebookPanel, INotebookModel>\n{\n  constructor(\n    private options: {\n      languageServerManager: ILanguageServerManager;\n      connectionManager: ILSPDocumentConnectionManager;\n      shell: JupyterFrontEnd.IShell;\n      translatorBundle: TranslationBundle;\n    }\n  ) {}\n\n  /**\n   * For statusbar registration and for internal use.\n   */\n  createItem(displayText: boolean = true): LSPStatus {\n    const statusBarItem = new LSPStatus(\n      displayText,\n      this.options.shell,\n      this.options.translatorBundle\n    );\n    statusBarItem.model.languageServerManager =\n      this.options.languageServerManager;\n    statusBarItem.model.connectionManager = this.options.connectionManager;\n    return statusBarItem;\n  }\n\n  /**\n   * For registration on notebook panels.\n   */\n  createNew(\n    panel: NotebookPanel,\n    context: DocumentRegistry.IContext<INotebookModel>\n  ): LSPStatus {\n    const item = this.createItem(false);\n    item.addClass('jp-ToolbarButton');\n    panel.toolbar.insertAfter('spacer', 'LSPStatus', item);\n\n    return item;\n  }\n}\n\ntype StatusCode =\n  | 'noServerExtension'\n  | 'waiting'\n  | 'initializing'\n  | 'initialized'\n  | 'connecting'\n  | 'initializedButSomeMissing';\n\nexport interface IStatus {\n  connectedDocuments: Set<VirtualDocument>;\n  initializedDocuments: Set<VirtualDocument>;\n  openConnections: Array<ILSPConnection>;\n  detectedDocuments: Set<VirtualDocument>;\n  status: StatusCode;\n}\n\nfunction collectLanguages(virtualDocument: VirtualDocument): Set<string> {\n  let documents = collectDocuments(virtualDocument);\n  return new Set(\n    [...documents].map(document => document.language.toLocaleLowerCase())\n  );\n}\n\ntype StatusMap = Record<StatusCode, string>;\ntype StatusIconClass = Record<StatusCode, string>;\n\nconst classByStatus: StatusIconClass = {\n  noServerExtension: 'error',\n  waiting: 'inactive',\n  initialized: 'ready',\n  initializing: 'preparing',\n  initializedButSomeMissing: 'ready',\n  connecting: 'preparing'\n};\n\nconst iconByStatus: Record<StatusCode, LabIcon> = {\n  noServerExtension: codeWarningIcon,\n  waiting: codeClockIcon,\n  initialized: codeCheckIcon,\n  initializing: codeClockIcon,\n  initializedButSomeMissing: codeWarningIcon,\n  connecting: codeClockIcon\n};\n\nexport namespace LSPStatus {\n  /**\n   * A VDomModel for the LSP of current file editor/notebook.\n   */\n  export class Model extends VDomModel {\n    languageServerManager: ILanguageServerManager;\n    trans: TranslationBundle;\n    private _connectionManager: ILSPDocumentConnectionManager;\n    private _shortMessageByStatus: StatusMap;\n\n    constructor(\n      private _shell: JupyterFrontEnd.IShell,\n      trans: TranslationBundle\n    ) {\n      super();\n      this.trans = trans;\n      this._shortMessageByStatus = {\n        noServerExtension: trans.__('Server extension missing'),\n        waiting: trans.__('Waiting…'),\n        initialized: trans.__('Fully initialized'),\n        initializedButSomeMissing: trans.__(\n          'Initialized (additional servers needed)'\n        ),\n        initializing: trans.__('Initializing…'),\n        connecting: trans.__('Connecting…')\n      };\n    }\n\n    get availableServers(): TSessionMap {\n      return this.languageServerManager.sessions;\n    }\n\n    get supportedLanguages(): Set<string> {\n      const languages = new Set<string>();\n      for (let server of this.availableServers.values()) {\n        for (let language of server.spec.languages!) {\n          languages.add(language.toLocaleLowerCase());\n        }\n      }\n      return languages;\n    }\n\n    private _isServerRunning(\n      id: TLanguageServerId,\n      server: SCHEMA.LanguageServerSession\n    ): boolean {\n      for (const language of this.detectedLanguages) {\n        const matchedServers = this.languageServerManager.getMatchingServers({\n          language\n        });\n        // TODO server.status === \"started\" ?\n        // TODO update once multiple servers are allowed\n        if (matchedServers.length && matchedServers[0] === id) {\n          return true;\n        }\n      }\n      return false;\n    }\n\n    get documentsByServer(): Map<\n      SCHEMA.LanguageServerSession,\n      Map<string, VirtualDocument[]>\n    > {\n      let data = new Map<\n        SCHEMA.LanguageServerSession,\n        Map<string, VirtualDocument[]>\n      >();\n      if (!this.adapter?.virtualDocument) {\n        return data;\n      }\n\n      let mainDocument = this.adapter.virtualDocument;\n      let documents = collectDocuments(mainDocument);\n\n      for (let document of documents.values()) {\n        let language = document.language.toLocaleLowerCase();\n        let serverIds =\n          this._connectionManager.languageServerManager.getMatchingServers({\n            language: document.language\n          });\n        if (serverIds.length === 0) {\n          continue;\n        }\n        // For now only use the server with the highest priority\n        let server = this.languageServerManager.sessions.get(serverIds[0])!;\n\n        if (!data.has(server)) {\n          data.set(server, new Map<string, VirtualDocument[]>());\n        }\n\n        let documentsMap = data.get(server)!;\n\n        if (!documentsMap.has(language)) {\n          documentsMap.set(language, new Array<VirtualDocument>());\n        }\n\n        let documents = documentsMap.get(language)!;\n        documents.push(document);\n      }\n      return data;\n    }\n\n    get serversAvailableNotInUse(): Array<SCHEMA.LanguageServerSession> {\n      return [...this.availableServers.entries()]\n        .filter(([id, server]) => !this._isServerRunning(id, server))\n        .map(([id, server]) => server);\n    }\n\n    get detectedLanguages(): Set<string> {\n      if (!this.adapter?.virtualDocument) {\n        return new Set<string>();\n      }\n\n      let document = this.adapter.virtualDocument;\n      return collectLanguages(document);\n    }\n\n    get missingLanguages(): Array<string> {\n      // TODO: false negative for r vs R?\n      return [...this.detectedLanguages].filter(\n        language => !this.supportedLanguages.has(language.toLocaleLowerCase())\n      );\n    }\n\n    get status(): IStatus {\n      let detectedDocuments: Map<string, VirtualDocument>;\n\n      if (!this.adapter?.virtualDocument) {\n        detectedDocuments = new Map();\n      } else {\n        let mainDocument = this.adapter.virtualDocument;\n        const allDocuments = this._connectionManager.documents;\n        // detected documents that are open in the current virtual editor\n        const detectedDocumentsSet = collectDocuments(mainDocument);\n        detectedDocuments = new Map(\n          [...allDocuments].filter(([id, doc]) => detectedDocumentsSet.has(doc))\n        );\n      }\n\n      let connectedDocuments = new Set<VirtualDocument>();\n      let initializedDocuments = new Set<VirtualDocument>();\n      let absentDocuments = new Set<VirtualDocument>();\n      // detected documents with LSP servers available\n      let documentsWithAvailableServers = new Set<VirtualDocument>();\n      // detected documents with LSP servers known\n      let documentsWithKnownServers = new Set<VirtualDocument>();\n\n      detectedDocuments.forEach((document, uri) => {\n        let connection = this._connectionManager.connections.get(uri);\n        let serverIds =\n          this._connectionManager.languageServerManager.getMatchingServers({\n            language: document.language\n          });\n\n        if (serverIds.length !== 0) {\n          documentsWithKnownServers.add(document);\n        }\n        if (!connection) {\n          absentDocuments.add(document);\n          return;\n        } else {\n          documentsWithAvailableServers.add(document);\n        }\n\n        if (connection.isConnected) {\n          connectedDocuments.add(document);\n        }\n        if (connection.isInitialized) {\n          initializedDocuments.add(document);\n        }\n      });\n\n      // there may be more open connections than documents if a document was recently closed\n      // and the grace period has not passed yet\n      let openConnections = new Array<ILSPConnection>();\n      this._connectionManager.connections.forEach((connection, path) => {\n        if (connection.isConnected) {\n          openConnections.push(connection);\n        }\n      });\n\n      let status: StatusCode;\n      if (this.languageServerManager.statusCode === 404) {\n        status = 'noServerExtension';\n      } else if (detectedDocuments.size === 0) {\n        status = 'waiting';\n      } else if (initializedDocuments.size === detectedDocuments.size) {\n        status = 'initialized';\n      } else if (\n        initializedDocuments.size === documentsWithAvailableServers.size &&\n        detectedDocuments.size > documentsWithKnownServers.size\n      ) {\n        status = 'initializedButSomeMissing';\n      } else if (\n        connectedDocuments.size === documentsWithAvailableServers.size\n      ) {\n        status = 'initializing';\n      } else {\n        status = 'connecting';\n      }\n\n      return {\n        openConnections,\n        connectedDocuments,\n        initializedDocuments,\n        detectedDocuments: new Set([...detectedDocuments.values()]),\n        status\n      };\n    }\n\n    get statusIcon(): LabIcon {\n      if (!this.adapter) {\n        return stopIcon;\n      }\n      return iconByStatus[this.status.status].bindprops({\n        className: 'lsp-status-icon ' + classByStatus[this.status.status]\n      });\n    }\n\n    get shortMessage(): string {\n      if (!this.adapter) {\n        return this.trans.__('Not initialized');\n      }\n      return this._shortMessageByStatus[this.status.status];\n    }\n\n    get longMessage(): string {\n      if (!this.adapter) {\n        return this.trans.__('not initialized');\n      }\n      let status = this.status;\n      let msg = '';\n      if (status.status === 'waiting') {\n        msg = this.trans.__('Waiting for documents initialization...');\n      } else if (status.status === 'initialized') {\n        msg = this.trans._n(\n          'Fully connected & initialized (%2 virtual document)',\n          'Fully connected & initialized (%2 virtual document)',\n          status.detectedDocuments.size,\n          status.detectedDocuments.size\n        );\n      } else if (status.status === 'initializing') {\n        const uninitialized = new Set<VirtualDocument>(\n          status.detectedDocuments\n        );\n        for (let initialized of status.initializedDocuments.values()) {\n          uninitialized.delete(initialized);\n        }\n        // servers for n documents did not respond to the initialization request\n        msg = this.trans._np(\n          'pluralized',\n          'Fully connected, but %2/%3 virtual document stuck uninitialized: %4',\n          'Fully connected, but %2/%3 virtual documents stuck uninitialized: %4',\n          status.detectedDocuments.size,\n          uninitialized.size,\n          status.detectedDocuments.size,\n          [...uninitialized].map(document => document.idPath).join(', ')\n        );\n      } else {\n        const unconnected = new Set<VirtualDocument>(status.detectedDocuments);\n        for (let connected of status.connectedDocuments.values()) {\n          unconnected.delete(connected);\n        }\n\n        msg = this.trans._np(\n          'pluralized',\n          '%2/%3 virtual document connected (%4 connections; waiting for: %5)',\n          '%2/%3 virtual documents connected (%4 connections; waiting for: %5)',\n          status.detectedDocuments.size,\n          status.connectedDocuments.size,\n          status.detectedDocuments.size,\n          status.openConnections.length,\n          [...unconnected].map(document => document.idPath).join(', ')\n        );\n      }\n      return msg;\n    }\n\n    get adapter(): WidgetLSPAdapter<IDocumentWidget> | null {\n      const adapter = [...this.connectionManager.adapters.values()].find(\n        adapter => adapter.widget == this._shell.currentWidget\n      );\n      return adapter ?? null;\n    }\n\n    get connectionManager() {\n      return this._connectionManager;\n    }\n\n    /**\n     * Note: it is ever only set once, as connectionManager is a singleton.\n     */\n    set connectionManager(connectionManager) {\n      if (this._connectionManager != null) {\n        this._connectionManager.connected.disconnect(this._onChange);\n        this._connectionManager.initialized.connect(this._onChange);\n        this._connectionManager.disconnected.disconnect(this._onChange);\n        this._connectionManager.closed.disconnect(this._onChange);\n        this._connectionManager.documentsChanged.disconnect(this._onChange);\n      }\n\n      if (connectionManager != null) {\n        connectionManager.connected.connect(this._onChange);\n        connectionManager.initialized.connect(this._onChange);\n        connectionManager.disconnected.connect(this._onChange);\n        connectionManager.closed.connect(this._onChange);\n        connectionManager.documentsChanged.connect(this._onChange);\n      }\n\n      this._connectionManager = connectionManager;\n    }\n\n    private _onChange = () => {\n      this.stateChanged.emit(void 0);\n    };\n  }\n}\n","import type * as lsp from 'vscode-languageserver-protocol';\n\n/** Workaround to silence a bug in https://github.com/microsoft/vscode-languageserver-node/pull/720 */\nexport type ClientCapabilities = Omit<\n  lsp.ClientCapabilities,\n  'textDocument'\n> & { textDocument?: Omit<lsp.TextDocumentClientCapabilities, 'moniker'> };\n\nexport enum DiagnosticSeverity {\n  Error = 1,\n  Warning = 2,\n  Information = 3,\n  Hint = 4\n}\n\nexport enum DiagnosticTag {\n  Unnecessary = 1,\n  Deprecated = 2\n}\n\nexport enum SymbolTag {\n  Deprecated = 1\n}\n\nexport enum CompletionItemTag {\n  Deprecated = 1\n}\n\nexport enum CompletionItemKind {\n  Text = 1,\n  Method = 2,\n  Function = 3,\n  Constructor = 4,\n  Field = 5,\n  Variable = 6,\n  Class = 7,\n  Interface = 8,\n  Module = 9,\n  Property = 10,\n  Unit = 11,\n  Value = 12,\n  Enum = 13,\n  Keyword = 14,\n  Snippet = 15,\n  Color = 16,\n  File = 17,\n  Reference = 18,\n  Folder = 19,\n  EnumMember = 20,\n  Constant = 21,\n  Struct = 22,\n  Event = 23,\n  Operator = 24,\n  TypeParameter = 25\n}\n\nexport enum DocumentHighlightKind {\n  Text = 1,\n  Read = 2,\n  Write = 3\n}\n\nexport enum CompletionTriggerKind {\n  Invoked = 1,\n  TriggerCharacter = 2,\n  TriggerForIncompleteCompletions = 3\n}\n\nexport enum AdditionalCompletionTriggerKinds {\n  AutoInvoked = 9999\n}\n\nexport type ExtendedCompletionTriggerKind =\n  | CompletionTriggerKind\n  | AdditionalCompletionTriggerKinds;\n\nexport type CompletionItemKindStrings = keyof typeof CompletionItemKind;\n\n/**\n * The language identifier for LSP, with the preferred identifier as defined in the documentation\n * see the table in https://microsoft.github.io/language-server-protocol/specification#textDocumentItem\n */\nexport enum Languages {\n  'abap' = 'ABAP',\n  'bat' = 'Windows Bat',\n  'bibtex' = 'BibTeX',\n  'clojure' = 'Clojure',\n  'coffeescript' = 'Coffeescript',\n  'c' = 'C',\n  'cpp' = 'C++',\n  'csharp' = 'C#',\n  'css' = 'CSS',\n  'diff' = 'Diff',\n  'dart' = 'Dart',\n  'dockerfile' = 'Dockerfile',\n  'elixir' = 'Elixir',\n  'erlang' = 'Erlang',\n  'fsharp' = 'F#',\n  'git-commit' = 'Git (commit)',\n  'git-rebase' = 'Git (rebase)',\n  'go' = 'Go',\n  'groovy' = 'Groovy',\n  'handlebars' = 'Handlebars',\n  'html' = 'HTML',\n  'ini' = 'Ini',\n  'java' = 'Java',\n  'javascript' = 'JavaScript',\n  'javascriptreact' = 'JavaScript React',\n  'json' = 'JSON',\n  'latex' = 'LaTeX',\n  'less' = 'Less',\n  'lua' = 'Lua',\n  'makefile' = 'Makefile',\n  'markdown' = 'Markdown',\n  'objective-c' = 'Objective-C',\n  'objective-cpp' = 'Objective-C++',\n  'perl' = 'Perl',\n  'perl6' = 'Perl 6',\n  'php' = 'PHP',\n  'powershell' = 'Powershell',\n  'jade' = 'Pug',\n  'python' = 'Python',\n  'r' = 'R',\n  'razor' = 'Razor (cshtml)',\n  'ruby' = 'Ruby',\n  'rust' = 'Rust',\n  'scss' = 'SCSS (syntax using curly brackets)',\n  'sass' = 'SCSS (indented syntax)',\n  'scala' = 'Scala',\n  'shaderlab' = 'ShaderLab',\n  'shellscript' = 'Shell Script (Bash)',\n  'sql' = 'SQL',\n  'swift' = 'Swift',\n  'typescript' = 'TypeScript',\n  'typescriptreact' = 'TypeScript React',\n  'tex' = 'TeX',\n  'vb' = 'Visual Basic',\n  'xml' = 'XML',\n  'xsl' = 'XSL',\n  'yaml' = 'YAML'\n}\n\nexport type RecommendedLanguageIdentifier = keyof typeof Languages;\n\n/**\n * Language identifier for the LSP server, allowing any string but preferring\n * the identifiers as recommended by the LSP documentation.\n */\nexport type LanguageIdentifier = RecommendedLanguageIdentifier | string;\n","import {\n  IFeature,\n  ILSPDocumentConnectionManager,\n  EditorAdapter\n} from '@jupyterlab/lsp';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { PromiseDelegate } from '@lumino/coreutils';\nimport { Signal } from '@lumino/signaling';\nimport * as lsProtocol from 'vscode-languageserver-protocol';\n\nexport interface IFeatureSettings<T> {\n  readonly composite: Required<T>;\n  readonly changed: Signal<IFeatureSettings<T>, void>;\n  readonly ready?: Promise<void>;\n\n  set(setting: keyof T, value: any): void;\n}\n\nexport namespace Feature {\n  export interface IOptions {\n    connectionManager: ILSPDocumentConnectionManager;\n  }\n}\n\nexport abstract class Feature implements IFeature {\n  /**\n   * The feature identifier. It must be the same as the feature plugin id.\n   */\n  abstract readonly id: string;\n  /**\n   * LSP capabilities implemented by the feature.\n   */\n  abstract readonly capabilities?: lsProtocol.ClientCapabilities;\n\n  /**\n   * Editor extension factory linked to the LSP feature.\n   */\n  extensionFactory?: EditorAdapter.ILSPEditorExtensionFactory = undefined;\n\n  protected connectionManager: ILSPDocumentConnectionManager;\n\n  constructor(options: Feature.IOptions) {\n    this.connectionManager = options.connectionManager;\n  }\n}\n\nexport class FeatureSettings<T> implements IFeatureSettings<T> {\n  protected settings: ISettingRegistry.ISettings;\n  public changed: Signal<FeatureSettings<T>, void>;\n  private _ready = new PromiseDelegate<void>();\n\n  constructor(protected settingRegistry: ISettingRegistry, featureID: string) {\n    this.changed = new Signal(this);\n    if (!(featureID in settingRegistry.plugins)) {\n      this._ready.reject(\n        `${featureID} settings schema could not be found and was not loaded`\n      );\n    } else {\n      settingRegistry\n        .load(featureID)\n        .then(settings => {\n          this.settings = settings;\n          this._ready.resolve(void 0);\n          this.changed.emit();\n          settings.changed.connect(() => {\n            this.settings = settings;\n            this.changed.emit();\n          });\n        })\n        .catch(console.warn);\n    }\n  }\n\n  get ready(): Promise<void> {\n    return this._ready.promise;\n  }\n\n  get composite(): Required<T> {\n    return this.settings.composite as unknown as Required<T>;\n  }\n\n  set(setting: keyof T, value: any) {\n    this.settings.set(setting as string, value).catch(console.warn);\n  }\n}\n","import { CodeEditor } from '@jupyterlab/codeeditor';\nimport type {\n  ISourcePosition,\n  IVirtualPosition,\n  IRootPosition,\n  IPosition,\n  IEditorPosition,\n  WidgetLSPAdapter,\n  Document\n} from '@jupyterlab/lsp';\nimport type * as lsProtocol from 'vscode-languageserver-protocol';\n\nimport { VirtualDocument } from './virtual/document';\n\nexport class PositionConverter {\n  static lsp_to_cm(position: lsProtocol.Position): IPosition {\n    return { line: position.line, ch: position.character };\n  }\n\n  static cm_to_lsp(position: IPosition): lsProtocol.Position {\n    return { line: position.line, character: position.ch };\n  }\n\n  static lsp_to_ce(position: lsProtocol.Position): CodeEditor.IPosition {\n    return { line: position.line, column: position.character };\n  }\n\n  static cm_to_ce(position: IPosition): CodeEditor.IPosition {\n    return { line: position.line, column: position.ch };\n  }\n\n  static ce_to_cm(position: CodeEditor.IPosition): IPosition {\n    return { line: position.line, ch: position.column };\n  }\n}\n\n/** TODO should it be wrapped into an object? Where should these live? */\n\nexport interface IEditorRange {\n  start: IEditorPosition;\n  end: IEditorPosition;\n  editor: CodeEditor.IEditor;\n}\n\nexport function documentAtRootPosition(\n  adapter: WidgetLSPAdapter<any>,\n  position: IRootPosition\n): VirtualDocument {\n  let rootAsSource = position as ISourcePosition;\n  if (!adapter.virtualDocument) {\n    throw Error('Virtual document of adapter disposed!');\n  }\n  if (adapter.virtualDocument.root !== adapter.virtualDocument) {\n    throw Error('Virtual document on adapter must be the root document');\n  }\n  return adapter.virtualDocument.documentAtSourcePosition(\n    rootAsSource\n  ) as VirtualDocument;\n}\n\nexport function editorAtRootPosition(\n  adapter: WidgetLSPAdapter<any>,\n  position: IRootPosition\n): Document.IEditor {\n  let rootAsSource = position as ISourcePosition;\n  if (!adapter.virtualDocument) {\n    throw Error('Virtual document of adapter disposed!');\n  }\n  if (adapter.virtualDocument.root !== adapter.virtualDocument) {\n    throw Error('Virtual document on adapter must be the root document');\n  }\n  return adapter.virtualDocument.getEditorAtSourceLine(rootAsSource);\n}\n\nexport function rootPositionToVirtualPosition(\n  adapter: WidgetLSPAdapter<any>,\n  position: IRootPosition\n): IVirtualPosition {\n  let rootAsSource = position as ISourcePosition;\n  if (!adapter.virtualDocument) {\n    throw Error('Virtual document of adapter disposed!');\n  }\n  if (adapter.virtualDocument.root !== adapter.virtualDocument) {\n    throw Error('Virtual document on adapter must be the root document');\n  }\n  return adapter.virtualDocument!.virtualPositionAtDocument(rootAsSource);\n}\n\nexport function rootPositionToEditorPosition(\n  adapter: WidgetLSPAdapter<any>,\n  position: IRootPosition\n): IEditorPosition {\n  let rootAsSource = position as ISourcePosition;\n  if (!adapter.virtualDocument) {\n    throw Error('Virtual document of adapter disposed!');\n  }\n  if (adapter.virtualDocument.root !== adapter.virtualDocument) {\n    throw Error('Virtual document on adapter must be the root document');\n  }\n  return adapter.virtualDocument.transformSourceToEditor(rootAsSource);\n}\n\nexport function editorPositionToRootPosition(\n  adapter: WidgetLSPAdapter<any>,\n  editor: Document.IEditor,\n  position: IEditorPosition\n): IRootPosition | null {\n  if (!adapter.virtualDocument) {\n    throw Error('Virtual document of adapter disposed!');\n  }\n  return adapter.virtualDocument.transformFromEditorToRoot(editor, position);\n}\n\nexport function rangeToEditorRange(\n  adapter: WidgetLSPAdapter<any>,\n  range: lsProtocol.Range,\n  editor: CodeEditor.IEditor | null,\n  virtualDocument: VirtualDocument\n): IEditorRange {\n  let start = PositionConverter.lsp_to_cm(range.start) as IVirtualPosition;\n  let end = PositionConverter.lsp_to_cm(range.end) as IVirtualPosition;\n\n  // because `openForeign()` does not use new this.constructor, we need to workaround it for now:\n  // const startInRoot = virtualDocument.transformVirtualToRoot(start);\n  // https://github.com/jupyterlab/jupyterlab/issues/15126\n  const startInRoot = VirtualDocument.prototype.transformVirtualToRoot.call(\n    virtualDocument,\n    start\n  );\n\n  if (!startInRoot) {\n    throw Error('Could not determine position in root');\n  }\n\n  if (editor == null) {\n    let editorAccessor = editorAtRootPosition(adapter, startInRoot);\n    const candidate = editorAccessor.getEditor();\n    if (!candidate) {\n      throw Error('Editor could not be accessed');\n    }\n    editor = candidate;\n  }\n\n  const document = documentAtRootPosition(adapter, startInRoot);\n\n  return {\n    start: document.transformVirtualToEditor(start)!,\n    end: document.transformVirtualToEditor(end)!,\n    editor: editor\n  };\n}\n","import {\n  ILSPCompletionThemeManager,\n  KernelKind\n} from '@jupyter-lsp/completion-theme';\nimport {\n  ContextCompleterProvider,\n  KernelCompleterProvider,\n  CompletionHandler,\n  ICompletionContext\n} from '@jupyterlab/completer';\nimport { IDocumentWidget } from '@jupyterlab/docregistry';\nimport {\n  ILSPDocumentConnectionManager,\n  IEditorPosition\n} from '@jupyterlab/lsp';\nimport { LabIcon } from '@jupyterlab/ui-components';\n\nimport { CodeCompletion as LSPCompletionSettings } from '../../_completion';\nimport {\n  editorPositionToRootPosition,\n  PositionConverter,\n  documentAtRootPosition\n} from '../../converter';\nimport { FeatureSettings } from '../../feature';\n\ninterface IOptions {\n  settings: FeatureSettings<LSPCompletionSettings>;\n  iconsThemeManager: ILSPCompletionThemeManager;\n  connectionManager: ILSPDocumentConnectionManager;\n}\n\nexport class EnhancedContextCompleterProvider extends ContextCompleterProvider {\n  readonly label = 'context';\n\n  constructor(protected options: IOptions) {\n    super();\n  }\n\n  async fetch(\n    request: CompletionHandler.IRequest,\n    context: ICompletionContext\n  ): Promise<CompletionHandler.ICompletionItemsReply> {\n    const result = await super.fetch(request, context);\n    result.items = result.items.map((item, order) => {\n      return {\n        ...item,\n        icon: this.iconFor(item.type ?? 'Text') ?? this.iconFor('Text'),\n        type: item.type === '<unknown>' ? undefined : (item.type as string),\n        sortText: String.fromCharCode(order),\n        source: this.label\n      };\n    });\n    return result;\n  }\n\n  protected iconFor(type: string): LabIcon | undefined {\n    const icon = this.options.iconsThemeManager.getIcon(type) as LabIcon | null;\n    return icon ? icon : undefined;\n  }\n}\n\nexport class EnhancedKernelCompleterProvider extends KernelCompleterProvider {\n  readonly label = 'kernel';\n\n  constructor(protected options: IOptions) {\n    super();\n  }\n\n  async fetch(\n    request: CompletionHandler.IRequest,\n    context: ICompletionContext\n  ): Promise<CompletionHandler.ICompletionItemsReply> {\n    const result = await super.fetch(request, context);\n    result.items = result.items.map((item, order) => {\n      return {\n        ...item,\n        icon: this.iconFor(item.type ?? KernelKind) ?? this.iconFor(KernelKind),\n        sortText: String.fromCharCode(order),\n        source: this.label\n      };\n    });\n    return result;\n  }\n\n  async isApplicable(context: ICompletionContext): Promise<boolean> {\n    // Note: this method logs errors instead of throwing to ensure we do not ever\n    // break the upstream kernel completer, even if there is an error elsewhere.\n    const upstream = await super.isApplicable(context);\n\n    if (upstream === false) {\n      return false;\n    }\n\n    const manager = this.options.connectionManager;\n    const widget = context.widget as IDocumentWidget;\n    if (typeof widget.context === 'undefined') {\n      // there is no path for Console as it is not a DocumentWidget\n      return upstream;\n    }\n    const adapter = manager.adapters.get(widget.context.path);\n\n    if (!adapter) {\n      return upstream;\n    }\n\n    if (!context.editor) {\n      // TODO: why is editor optional in the first place?\n      console.error('No editor');\n      return upstream;\n    }\n    const editor = context.editor;\n\n    const editorPosition = PositionConverter.ce_to_cm(\n      editor.getCursorPosition()\n    ) as IEditorPosition;\n\n    const block = adapter.editors.find(\n      value => value.ceEditor.getEditor() == editor\n    );\n\n    if (!block) {\n      console.error('Could not get block with editor');\n      return upstream;\n    }\n    const rootPosition = editorPositionToRootPosition(\n      adapter,\n      block.ceEditor,\n      editorPosition\n    );\n\n    if (!rootPosition) {\n      console.error('Could not get root position');\n      return upstream;\n    }\n    const virtualDocument = documentAtRootPosition(adapter, rootPosition);\n    return virtualDocument === adapter.virtualDocument;\n  }\n\n  protected iconFor(type: string): LabIcon | undefined {\n    const icon = this.options.iconsThemeManager.getIcon(type) as LabIcon | null;\n    return icon ? icon : undefined;\n  }\n}\n","\n      import API from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../node_modules/css-loader/dist/cjs.js!./console.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../node_modules/css-loader/dist/cjs.js!./console.css\";\n       export default content && content.locals ? content.locals : undefined;\n","import '../../style/console.css';\nimport { JupyterFrontEndPlugin } from '@jupyterlab/application';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { Signal } from '@lumino/signaling';\n\nimport {\n  LanguageServers as LSPSettings,\n  LoggingConsoleVerbosityLevel\n} from '../_plugin';\nimport { ILSPLogConsole, ILogConsoleCore, PLUGIN_ID } from '../tokens';\n\ninterface ILogConsoleImplementation extends ILogConsoleCore {\n  dispose(): void;\n  bindThis(): any;\n}\n\nfunction toString(args: any[]): string {\n  return args\n    .map(arg => {\n      let textual: string;\n      if (typeof arg === 'string') {\n        return arg;\n      }\n      try {\n        textual = JSON.stringify({ k: arg }).slice(5, -1);\n      } catch {\n        textual = '' + arg;\n      }\n      return '<span class=\"lsp-code\">' + textual + '</span>';\n    })\n    .join(' ');\n}\n\nclass FloatingConsole implements ILogConsoleImplementation {\n  // likely to be replaced by JupyterLab console: https://github.com/jupyterlab/jupyterlab/pull/6833#issuecomment-543016425\n  private readonly element: HTMLElement;\n\n  constructor(scope: string[] = ['LSP'], element: HTMLElement | null = null) {\n    if (element) {\n      this.element = element;\n    } else {\n      this.element = document.createElement('ul');\n      this.element.className = 'lsp-floating-console';\n      document.body.appendChild(this.element);\n    }\n  }\n\n  bindThis(): any {\n    return this;\n  }\n\n  dispose() {\n    this.element.remove();\n  }\n\n  append(text: string, kind = 'log') {\n    let entry = document.createElement('li');\n    entry.innerHTML = '<span class=\"lsp-kind\">' + kind + '</span>' + text;\n    this.element.appendChild(entry);\n    this.element.scrollTop = this.element.scrollHeight;\n  }\n\n  debug(...args: any[]) {\n    this.append(toString(args), 'debug');\n  }\n  log(...args: any[]) {\n    this.append(toString(args), 'log');\n  }\n  warn(...args: any[]) {\n    this.append(toString(args), 'warn');\n  }\n  error(...args: any[]) {\n    this.append(toString(args), 'error');\n  }\n}\n\n/**\n * Used both as a console implementation, and as a dummy ILSPLogConsole\n */\nexport class BrowserConsole\n  implements ILogConsoleImplementation, ILSPLogConsole\n{\n  debug = window.console.debug.bind(window.console);\n  log = window.console.log.bind(window.console);\n  warn = window.console.warn.bind(window.console);\n  error = window.console.error.bind(window.console);\n\n  dispose(): void {\n    return;\n  }\n  scope(scope: string): BrowserConsole {\n    return this;\n  }\n\n  bindThis(): any {\n    return window.console;\n  }\n}\n\nclass ConsoleWrapper implements ILSPLogConsole {\n  private readonly singleton: ConsoleSingleton;\n  private readonly breadcrumbs: string[];\n  private readonly _scope: string;\n\n  constructor(scope: string[] = ['LSP'], singleton: ConsoleSingleton) {\n    this.breadcrumbs = scope;\n    this._scope = this.breadcrumbs.join('.') + ':';\n    this.singleton = singleton;\n    this.singleton.changed.connect(this._rebindFunctions.bind(this));\n    this._rebindFunctions();\n  }\n\n  /**\n   * Re-binding directly to the underlying functions allows to get nice\n   * location (file:line) of the actual call rather than of this wrapper\n   * when using with the browser implementation.\n   */\n  _rebindFunctions() {\n    const noOp = () => {\n      // do nothing\n    };\n    const bindArg = this.implementation.bindThis();\n\n    if (this.verbosity === 'debug') {\n      this.debug = this.implementation.debug.bind(bindArg, this._scope);\n    } else {\n      this.debug = noOp;\n    }\n\n    if (this.verbosity === 'debug' || this.verbosity === 'log') {\n      this.log = this.implementation.log.bind(bindArg, this._scope);\n    } else {\n      this.log = noOp;\n    }\n\n    if (\n      this.verbosity === 'debug' ||\n      this.verbosity === 'log' ||\n      this.verbosity === 'warn'\n    ) {\n      this.warn = this.implementation.warn.bind(bindArg, this._scope);\n    } else {\n      this.warn = noOp;\n    }\n\n    this.error = this.implementation.error.bind(bindArg, this._scope);\n  }\n\n  get verbosity() {\n    return this.singleton.verbosity;\n  }\n\n  get implementation() {\n    return this.singleton.implementation;\n  }\n\n  debug(...args: any[]) {\n    return this.implementation.debug(this._scope, ...args);\n  }\n  log(...args: any[]) {\n    return this.implementation.log(this._scope, ...args);\n  }\n  warn(...args: any[]) {\n    return this.implementation.warn(this._scope, ...args);\n  }\n  error(...args: any[]) {\n    return this.implementation.error(this._scope, ...args);\n  }\n\n  scope(scope: string): ILSPLogConsole {\n    return new ConsoleWrapper([...this.breadcrumbs, scope], this.singleton);\n  }\n}\n\nclass ConsoleSingleton {\n  public verbosity: LoggingConsoleVerbosityLevel;\n  public implementation: ILogConsoleImplementation;\n  public changed: Signal<ConsoleSingleton, void>;\n\n  constructor(settingRegistry: ISettingRegistry) {\n    // until loaded log everything, to browser console\n    this.verbosity = 'debug';\n    this.implementation = new BrowserConsole();\n    this.changed = new Signal(this);\n\n    settingRegistry\n      .load(PLUGIN_ID + ':plugin')\n      .then(settings => {\n        this.updateSettings(settings);\n        settings.changed.connect(() => {\n          this.updateSettings(settings);\n        });\n      })\n      .catch(console.warn);\n  }\n\n  updateSettings(settings: ISettingRegistry.ISettings) {\n    const composite = settings.composite as LSPSettings;\n    const kind = composite.loggingConsole;\n\n    if (this.implementation) {\n      this.implementation.dispose();\n    }\n\n    if (kind === 'browser') {\n      this.implementation = new BrowserConsole();\n    } else if (kind === 'floating') {\n      this.implementation = new FloatingConsole();\n    } else {\n      console.warn(\n        'Unknown console type',\n        kind,\n        'falling back to browser console'\n      );\n      this.implementation = new BrowserConsole();\n    }\n\n    this.verbosity = composite.loggingLevel!;\n    this.changed.emit();\n  }\n}\n\nexport const LOG_CONSOLE: JupyterFrontEndPlugin<ILSPLogConsole> = {\n  id: PLUGIN_ID + ':ILSPLogConsole',\n  requires: [ISettingRegistry],\n  activate: (app, settingRegistry: ISettingRegistry) => {\n    const singleton = new ConsoleSingleton(settingRegistry);\n    return new ConsoleWrapper(['LSP'], singleton);\n  },\n  provides: ILSPLogConsole,\n  autoStart: true\n};\n","import { CompletionHandler } from '@jupyterlab/completer';\nimport { ILSPConnection } from '@jupyterlab/lsp';\nimport { LabIcon } from '@jupyterlab/ui-components';\nimport * as lsProtocol from 'vscode-languageserver-types';\n\n/**\n * To be upstreamed\n */\nexport interface IExtendedCompletionItem\n  extends CompletionHandler.ICompletionItem {\n  insertText: string;\n  sortText: string;\n  source: string;\n}\n\nnamespace CompletionItem {\n  export interface IOptions {\n    /**\n     * Type of this completion item.\n     */\n    type: string;\n    /**\n     * LabIcon object for icon to be rendered with completion type.\n     */\n    icon: LabIcon | null;\n    match: lsProtocol.CompletionItem;\n    connection: ILSPConnection;\n    source: string;\n  }\n}\n\nexport class CompletionItem implements IExtendedCompletionItem {\n  /**\n   * Self-reference to make sure that the instance for will remain accessible\n   * after any copy operation (whether via spread syntax or Object.assign)\n   * performed by the JupyterLab completer internals.\n   */\n  public self: CompletionItem;\n  public element: HTMLLIElement;\n  public source: string;\n\n  get isDocumentationMarkdown(): boolean {\n    return this._isDocumentationMarkdown;\n  }\n\n  /**\n   * User facing completion.\n   * If insertText is not set, this will be inserted.\n   */\n  public label: string;\n\n  icon: LabIcon | undefined;\n\n  constructor(protected options: CompletionItem.IOptions) {\n    const match = options.match;\n    this.label = match.label;\n    this._setDocumentation(match.documentation);\n    this._resolved = false;\n    this._detail = match.detail;\n    this._match = match;\n    this.self = this;\n    this.source = options.source;\n    this.icon = options.icon ? options.icon : undefined;\n\n    // Upstream is sometimes using spread operator to copy the object (in reconciliator),\n    // which does not copy getters because these are not enumerable; we should use\n    // `Object.assign` upstream, but them, but for now marking relevant properties as enumerable is enough\n    // Ideally this would be fixed and tested e2e in JupyterLab 4.0.7.\n    // https://github.com/jupyterlab/jupyterlab/issues/15125\n    makeGetterEnumerable(this, 'insertText');\n    makeGetterEnumerable(this, 'sortText');\n    makeGetterEnumerable(this, 'filterText');\n  }\n\n  get type() {\n    return this.options.type;\n  }\n\n  /**\n   * Completion to be inserted.\n   */\n  get insertText(): string {\n    return (\n      this._currentInsertText || this._match.insertText || this._match.label\n    );\n  }\n  set insertText(text: string) {\n    this._currentInsertText = text;\n  }\n\n  get sortText(): string {\n    return this._currentSortText || this._match.sortText || this._match.label;\n  }\n  set sortText(text: string) {\n    this._currentSortText = text;\n  }\n\n  get filterText(): string | undefined {\n    return this._match.filterText;\n  }\n  set filterText(text: string | undefined) {\n    this._match.filterText = text;\n  }\n\n  get detail(): string | undefined {\n    return this._detail;\n  }\n\n  public needsResolution(): boolean {\n    if (this.documentation) {\n      return false;\n    }\n\n    if (this._resolved) {\n      return false;\n    }\n\n    return this._supportsResolution();\n  }\n\n  public isResolved() {\n    return this._resolved;\n  }\n\n  /**\n   * Resolve (fetch) details such as documentation.\n   */\n  public async resolve(): Promise<CompletionItem> {\n    if (this._resolved) {\n      return this;\n    }\n    if (!this._supportsResolution()) {\n      return this;\n    }\n\n    const connection = this.options.connection;\n\n    const resolvedCompletionItem = await connection.clientRequests[\n      'completionItem/resolve'\n    ].request(this._match);\n\n    if (resolvedCompletionItem === null) {\n      return this;\n    }\n    this._setDocumentation(resolvedCompletionItem?.documentation);\n    this._detail = resolvedCompletionItem?.detail;\n    // TODO: implement in pylsp and enable with proper LSP communication\n    // this.label = resolvedCompletionItem.label;\n    this._resolved = true;\n    return this;\n  }\n\n  /**\n   * A human-readable string with additional information\n   * about this item, like type or symbol information.\n   */\n  get documentation(): string | undefined {\n    if (this._documentation) {\n      return this._documentation;\n    }\n    return undefined;\n  }\n\n  /**\n   * Indicates if the item is deprecated.\n   */\n  get deprecated(): boolean {\n    if (this._match.deprecated) {\n      return this._match.deprecated;\n    }\n    return (\n      this._match.tags != null &&\n      this._match.tags.some(\n        tag => tag == lsProtocol.CompletionItemTag.Deprecated\n      )\n    );\n  }\n\n  private _setDocumentation(\n    documentation: string | lsProtocol.MarkupContent | undefined\n  ) {\n    if (lsProtocol.MarkupContent.is(documentation)) {\n      this._documentation = documentation.value;\n      this._isDocumentationMarkdown = documentation.kind === 'markdown';\n    } else {\n      this._documentation = documentation;\n      this._isDocumentationMarkdown = false;\n    }\n  }\n\n  private _supportsResolution(): boolean {\n    const connection = this.options.connection;\n    return (\n      connection.serverCapabilities.completionProvider?.resolveProvider ?? false\n    );\n  }\n\n  private _detail: string | undefined;\n  private _documentation: string | undefined;\n  private _isDocumentationMarkdown: boolean;\n  private _resolved: boolean;\n  private _currentInsertText: string;\n  private _currentSortText: string;\n  private _match: lsProtocol.CompletionItem;\n}\n\nfunction makeGetterEnumerable(instance: object, name: string) {\n  const generatedDescriptor = findDescriptor(instance, name);\n  Object.defineProperty(instance, name, {\n    enumerable: true,\n    get: generatedDescriptor.get,\n    set: generatedDescriptor.set\n  });\n}\n\nfunction findDescriptor(instance: object, name: string) {\n  while (instance) {\n    const desc = Object.getOwnPropertyDescriptor(instance, name);\n    if (desc) {\n      return desc;\n    }\n    instance = Object.getPrototypeOf(instance);\n  }\n  throw Error(`No ${name} descriptor found.`);\n}\n","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\n\nimport { CompleterModel, CompletionHandler } from '@jupyterlab/completer';\nimport { StringExt } from '@lumino/algorithm';\n\nimport { CompletionItem } from './item';\n\ninterface ICompletionMatch<T extends CompletionHandler.ICompletionItem> {\n  /**\n   * A score which indicates the strength of the match.\n   *\n   * A lower score is better. Zero is the best possible score.\n   */\n  score: number;\n  item: T;\n}\n\nfunction escapeHTML(text: string) {\n  let node = document.createElement('span');\n  node.textContent = text;\n  return node.innerHTML;\n}\n\n/**\n * A lot of this was contributed upstream\n */\nexport class GenericCompleterModel<\n  T extends CompletionHandler.ICompletionItem\n> extends CompleterModel {\n  public settings: GenericCompleterModel.IOptions;\n\n  constructor(settings: GenericCompleterModel.IOptions = {}) {\n    super();\n    // TODO: refactor upstream so that it does not block \"options\"?\n    this.settings = { ...GenericCompleterModel.defaultOptions, ...settings };\n  }\n\n  completionItems(): T[] {\n    let query = this.query;\n    // (setting query is bad because it resets the cache; ideally we would\n    // modify the sorting and filtering algorithm upstream).\n\n    // TODO processedItemsCache\n    this.query = '';\n\n    let unfilteredItems = (\n      super.completionItems() as CompletionHandler.ICompletionItem[]\n    ).map(this.harmoniseItem);\n\n    this.query = query;\n\n    // always want to sort\n    // TODO does this behave strangely with %%<tab> if always sorting?\n    return this._sortAndFilter(query, unfilteredItems);\n  }\n\n  protected harmoniseItem(item: CompletionHandler.ICompletionItem): T {\n    return item as T;\n  }\n\n  private _markFragment(value: string): string {\n    return `<mark>${value}</mark>`;\n  }\n\n  protected getFilterText(item: T) {\n    return this.getHighlightableLabelRegion(item);\n  }\n\n  protected getHighlightableLabelRegion(item: T) {\n    // TODO: ideally label and params would be separated so we don't have to do\n    //  things like these which are not language-agnostic\n    //  (assume that params follow after first opening parenthesis which may not be the case);\n    //  the upcoming LSP 3.17 includes CompletionItemLabelDetails\n    //  which separates parameters from the label\n    // With ICompletionItems, the label may include parameters, so we exclude them from the matcher.\n    // e.g. Given label `foo(b, a, r)` and query `bar`,\n    // don't count parameters, `b`, `a`, and `r` as matches.\n    const index = item.label.indexOf('(');\n    return index > -1 ? item.label.substring(0, index) : item.label;\n  }\n\n  createPatch(patch: string) {\n    if (this.subsetMatch) {\n      // Prevent insertion code path when auto-populating subset on tab, to avoid problems with\n      // prefix which is a subset of token incorrectly replacing a string with file system path.\n      // - Q: Which code path is being blocked?\n      //   A: The code path (b) discussed in https://github.com/jupyterlab/jupyterlab/issues/15130.\n      // - Q: Why are we short- circuiting here?\n      //   A: we want to prevent `onCompletionSelected()` from proceeding with text insertion,\n      //      but direct extension of Completer handler is difficult.\n      return undefined;\n    }\n    return super.createPatch(patch);\n  }\n\n  protected resolveQuery(userQuery: string, _item: T) {\n    return userQuery;\n  }\n\n  private _sortAndFilter(userQuery: string, items: T[]): T[] {\n    let results: ICompletionMatch<T>[] = [];\n\n    for (let item of items) {\n      // See if label matches query string\n\n      let matched: boolean;\n\n      let filterText: string | null = null;\n      let filterMatch: StringExt.IMatchResult | null = null;\n\n      const query = this.resolveQuery(userQuery, item);\n\n      let lowerCaseQuery = query.toLowerCase();\n\n      if (query) {\n        filterText = this.getFilterText(item);\n        if (this.settings.caseSensitive) {\n          filterMatch = StringExt.matchSumOfSquares(filterText, query);\n        } else {\n          filterMatch = StringExt.matchSumOfSquares(\n            filterText.toLowerCase(),\n            lowerCaseQuery\n          );\n        }\n        matched = !!filterMatch;\n        if (!this.settings.includePerfectMatches) {\n          matched = matched && filterText != query;\n        }\n      } else {\n        matched = true;\n      }\n\n      // Filter non-matching items. Filtering may happen on a criterion different than label.\n      if (matched) {\n        // If the matches are substrings of label, highlight them\n        // in this part of the label that can be highlighted (must be a prefix),\n        // which is intended to avoid highlighting matches in function arguments etc.\n        let labelMatch: StringExt.IMatchResult | null = null;\n        if (query) {\n          let labelPrefix = escapeHTML(this.getHighlightableLabelRegion(item));\n          if (labelPrefix == filterText) {\n            labelMatch = filterMatch;\n          } else {\n            labelMatch = StringExt.matchSumOfSquares(labelPrefix, query);\n          }\n        }\n\n        let label: string;\n        let score: number;\n\n        if (labelMatch) {\n          // Highlight label text if there's a match\n          // there won't be a match if filter text includes additional keywords\n          // for easier search that are not a part of the label\n          let marked = StringExt.highlight(\n            escapeHTML(item.label),\n            labelMatch.indices,\n            this._markFragment\n          );\n          label = marked.join('');\n          score = labelMatch.score;\n        } else {\n          label = escapeHTML(item.label);\n          score = 0;\n        }\n        // preserve getters (allow for lazily retrieved documentation)\n        const itemClone = Object.create(\n          Object.getPrototypeOf(item),\n          Object.getOwnPropertyDescriptors(item)\n        );\n        itemClone.label = label;\n        // If no insertText is present, preserve original label value\n        // by setting it as the insertText.\n        itemClone.insertText = item.insertText ? item.insertText : item.label;\n\n        results.push({\n          item: itemClone,\n          score: score\n        });\n      }\n    }\n\n    results.sort(this.compareMatches.bind(this));\n\n    return results.map(x => x.item);\n  }\n\n  protected compareMatches(\n    a: ICompletionMatch<T>,\n    b: ICompletionMatch<T>\n  ): number {\n    const delta = a.score - b.score;\n    if (delta !== 0) {\n      return delta;\n    }\n    return a.item.insertText?.localeCompare(b.item.insertText ?? '') ?? 0;\n  }\n}\n\nexport namespace GenericCompleterModel {\n  export interface IOptions {\n    /**\n     * Whether matching should be case-sensitive (default = true)\n     */\n    caseSensitive?: boolean;\n    /**\n     * Whether perfect matches should be included (default = true)\n     */\n    includePerfectMatches?: boolean;\n    /**\n     * Whether kernel completions should be shown first.\n     */\n    kernelCompletionsFirst?: boolean;\n  }\n  export const defaultOptions: IOptions = {\n    caseSensitive: true,\n    includePerfectMatches: true,\n    kernelCompletionsFirst: false\n  };\n}\n\ntype MaybeCompletionItem = Partial<CompletionItem> &\n  CompletionHandler.ICompletionItem;\n\nexport class LSPCompleterModel extends GenericCompleterModel<MaybeCompletionItem> {\n  public settings: LSPCompleterModel.IOptions;\n\n  constructor(settings: LSPCompleterModel.IOptions = {}) {\n    super();\n    this.settings = { ...LSPCompleterModel.defaultOptions, ...settings };\n  }\n\n  protected getFilterText(item: MaybeCompletionItem): string {\n    if (item.filterText) {\n      return item.filterText;\n    }\n    return super.getFilterText(item);\n  }\n\n  setCompletionItems(newValue: MaybeCompletionItem[]) {\n    super.setCompletionItems(newValue);\n    this._preFilterQuery = '';\n\n    if (this.current && this.cursor) {\n      // set initial query to pre-filter items; in future we should use:\n      // https://github.com/jupyterlab/jupyterlab/issues/9763#issuecomment-1001603348\n\n      // note: start/end from cursor are not ideal because these get populated from fetch\n      // reply which will vary depending on what providers decide to return; we want the\n      // actual position in token, the same as passed in request to fetch. We can get it\n      // by searching for longest common prefix as seen below (or by counting characters).\n      // Maybe upstream should expose it directly?\n      const { start, end } = this.cursor;\n      const { text, line, column } = this.original!;\n\n      const queryRange = text.substring(start, end).trim();\n      const linePrefix = text.split('\\n')[line].substring(0, column).trim();\n      let query = '';\n      for (let i = queryRange.length; i > 0; i--) {\n        if (queryRange.slice(0, i) == linePrefix.slice(-i)) {\n          query = linePrefix.slice(-i);\n          break;\n        }\n      }\n      if (!query) {\n        return;\n      }\n\n      let trimmedQuotes = false;\n      // special case for \"Completes Paths In Strings\" test case\n      if (query.startsWith('\"') || query.startsWith(\"'\")) {\n        query = query.substring(1);\n        trimmedQuotes = true;\n      }\n      if (query.endsWith('\"') || query.endsWith(\"'\")) {\n        query = query.substring(0, -1);\n        trimmedQuotes = true;\n      }\n      if (this.settings.preFilterMatches || trimmedQuotes) {\n        this._preFilterQuery = query;\n      }\n    }\n  }\n\n  protected resolveQuery(userQuery: string, item: MaybeCompletionItem) {\n    return userQuery\n      ? userQuery\n      : item.source === 'LSP'\n      ? this._preFilterQuery\n      : '';\n  }\n\n  protected harmoniseItem(item: CompletionHandler.ICompletionItem) {\n    if ((item as any).self) {\n      const self = (item as any).self;\n      // reflect any changes made on copy\n      self.insertText = item.insertText;\n      return self;\n    }\n    return super.harmoniseItem(item);\n  }\n\n  protected compareMatches(\n    a: ICompletionMatch<MaybeCompletionItem>,\n    b: ICompletionMatch<MaybeCompletionItem>\n  ): number {\n    // TODO: take source order from provider ranks, upstream this code\n    const sourceOrder = {\n      LSP: 1,\n      kernel: this.settings.kernelCompletionsFirst ? 0 : 2,\n      context: 3\n    };\n    const aRank = a.item.source\n      ? sourceOrder[a.item.source as keyof typeof sourceOrder] ?? 4\n      : 4;\n    const bRank = b.item.source\n      ? sourceOrder[b.item.source as keyof typeof sourceOrder] ?? 4\n      : 4;\n    return (\n      aRank - bRank ||\n      (a.item.sortText ?? 'z').localeCompare(b.item.sortText ?? 'z') ||\n      a.score - b.score\n    );\n  }\n\n  private _preFilterQuery: string = '';\n}\n\nexport namespace LSPCompleterModel {\n  export interface IOptions extends GenericCompleterModel.IOptions {\n    /**\n     * Whether matches should be pre-filtered (default = true)\n     */\n    preFilterMatches?: boolean;\n  }\n  export const defaultOptions: IOptions = {\n    ...GenericCompleterModel.defaultOptions,\n    preFilterMatches: true\n  };\n}\n","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\n\nimport { Completer } from '@jupyterlab/completer';\nimport { IRenderMime } from '@jupyterlab/rendermime';\n\nimport { CodeCompletion as LSPCompletionSettings } from '../../_completion';\nimport { FeatureSettings } from '../../feature';\nimport { ILSPLogConsole } from '../../tokens';\n\nimport { CompletionItem, IExtendedCompletionItem } from './item';\n\nexport interface ICompletionData {\n  item: CompletionItem;\n  element: HTMLLIElement;\n}\n\nexport class LSPCompletionRenderer\n  extends Completer.Renderer\n  implements Completer.IRenderer\n{\n  // observers\n  private visibilityObserver: IntersectionObserver;\n  // element data maps (with weak references for better GC)\n  private elementToItem: WeakMap<HTMLLIElement, CompletionItem>;\n\n  protected ITEM_PLACEHOLDER_CLASS = 'lsp-detail-placeholder';\n  protected EXTRA_INFO_CLASS = 'jp-Completer-typeExtended';\n  protected LABEL_CLASS = 'jp-Completer-match';\n\n  constructor(protected options: LSPCompletionRenderer.IOptions) {\n    super();\n    this.elementToItem = new WeakMap();\n\n    this.visibilityObserver = new IntersectionObserver(\n      entries => {\n        entries.forEach(entry => {\n          if (!entry.isIntersecting) {\n            return;\n          }\n          let li = entry.target as HTMLLIElement;\n          let item = this.elementToItem.get(li)!;\n          item.resolve().catch(console.error);\n        });\n      },\n      {\n        threshold: 0.25\n      }\n    );\n  }\n\n  protected getExtraInfo(\n    item: CompletionItem | IExtendedCompletionItem\n  ): string | undefined {\n    const labelExtra = this.options.settings.composite.labelExtra;\n    const detail = 'detail' in item ? item?.detail ?? '' : '';\n    switch (labelExtra) {\n      case 'detail':\n        return detail;\n      case 'type':\n        return item?.type?.toLowerCase?.();\n      case 'source':\n        return item?.source;\n      case 'auto':\n        return [detail, item?.type?.toLowerCase?.(), item?.source].filter(\n          x => !!x\n        )[0];\n      default:\n        this.options.console.warn(\n          'labelExtra does not match any of the expected values',\n          labelExtra\n        );\n        return '';\n    }\n  }\n\n  public updateExtraInfo(\n    item: CompletionItem | IExtendedCompletionItem,\n    li: HTMLLIElement\n  ) {\n    const extraText = this.getExtraInfo(item);\n    if (extraText) {\n      const extraElement = li.getElementsByClassName(this.EXTRA_INFO_CLASS)[0];\n      extraElement.textContent = extraText;\n      this._elideMark(item, li);\n    }\n  }\n\n  createCompletionItemNode(\n    item: CompletionItem,\n    orderedTypes: string[]\n  ): HTMLLIElement {\n    const li = super.createCompletionItemNode(item, orderedTypes);\n\n    // make sure that an instance reference, and not an object copy is being used;\n    const lspItem = item.self;\n\n    // only monitor nodes that have item.self as others are not our completion items\n    if (lspItem) {\n      lspItem.element = li;\n      this.elementToItem.set(li, lspItem);\n      this.visibilityObserver.observe(li);\n      // TODO: build custom li from ground up\n      this.updateExtraInfo(lspItem, li);\n      this._elideMark(lspItem, li);\n    } else {\n      this.updateExtraInfo(item, li);\n      this._elideMark(lspItem, li);\n    }\n\n    return li;\n  }\n\n  private _elideMark(item: IExtendedCompletionItem, li: HTMLLIElement) {\n    if (!item || !item.type) {\n      return;\n    }\n    const type = item.type.toLowerCase();\n    if (type !== 'file' && type !== 'path') {\n      // do not elide for non-paths.\n      return;\n    }\n    const labelElement = li.getElementsByClassName(this.LABEL_CLASS)[0];\n    const originalHTMLLabel = labelElement.childNodes;\n    let hasMark = false;\n    for (const node of originalHTMLLabel) {\n      if (node instanceof HTMLElement) {\n        const element = node as HTMLElement;\n        const text = element.textContent;\n        if (element.tagName === 'MARK' && text && text.length > 3) {\n          const elidableElement = document.createElement('bdo');\n          elidableElement.setAttribute('dir', 'ltr');\n          elidableElement.textContent = text;\n          element.title = text;\n          element.replaceChildren(elidableElement);\n          element.classList.add('lsp-elide');\n          hasMark = true;\n        }\n      }\n    }\n    if (hasMark) {\n      const wrapper = document.createElement('div');\n      wrapper.className = 'lsp-elide-wrapper';\n      wrapper.replaceChildren(...labelElement.childNodes);\n      labelElement.replaceChildren(wrapper);\n    }\n  }\n\n  createDocumentationNode(item: CompletionItem): HTMLElement {\n    // note: not worth trying to `fetchDocumentation()` as this is not\n    // invoked if documentation is empty (as of jlab 3.2)\n    if (item.isDocumentationMarkdown && this.options.markdownRenderer) {\n      let documentation = item.documentation;\n      this.options.markdownRenderer\n        .renderModel({\n          data: {\n            'text/markdown': documentation\n          },\n          trusted: false,\n          metadata: {},\n          setData(options: IRenderMime.IMimeModel.ISetDataOptions) {\n            // empty\n          }\n        })\n        .then(() => {\n          if (\n            this.options.markdownRenderer &&\n            this.options.latexTypesetter &&\n            documentation &&\n            documentation.includes('$')\n          ) {\n            this.options.latexTypesetter.typeset(\n              this.options.markdownRenderer.node\n            );\n          }\n        })\n        .catch(this.options.console.warn);\n      return this.options.markdownRenderer.node;\n    } else if (item.source != 'LSP') {\n      // fallback to default implementation for non-LSP completions\n      return super.createDocumentationNode(item);\n    } else {\n      let node = document.createElement('pre');\n      if (item.documentation) {\n        node.textContent = item.documentation;\n      }\n      return node;\n    }\n  }\n\n  itemWidthHeuristic(item: CompletionItem | IExtendedCompletionItem): number {\n    let labelSize = item.label.replace(/<(\\/)?mark>/g, '').length;\n    const extra = this.getExtraInfo(item);\n    const extraTextSize = extra?.length ?? 0;\n    const type = item.type?.toLowerCase();\n    if (type === 'file' || type === 'path') {\n      // account for elision\n      const parts = item.label.split(/<\\/mark>/g);\n      const lastPart = parts[parts.length - 1];\n      const proposedElipsed = lastPart.length + 3;\n      if (proposedElipsed < labelSize) {\n        labelSize = proposedElipsed;\n      }\n    }\n    if (this.options.settings.composite.layout === 'side-by-side') {\n      // in 'side-by-side' take the sum\n      return labelSize + extraTextSize;\n    }\n    // 'detail-below' mode take whichever is longer\n    return Math.max(labelSize, extraTextSize);\n  }\n}\n\nexport namespace LSPCompletionRenderer {\n  export interface IOptions {\n    settings: FeatureSettings<LSPCompletionSettings>;\n    markdownRenderer: IRenderMime.IRenderer | null;\n    latexTypesetter?: IRenderMime.ILatexTypesetter | null;\n    console: ILSPLogConsole;\n  }\n}\n","import { SourceChange } from '@jupyter/ydoc';\nimport { ILSPCompletionThemeManager } from '@jupyter-lsp/completion-theme';\nimport { CodeEditor } from '@jupyterlab/codeeditor';\nimport {\n  ICompletionProvider,\n  CompletionHandler,\n  ICompletionContext,\n  Completer\n} from '@jupyterlab/completer';\nimport { IDocumentWidget } from '@jupyterlab/docregistry';\nimport {\n  ILSPDocumentConnectionManager,\n  IEditorPosition\n} from '@jupyterlab/lsp';\nimport { IRenderMimeRegistry } from '@jupyterlab/rendermime';\nimport { LabIcon } from '@jupyterlab/ui-components';\nimport type * as lsProtocol from 'vscode-languageserver-protocol';\n\nimport { CodeCompletion as LSPCompletionSettings } from '../../_completion';\nimport {\n  editorPositionToRootPosition,\n  PositionConverter,\n  documentAtRootPosition,\n  rootPositionToVirtualPosition\n} from '../../converter';\nimport { FeatureSettings } from '../../feature';\nimport { CompletionTriggerKind, CompletionItemKind } from '../../lsp';\nimport { ILSPLogConsole } from '../../tokens';\nimport { BrowserConsole } from '../../virtual/console';\n\nimport { CompletionItem } from './item';\nimport { LSPCompleterModel } from './model';\nimport { LSPCompletionRenderer } from './renderer';\n\ninterface IOptions {\n  settings: FeatureSettings<LSPCompletionSettings>;\n  renderMimeRegistry: IRenderMimeRegistry;\n  iconsThemeManager: ILSPCompletionThemeManager;\n  connectionManager: ILSPDocumentConnectionManager;\n}\n\nexport class CompletionProvider implements ICompletionProvider<CompletionItem> {\n  readonly identifier = 'lsp';\n  readonly label = 'LSP';\n  readonly rank = 1000;\n  protected console = new BrowserConsole().scope('Completion provider');\n\n  constructor(protected options: IOptions) {\n    const markdownRenderer =\n      options.renderMimeRegistry.createRenderer('text/markdown');\n\n    this.renderer = new LSPCompletionRenderer({\n      settings: options.settings,\n      markdownRenderer,\n      latexTypesetter: options.renderMimeRegistry.latexTypesetter,\n      console: this.console\n    });\n  }\n\n  renderer: LSPCompletionRenderer;\n\n  modelFactory = async (\n    context: ICompletionContext\n  ): Promise<Completer.IModel> => {\n    const composite = this.options.settings.composite;\n    const model = new LSPCompleterModel({\n      caseSensitive: composite.caseSensitive,\n      preFilterMatches: composite.preFilterMatches,\n      includePerfectMatches: composite.includePerfectMatches,\n      kernelCompletionsFirst: composite.kernelCompletionsFirst\n    });\n    this.options.settings.changed.connect(() => {\n      const composite = this.options.settings.composite;\n      model.settings.caseSensitive = composite.caseSensitive;\n      model.settings.preFilterMatches = composite.preFilterMatches;\n      model.settings.includePerfectMatches = composite.includePerfectMatches;\n      model.settings.kernelCompletionsFirst = composite.kernelCompletionsFirst;\n    });\n    return model;\n  };\n\n  /**\n   * Resolve (fetch) details such as documentation.\n   */\n  async resolve(completionItem: CompletionItem): Promise<any> {\n    await completionItem.resolve();\n    // expand getters\n    return {\n      label: completionItem.label,\n      documentation: completionItem.documentation,\n      deprecated: completionItem.deprecated,\n      detail: completionItem.detail,\n      filterText: completionItem.filterText,\n      sortText: completionItem.sortText,\n      insertText: completionItem.insertText,\n      source: completionItem.source,\n      type: completionItem.type,\n      isDocumentationMarkdown: completionItem.isDocumentationMarkdown,\n      icon: completionItem.icon\n    };\n  }\n\n  shouldShowContinuousHint(\n    completerIsVisible: boolean,\n    changed: SourceChange,\n    context?: ICompletionContext\n  ): boolean {\n    if (!context) {\n      // waiting for https://github.com/jupyterlab/jupyterlab/pull/15015 due to\n      // https://github.com/jupyterlab/jupyterlab/issues/15014\n      return false;\n      // throw Error('Completion context was expected');\n    }\n\n    const manager = this.options.connectionManager;\n    const widget = context?.widget as IDocumentWidget;\n    const adapter = manager.adapters.get(widget.context.path);\n    if (!context.editor) {\n      // TODO: why is editor optional in the first place?\n      throw Error('No editor');\n    }\n    if (!adapter) {\n      throw Error('No adapter');\n    }\n    const editor = context.editor;\n    const editorPosition = PositionConverter.ce_to_cm(\n      editor.getCursorPosition()\n    ) as IEditorPosition;\n\n    const block = adapter.editors.find(\n      value => value.ceEditor.getEditor() == editor\n    );\n\n    if (!block) {\n      throw Error('Could not get block with editor');\n    }\n    const rootPosition = editorPositionToRootPosition(\n      adapter,\n      block.ceEditor,\n      editorPosition\n    );\n\n    if (!rootPosition) {\n      throw Error('Could not get root position');\n    }\n\n    const virtualDocument = documentAtRootPosition(adapter, rootPosition);\n    const connection = manager.connections.get(virtualDocument.uri);\n\n    if (!connection) {\n      throw Error('Could not find connection for virtual document');\n    }\n\n    const triggerCharacters =\n      connection.serverCapabilities?.completionProvider?.triggerCharacters ||\n      [];\n\n    const sourceChange = changed.sourceChange;\n\n    if (sourceChange == null) {\n      return false;\n    }\n\n    if (sourceChange.some(delta => delta.delete != null)) {\n      return false;\n    }\n    const token = editor.getTokenAtCursor();\n\n    if (this.options.settings.composite.continuousHinting) {\n      // if token type is known and not ignored token type is ignored - show completer\n      if (\n        token.type &&\n        !this.options.settings.composite.suppressContinuousHintingIn.includes(\n          token.type\n        )\n      ) {\n        return true;\n      }\n      // otherwise show it may still be shown due to trigger character\n    }\n    if (\n      !token.type ||\n      this.options.settings.composite.suppressTriggerCharacterIn.includes(\n        token.type\n      )\n    ) {\n      return false;\n    }\n\n    return sourceChange.some(\n      delta =>\n        delta.insert != null &&\n        (triggerCharacters.includes(delta.insert) ||\n          (!completerIsVisible && delta.insert.trim().length > 0))\n    );\n  }\n\n  async fetch(\n    request: CompletionHandler.IRequest,\n    context: ICompletionContext,\n    trigger?: CompletionTriggerKind\n  ): Promise<CompletionHandler.ICompletionItemsReply<CompletionItem>> {\n    const manager = this.options.connectionManager;\n    const widget = context.widget as IDocumentWidget;\n    const adapter = manager.adapters.get(widget.context.path);\n\n    if (!context.editor) {\n      // TODO: why is editor optional in the first place?\n      throw Error('No editor');\n    }\n    if (!adapter) {\n      throw Error('No adapter');\n    }\n    const editor = context.editor;\n    const editorPosition = PositionConverter.ce_to_cm(\n      editor.getPositionAt(request.offset)!\n    ) as IEditorPosition;\n    const token = editor.getTokenAt(request.offset);\n    const positionInToken = request.offset - token.offset;\n    // TODO: (typedCharacter can serve as a proxy for triggerCharacter)\n    const typedCharacter = token.value[positionInToken - 1];\n\n    // TODO: direct mapping\n    // because we need editorAccessor, not the editor itself we perform this rather sad dance:\n    const block = adapter.editors.find(\n      value => value.ceEditor.getEditor() == editor\n    );\n    if (!block) {\n      throw Error('Could not get block with editor');\n    }\n\n    const rootPosition = editorPositionToRootPosition(\n      adapter,\n      block.ceEditor,\n      editorPosition\n    );\n\n    if (!rootPosition) {\n      throw Error('Could not get root position');\n    }\n\n    const virtualDocument = documentAtRootPosition(adapter, rootPosition);\n    const virtualPosition = rootPositionToVirtualPosition(\n      adapter,\n      rootPosition\n    );\n\n    const connection = manager.connections.get(virtualDocument.uri);\n\n    if (!connection) {\n      throw Error('Could not find connection for virtual document');\n    }\n\n    const lspCompletionReply = await connection.clientRequests[\n      'textDocument/completion'\n    ].request({\n      textDocument: {\n        uri: virtualDocument.documentInfo.uri\n      },\n      position: {\n        line: virtualPosition.line,\n        character: virtualPosition.ch\n      },\n      context: {\n        triggerKind: trigger || CompletionTriggerKind.Invoked,\n        triggerCharacter:\n          trigger === CompletionTriggerKind.TriggerCharacter\n            ? typedCharacter\n            : undefined\n      }\n    });\n\n    const completionList =\n      !lspCompletionReply || Array.isArray(lspCompletionReply)\n        ? ({\n            isIncomplete: false,\n            items: lspCompletionReply || []\n          } as lsProtocol.CompletionList)\n        : lspCompletionReply;\n\n    return transformLSPCompletions(\n      token,\n      positionInToken,\n      completionList.items,\n      (kind, match) => {\n        return new CompletionItem({\n          match,\n          connection,\n          type: kind,\n          icon: this.options.iconsThemeManager.getIcon(kind) as LabIcon | null,\n          source: this.label\n        });\n      },\n      this.console\n    );\n  }\n\n  async isApplicable(context: ICompletionContext): Promise<boolean> {\n    if (this.options.settings.composite.disable) {\n      return false;\n    }\n    const manager = this.options.connectionManager;\n    const widget = context.widget as IDocumentWidget;\n    if (typeof widget.context === 'undefined') {\n      // there is no path for Console as it is not a DocumentWidget\n      return false;\n    }\n    const adapter = manager.adapters.get(widget.context.path);\n    if (!adapter) {\n      return false;\n    }\n    return true;\n  }\n}\n\nfunction stripQuotes(path: string): string {\n  return path.slice(\n    path.startsWith(\"'\") || path.startsWith('\"') ? 1 : 0,\n    path.endsWith(\"'\") || path.endsWith('\"') ? -1 : path.length\n  );\n}\nexport function transformLSPCompletions<T>(\n  token: CodeEditor.IToken,\n  positionInToken: number,\n  lspCompletionItems: lsProtocol.CompletionItem[],\n  createCompletionItem: (kind: string, match: lsProtocol.CompletionItem) => T,\n  console: ILSPLogConsole\n) {\n  let prefix = token.value.slice(0, positionInToken);\n  let suffix = token.value.slice(positionInToken, token.value.length);\n  let items: T[] = [];\n  // If there are no prefixes, we will just insert the text without replacing the token,\n  // which is the case for example in R for `stats::<tab>` which returns module members\n  // without `::` prefix.\n  // If there are prefixes, we will replace the token so we may need to prepend/append to,\n  // or otherwise modify the insert text of individual completion items.\n  let anyPrefixed = false;\n\n  lspCompletionItems.forEach(match => {\n    let kind = match.kind ? CompletionItemKind[match.kind] : '';\n\n    let text = match.insertText ? match.insertText : match.label;\n    let intendedText = match.insertText ? match.insertText : match.label;\n\n    if (intendedText.toLowerCase().startsWith(prefix.toLowerCase())) {\n      anyPrefixed = true;\n    }\n\n    // Add overlap with token prefix\n    if (intendedText.startsWith(token.value)) {\n      anyPrefixed = true;\n      // remove overlap with prefix before expanding it\n      if (intendedText.startsWith(prefix)) {\n        text = text.substring(prefix.length, text.length);\n        match.insertText = text;\n      }\n      text = token.value + text;\n      match.insertText = text;\n    }\n\n    // special handling for paths\n    if (token.type === 'String' && prefix.includes('/')) {\n      const parts = stripQuotes(prefix).split('/');\n      if (\n        text.toLowerCase().startsWith(parts[parts.length - 1].toLowerCase())\n      ) {\n        let pathPrefix = parts.slice(0, -1).join('/') + '/';\n        text =\n          (prefix.startsWith(\"'\") || prefix.startsWith('\"') ? prefix[0] : '') +\n          pathPrefix +\n          text +\n          (suffix.startsWith(\"'\") || suffix.startsWith('\"') ? suffix[0] : '');\n        match.insertText = text;\n        // for label without quotes\n        match.label = pathPrefix + match.label;\n        anyPrefixed = true;\n      }\n    } else {\n      // harmonise end to token\n      if (text.toLowerCase().endsWith(suffix.toLowerCase())) {\n        text = text.substring(0, text.length - suffix.length);\n        match.insertText = text;\n      } else if (token.type === 'String') {\n        // special case for completion in strings to preserve the closing quote;\n        // there is an issue that this gives opposing results in Notebook vs File editor\n        // probably due to reconciliator logic\n        if (suffix.startsWith(\"'\") || suffix.startsWith('\"')) {\n          match.insertText = text + suffix[0];\n        }\n      }\n    }\n\n    let completionItem = createCompletionItem(kind, match);\n\n    items.push(completionItem);\n  });\n  console.debug('Transformed');\n\n  let start = token.offset;\n  let end = token.offset + token.value.length;\n  if (!anyPrefixed) {\n    start = end;\n  }\n\n  let response = {\n    start,\n    end,\n    items,\n    source: 'LSP'\n  };\n  if (response.start > response.end) {\n    console.warn(\n      'Response contains start beyond end; this should not happen!',\n      response\n    );\n  }\n  return response;\n}\n","import { Token } from '@lumino/coreutils';\n\nimport { PLUGIN_ID } from '../../tokens';\n\n/**\n * Token provided by the plugin which implements LSP completion.\n * As of now no methods are exposed, but it still functions as\n * an indicator for whether the LSP completion plugin is available,\n * or whether it was disabled by the user (or failed to activate).\n */\nexport interface ICompletionFeature {\n  readonly id: string;\n}\n\nexport const ICompletionFeature = new Token<ICompletionFeature>(\n  PLUGIN_ID + ':ICompletionFeature'\n);\n","import { ILSPCompletionThemeManager } from '@jupyter-lsp/completion-theme';\nimport {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\nimport {\n  ICompletionProviderManager,\n  ContextCompleterProvider,\n  KernelCompleterProvider\n} from '@jupyterlab/completer';\nimport {\n  ILSPFeatureManager,\n  ILSPDocumentConnectionManager\n} from '@jupyterlab/lsp';\nimport { IRenderMimeRegistry } from '@jupyterlab/rendermime';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { LabIcon } from '@jupyterlab/ui-components';\nimport * as lsProtocol from 'vscode-languageserver-protocol';\n\nimport completionSvg from '../../../style/icons/completion.svg';\nimport { CodeCompletion as LSPCompletionSettings } from '../../_completion';\nimport { FeatureSettings, Feature } from '../../feature';\nimport { CompletionItemTag } from '../../lsp';\nimport { PLUGIN_ID } from '../../tokens';\n\nimport {\n  EnhancedContextCompleterProvider,\n  EnhancedKernelCompleterProvider\n} from './overrides';\nimport { CompletionProvider } from './provider';\nimport { ICompletionFeature } from './tokens';\n\nexport const completionIcon = new LabIcon({\n  name: 'lsp:completion',\n  svgstr: completionSvg\n});\n\nexport class CompletionFeature extends Feature {\n  readonly id = CompletionFeature.id;\n  readonly capabilities: lsProtocol.ClientCapabilities = {\n    textDocument: {\n      completion: {\n        dynamicRegistration: true,\n        completionItem: {\n          snippetSupport: false,\n          commitCharactersSupport: true,\n          documentationFormat: ['markdown', 'plaintext'],\n          deprecatedSupport: true,\n          preselectSupport: false,\n          tagSupport: {\n            valueSet: [CompletionItemTag.Deprecated]\n          }\n        },\n        contextSupport: true\n      }\n    }\n  };\n\n  constructor(protected options: CompletionFeature.IOptions) {\n    super(options);\n    this._configure();\n\n    options.settings.changed.connect(() => {\n      this._configure();\n    });\n\n    const provider = new CompletionProvider({ ...options });\n    options.completionProviderManager.registerProvider(provider);\n    options.completionProviderManager.registerProvider(\n      new EnhancedContextCompleterProvider(options)\n    );\n    options.completionProviderManager.registerProvider(\n      new EnhancedKernelCompleterProvider(options)\n    );\n  }\n\n  private _configure() {\n    const settings = this.options.settings;\n    const completionThemeManager = this.options.iconsThemeManager;\n\n    if (!settings.composite.disable) {\n      document.body.dataset.lspCompleterLayout = settings.composite.layout;\n      completionThemeManager.setTheme(settings.composite.theme);\n      completionThemeManager.setIconsOverrides(settings.composite.typesMap);\n    } else {\n      completionThemeManager.setTheme(null);\n      delete document.body.dataset.lspCompleterLayout;\n    }\n  }\n}\n\nexport namespace CompletionFeature {\n  export interface IOptions extends Feature.IOptions {\n    settings: FeatureSettings<LSPCompletionSettings>;\n    renderMimeRegistry: IRenderMimeRegistry;\n    completionProviderManager: ICompletionProviderManager;\n    iconsThemeManager: ILSPCompletionThemeManager;\n  }\n  export const id = PLUGIN_ID + ':completion';\n}\n\nexport const COMPLETION_PLUGIN: JupyterFrontEndPlugin<ICompletionFeature | null> =\n  {\n    id: CompletionFeature.id,\n    requires: [\n      ILSPFeatureManager,\n      ISettingRegistry,\n      ICompletionProviderManager,\n      ILSPCompletionThemeManager,\n      IRenderMimeRegistry,\n      ILSPDocumentConnectionManager\n    ],\n    provides: ICompletionFeature,\n    autoStart: true,\n    activate: async (\n      app: JupyterFrontEnd,\n      featureManager: ILSPFeatureManager,\n      settingRegistry: ISettingRegistry,\n      completionProviderManager: ICompletionProviderManager,\n      iconsThemeManager: ILSPCompletionThemeManager,\n      renderMimeRegistry: IRenderMimeRegistry,\n      connectionManager: ILSPDocumentConnectionManager\n    ): Promise<ICompletionFeature | null> => {\n      const settings = new FeatureSettings<LSPCompletionSettings>(\n        settingRegistry,\n        CompletionFeature.id\n      );\n      await settings.ready;\n      if (settings.composite.disable) {\n        return null;\n      }\n      const feature = new CompletionFeature({\n        settings,\n        connectionManager,\n        renderMimeRegistry,\n        iconsThemeManager,\n        completionProviderManager\n      });\n\n      featureManager.register(feature);\n      return { id: CompletionFeature.id };\n    }\n  };\n\nexport const COMPLETION_FALLBACK_PLUGIN: JupyterFrontEndPlugin<void> = {\n  id: CompletionFeature.id + '-fallback',\n  description:\n    'Plugin which restores the default completion provider when the LSP completion plugin is disabled',\n  requires: [ICompletionProviderManager],\n  optional: [ICompletionFeature],\n  autoStart: true,\n  activate: async (\n    app: JupyterFrontEnd,\n    completionProviderManager: ICompletionProviderManager,\n    completionFeature: ICompletionFeature | null\n  ) => {\n    if (completionFeature == null) {\n      completionProviderManager.registerProvider(\n        new ContextCompleterProvider()\n      );\n      completionProviderManager.registerProvider(new KernelCompleterProvider());\n    }\n  }\n};\n","import type { EditorView } from '@codemirror/view';\nimport { JupyterFrontEnd } from '@jupyterlab/application';\nimport { CodeEditor } from '@jupyterlab/codeeditor';\nimport type { CodeMirrorEditor } from '@jupyterlab/codemirror';\nimport { IDocumentWidget } from '@jupyterlab/docregistry';\nimport {\n  ILSPConnection,\n  WidgetLSPAdapter,\n  ILSPDocumentConnectionManager,\n  IEditorPosition,\n  IRootPosition,\n  IVirtualPosition,\n  Document\n} from '@jupyterlab/lsp';\n\nimport {\n  PositionConverter,\n  documentAtRootPosition,\n  rootPositionToVirtualPosition,\n  editorPositionToRootPosition,\n  editorAtRootPosition,\n  rootPositionToEditorPosition\n} from './converter';\nimport { BrowserConsole } from './virtual/console';\nimport { VirtualDocument } from './virtual/document';\n\n// TODO: reconsider naming\nexport class ContextAssembler {\n  protected console = new BrowserConsole().scope('ContexAssembler');\n\n  constructor(private options: ContextAssembler.IOptions) {\n    // no-op\n  }\n\n  /**\n   * Get context from current context menu (or fallback to document context).\n   */\n  getContext(): ICommandContext | null {\n    let context: ICommandContext | null = null;\n    try {\n      context = this.getContextFromContextMenu();\n    } catch (e) {\n      this.console.warn(\n        'contextMenu is attached, but could not get the context',\n        e\n      );\n      context = null;\n    }\n    if (context == null) {\n      try {\n        context = this._contextFromActiveDocument();\n      } catch (e) {\n        if (\n          e instanceof Error &&\n          e.message === 'Source line not mapped to virtual position'\n        ) {\n          this.console.log(\n            'Could not get context from active document: it is expected when restoring workspace with open files'\n          );\n        } else {\n          throw e;\n        }\n      }\n    }\n    return context;\n  }\n\n  isContextMenuOverToken() {\n    const context = this.getContextFromContextMenu();\n    if (!context) {\n      // annoyingly `isEnabled()` gets called again when mouse is over the menu\n      // which means we are no longer able to retrieve context; therefore we cache\n      // last value and return it if the mouse is over menu.\n      return this._wasOverToken;\n    }\n    const { rootPosition, adapter } = context;\n    const editorAccessor = editorAtRootPosition(adapter, rootPosition);\n    const editor = editorAccessor.getEditor();\n    if (!editor) {\n      return;\n    }\n\n    const editorPosition = rootPositionToEditorPosition(adapter, rootPosition);\n\n    const offset = editor.getOffsetAt(\n      PositionConverter.cm_to_ce(editorPosition)\n    );\n    const token = editor.getTokenAt(offset);\n    const isOverToken = token.value !== '';\n    this._wasOverToken = isOverToken;\n    return isOverToken;\n  }\n  private _wasOverToken = false;\n\n  private _contextFromActiveDocument(): ICommandContext | null {\n    const adapter = [...this.options.connectionManager.adapters.values()].find(\n      adapter => adapter.widget == this.options.app.shell.currentWidget\n    );\n\n    if (!adapter) {\n      this.console.debug('No adapter');\n      return null;\n    }\n\n    const editor = adapter.activeEditor!.getEditor();\n\n    if (editor === null) {\n      return null;\n    }\n\n    let ceCursor = editor.getCursorPosition();\n    let cmCursor = PositionConverter.ce_to_cm(ceCursor) as IEditorPosition;\n\n    const virtualDocument = adapter.virtualDocument;\n    if (!virtualDocument) {\n      console.warn('Could not retrieve current context', virtualDocument);\n      return null;\n    }\n    const rootPosition = virtualDocument.transformFromEditorToRoot(\n      adapter.activeEditor!,\n      cmCursor\n    )!;\n\n    if (rootPosition == null) {\n      console.warn('Could not retrieve current context', virtualDocument);\n      return null;\n    }\n\n    return this._contextFromRoot(adapter, rootPosition);\n  }\n\n  private _contextFromRoot(\n    adapter: WidgetLSPAdapter<any>,\n    rootPosition: IRootPosition\n  ): ICommandContext | null {\n    const document = documentAtRootPosition(adapter, rootPosition);\n    const connection = this.options.connectionManager.connections.get(\n      document.uri\n    )!;\n    const virtualPosition = rootPositionToVirtualPosition(\n      adapter,\n      rootPosition\n    );\n    return {\n      document: document as any,\n      connection,\n      virtualPosition,\n      rootPosition,\n      adapter: adapter\n    };\n  }\n\n  adapterFromNode(leafNode: HTMLElement): WidgetLSPAdapter<any> | undefined {\n    return [...this.options.connectionManager.adapters.values()].find(adapter =>\n      adapter.widget.node.contains(leafNode!)\n    );\n  }\n\n  positionFromCoordinates(\n    left: number,\n    top: number,\n    adapter: WidgetLSPAdapter<any>,\n    editorAccessor: Document.IEditor | undefined\n  ): IRootPosition | null {\n    if (!editorAccessor) {\n      return null;\n    }\n\n    const editorPosition = this.editorPositionFromCoordinates(\n      left,\n      top,\n      editorAccessor\n    );\n\n    if (!editorPosition) {\n      return null;\n    }\n\n    return editorPositionToRootPosition(\n      adapter,\n      editorAccessor,\n      editorPosition\n    );\n  }\n\n  editorPositionFromCoordinates(\n    left: number,\n    top: number,\n    editorAccessor: Document.IEditor\n  ): IEditorPosition | null {\n    const editor = editorAccessor.getEditor();\n    if (!editor) {\n      return null;\n    }\n    const position = editor.getPositionForCoordinate({\n      left: left,\n      right: left,\n      bottom: top,\n      top: top,\n      y: top,\n      x: left,\n      width: 0,\n      height: 0\n    } as CodeEditor.ICoordinate);\n\n    if (!position) {\n      return null;\n    }\n\n    const editorPosition = {\n      ch: position.column,\n      line: position.line\n    } as IEditorPosition;\n\n    return editorPosition;\n  }\n\n  /*\n   * Attempt to find editor from DOM and then (naively) find `Document.Editor`\n   * from `CodeEditor` isntances. The naive approach iterates all the editors\n   * (=cells) in the adapter, which is expensive and prone to fail in windowed notebooks.\n   *\n   * This may not be needed once https://github.com/jupyterlab/jupyterlab/pull/14920\n   * is finalised an released.\n   */\n  editorFromNode(\n    adapter: WidgetLSPAdapter<any>,\n    node: HTMLElement\n  ): Document.IEditor | undefined {\n    const cmContent = (node as HTMLElement).closest('.cm-content');\n    if (!cmContent) {\n      return;\n    }\n    const cmView = (cmContent as any)?.cmView?.view as EditorView | undefined;\n\n    if (!cmView) {\n      return;\n    }\n\n    const editorAccessor = adapter.editors\n      .map(e => e.ceEditor)\n      .find(e => (e.getEditor() as CodeMirrorEditor | null)?.editor === cmView);\n    return editorAccessor;\n  }\n\n  private getContextFromContextMenu(): ICommandContext | null {\n    // Note: could also try using this.app.contextMenu.menu.contentNode position.\n    // Note: could add a guard on this.app.contextMenu.menu.isAttached\n\n    // get the first node as it gives the most accurate approximation\n    const leafNode = this.options.app.contextMenuHitTest(() => true);\n\n    if (!leafNode) {\n      return null;\n    }\n\n    let { left, top } = leafNode.getBoundingClientRect();\n\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    let event = this.options.app._contextMenuEvent;\n\n    // if possible, use more accurate position from the actual event\n    // (but this relies on an undocumented and unstable feature)\n    if (event !== undefined) {\n      left = event.clientX;\n      top = event.clientY;\n      event.stopPropagation();\n    }\n    const adapter = this.adapterFromNode(leafNode);\n\n    if (!adapter) {\n      return null;\n    }\n\n    const accessorFromNode = this.editorFromNode(adapter, leafNode);\n    if (!accessorFromNode) {\n      // Using `activeEditor` can lead to suprising results in notebook\n      // as a cell can be opened over a cell diffferent than the active one.\n      this.console.warn(\n        'Editor accessor not found from node, falling back to activeEditor'\n      );\n    }\n    const editorAccessor = accessorFromNode\n      ? accessorFromNode\n      : adapter.activeEditor;\n    const rootPosition = this.positionFromCoordinates(\n      left,\n      top,\n      adapter,\n      editorAccessor\n    );\n\n    if (!rootPosition) {\n      return null;\n    }\n\n    return this._contextFromRoot(adapter!, rootPosition);\n  }\n}\n\nexport namespace ContextAssembler {\n  export interface IOptions {\n    app: JupyterFrontEnd;\n    connectionManager: ILSPDocumentConnectionManager;\n  }\n}\n\nexport interface ICommandContext {\n  document: VirtualDocument;\n  connection?: ILSPConnection;\n  virtualPosition: IVirtualPosition;\n  rootPosition: IRootPosition;\n  adapter: WidgetLSPAdapter<IDocumentWidget>;\n}\n","import { PageConfig } from '@jupyterlab/coreutils';\nimport { ReadonlyJSONObject, ReadonlyJSONValue } from '@lumino/coreutils';\nimport mergeWith from 'lodash.mergewith';\n\nconst RE_PATH_ANCHOR = /^file:\\/\\/([^\\/]+|\\/[a-zA-Z](?::|%3A))/;\n\nexport async function sleep(timeout: number) {\n  return new Promise<void>(resolve => {\n    setTimeout(() => {\n      resolve();\n    }, timeout);\n  });\n}\n\nexport type ModifierKey =\n  | 'Shift'\n  | 'Alt'\n  | 'AltGraph'\n  | 'Control'\n  | 'Meta'\n  | 'Accel';\n\n/**\n * CodeMirror-proof implementation of event.getModifierState()\n */\nexport function getModifierState(\n  event: MouseEvent | KeyboardEvent,\n  modifierKey: ModifierKey\n): boolean {\n  // Note: Safari does not support getModifierState on MouseEvent, see:\n  // https://github.com/krassowski/jupyterlab-go-to-definition/issues/3\n  // thus AltGraph and others are not supported on Safari\n  // Full list of modifier keys and mappings to physical keys on different OSes:\n  // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/getModifierState\n\n  // the key approach is needed for CodeMirror events which do not set\n  // *key (e.g. ctrlKey) correctly\n  const key = (event as KeyboardEvent).key || null;\n  let value = false;\n\n  switch (modifierKey) {\n    case 'Shift':\n      value = event.shiftKey || key == 'Shift';\n      break;\n    case 'Alt':\n      value = event.altKey || key == 'Alt';\n      break;\n    case 'AltGraph':\n      value = key == 'AltGraph';\n      break;\n    case 'Control':\n      value = event.ctrlKey || key == 'Control';\n      break;\n    case 'Meta':\n      value = event.metaKey || key == 'Meta';\n      break;\n    case 'Accel':\n      value =\n        event.metaKey || key == 'Meta' || event.ctrlKey || key == 'Control';\n      break;\n  }\n\n  if (event.getModifierState !== undefined) {\n    return value || event.getModifierState(modifierKey);\n  }\n\n  return value;\n}\n\nexport class DefaultMap<K, V> extends Map<K, V> {\n  constructor(\n    private defaultFactory: (...args: any[]) => V,\n    entries?: ReadonlyArray<readonly [K, V]> | null\n  ) {\n    super(entries);\n  }\n\n  get(k: K): V {\n    return this.getOrCreate(k);\n  }\n\n  getOrCreate(k: K, ...args: any[]): V {\n    if (this.has(k)) {\n      return super.get(k)!;\n    } else {\n      let v = this.defaultFactory(k, ...args);\n      this.set(k, v);\n      return v;\n    }\n  }\n}\n\nfunction serverRootUri() {\n  return PageConfig.getOption('rootUri');\n}\n\n/**\n * compare two URIs, discounting:\n * - drive capitalization\n * - uri encoding\n * TODO: probably use vscode-uri\n */\nexport function urisEqual(a: string, b: string) {\n  const winPaths = isWinPath(a) && isWinPath(b);\n  if (winPaths) {\n    a = normalizeWinPath(a);\n    b = normalizeWinPath(b);\n  }\n  return a === b || decodeURI(a) === decodeURI(b);\n}\n\n/**\n * grossly detect whether a URI represents a file on a windows drive\n */\nexport function isWinPath(uri: string) {\n  return uri.match(RE_PATH_ANCHOR);\n}\n\n/**\n * lowercase the drive component of a URI\n */\nexport function normalizeWinPath(uri: string) {\n  // Pyright encodes colon on Windows, see:\n  // https://github.com/jupyter-lsp/jupyterlab-lsp/pull/587#issuecomment-844225253\n  return uri.replace(RE_PATH_ANCHOR, it =>\n    it.replace('%3A', ':').toLowerCase()\n  );\n}\n\nexport function uriToContentsPath(child: string, parent?: string) {\n  parent = parent || serverRootUri();\n  if (parent == null) {\n    return null;\n  }\n  const winPaths = isWinPath(parent) && isWinPath(child);\n  if (winPaths) {\n    parent = normalizeWinPath(parent);\n    child = normalizeWinPath(child);\n  }\n  if (child.startsWith(parent)) {\n    // 'decodeURIComponent' is needed over 'decodeURI' for '@' in TS/JS paths\n    return decodeURIComponent(child.replace(parent, ''));\n  }\n  return null;\n}\n\n/**\n * The docs for many language servers show settings in the\n * VSCode format, e.g.: \"pyls.plugins.pyflakes.enabled\"\n *\n * VSCode converts that dot notation to JSON behind the scenes,\n * as the language servers themselves don't accept that syntax.\n */\nexport const expandPath = (\n  path: string[],\n  value: ReadonlyJSONValue\n): ReadonlyJSONObject => {\n  const obj: any = {};\n\n  let curr = obj;\n  path.forEach((prop: string, i: any) => {\n    curr[prop] = {};\n\n    if (i === path.length - 1) {\n      curr[prop] = value;\n    } else {\n      curr = curr[prop];\n    }\n  });\n\n  return obj;\n};\n\nexport const expandDottedPaths = (\n  obj: ReadonlyJSONObject\n): ReadonlyJSONObject => {\n  const settings: any = [];\n  for (let key in obj) {\n    const parsed = expandPath(key.split('.'), obj[key]);\n    settings.push(parsed);\n  }\n  return mergeWith({}, ...settings);\n};\n\ninterface ICollapsingResult {\n  result: Record<string, ReadonlyJSONValue>;\n  conflicts: Record<string, any[]>;\n}\n\nexport function collapseToDotted(obj: ReadonlyJSONObject): ICollapsingResult {\n  const result: Record<string, ReadonlyJSONValue> = {};\n  const conflicts: Record<string, any[]> = {};\n\n  const collapse = (obj: any, root = ''): void => {\n    for (let [key, value] of Object.entries(obj)) {\n      const prefix = root ? root + '.' + key : key;\n      if (\n        value != null &&\n        typeof value === 'object' &&\n        !Array.isArray(value) &&\n        Object.keys(value!).length !== 0\n      ) {\n        collapse(value, prefix);\n      } else {\n        if (result.hasOwnProperty(prefix) && result[prefix] !== value) {\n          if (!conflicts.hasOwnProperty(prefix)) {\n            conflicts[prefix] = [];\n            conflicts[prefix].push(result[prefix]);\n          }\n          if (!conflicts[prefix].includes(value)) {\n            conflicts[prefix].push(value);\n          }\n        }\n        result[prefix] = value as ReadonlyJSONValue;\n      }\n    }\n  };\n  collapse(obj);\n\n  return {\n    result: result as any as ReadonlyJSONObject,\n    conflicts: conflicts\n  };\n}\n\nexport function escapeMarkdown(text: string) {\n  // note: keeping backticks for highlighting of code sections\n  text = text.replace(/([\\\\#*_[\\]])/g, '\\\\$1');\n  // escape HTML\n  const span = document.createElement('span');\n  span.textContent = text;\n  return span.innerHTML.replace(/\\n/g, '<br>').replace(/ {2}/g, '\\u00A0\\u00A0');\n}\n","import { EditorView } from '@codemirror/view';\nimport {\n  CodeJumper,\n  FileEditorJumper,\n  NotebookJumper\n} from '@jupyter-lsp/code-jumpers';\nimport {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\nimport {\n  InputDialog,\n  ICommandPalette,\n  Notification\n} from '@jupyterlab/apputils';\nimport {\n  CodeMirrorEditor,\n  EditorExtensionRegistry\n} from '@jupyterlab/codemirror';\nimport { URLExt } from '@jupyterlab/coreutils';\nimport { IDocumentManager } from '@jupyterlab/docmanager';\nimport { IEditorTracker } from '@jupyterlab/fileeditor';\nimport {\n  IVirtualPosition,\n  ProtocolCoordinates,\n  WidgetLSPAdapter,\n  ILSPFeatureManager,\n  ILSPDocumentConnectionManager\n} from '@jupyterlab/lsp';\nimport { AnyLocation } from '@jupyterlab/lsp/lib/lsp';\nimport { INotebookTracker } from '@jupyterlab/notebook';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport {\n  ITranslator,\n  TranslationBundle,\n  nullTranslator\n} from '@jupyterlab/translation';\nimport { LabIcon } from '@jupyterlab/ui-components';\nimport type * as lsp from 'vscode-languageserver-protocol';\nimport * as lsProtocol from 'vscode-languageserver-protocol';\n\nimport jumpToSvg from '../../style/icons/jump-to.svg';\nimport { CodeJump as LSPJumpSettings, ModifierKey } from '../_jump_to';\nimport { ContextAssembler } from '../context';\nimport {\n  PositionConverter,\n  documentAtRootPosition,\n  editorAtRootPosition,\n  rootPositionToVirtualPosition,\n  rootPositionToEditorPosition\n} from '../converter';\nimport { FeatureSettings, Feature } from '../feature';\nimport { PLUGIN_ID } from '../tokens';\nimport { getModifierState, uriToContentsPath, urisEqual } from '../utils';\nimport { BrowserConsole } from '../virtual/console';\nimport { VirtualDocument } from '../virtual/document';\n\nexport const jumpToIcon = new LabIcon({\n  name: 'lsp:jump-to',\n  svgstr: jumpToSvg\n});\n\nconst jumpBackIcon = new LabIcon({\n  name: 'lsp:jump-back',\n  svgstr: jumpToSvg.replace('jp-icon3', 'lsp-icon-flip-x jp-icon3')\n});\n\nconst enum JumpResult {\n  NoTargetsFound = 1,\n  PositioningFailure = 2,\n  PathResolutionFailure = 3,\n  AssumeSuccess = 4,\n  UnspecifiedFailure = 5,\n  AlreadyAtTarget = 6\n}\n\nexport class NavigationFeature extends Feature {\n  readonly id = NavigationFeature.id;\n  readonly capabilities: lsProtocol.ClientCapabilities = {\n    textDocument: {\n      declaration: {\n        dynamicRegistration: true,\n        linkSupport: true\n      },\n      definition: {\n        dynamicRegistration: true,\n        linkSupport: true\n      },\n      typeDefinition: {\n        dynamicRegistration: true,\n        linkSupport: true\n      },\n      implementation: {\n        dynamicRegistration: true,\n        linkSupport: true\n      }\n    }\n  };\n  protected settings: FeatureSettings<LSPJumpSettings>;\n  protected console = new BrowserConsole().scope('Navigation');\n  protected contextAssembler: ContextAssembler;\n\n  constructor(options: NavigationFeature.IOptions) {\n    super(options);\n    this.settings = options.settings;\n    this._trans = options.trans;\n    this.contextAssembler = options.contextAssembler;\n\n    this.extensionFactory = {\n      name: 'lsp:jump',\n      factory: factoryOptions => {\n        const { widgetAdapter: adapter } = factoryOptions;\n        const clickListener = EditorView.domEventHandlers({\n          mouseup: event => {\n            this._jumpOnMouseUp(event, adapter);\n          }\n        });\n\n        return EditorExtensionRegistry.createImmutableExtension([\n          clickListener\n        ]);\n      }\n    };\n\n    this._jumpers = new Map();\n    const { fileEditorTracker, notebookTracker, documentManager } = options;\n\n    if (fileEditorTracker !== null) {\n      fileEditorTracker.widgetAdded.connect((_, widget) => {\n        let fileEditor = widget.content;\n\n        if (fileEditor.editor instanceof CodeMirrorEditor) {\n          let jumper = new FileEditorJumper(widget, documentManager);\n          this._jumpers.set(widget.id, jumper);\n        }\n      });\n    }\n\n    notebookTracker.widgetAdded.connect(async (_, widget) => {\n      let jumper = new NotebookJumper(widget, documentManager);\n      this._jumpers.set(widget.id, jumper);\n    });\n  }\n\n  getJumper(adapter: WidgetLSPAdapter<any>): CodeJumper {\n    let current = adapter.widget.id;\n    return this._jumpers.get(current)!;\n  }\n\n  protected get modifierKey(): ModifierKey {\n    return this.settings.composite.modifierKey;\n  }\n\n  private _jumpOnMouseUp(event: MouseEvent, adapter: WidgetLSPAdapter<any>) {\n    // For Alt + click we need to wait for mouse up to enable users to create\n    // rectangular selections with Alt + drag.\n    if (this.modifierKey === 'Alt') {\n      document.body.addEventListener(\n        'mouseup',\n        (mouseUpEvent: MouseEvent) => {\n          if (mouseUpEvent.target !== event.target) {\n            // Cursor moved, possibly block selection was attempted, see:\n            // https://github.com/jupyter-lsp/jupyterlab-lsp/issues/823\n            return;\n          }\n          return this._jumpToDefinitionOrRefernce(event, adapter);\n        },\n        {\n          once: true\n        }\n      );\n    } else {\n      // For Ctrl + click we need to act on mouse down to prevent\n      // adding multiple cursors if jump were to occur.\n      return this._jumpToDefinitionOrRefernce(event, adapter);\n    }\n  }\n\n  private _jumpToDefinitionOrRefernce(\n    event: MouseEvent,\n    adapter: WidgetLSPAdapter<any>\n  ) {\n    const { button } = event;\n    const shouldJump =\n      button === 0 && getModifierState(event, this.modifierKey);\n    if (!shouldJump) {\n      return;\n    }\n\n    const accessorFromNode = this.contextAssembler.editorFromNode(\n      adapter,\n      event.target as HTMLElement\n    );\n    if (!accessorFromNode) {\n      this.console.warn(\n        'Editor accessor not found from node, falling back to activeEditor'\n      );\n    }\n    const editorAccessor = accessorFromNode\n      ? accessorFromNode\n      : adapter.activeEditor;\n\n    const rootPosition = this.contextAssembler.positionFromCoordinates(\n      event.clientX,\n      event.clientY,\n      adapter,\n      editorAccessor\n    );\n\n    if (rootPosition == null) {\n      this.console.warn(\n        'Could not retrieve root position from mouse event to jump to definition/reference'\n      );\n      return;\n    }\n\n    const virtualPosition = rootPositionToVirtualPosition(\n      adapter,\n      rootPosition\n    );\n    const document = documentAtRootPosition(adapter, rootPosition);\n\n    const connection = this.connectionManager.connections.get(document.uri)!;\n\n    const positionParams: lsp.TextDocumentPositionParams = {\n      textDocument: {\n        uri: document.documentInfo.uri\n      },\n      position: {\n        line: virtualPosition.line,\n        character: virtualPosition.ch\n      }\n    };\n\n    connection.clientRequests['textDocument/definition']\n      .request(positionParams)\n      .then(targets => {\n        this.handleJump(targets, positionParams, adapter, document)\n          .then((result: JumpResult | undefined) => {\n            if (\n              result === JumpResult.NoTargetsFound ||\n              result === JumpResult.AlreadyAtTarget\n            ) {\n              // definition was not found, or we are in definition already, suggest references\n              connection.clientRequests['textDocument/references']\n                .request({\n                  ...positionParams,\n                  context: { includeDeclaration: false }\n                })\n                .then(targets =>\n                  // TODO: explain that we are now presenting references?\n                  this.handleJump(targets, positionParams, adapter, document)\n                )\n                .catch(this.console.warn);\n            }\n          })\n          .catch(this.console.warn);\n      })\n      .catch(this.console.warn);\n\n    event.preventDefault();\n    event.stopPropagation();\n  }\n\n  private _harmonizeLocations(locationData: AnyLocation): lsp.Location[] {\n    if (locationData == null) {\n      return [];\n    }\n\n    const locationsList = Array.isArray(locationData)\n      ? locationData\n      : [locationData];\n\n    return (locationsList as (lsp.Location | lsp.LocationLink)[])\n      .map((locationOrLink): lsp.Location | undefined => {\n        if ('targetUri' in locationOrLink) {\n          return {\n            uri: locationOrLink.targetUri,\n            range: locationOrLink.targetRange\n          };\n        } else if ('uri' in locationOrLink) {\n          return {\n            uri: locationOrLink.uri,\n            range: locationOrLink.range\n          };\n        } else {\n          this.console.warn(\n            'Returned jump location is incorrect (no uri or targetUri):',\n            locationOrLink\n          );\n          return undefined;\n        }\n      })\n      .filter((location): location is lsp.Location => location != null);\n  }\n\n  private async _chooseTarget(locations: lsp.Location[]) {\n    if (locations.length > 1) {\n      const choices = locations.map(location => {\n        // TODO: extract the line, the line above and below, and show it\n        const path = this._resolvePath(location.uri) || location.uri;\n        return path + ', line: ' + location.range.start.line;\n      });\n\n      // TODO: use selector with preview, basically needs the ui-component\n      // from jupyterlab-citation-manager; let's try to move it to JupyterLab core\n      // (and re-implement command palette with it)\n      // the preview should use this.jumper.document_manager.services.contents\n\n      let getItemOptions = {\n        title: this._trans.__('Choose the jump target'),\n        okLabel: this._trans.__('Jump'),\n        items: choices\n      };\n      // TODO: use showHints() or completion-like widget instead?\n      const choice = await InputDialog.getItem(getItemOptions).catch(\n        this.console.warn\n      );\n      if (!choice || choice.value == null) {\n        this.console.warn('No choice selected for jump location selection');\n        return;\n      }\n      const choiceIndex = choices.indexOf(choice.value);\n      if (choiceIndex === -1) {\n        this.console.error(\n          'Choice selection error: please report this as a bug:',\n          choices,\n          choice\n        );\n        return;\n      }\n      return locations[choiceIndex];\n    } else {\n      return locations[0];\n    }\n  }\n\n  private _resolvePath(uri: string): string | null {\n    let contentsPath = uriToContentsPath(uri);\n\n    if (contentsPath == null) {\n      if (uri.startsWith('file://')) {\n        contentsPath = decodeURIComponent(uri.slice(7));\n      } else {\n        contentsPath = decodeURIComponent(uri);\n      }\n    }\n    return contentsPath;\n  }\n\n  async handleJump(\n    locationData: AnyLocation,\n    positionParams: lsp.TextDocumentPositionParams,\n    adapter: WidgetLSPAdapter<any>,\n    document: VirtualDocument\n  ) {\n    const locations = this._harmonizeLocations(locationData);\n    const targetInfo = await this._chooseTarget(locations);\n    const jumper = this.getJumper(adapter);\n\n    if (!targetInfo) {\n      Notification.info(this._trans.__('No jump targets found'), {\n        autoClose: 3 * 1000\n      });\n      return JumpResult.NoTargetsFound;\n    }\n\n    let { uri, range } = targetInfo;\n\n    let virtualPosition = PositionConverter.lsp_to_cm(\n      range.start\n    ) as IVirtualPosition;\n\n    if (urisEqual(uri, positionParams.textDocument.uri)) {\n      // if in current file, transform from the position within virtual document to the editor position:\n\n      // because `openForeign()` does not use new this.constructor, we need to workaround it for now:\n      // const rootPosition = document.transformVirtualToRoot(virtualPosition);\n      // https://github.com/jupyterlab/jupyterlab/issues/15126\n      const rootPosition =\n        VirtualDocument.prototype.transformVirtualToRoot.call(\n          document,\n          virtualPosition\n        );\n\n      if (rootPosition === null) {\n        this.console.warn(\n          'Could not jump: conversion from virtual position to editor position failed',\n          virtualPosition\n        );\n        return JumpResult.PositioningFailure;\n      }\n      const editorPosition = rootPositionToEditorPosition(\n        adapter,\n        rootPosition\n      );\n\n      const editorAccessor = editorAtRootPosition(adapter, rootPosition);\n\n      // TODO: getEditorIndex should work, but does not\n      // adapter.getEditorIndex(editorAccessor)\n      await editorAccessor.reveal();\n      const editor = editorAccessor.getEditor();\n      const editorIndex = adapter.editors.findIndex(\n        e => e.ceEditor.getEditor() === editor\n      );\n      if (editorIndex === -1) {\n        return JumpResult.PositioningFailure;\n      }\n\n      this.console.log(`Jumping to ${editorIndex}th editor of ${uri}`);\n      this.console.log('Jump target within editor:', editorPosition);\n\n      let contentsPath = adapter.widget.context.path;\n\n      const didUserChooseThis = locations.length > 1;\n\n      // note: we already know that URIs are equal, so just check the position range\n      if (\n        !didUserChooseThis &&\n        ProtocolCoordinates.isWithinRange(positionParams.position, range)\n      ) {\n        return JumpResult.AlreadyAtTarget;\n      }\n\n      jumper.globalJump({\n        line: editorPosition.line,\n        column: editorPosition.ch,\n        editorIndex,\n        isSymlink: false,\n        contentsPath\n      });\n      return JumpResult.AssumeSuccess;\n    } else {\n      // otherwise there is no virtual document and we expect the returned position to be source position:\n      let sourcePosition = PositionConverter.cm_to_ce(virtualPosition);\n      this.console.log(`Jumping to external file: ${uri}`);\n      this.console.log('Jump target (source location):', sourcePosition);\n\n      let jumpData = {\n        editorIndex: 0,\n        line: sourcePosition.line,\n        column: sourcePosition.column\n      };\n\n      // assume that we got a relative path to a file within the project\n      // TODO use is_relative() or something? It would need to be not only compatible\n      //  with different OSes but also with JupyterHub and other platforms.\n\n      // can it be resolved vs our guessed server root?\n      const contentsPath = this._resolvePath(uri);\n\n      if (contentsPath === null) {\n        this.console.warn('contents_path could not be resolved');\n        return JumpResult.PathResolutionFailure;\n      }\n\n      try {\n        await jumper.documentManager.services.contents.get(contentsPath, {\n          content: false\n        });\n        jumper.globalJump({\n          contentsPath,\n          ...jumpData,\n          isSymlink: false\n        });\n        return JumpResult.AssumeSuccess;\n      } catch (err) {\n        this.console.warn(err);\n      }\n\n      // TODO: user debugger source request?\n      jumper.globalJump({\n        contentsPath: URLExt.join('.lsp_symlink', contentsPath),\n        ...jumpData,\n        isSymlink: true\n      });\n      return JumpResult.AssumeSuccess;\n    }\n  }\n\n  private _trans: TranslationBundle;\n  private _jumpers: Map<string, CodeJumper>;\n}\n\nexport namespace NavigationFeature {\n  export interface IOptions extends Feature.IOptions {\n    settings: FeatureSettings<LSPJumpSettings>;\n    trans: TranslationBundle;\n    notebookTracker: INotebookTracker;\n    documentManager: IDocumentManager;\n    contextAssembler: ContextAssembler;\n    fileEditorTracker: IEditorTracker | null;\n  }\n  export const id = PLUGIN_ID + ':jump_to';\n}\n\nexport namespace CommandIDs {\n  export const jumpToDefinition = 'lsp:jump-to-definition';\n  export const jumpToReference = 'lsp:jump-to-reference';\n  export const jumpBack = 'lsp:jump-back';\n}\n\nexport const JUMP_PLUGIN: JupyterFrontEndPlugin<void> = {\n  id: NavigationFeature.id,\n  requires: [\n    ILSPFeatureManager,\n    ISettingRegistry,\n    ILSPDocumentConnectionManager,\n    INotebookTracker,\n    IDocumentManager\n  ],\n  optional: [IEditorTracker, ICommandPalette, ITranslator],\n  autoStart: true,\n  activate: async (\n    app: JupyterFrontEnd,\n    featureManager: ILSPFeatureManager,\n    settingRegistry: ISettingRegistry,\n    connectionManager: ILSPDocumentConnectionManager,\n    notebookTracker: INotebookTracker,\n    documentManager: IDocumentManager,\n    fileEditorTracker: IEditorTracker | null,\n    palette: ICommandPalette | null,\n    translator: ITranslator | null\n  ) => {\n    const trans = (translator || nullTranslator).load('jupyterlab_lsp');\n    const contextAssembler = new ContextAssembler({ app, connectionManager });\n    const settings = new FeatureSettings<LSPJumpSettings>(\n      settingRegistry,\n      NavigationFeature.id\n    );\n    await settings.ready;\n\n    if (settings.composite.disable) {\n      return;\n    }\n\n    const feature = new NavigationFeature({\n      settings,\n      connectionManager,\n      notebookTracker,\n      documentManager,\n      fileEditorTracker,\n      contextAssembler,\n      trans\n    });\n    featureManager.register(feature);\n\n    app.commands.addCommand(CommandIDs.jumpToDefinition, {\n      execute: async () => {\n        const context = contextAssembler.getContext();\n        if (!context) {\n          console.warn('Could not get context');\n          return;\n        }\n        const { connection, virtualPosition, document, adapter } = context;\n\n        if (!connection) {\n          Notification.warning(trans.__('Connection not found for jump'), {\n            autoClose: 4 * 1000\n          });\n          return;\n        }\n\n        const positionParams: lsp.TextDocumentPositionParams = {\n          textDocument: {\n            uri: document.documentInfo.uri\n          },\n          position: {\n            line: virtualPosition.line,\n            character: virtualPosition.ch\n          }\n        };\n        const targets = await connection.clientRequests[\n          'textDocument/definition'\n        ].request(positionParams);\n        await feature.handleJump(targets, positionParams, adapter, document);\n      },\n      label: trans.__('Jump to definition'),\n      icon: jumpToIcon,\n      isEnabled: () => {\n        const context = contextAssembler.getContext();\n        if (!context) {\n          console.debug('Could not get context');\n          return false;\n        }\n        const { connection } = context;\n        return connection ? connection.provides('definitionProvider') : false;\n      }\n    });\n\n    app.commands.addCommand(CommandIDs.jumpToReference, {\n      execute: async () => {\n        const context = contextAssembler.getContext();\n        if (!context) {\n          console.warn('Could not get context');\n          return;\n        }\n        const { connection, virtualPosition, document, adapter } = context;\n\n        if (!connection) {\n          Notification.warning(trans.__('Connection not found for jump'), {\n            autoClose: 5 * 1000\n          });\n          return;\n        }\n\n        const positionParams: lsp.TextDocumentPositionParams = {\n          textDocument: {\n            uri: document.documentInfo.uri\n          },\n          position: {\n            line: virtualPosition.line,\n            character: virtualPosition.ch\n          }\n        };\n        const targets = await connection.clientRequests[\n          'textDocument/references'\n        ].request({\n          ...positionParams,\n          context: { includeDeclaration: false }\n        });\n        await feature.handleJump(targets, positionParams, adapter, document);\n      },\n      label: trans.__('Jump to references'),\n      icon: jumpToIcon,\n      isEnabled: () => {\n        const context = contextAssembler.getContext();\n        if (!context) {\n          console.debug('Could not get context');\n          return false;\n        }\n        const { connection } = context;\n        return connection ? connection.provides('referencesProvider') : false;\n      }\n    });\n\n    app.commands.addCommand(CommandIDs.jumpBack, {\n      execute: async () => {\n        const context = contextAssembler.getContext();\n        if (!context) {\n          console.warn('Could not get context');\n          return;\n        }\n        feature.getJumper(context.adapter).globalJumpBack();\n      },\n      label: trans.__('Jump back'),\n      icon: jumpBackIcon,\n      isEnabled: () => {\n        const context = contextAssembler.getContext();\n        if (!context) {\n          console.debug('Could not get context');\n          return false;\n        }\n        const { connection } = context;\n        return connection\n          ? connection.provides('definitionProvider') ||\n              connection.provides('referencesProvider')\n          : false;\n      }\n    });\n\n    for (const commandID of [\n      CommandIDs.jumpToDefinition,\n      CommandIDs.jumpToReference\n    ]) {\n      // add to menus\n      app.contextMenu.addItem({\n        selector: '.jp-Notebook .jp-CodeCell .jp-Editor',\n        command: commandID,\n        rank: 10\n      });\n\n      app.contextMenu.addItem({\n        selector: '.jp-FileEditor',\n        command: commandID,\n        rank: 0\n      });\n    }\n\n    for (const commandID of [\n      CommandIDs.jumpToDefinition,\n      CommandIDs.jumpToReference,\n      CommandIDs.jumpBack\n    ]) {\n      if (palette) {\n        palette.addItem({\n          command: commandID,\n          category: trans.__('Language Server Protocol')\n        });\n      }\n    }\n  }\n};\n","\n      import API from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../node_modules/css-loader/dist/cjs.js!./diagnostics_listing.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../node_modules/css-loader/dist/cjs.js!./diagnostics_listing.css\";\n       export default content && content.locals ? content.locals : undefined;\n","import { VDomModel, VDomRenderer } from '@jupyterlab/apputils';\nimport { IDocumentWidget } from '@jupyterlab/docregistry';\nimport { VirtualDocument, WidgetLSPAdapter } from '@jupyterlab/lsp';\nimport { TranslationBundle } from '@jupyterlab/translation';\nimport { caretDownIcon, caretUpIcon } from '@jupyterlab/ui-components';\nimport React, { ReactElement } from 'react';\nimport * as lsProtocol from 'vscode-languageserver-protocol';\n\nimport { CodeDiagnostics as LSPDiagnosticsSettings } from '../../_diagnostics';\nimport { DocumentLocator } from '../../components/utils';\nimport { PositionConverter } from '../../converter';\nimport { IFeatureSettings } from '../../feature';\nimport { DiagnosticSeverity } from '../../lsp';\n\nimport { IEditorDiagnostic } from './tokens';\n\nimport '../../../style/diagnostics_listing.css';\n\nexport const DIAGNOSTICS_LISTING_CLASS = 'lsp-diagnostics-listing';\nconst DIAGNOSTICS_PLACEHOLDER_CLASS = 'lsp-diagnostics-placeholder';\n\nexport class DiagnosticsDatabase extends Map<\n  VirtualDocument,\n  IEditorDiagnostic[]\n> {\n  get all(): IEditorDiagnostic[] {\n    return [].concat.apply([], this.values() as any);\n  }\n}\n\nexport interface IDiagnosticsRow {\n  data: IEditorDiagnostic;\n  key: string;\n  document: VirtualDocument;\n  /**\n   * Cell number is the ordinal, 1-based cell identifier displayed to the user.\n   */\n  cellNumber?: number;\n}\n\ninterface IListingContext {\n  db: DiagnosticsDatabase;\n  adapter: WidgetLSPAdapter<IDocumentWidget>;\n}\n\ninterface IColumnOptions {\n  id: string;\n  label: string;\n  renderCell(data: IDiagnosticsRow, context?: IListingContext): ReactElement;\n  sort(a: IDiagnosticsRow, b: IDiagnosticsRow): number;\n  isAvailable?(context: IListingContext): boolean;\n}\n\nclass Column {\n  public isVisible: boolean;\n\n  constructor(private options: IColumnOptions) {\n    this.isVisible = true;\n  }\n\n  renderCell(data: IDiagnosticsRow, context: IListingContext) {\n    return this.options.renderCell(data, context);\n  }\n\n  sort(a: IDiagnosticsRow, b: IDiagnosticsRow) {\n    return this.options.sort(a, b);\n  }\n\n  get id(): string {\n    return this.options.id;\n  }\n\n  isAvailable(context: IListingContext) {\n    if (this.options.isAvailable != null) {\n      return this.options.isAvailable(context);\n    }\n    return true;\n  }\n\n  renderHeader(listing: DiagnosticsListing): ReactElement {\n    return (\n      <SortableTH\n        label={this.options.label}\n        id={this.id}\n        listing={listing}\n        key={this.id}\n      />\n    );\n  }\n}\n\nfunction SortableTH(props: {\n  id: string;\n  label: string;\n  listing: DiagnosticsListing;\n}): ReactElement {\n  const isSortKey = props.id === props.listing.sortKey;\n  const sortIcon =\n    !isSortKey || props.listing.sortDirection === 1\n      ? caretUpIcon\n      : caretDownIcon;\n  return (\n    <th\n      key={props.id}\n      onClick={() => props.listing.sort(props.id)}\n      className={isSortKey ? 'lsp-sorted-header' : undefined}\n      data-id={props.id}\n    >\n      <div>\n        <label>{props.label}</label>\n        <sortIcon.react tag=\"span\" className=\"lsp-sort-icon\" />\n      </div>\n    </th>\n  );\n}\n\nexport function messageWithoutCode(diagnostic: lsProtocol.Diagnostic) {\n  let message = diagnostic.message;\n  let codeString = '' + diagnostic.code;\n  if (\n    diagnostic.code != null &&\n    diagnostic.code !== '' &&\n    message.startsWith(codeString + '')\n  ) {\n    return message.slice(codeString.length).trim();\n  }\n  return message;\n}\n\nexport class DiagnosticsListing extends VDomRenderer<DiagnosticsListing.Model> {\n  sortKey = 'Severity';\n  sortDirection = 1;\n  private _diagnostics: Map<string, IDiagnosticsRow>;\n  protected trans: TranslationBundle;\n  public columns: Column[];\n  protected severityTranslations: Record<\n    keyof typeof DiagnosticSeverity,\n    string\n  >;\n\n  constructor(model: DiagnosticsListing.Model) {\n    super(model);\n    const trans = model.trans;\n    this.trans = trans;\n    this.severityTranslations = {\n      Error: trans.__('Error'),\n      Warning: trans.__('Warning'),\n      Information: trans.__('Information'),\n      Hint: trans.__('Hint')\n    };\n\n    this.columns = [\n      new Column({\n        id: 'Virtual Document',\n        label: this.trans.__('Virtual Document'),\n        renderCell: (row, context: IListingContext) => (\n          <td key={0}>\n            <DocumentLocator\n              document={row.document}\n              adapter={context.adapter}\n              trans={this.trans}\n            />\n          </td>\n        ),\n        sort: (a, b) => a.document.idPath.localeCompare(b.document.idPath),\n        isAvailable: context => context.db.size > 1\n      }),\n      new Column({\n        id: 'Message',\n        label: this.trans.__('Message'),\n        renderCell: row => {\n          let message = messageWithoutCode(row.data.diagnostic);\n          return <td key={1}>{message}</td>;\n        },\n        sort: (a, b) =>\n          a.data.diagnostic.message.localeCompare(b.data.diagnostic.message)\n      }),\n      new Column({\n        id: 'Code',\n        label: this.trans.__('Code'),\n        renderCell: row => <td key={2}>{row.data.diagnostic.code}</td>,\n        sort: (a, b) =>\n          (a.data.diagnostic.code + '').localeCompare(\n            b.data.diagnostic.source + ''\n          )\n      }),\n      new Column({\n        id: 'Severity',\n        label: this.trans.__('Severity'),\n        // TODO: use default diagnostic severity\n        renderCell: row => {\n          const severity = DiagnosticSeverity[\n            row.data.diagnostic.severity || 1\n          ] as keyof typeof DiagnosticSeverity;\n          return (\n            <td key={3}>{this.severityTranslations[severity] || severity}</td>\n          );\n        },\n        sort: (a, b) => {\n          if (!a.data.diagnostic.severity) {\n            return +1;\n          }\n          if (!b.data.diagnostic.severity) {\n            return -1;\n          }\n          return a.data.diagnostic.severity > b.data.diagnostic.severity\n            ? 1\n            : -1;\n        }\n      }),\n      new Column({\n        id: 'Source',\n        label: this.trans.__('Source'),\n        renderCell: row => <td key={4}>{row.data.diagnostic.source}</td>,\n        sort: (a, b) => {\n          if (!a.data.diagnostic.source) {\n            return +1;\n          }\n          if (!b.data.diagnostic.source) {\n            return -1;\n          }\n          return a.data.diagnostic.source.localeCompare(\n            b.data.diagnostic.source\n          );\n        }\n      }),\n      new Column({\n        id: 'Cell',\n        label: this.trans.__('Cell'),\n        renderCell: row => <td key={5}>{row.cellNumber}</td>,\n        sort: (a, b) =>\n          a.cellNumber! - b.cellNumber! ||\n          a.data.range.start.line - b.data.range.start.line ||\n          a.data.range.start.ch - b.data.range.start.ch,\n        isAvailable: context => context.adapter.hasMultipleEditors\n      }),\n      new Column({\n        id: 'Line:Ch',\n        label: this.trans.__('Line:Ch'),\n        renderCell: row => (\n          <td key={6}>\n            {row.data.range.start.line}:{row.data.range.start.ch}\n          </td>\n        ),\n        sort: (a, b) =>\n          a.data.range.start.line - b.data.range.start.line ||\n          a.data.range.start.ch - b.data.range.start.ch\n      })\n    ];\n  }\n\n  sort(key: string) {\n    if (key === this.sortKey) {\n      this.sortDirection = this.sortDirection * -1;\n    } else {\n      this.sortKey = key;\n      this.sortDirection = 1;\n    }\n    this.update();\n  }\n\n  render() {\n    let diagnosticsDatabase = this.model.diagnostics;\n    const adapter = this.model.adapter;\n    if (diagnosticsDatabase == null || !adapter) {\n      return (\n        <div className={DIAGNOSTICS_PLACEHOLDER_CLASS}>\n          <h3>No diagnostics</h3>\n          {this.trans.__(\n            'Diagnostics panel shows linting results in notebooks and files connected to a language server.'\n          )}\n        </div>\n      );\n    }\n    if (diagnosticsDatabase.size === 0) {\n      return (\n        <div className={DIAGNOSTICS_PLACEHOLDER_CLASS}>\n          {this.trans.__('No issues detected, great job!')}\n        </div>\n      );\n    }\n\n    let byDocument = Array.from(diagnosticsDatabase).map(\n      ([virtualDocument, diagnostics]) => {\n        if (virtualDocument.isDisposed) {\n          return [];\n        }\n        return diagnostics.map((diagnosticData, i) => {\n          let cellNumber: number | null = null;\n          if (adapter.hasMultipleEditors) {\n            const cellIndex = adapter.editors.findIndex(\n              value => value.ceEditor == diagnosticData.editorAccessor\n            );\n            cellNumber = cellIndex + 1;\n          }\n          return {\n            data: diagnosticData,\n            key: virtualDocument.uri + ',' + i,\n            document: virtualDocument,\n            cellNumber: cellNumber\n          } as IDiagnosticsRow;\n        });\n      }\n    );\n    let flattened: IDiagnosticsRow[] = ([] as IDiagnosticsRow[]).concat.apply(\n      [],\n      byDocument\n    );\n    this._diagnostics = new Map(flattened.map(row => [row.key, row]));\n\n    let sortedColumn = this.columns.filter(\n      column => column.id === this.sortKey\n    )[0];\n    let sorter = sortedColumn.sort.bind(sortedColumn);\n    let sorted = flattened.sort((a, b) => sorter(a, b) * this.sortDirection);\n\n    let context: IListingContext = {\n      db: diagnosticsDatabase,\n      adapter: adapter\n    };\n\n    let columnsToDisplay = this.columns.filter(\n      column => column.isAvailable(context) && column.isVisible\n    );\n\n    let elements = sorted.map(row => {\n      let cells = columnsToDisplay.map(column =>\n        column.renderCell(row, context)\n      );\n\n      return (\n        <tr\n          key={row.key}\n          data-key={row.key}\n          onClick={() => {\n            return this.jumpTo(row);\n          }}\n        >\n          {cells}\n        </tr>\n      );\n    });\n\n    let columnsHeaders = columnsToDisplay.map(column =>\n      column.renderHeader(this)\n    );\n\n    return (\n      <table className={DIAGNOSTICS_LISTING_CLASS}>\n        <thead>\n          <tr>{columnsHeaders}</tr>\n        </thead>\n        <tbody>{elements}</tbody>\n      </table>\n    );\n  }\n\n  getDiagnostic(key: string): IDiagnosticsRow | undefined {\n    if (!this._diagnostics.has(key)) {\n      console.warn('Could not find the diagnostics row with key', key);\n      return;\n    }\n    return this._diagnostics.get(key);\n  }\n\n  async jumpTo(row: IDiagnosticsRow): Promise<void> {\n    const editor = await row.data.editorAccessor.reveal();\n    editor.setCursorPosition(PositionConverter.cm_to_ce(row.data.range.start));\n    editor.focus();\n  }\n}\n\nexport namespace DiagnosticsListing {\n  /**\n   * A VDomModel for the LSP of current file editor/notebook.\n   */\n  export class Model extends VDomModel {\n    diagnostics: DiagnosticsDatabase | null;\n    adapter: WidgetLSPAdapter<any> | null;\n    settings: IFeatureSettings<LSPDiagnosticsSettings>;\n    trans: TranslationBundle;\n\n    constructor(translatorBundle: TranslationBundle) {\n      super();\n      this.trans = translatorBundle;\n    }\n  }\n}\n","import { JupyterFrontEnd } from '@jupyterlab/application';\nimport { MainAreaWidget, Notification } from '@jupyterlab/apputils';\nimport { nullTranslator, TranslationBundle } from '@jupyterlab/translation';\nimport { LabIcon, copyIcon } from '@jupyterlab/ui-components';\nimport { Menu } from '@lumino/widgets';\n\nimport diagnosticsSvg from '../../../style/icons/diagnostics.svg';\nimport { jumpToIcon } from '../jump_to';\n\nimport { DiagnosticsFeature } from './feature';\nimport {\n  DIAGNOSTICS_LISTING_CLASS,\n  DiagnosticsDatabase,\n  DiagnosticsListing,\n  IDiagnosticsRow\n} from './listing';\n\nexport const diagnosticsIcon = new LabIcon({\n  name: 'lsp:diagnostics',\n  svgstr: diagnosticsSvg\n});\n\nconst CMD_COLUMN_VISIBILITY = 'lsp-set-column-visibility';\nconst CMD_JUMP_TO_DIAGNOSTIC = 'lsp-jump-to-diagnostic';\nconst CMD_COPY_DIAGNOSTIC = 'lsp-copy-diagnostic';\nconst CMD_IGNORE_DIAGNOSTIC_CODE = 'lsp-ignore-diagnostic-code';\nconst CMD_IGNORE_DIAGNOSTIC_MSG = 'lsp-ignore-diagnostic-message';\n\n/**\n * Escape pattern to form a base of a regular expression.\n * The snippet comes from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#Escaping\n * and is in the Public Domain (CC0):\n *  > Any copyright is dedicated to the Public Domain.\n *  > http://creativecommons.org/publicdomain/zero/1.0/\n */\nfunction escapeRegExp(string: string) {\n  return string.replace(/[.*+\\-?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nclass DiagnosticsPanel {\n  private _content: DiagnosticsListing | null = null;\n  private _widget: MainAreaWidget<DiagnosticsListing> | null = null;\n  feature: DiagnosticsFeature;\n  isRegistered = false;\n  trans: TranslationBundle;\n\n  constructor(trans: TranslationBundle) {\n    this.trans = trans;\n  }\n\n  get widget() {\n    if (this._widget == null || this._widget.content.model == null) {\n      if (this._widget && !this._widget.isDisposed) {\n        this._widget.dispose();\n      }\n      this._widget = this.initWidget();\n    }\n    return this._widget;\n  }\n\n  get content() {\n    return this.widget.content;\n  }\n\n  protected initWidget() {\n    this._content = new DiagnosticsListing(\n      new DiagnosticsListing.Model(this.trans)\n    );\n    this._content.model.diagnostics = new DiagnosticsDatabase();\n    this._content.addClass('lsp-diagnostics-panel-content');\n    const widget = new MainAreaWidget({ content: this._content });\n    widget.id = 'lsp-diagnostics-panel';\n    widget.title.label = this.trans.__('Diagnostics Panel');\n    widget.title.closable = true;\n    widget.title.icon = diagnosticsIcon;\n    return widget;\n  }\n\n  update() {\n    // if not attached, do not bother to update\n    if (!this.widget.isAttached) {\n      return;\n    }\n    this.widget.content.update();\n  }\n\n  register(app: JupyterFrontEnd) {\n    const widget = this.widget;\n\n    let getColumn = (id: string) => {\n      // TODO: a hashmap in the panel itself?\n      for (let column of widget.content.columns) {\n        if (column.id === id) {\n          return column;\n        }\n      }\n      return undefined;\n    };\n\n    /** Columns Menu **/\n    let columnsMenu = new Menu({ commands: app.commands });\n    columnsMenu.title.label = this.trans.__('Panel columns');\n\n    app.commands.addCommand(CMD_COLUMN_VISIBILITY, {\n      execute: args => {\n        let column = getColumn(args['id'] as string)!;\n        column.isVisible = !column.isVisible;\n        widget.update();\n      },\n      label: args => this.trans.__(args['id'] as string),\n      isToggled: args => {\n        let column = getColumn(args['id'] as string);\n        return column ? column.isVisible : false;\n      }\n    });\n\n    for (let column of widget.content.columns) {\n      columnsMenu.addItem({\n        command: CMD_COLUMN_VISIBILITY,\n        args: { id: column.id }\n      });\n    }\n    app.contextMenu.addItem({\n      selector: '.' + DIAGNOSTICS_LISTING_CLASS + ' th',\n      submenu: columnsMenu,\n      type: 'submenu'\n    });\n\n    /** Diagnostics Menu **/\n    let ignoreDiagnosticsMenu = new Menu({ commands: app.commands });\n    ignoreDiagnosticsMenu.title.label = this.trans.__(\n      'Ignore diagnostics like this'\n    );\n\n    let getRow = (): IDiagnosticsRow | undefined => {\n      let tr = app.contextMenuHitTest(\n        node => node.tagName.toLowerCase() == 'tr'\n      );\n      if (!tr) {\n        return;\n      }\n      return this.widget.content.getDiagnostic(tr.dataset.key!);\n    };\n\n    ignoreDiagnosticsMenu.addItem({\n      command: CMD_IGNORE_DIAGNOSTIC_CODE\n    });\n    ignoreDiagnosticsMenu.addItem({\n      command: CMD_IGNORE_DIAGNOSTIC_MSG\n    });\n    app.commands.addCommand(CMD_IGNORE_DIAGNOSTIC_CODE, {\n      execute: () => {\n        const row = getRow();\n        if (!row) {\n          console.warn(\n            'LPS: diagnostics row not found for ignore code execute()'\n          );\n          return;\n        }\n        const diagnostic = row.data.diagnostic;\n        let current = this.content.model.settings.composite.ignoreCodes;\n        this.content.model.settings.set('ignoreCodes', [\n          ...current,\n          diagnostic.code\n        ]);\n        this.feature.refreshDiagnostics();\n      },\n      isVisible: () => {\n        const row = getRow();\n        if (!row) {\n          return false;\n        }\n        const diagnostic = row.data.diagnostic;\n        return !!diagnostic.code;\n      },\n      label: () => {\n        const row = getRow();\n        if (!row) {\n          return '';\n        }\n        const diagnostic = row.data.diagnostic;\n        return this.trans.__(\n          'Ignore diagnostics with \"%1\" code',\n          diagnostic.code\n        );\n      }\n    });\n    app.commands.addCommand(CMD_IGNORE_DIAGNOSTIC_MSG, {\n      execute: () => {\n        const row = getRow();\n        if (!row) {\n          console.warn(\n            'LPS: diagnostics row not found for ignore message execute()'\n          );\n          return;\n        }\n        const diagnostic = row.data.diagnostic;\n        let current =\n          this.content.model.settings.composite.ignoreMessagesPatterns;\n        this.content.model.settings.set('ignoreMessagesPatterns', [\n          ...current,\n          escapeRegExp(diagnostic.message)\n        ]);\n        this.feature.refreshDiagnostics();\n      },\n      isVisible: () => {\n        const row = getRow();\n        if (!row) {\n          return false;\n        }\n        const diagnostic = row.data.diagnostic;\n        return !!diagnostic.message;\n      },\n      label: () => {\n        const row = getRow();\n        if (!row) {\n          return '';\n        }\n        const diagnostic = row.data.diagnostic;\n        return this.trans.__(\n          'Ignore diagnostics with \"%1\" message',\n          diagnostic.message\n        );\n      }\n    });\n\n    app.commands.addCommand(CMD_JUMP_TO_DIAGNOSTIC, {\n      execute: () => {\n        const row = getRow();\n        if (!row) {\n          console.warn('LPS: diagnostics row not found for jump execute()');\n          return;\n        }\n        return this.widget.content.jumpTo(row);\n      },\n      label: this.trans.__('Jump to location'),\n      icon: jumpToIcon\n    });\n\n    app.commands.addCommand(CMD_COPY_DIAGNOSTIC, {\n      execute: () => {\n        const row = getRow();\n        if (!row) {\n          console.warn('LPS: diagnostics row not found for copy execute()');\n          return;\n        }\n        const message = row.data.diagnostic.message;\n        navigator.clipboard\n          .writeText(message)\n          .then(() => {\n            Notification.info(\n              this.trans.__('Successfully copied \"%1\" to clipboard', message),\n              {\n                autoClose: 3 * 1000\n              }\n            );\n          })\n          .catch(() => {\n            console.warn(\n              'Could not copy with clipboard.writeText interface, falling back'\n            );\n            window.prompt(\n              this.trans.__(\n                'Your browser protects clipboard from write operations; please copy the message manually'\n              ),\n              message\n            );\n          });\n      },\n      label: this.trans.__(\"Copy diagnostics' message\"),\n      icon: copyIcon\n    });\n\n    app.contextMenu.addItem({\n      selector: '.' + DIAGNOSTICS_LISTING_CLASS + ' tbody tr',\n      command: CMD_COPY_DIAGNOSTIC\n    });\n    app.contextMenu.addItem({\n      selector: '.' + DIAGNOSTICS_LISTING_CLASS + ' tbody tr',\n      command: CMD_JUMP_TO_DIAGNOSTIC\n    });\n    app.contextMenu.addItem({\n      selector: '.' + DIAGNOSTICS_LISTING_CLASS + ' tbody tr',\n      submenu: ignoreDiagnosticsMenu,\n      type: 'submenu'\n    });\n\n    this.isRegistered = true;\n  }\n}\n\nexport const diagnosticsPanel = new DiagnosticsPanel(\n  nullTranslator.load('jupyterlab_lsp')\n);\n","// MIT License\n// Copyright (C) 2018-2021 by Marijn Haverbeke <marijn@haverbeke.berlin> and others\n\nfunction svg(content: string, attrs = `viewBox=\"0 0 40 40\"`) {\n  return `url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" ${attrs}>${encodeURIComponent(\n    content\n  )}</svg>')`;\n}\n\nexport function underline(color: string) {\n  return svg(\n    `<path d=\"m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0\" stroke=\"${color}\" fill=\"none\" stroke-width=\".7\"/>`,\n    `width=\"6\" height=\"3\"`\n  );\n}\n","import { linter, Diagnostic, lintGutter } from '@codemirror/lint';\nimport { StateField, StateEffect, StateEffectType } from '@codemirror/state';\nimport { EditorView } from '@codemirror/view';\nimport { INotebookShell } from '@jupyter-notebook/application';\nimport { ILabShell } from '@jupyterlab/application';\nimport { IThemeManager } from '@jupyterlab/apputils';\nimport {\n  CodeMirrorEditor,\n  IEditorExtensionRegistry,\n  EditorExtensionRegistry\n} from '@jupyterlab/codemirror';\nimport {\n  WidgetLSPAdapter,\n  IEditorPosition,\n  IVirtualPosition,\n  ILSPConnection,\n  VirtualDocument\n} from '@jupyterlab/lsp';\nimport { TranslationBundle } from '@jupyterlab/translation';\nimport { PromiseDelegate } from '@lumino/coreutils';\nimport { StyleModule } from 'style-mod';\nimport * as lsProtocol from 'vscode-languageserver-protocol';\n\nimport { CodeDiagnostics as LSPDiagnosticsSettings } from '../../_diagnostics';\nimport { PositionConverter } from '../../converter';\nimport { IFeatureSettings, Feature } from '../../feature';\nimport { DiagnosticSeverity, DiagnosticTag } from '../../lsp';\nimport { PLUGIN_ID } from '../../tokens';\nimport { urisEqual } from '../../utils';\nimport { BrowserConsole } from '../../virtual/console';\n\nimport { diagnosticsPanel } from './diagnostics';\nimport { DiagnosticsDatabase } from './listing';\nimport { IDiagnosticsFeature, IEditorDiagnostic } from './tokens';\nimport { underline } from './underline';\n\nconst SeverityMap: Record<\n  1 | 2 | 3 | 4,\n  'error' | 'warning' | 'info' | 'hint'\n> = {\n  1: 'error',\n  2: 'warning',\n  3: 'info',\n  4: 'hint'\n};\n\nexport class DiagnosticsFeature extends Feature implements IDiagnosticsFeature {\n  readonly id = DiagnosticsFeature.id;\n  readonly capabilities: lsProtocol.ClientCapabilities = {\n    textDocument: {\n      publishDiagnostics: {\n        tagSupport: {\n          valueSet: [DiagnosticTag.Deprecated, DiagnosticTag.Unnecessary]\n        }\n      }\n    }\n  };\n  protected settings: IFeatureSettings<LSPDiagnosticsSettings>;\n  protected console = new BrowserConsole().scope('Diagnostics');\n  private _firstResponseReceived: PromiseDelegate<void> = new PromiseDelegate();\n  private _diagnosticsDatabases = new WeakMap<\n    WidgetLSPAdapter<any>,\n    DiagnosticsDatabase\n  >();\n\n  constructor(options: DiagnosticsFeature.IOptions) {\n    super(options);\n    this.settings = options.settings;\n\n    options.connectionManager.connected.connect((manager, connectionData) => {\n      const { connection, virtualDocument } = connectionData;\n      const adapter = manager.adapters.get(virtualDocument.root.path)!;\n      // TODO: unregister\n      connection.serverNotifications['textDocument/publishDiagnostics'].connect(\n        async (connection: ILSPConnection, diagnostics) => {\n          await this.handleDiagnostic(diagnostics, virtualDocument, adapter);\n        }\n      );\n      virtualDocument.foreignDocumentClosed.connect((document, context) => {\n        // TODO: check if we need to cast\n        this.clearDocumentDiagnostics(adapter, context.foreignDocument);\n      });\n    });\n\n    //this.unique_editor_ids = new DefaultMap(() => this.unique_editor_ids.size);\n    this.settings.changed.connect(this.refreshDiagnostics, this);\n    this._trans = options.trans;\n    this._invalidate = StateEffect.define<void>();\n    this._invalidationCounter = StateField.define<number>({\n      create: () => 0,\n      update: (value, tr) => {\n        for (const e of tr.effects) {\n          if (e.is(this._invalidate)) {\n            value += 1;\n          }\n        }\n        return value;\n      }\n    });\n\n    const connectionManager = options.connectionManager;\n    // https://github.com/jupyterlab/jupyterlab/issues/14783\n    options.shell.currentChanged.connect(shell => {\n      if (shell.currentWidget == diagnosticsPanel.widget) {\n        // allow focusing on the panel\n        return;\n      }\n\n      const adapter = [...connectionManager.adapters.values()].find(\n        adapter => adapter.widget == shell.currentWidget\n      );\n\n      if (!adapter) {\n        this.switchDiagnosticsPanelSource(null);\n        // this dance should not be needed once https://github.com/jupyterlab/jupyterlab/pull/14920 is in,\n        // but we will need to continue listening to `currentChanged` signal anyways to make sure we show\n        // empty indicator in launcher or other widget which does not support linting.\n        let attemptsLeft = 3;\n        const retry = () => {\n          const adapter = [...connectionManager.adapters.values()].find(\n            adapter => adapter.widget == shell.currentWidget\n          );\n          attemptsLeft -= 1;\n          if (adapter) {\n            this.switchDiagnosticsPanelSource(adapter);\n            attemptsLeft = 0;\n          }\n          if (attemptsLeft == 0) {\n            connectionManager.connected.disconnect(retry);\n          }\n        };\n        connectionManager.connected.connect(retry);\n        this.console.debug(\n          'No adapter (yet?), will retry on next connected document'\n        );\n      } else {\n        this.switchDiagnosticsPanelSource(adapter);\n      }\n    });\n\n    const settings = options.settings;\n    const themeManager = options.themeManager;\n\n    this._reconfigureTheme();\n    document.head.appendChild(this._styleElement);\n\n    if (themeManager) {\n      themeManager.themeChanged.connect(() => {\n        this._reconfigureTheme();\n      });\n    }\n\n    this.extensionFactory = {\n      name: 'lsp:diagnostics',\n      factory: factoryOptions => {\n        const { widgetAdapter: adapter } = factoryOptions;\n        const source = async (view: EditorView) => {\n          let diagnostics: Diagnostic[] = [];\n          // NHT: `response.version` could be checked against document versions\n          // and if non matches we could yield (raise an error or hang for a\n          // few seconds to trigger timeout). Because `response.version` is\n          // optional it would require further testing.\n\n          if (view.state.field(this._invalidationCounter) == 0) {\n            // If we are displaying the editor for the first time,\n            // e.g. after scrolling down in windowed notebook,\n            // do not wait for next update, show what we already know.\n\n            // TODO: this still fails when scrolling down fast and then\n            // scrolling up to the skipped cells because the state invalidation\n            // counter kicks in but diagnostics does not get rendered yet before\n            // we leave..\n            await this._firstResponseReceived.promise;\n          } else {\n            await adapter.updateFinished;\n          }\n\n          const database = this.getDiagnosticsDB(adapter);\n\n          for (const editorDiagnostics of database.values()) {\n            for (const editorDiagnostic of editorDiagnostics) {\n              const editor = editorDiagnostic.editorAccessor.getEditor() as\n                | CodeMirrorEditor\n                | undefined;\n\n              if (editor?.editor !== view) {\n                continue;\n              }\n              const diagnostic = editorDiagnostic.diagnostic;\n              const severity = SeverityMap[diagnostic.severity!];\n\n              const lines = view.state.doc.lines;\n              const lastLineLength = view.state.doc.line(lines).length;\n              const start = PositionConverter.cm_to_ce(\n                editorDiagnostic.range.start\n              );\n              const end = PositionConverter.cm_to_ce(\n                editorDiagnostic.range.end\n              );\n\n              const from = editor.getOffsetAt(\n                start.line >= lines\n                  ? {\n                      line: Math.min(start.line, lines),\n                      column: Math.min(start.column, lastLineLength)\n                    }\n                  : start\n              );\n              // TODO: this is wrong; there is however an issue if this is not applied\n              const to = editor.getOffsetAt(\n                end.line >= lines\n                  ? {\n                      line: Math.min(end.line, lines),\n                      column: Math.min(end.column, lastLineLength)\n                    }\n                  : end\n              );\n\n              const classNames = [];\n              for (const tag of new Set(diagnostic.tags)) {\n                classNames.push('cm-lsp-diagnostic-tag-' + DiagnosticTag[tag]);\n              }\n\n              diagnostics.push({\n                from: Math.min(from, view.state.doc.length),\n                to: Math.min(to, view.state.doc.length),\n                severity: severity,\n                message: diagnostic.message,\n                source: diagnostic.source,\n                markClass: classNames.join(' ')\n                // TODO: actions\n              });\n            }\n          }\n          return diagnostics;\n        };\n\n        // never run linter on typing - we will trigger it manually when update is needed\n        const lspLinter = linter(source, {\n          delay: settings.composite.debounceDelay || 250,\n          needsRefresh: update => {\n            const previous = update.startState.field(this._invalidationCounter);\n            const current = update.state.field(this._invalidationCounter);\n            return previous !== current;\n          }\n        });\n\n        const extensions = [lspLinter, this._invalidationCounter];\n        if (settings.composite.gutter) {\n          extensions.push(lintGutter());\n        }\n\n        return EditorExtensionRegistry.createImmutableExtension(extensions);\n      }\n    };\n  }\n\n  private _reconfigureTheme() {\n    const style = getComputedStyle(document.body);\n    const lintTheme = new StyleModule({\n      '.cm-editor .cm-lintRange-error': {\n        backgroundImage: underline(\n          style.getPropertyValue(\n            '--jp-editor-mirror-lsp-diagnostic-error-decoration-color'\n          )\n        )\n      },\n      '.cm-editor .cm-lintRange-warning': {\n        backgroundImage: underline(\n          style.getPropertyValue(\n            '--jp-editor-mirror-lsp-diagnostic-warning-decoration-color'\n          )\n        )\n      },\n      '.cm-editor .cm-lintRange-info': {\n        backgroundImage: underline(\n          style.getPropertyValue(\n            '--jp-editor-mirror-lsp-diagnostic-information-decoration-color'\n          )\n        )\n      },\n      '.cm-editor .cm-lintRange-hint': {\n        backgroundImage: underline(\n          style.getPropertyValue(\n            '--jp-editor-mirror-lsp-diagnostic-hint-decoration-color'\n          )\n        )\n      }\n    });\n    this._styleElement.innerHTML = lintTheme.getRules();\n  }\n\n  clearDocumentDiagnostics(\n    adapter: WidgetLSPAdapter<any>,\n    document: VirtualDocument\n  ) {\n    this.getDiagnosticsDB(adapter).set(document, []);\n  }\n\n  /**\n   * Allows access to the most recent diagnostics in context of the editor.\n   *\n   * One can use VirtualEditorForNotebook.find_cell_by_editor() to find\n   * the corresponding cell in notebook.\n   * Can be used to implement a Panel showing diagnostics list.\n   *\n   * Maps virtualDocument.uri to IEditorDiagnostic[].\n   */\n  public getDiagnosticsDB(adapter: WidgetLSPAdapter<any>): DiagnosticsDatabase {\n    // Note that virtual_editor can change at runtime (kernel restart)\n    if (!this._diagnosticsDatabases.has(adapter)) {\n      this._diagnosticsDatabases.set(adapter, new DiagnosticsDatabase());\n    }\n    return this._diagnosticsDatabases.get(adapter)!;\n  }\n\n  switchDiagnosticsPanelSource = (adapter: WidgetLSPAdapter<any> | null) => {\n    diagnosticsPanel.trans = this._trans;\n    if (adapter !== null) {\n      const diagnostics = this.getDiagnosticsDB(adapter);\n      if (diagnosticsPanel.content.model.diagnostics == diagnostics) {\n        return;\n      }\n      diagnosticsPanel.content.model.diagnostics = diagnostics;\n      diagnosticsPanel.content.model.settings = this.settings;\n      diagnosticsPanel.feature = this;\n    } else {\n      diagnosticsPanel.content.model.diagnostics = null;\n    }\n    diagnosticsPanel.content.model.adapter = adapter;\n    diagnosticsPanel.update();\n  };\n\n  protected diagnosticsByRange(\n    diagnostics: lsProtocol.Diagnostic[]\n  ): Map<lsProtocol.Range, lsProtocol.Diagnostic[]> {\n    // because Range is not a primitive type, the equality of the objects having\n    // the same parameters won't be compared (thus considered equal) in Map.\n\n    // instead, a intermediate step of mapping through a stringified representation of Range is needed:\n    // an alternative would be using nested [start line][start character][end line][end character] structure,\n    // which would increase the code complexity, but reduce memory use and may be slightly faster.\n    type RangeID = string;\n    const rangeIdToRange = new Map<RangeID, lsProtocol.Range>();\n    const rangeIdToDiagnostics = new Map<RangeID, lsProtocol.Diagnostic[]>();\n\n    function getRangeId(range: lsProtocol.Range): RangeID {\n      return (\n        range.start.line +\n        ',' +\n        range.start.character +\n        ',' +\n        range.end.line +\n        ',' +\n        range.end.character\n      );\n    }\n\n    diagnostics.forEach((diagnostic: lsProtocol.Diagnostic) => {\n      let range = diagnostic.range;\n      let rangeId = getRangeId(range);\n      rangeIdToRange.set(rangeId, range);\n      if (rangeIdToDiagnostics.has(rangeId)) {\n        let rangesList = rangeIdToDiagnostics.get(rangeId)!;\n        rangesList.push(diagnostic);\n      } else {\n        rangeIdToDiagnostics.set(rangeId, [diagnostic]);\n      }\n    });\n\n    let map = new Map<lsProtocol.Range, lsProtocol.Diagnostic[]>();\n\n    rangeIdToDiagnostics.forEach(\n      (rangeDiagnostics: lsProtocol.Diagnostic[], rangeId: RangeID) => {\n        let range = rangeIdToRange.get(rangeId)!;\n        map.set(range, rangeDiagnostics);\n      }\n    );\n\n    return map;\n  }\n\n  get defaultSeverity(): lsProtocol.DiagnosticSeverity {\n    return DiagnosticSeverity[this.settings.composite.defaultSeverity];\n  }\n\n  private filterDiagnostics(\n    diagnostics: lsProtocol.Diagnostic[]\n  ): lsProtocol.Diagnostic[] {\n    const ignoredDiagnosticsCodes = new Set(\n      this.settings.composite.ignoreCodes\n    );\n    const ignoredSeverities = new Set<number>(\n      this.settings.composite.ignoreSeverities.map(\n        severityName => DiagnosticSeverity[severityName]\n      )\n    );\n    const ignoredMessagesRegExp =\n      this.settings.composite.ignoreMessagesPatterns.map(\n        pattern => new RegExp(pattern)\n      );\n\n    return diagnostics.filter(diagnostic => {\n      let code = diagnostic.code;\n      if (\n        typeof code !== 'undefined' &&\n        // pygls servers return code null if value is missing (rather than undefined)\n        // which is a departure from the LSP specs: https://microsoft.github.io/language-server-protocol/specification#diagnostic\n        // there is an open issue: https://github.com/openlawlibrary/pygls/issues/124\n        // and PR: https://github.com/openlawlibrary/pygls/pull/132\n        // this also affects hover tooltips.\n        code !== null &&\n        ignoredDiagnosticsCodes.has(code.toString())\n      ) {\n        return false;\n      }\n      let severity = diagnostic.severity;\n      if (severity && ignoredSeverities.has(severity)) {\n        return false;\n      }\n      let message = diagnostic.message;\n      if (\n        message &&\n        ignoredMessagesRegExp.some(pattern => pattern.test(message))\n      ) {\n        return false;\n      }\n      return true;\n    });\n  }\n\n  setDiagnostics(\n    response: lsProtocol.PublishDiagnosticsParams,\n    document: VirtualDocument,\n    adapter: WidgetLSPAdapter<any>\n  ) {\n    let diagnosticsList: IEditorDiagnostic[] = [];\n    // TODO: test case for severity class always being set, even if diagnostic has no severity\n\n    let diagnosticsByRange = this.diagnosticsByRange(\n      this.filterDiagnostics(response.diagnostics)\n    );\n\n    diagnosticsByRange.forEach(\n      (diagnostics: lsProtocol.Diagnostic[], range: lsProtocol.Range) => {\n        const start = PositionConverter.lsp_to_cm(\n          range.start\n        ) as IVirtualPosition;\n        const end = PositionConverter.lsp_to_cm(range.end) as IVirtualPosition;\n        const lastLineNumber =\n          document.lastVirtualLine - document.blankLinesBetweenCells;\n        if (start.line > lastLineNumber) {\n          this.console.log(\n            `Out of range diagnostic (${start.line} line > ${lastLineNumber}) was skipped `,\n            diagnostics\n          );\n          return;\n        } else {\n          let lastLine = document.lastLine;\n          if (start.line == lastLineNumber && start.ch > lastLine.length) {\n            this.console.log(\n              `Out of range diagnostic (${start.ch} character > ${lastLine.length} at line ${lastLineNumber}) was skipped `,\n              diagnostics\n            );\n            return;\n          }\n        }\n        if (\n          // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n          // @ts-ignore TODO\n          document.virtualLines\n            .get(start.line)!\n            .skipInspect.includes(document.idPath)\n        ) {\n          this.console.debug(\n            'Ignoring inspections silenced for this document:',\n            diagnostics,\n            document.idPath,\n            start.line\n          );\n          return;\n        }\n\n        const editorAccessor = document.getEditorAtVirtualLine(start);\n\n        const startInEditor = document.transformVirtualToEditor(start);\n        let endInEditor: IEditorPosition | null;\n\n        if (startInEditor === null) {\n          this.console.warn(\n            'Start in editor could not be be determined for',\n            diagnostics\n          );\n          return;\n        }\n\n        // some servers return strange positions for ends\n        try {\n          endInEditor = document.transformVirtualToEditor(end);\n        } catch (err) {\n          this.console.warn('Malformed range for diagnostic', end);\n          endInEditor = { ...startInEditor, ch: startInEditor.ch + 1 };\n        }\n\n        if (endInEditor === null) {\n          this.console.warn(\n            'End in editor could not be be determined for',\n            diagnostics\n          );\n          return;\n        }\n\n        for (let diagnostic of diagnostics) {\n          diagnosticsList.push({\n            diagnostic,\n            editorAccessor: editorAccessor,\n            range: {\n              start: startInEditor,\n              end: endInEditor\n            }\n          });\n        }\n      }\n    );\n\n    const diagnosticsDB = this.getDiagnosticsDB(adapter);\n\n    const previousList = diagnosticsDB.get(document);\n    const editorsWhichHadDiagnostics = new Set(\n      previousList?.map(d => d.editorAccessor.getEditor())\n    );\n\n    const editorsWithDiagnostics = new Set(\n      diagnosticsList?.map(d => d.editorAccessor.getEditor())\n    );\n    diagnosticsDB.set(document, diagnosticsList);\n\n    // Refresh editors with diagnostics; this is needed because linter's\n    // `source()` method will only refresh the cell with changes, but a change\n    // in one cell can influence validity of code in all other cells (e.g. due\n    // to removal of variable definition or usage).\n    for (const block of adapter.editors) {\n      const editor = block.ceEditor.getEditor() as CodeMirrorEditor | undefined;\n      if (!editor) {\n        continue;\n      }\n      if (\n        !(\n          editorsWithDiagnostics.has(editor) ||\n          editorsWhichHadDiagnostics.has(editor)\n        )\n      ) {\n        continue;\n      }\n\n      editor.editor.dispatch({\n        effects: this._invalidate.of()\n      });\n    }\n  }\n\n  public handleDiagnostic = async (\n    response: lsProtocol.PublishDiagnosticsParams,\n    document: VirtualDocument,\n    adapter: WidgetLSPAdapter<any>\n  ) => {\n    // use optional chaining operator because the diagnostics message may come late (after the document was disposed)\n    if (!urisEqual(response.uri, document?.documentInfo?.uri)) {\n      return;\n    }\n\n    if (document.lastVirtualLine === 0) {\n      return;\n    }\n\n    try {\n      this._lastResponse = response;\n      this._lastDocument = document;\n      this._lastAdapter = adapter;\n      this.setDiagnostics(response, document, adapter);\n      const done = new Promise<void>(resolve => {\n        setTimeout(() => {\n          this._firstResponseReceived.resolve();\n          resolve();\n        }, 0);\n      });\n      diagnosticsPanel.update();\n      return done;\n    } catch (e) {\n      this.console.warn(e);\n    }\n  };\n\n  public refreshDiagnostics() {\n    if (this._lastResponse) {\n      this.setDiagnostics(\n        this._lastResponse,\n        this._lastDocument,\n        this._lastAdapter\n      );\n    }\n    diagnosticsPanel.update();\n  }\n\n  private _lastResponse: lsProtocol.PublishDiagnosticsParams;\n  private _lastDocument: VirtualDocument;\n  private _lastAdapter: WidgetLSPAdapter<any>;\n  private _trans: TranslationBundle;\n  private _invalidate: StateEffectType<void>;\n  private _invalidationCounter: StateField<number>;\n  private _styleElement: HTMLStyleElement = document.createElement('style');\n}\n\nexport namespace DiagnosticsFeature {\n  export interface IOptions extends Feature.IOptions {\n    settings: IFeatureSettings<LSPDiagnosticsSettings>;\n    shell: ILabShell | INotebookShell;\n    trans: TranslationBundle;\n    editorExtensionRegistry: IEditorExtensionRegistry;\n    themeManager: IThemeManager | null;\n  }\n  export const id = PLUGIN_ID + ':diagnostics';\n}\n","import { INotebookShell } from '@jupyter-notebook/application';\nimport {\n  ILayoutRestorer,\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin,\n  ILabShell\n} from '@jupyterlab/application';\nimport {\n  ICommandPalette,\n  IThemeManager,\n  MainAreaWidget,\n  WidgetTracker\n} from '@jupyterlab/apputils';\nimport { IEditorExtensionRegistry } from '@jupyterlab/codemirror';\nimport {\n  ILSPFeatureManager,\n  ILSPDocumentConnectionManager\n} from '@jupyterlab/lsp';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { ITranslator, nullTranslator } from '@jupyterlab/translation';\n\nimport { CodeDiagnostics as LSPDiagnosticsSettings } from '../../_diagnostics';\nimport { ContextAssembler } from '../../context';\nimport { FeatureSettings } from '../../feature';\n\nimport { diagnosticsIcon, diagnosticsPanel } from './diagnostics';\nimport { DiagnosticsFeature } from './feature';\nimport { DiagnosticsListing } from './listing';\nimport { IDiagnosticsFeature } from './tokens';\n\nexport namespace CommandIDs {\n  export const showPanel = 'lsp:show-diagnostics-panel';\n}\n\nexport const DIAGNOSTICS_PLUGIN: JupyterFrontEndPlugin<IDiagnosticsFeature> = {\n  id: DiagnosticsFeature.id,\n  requires: [\n    ILSPFeatureManager,\n    ISettingRegistry,\n    ILSPDocumentConnectionManager,\n    IEditorExtensionRegistry\n  ],\n  optional: [ILayoutRestorer, IThemeManager, ICommandPalette, ITranslator],\n  autoStart: true,\n  activate: async (\n    app: JupyterFrontEnd,\n    featureManager: ILSPFeatureManager,\n    settingRegistry: ISettingRegistry,\n    connectionManager: ILSPDocumentConnectionManager,\n    editorExtensionRegistry: IEditorExtensionRegistry,\n    restorer: ILayoutRestorer | null,\n    themeManager: IThemeManager | null,\n    palette: ICommandPalette | null,\n    translator: ITranslator | null\n  ) => {\n    const trans = (translator || nullTranslator).load('jupyterlab_lsp');\n    const settings = new FeatureSettings<LSPDiagnosticsSettings>(\n      settingRegistry,\n      DiagnosticsFeature.id\n    );\n    await settings.ready;\n    const feature = new DiagnosticsFeature({\n      settings,\n      connectionManager,\n      shell: app.shell as ILabShell | INotebookShell,\n      editorExtensionRegistry,\n      themeManager,\n      trans\n    });\n    if (!settings.composite.disable) {\n      featureManager.register(feature);\n\n      const assembler = new ContextAssembler({\n        app,\n        connectionManager\n      });\n\n      const namespace = 'lsp-diagnostics';\n      const tracker = new WidgetTracker<MainAreaWidget<DiagnosticsListing>>({\n        namespace: namespace\n      });\n\n      app.commands.addCommand(CommandIDs.showPanel, {\n        execute: async () => {\n          const context = assembler.getContext();\n          let ref = null;\n          if (context) {\n            feature.switchDiagnosticsPanelSource(context.adapter);\n            ref = context.adapter.widgetId;\n          } else {\n            console.warn('Could not get context');\n          }\n\n          if (!diagnosticsPanel.isRegistered) {\n            diagnosticsPanel.trans = trans;\n            diagnosticsPanel.register(app);\n          }\n\n          const panelWidget = diagnosticsPanel.widget;\n          if (!panelWidget.isAttached) {\n            void tracker.add(panelWidget);\n            app.shell.add(panelWidget, 'main', {\n              ref: ref,\n              mode: 'split-bottom'\n            });\n          }\n          app.shell.activateById(panelWidget.id);\n          void tracker.save(panelWidget);\n        },\n        label: trans.__('Show diagnostics panel'),\n        icon: diagnosticsIcon,\n        isEnabled: () => {\n          // TODO notebook\n          return app.name != 'JupyterLab Classic';\n        }\n      });\n\n      // add to menus\n      app.contextMenu.addItem({\n        selector: '.jp-Notebook .jp-CodeCell .jp-Editor',\n        command: CommandIDs.showPanel,\n        rank: 10\n      });\n\n      app.contextMenu.addItem({\n        selector: '.jp-FileEditor',\n        command: CommandIDs.showPanel,\n        rank: 0\n      });\n\n      if (palette) {\n        palette.addItem({\n          command: CommandIDs.showPanel,\n          category: trans.__('Language Server Protocol')\n        });\n      }\n\n      if (restorer) {\n        void restorer.restore(tracker, {\n          command: CommandIDs.showPanel,\n          name: _ => 'listing'\n        });\n      }\n    }\n    return feature;\n  }\n};\n","import { StateField, StateEffect } from '@codemirror/state';\nimport { EditorView, Decoration, DecorationSet } from '@codemirror/view';\n\nexport interface IMark<Kinds> {\n  from: number;\n  to: number;\n  kind: Kinds;\n}\n\n/**\n * Manage marks in multiple editor views (e.g. cells).\n */\nexport interface ISimpleMarkManager<Kinds> {\n  putMarks(view: EditorView, positions: IMark<Kinds>[]): void;\n  /**\n   * Clear marks from all editor views.\n   */\n  clearAllMarks(): void;\n  clearEditorMarks(view: EditorView): void;\n}\n\nexport type MarkDecorationSpec = Parameters<typeof Decoration.mark>[0] & {\n  class: string;\n};\n\nnamespace Private {\n  export let specCounter = 0;\n}\n\nexport function createMarkManager<Kinds extends string | number>(\n  specs: Record<Kinds, MarkDecorationSpec>\n): ISimpleMarkManager<Kinds> {\n  const specId = ++Private.specCounter;\n  const kindToMark = Object.fromEntries(\n    Object.entries(specs).map(([k, spec]) => [\n      k as Kinds,\n      Decoration.mark({\n        ...(spec as MarkDecorationSpec),\n        _id: Private.specCounter\n      })\n    ])\n  ) as Record<Kinds, Decoration>;\n\n  const addMark = StateEffect.define<IMark<Kinds>>({\n    map: ({ from, to, kind }, change) => ({\n      from: change.mapPos(from),\n      to: change.mapPos(to),\n      kind\n    })\n  });\n\n  const removeMark = StateEffect.define<null>();\n\n  const markField = StateField.define<DecorationSet>({\n    create() {\n      return Decoration.none;\n    },\n    update(marks, tr) {\n      marks = marks.map(tr.changes);\n      for (let e of tr.effects) {\n        if (e.is(addMark)) {\n          marks = marks.update({\n            add: [\n              kindToMark[e.value.kind].range(\n                Math.min(e.value.from, tr.newDoc.length),\n                Math.min(e.value.to, tr.newDoc.length)\n              )\n            ]\n          });\n        } else if (e.is(removeMark)) {\n          marks = marks.update({\n            filter: (from, to, value) => {\n              return value.spec['_id'] !== specId;\n            }\n          });\n        }\n      }\n      return marks;\n    },\n    provide: f => EditorView.decorations.from(f)\n  });\n  const views = new Set<EditorView>();\n\n  return {\n    putMarks(view: EditorView, positions: IMark<Kinds>[]) {\n      const effects: StateEffect<unknown>[] = positions.map(position =>\n        addMark.of(position)\n      );\n\n      if (!view.state.field(markField, false)) {\n        effects.push(StateEffect.appendConfig.of([markField]));\n      }\n      view.dispatch({ effects });\n      views.add(view);\n    },\n    clearAllMarks() {\n      for (let view of views) {\n        this.clearEditorMarks(view);\n      }\n      views.clear();\n    },\n    clearEditorMarks(view: EditorView) {\n      const effects: StateEffect<unknown>[] = [removeMark.of(null)];\n      view.dispatch({ effects });\n    }\n  };\n}\n","import { EditorView } from '@codemirror/view';\nimport {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\nimport { CodeEditor } from '@jupyterlab/codeeditor';\nimport {\n  CodeMirrorEditor,\n  EditorExtensionRegistry\n} from '@jupyterlab/codemirror';\nimport {\n  IVirtualPosition,\n  ILSPFeatureManager,\n  IEditorPosition,\n  ILSPDocumentConnectionManager,\n  WidgetLSPAdapter,\n  Document\n} from '@jupyterlab/lsp';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { LabIcon } from '@jupyterlab/ui-components';\nimport { Debouncer } from '@lumino/polling';\nimport type * as lsProtocol from 'vscode-languageserver-protocol';\n\nimport highlightSvg from '../../style/icons/highlight.svg';\nimport { CodeHighlights as LSPHighlightsSettings } from '../_highlights';\nimport {\n  PositionConverter,\n  rootPositionToVirtualPosition,\n  editorPositionToRootPosition,\n  documentAtRootPosition,\n  rangeToEditorRange\n} from '../converter';\nimport { FeatureSettings, Feature } from '../feature';\nimport { DocumentHighlightKind } from '../lsp';\nimport { createMarkManager, ISimpleMarkManager } from '../marks';\nimport { PLUGIN_ID } from '../tokens';\nimport { BrowserConsole } from '../virtual/console';\nimport { VirtualDocument } from '../virtual/document';\n\nexport const highlightIcon = new LabIcon({\n  name: 'lsp:highlight',\n  svgstr: highlightSvg\n});\n\ninterface IEditorHighlight {\n  kind: DocumentHighlightKind;\n  from: number;\n  to: number;\n}\n\nexport class HighlightsFeature extends Feature {\n  readonly capabilities: lsProtocol.ClientCapabilities = {\n    textDocument: {\n      documentHighlight: {\n        dynamicRegistration: true\n      }\n    }\n  };\n  readonly id = HighlightsFeature.id;\n\n  protected settings: FeatureSettings<LSPHighlightsSettings>;\n  protected markManager: ISimpleMarkManager<DocumentHighlightKind>;\n  protected console = new BrowserConsole().scope('Highlights');\n\n  private _debouncedGetHighlight: Debouncer<\n    lsProtocol.DocumentHighlight[] | null,\n    void,\n    [VirtualDocument, IVirtualPosition]\n  >;\n  private _virtualPosition: IVirtualPosition;\n  private _versionSent: number;\n  private _lastToken: {\n    token: CodeEditor.IToken;\n    adapter: WidgetLSPAdapter<any>;\n  } | null = null;\n\n  constructor(options: HighlightsFeature.IOptions) {\n    super(options);\n    this.settings = options.settings;\n    this.markManager = createMarkManager({\n      [DocumentHighlightKind.Text]: { class: 'cm-lsp-highlight-Text' },\n      [DocumentHighlightKind.Read]: { class: 'cm-lsp-highlight-Read' },\n      [DocumentHighlightKind.Write]: { class: 'cm-lsp-highlight-Write' }\n    });\n\n    this._debouncedGetHighlight = this.createDebouncer();\n\n    this.settings.changed.connect(() => {\n      this._debouncedGetHighlight = this.createDebouncer();\n    });\n\n    this.extensionFactory = {\n      name: 'lsp:highlights',\n      factory: factoryOptions => {\n        const { editor: editorAccessor, widgetAdapter: adapter } =\n          factoryOptions;\n        const updateListener = EditorView.updateListener.of(viewUpdate => {\n          if (viewUpdate.docChanged || viewUpdate.selectionSet) {\n            this.onCursorActivity(editorAccessor, adapter).catch(\n              this.console.warn\n            );\n          }\n        });\n        const eventListeners = EditorView.domEventHandlers({\n          blur: (_, view) => {\n            this.onBlur(view);\n          },\n          focus: () => {\n            this.onCursorActivity(editorAccessor, adapter).catch(\n              this.console.warn\n            );\n          },\n          keydown: () => {\n            this.onCursorActivity(editorAccessor, adapter).catch(\n              this.console.warn\n            );\n          }\n        });\n        return EditorExtensionRegistry.createImmutableExtension([\n          updateListener,\n          eventListeners\n        ]);\n      }\n    };\n  }\n\n  protected onBlur(view: EditorView) {\n    if (this.settings.composite.removeOnBlur) {\n      // Delayed evaluation to avoid error:\n      // `Error: Calls to EditorView.update are not allowed while an update is in progress`\n      setTimeout(() => {\n        this.markManager.clearEditorMarks(view);\n        this._lastToken = null;\n      }, 0);\n    }\n  }\n\n  protected handleHighlight(\n    items: lsProtocol.DocumentHighlight[] | null,\n    adapter: WidgetLSPAdapter<any>,\n    document: VirtualDocument\n  ) {\n    this.markManager.clearAllMarks();\n\n    if (!items) {\n      return;\n    }\n\n    const highlightsByEditor = new Map<\n      CodeEditor.IEditor,\n      IEditorHighlight[]\n    >();\n\n    for (let item of items) {\n      let range = rangeToEditorRange(adapter, item.range, null, document);\n      const editor = range.editor;\n\n      let optionsList = highlightsByEditor.get(editor);\n\n      if (!optionsList) {\n        optionsList = [];\n        highlightsByEditor.set(editor, optionsList);\n      }\n\n      optionsList.push({\n        kind: item.kind || DocumentHighlightKind.Text,\n        from: editor.getOffsetAt(PositionConverter.cm_to_ce(range.start)),\n        to: editor.getOffsetAt(PositionConverter.cm_to_ce(range.end))\n      });\n    }\n\n    for (const [editor, markerDefinitions] of highlightsByEditor.entries()) {\n      // CodeMirror5 performance test cases:\n      //   - one cell with 1000 `math.pi` and `import math`; move cursor to `math`,\n      //     wait for 1000 highlights, then move to `pi`:\n      //     - step-by-step:\n      //        - highlight `math`: 13.1s\n      //        - then highlight `pi`: 16.6s\n      //     - operation():\n      //        - highlight `math`: 160ms\n      //        - then highlight `pi`: 227ms\n      //     - CodeMirror6, measuring `markManager.putMarks`:\n      //        - highlight `math`: 181ms\n      //        - then highlight `pi`: 334ms\n      //   - 100 cells with `math.pi` and one with `import math`; move cursor to `math`,\n      //     wait for 1000 highlights, then move to `pi` (this is overhead control,\n      //     no gains expected):\n      //     - step-by-step:\n      //        - highlight `math`: 385ms\n      //        - then highlight `pi`: 683 ms\n      //     - operation():\n      //        - highlight `math`: 390ms\n      //        - then highlight `pi`: 870ms\n\n      const editorView = (editor as CodeMirrorEditor).editor;\n      this.markManager.putMarks(editorView, markerDefinitions);\n    }\n  }\n\n  protected createDebouncer() {\n    return new Debouncer<\n      lsProtocol.DocumentHighlight[] | null,\n      void,\n      [VirtualDocument, IVirtualPosition]\n    >(this.requestHighlights, this.settings.composite.debouncerDelay);\n  }\n\n  protected requestHighlights = async (\n    virtualDocument: VirtualDocument,\n    virtualPosition: IVirtualPosition\n  ) => {\n    const connection = this.connectionManager.connections.get(\n      virtualDocument.uri\n    )!;\n    if (\n      !(\n        connection.isReady &&\n        connection.serverCapabilities.documentHighlightProvider\n      )\n    ) {\n      return null;\n    }\n    this._versionSent = virtualDocument.documentInfo.version;\n    return await connection.clientRequests[\n      'textDocument/documentHighlight'\n    ].request({\n      textDocument: {\n        uri: virtualDocument.documentInfo.uri\n      },\n      position: {\n        line: virtualPosition.line,\n        character: virtualPosition.ch\n      }\n    });\n  };\n\n  protected async onCursorActivity(\n    editorAccessor: Document.IEditor,\n    adapter: WidgetLSPAdapter<any>\n  ) {\n    if (!adapter.virtualDocument) {\n      this.console.log('virtualDocument not ready on adapter');\n      return;\n    }\n    await adapter.virtualDocument!.updateManager.updateDone;\n\n    const editor = editorAccessor.getEditor();\n    if (!editor) {\n      this.console.log('editor not found ready');\n      return;\n    }\n    const position = editor.getCursorPosition();\n    const editorPosition = PositionConverter.ce_to_cm(\n      position\n    ) as IEditorPosition;\n\n    const rootPosition = editorPositionToRootPosition(\n      adapter,\n      editorAccessor!,\n      editorPosition\n    );\n\n    if (!rootPosition) {\n      this.console.debug('Root position not available');\n      return;\n    }\n\n    const document = documentAtRootPosition(adapter, rootPosition);\n\n    if (!document.documentInfo) {\n      this.console.debug('Root document lacks document info');\n      return;\n    }\n\n    const offset = editor.getOffsetAt(\n      PositionConverter.cm_to_ce(editorPosition)\n    );\n    const token = editor.getTokenAt(offset);\n\n    // if token has not changed, no need to update highlight, unless it is an empty token\n    // which would indicate that the cursor is at the first character; we also need to check\n    // adapter in case if user switched between documents/notebooks.\n    if (\n      this._lastToken &&\n      token.value === this._lastToken.token.value &&\n      adapter === this._lastToken.adapter &&\n      token.value !== ''\n    ) {\n      this.console.log(\n        'not requesting highlights (token did not change)',\n        token\n      );\n      return;\n    }\n\n    try {\n      const virtualPosition = rootPositionToVirtualPosition(\n        adapter,\n        rootPosition\n      );\n      this._virtualPosition = virtualPosition;\n\n      const [highlights] = await Promise.all([\n        // request the highlights as soon as possible\n        this._debouncedGetHighlight.invoke(document, virtualPosition),\n        // and in the meantime remove the old markers\n        async () => {\n          this.markManager.clearAllMarks();\n          this._lastToken = null;\n        }\n      ]);\n\n      // in the time the response returned the document might have been closed - check that\n      if (document.isDisposed) {\n        return;\n      }\n\n      let versionAfter = document.documentInfo.version;\n\n      /// if document was updated since (e.g. user pressed delete - token change, but position did not)\n      if (versionAfter !== this._versionSent) {\n        this.console.log(\n          'skipping highlights response delayed by ' +\n            (versionAfter - this._versionSent) +\n            ' document versions'\n        );\n        return;\n      }\n      // if cursor position changed (e.g. user moved cursor up - position has changed, but document version did not)\n      if (virtualPosition !== this._virtualPosition) {\n        this.console.log(\n          'skipping highlights response: cursor moved since it was requested'\n        );\n        return;\n      }\n\n      this.handleHighlight(highlights, adapter, document);\n      this._lastToken = {\n        token,\n        adapter\n      };\n    } catch (e) {\n      this.console.warn('Could not get highlights:', e);\n    }\n  }\n}\n\nexport namespace HighlightsFeature {\n  export interface IOptions extends Feature.IOptions {\n    settings: FeatureSettings<LSPHighlightsSettings>;\n  }\n  export const id = PLUGIN_ID + ':highlights';\n}\n\nexport const HIGHLIGHTS_PLUGIN: JupyterFrontEndPlugin<void> = {\n  id: HighlightsFeature.id,\n  requires: [\n    ILSPFeatureManager,\n    ISettingRegistry,\n    ILSPDocumentConnectionManager\n  ],\n  autoStart: true,\n  activate: async (\n    app: JupyterFrontEnd,\n    featureManager: ILSPFeatureManager,\n    settingRegistry: ISettingRegistry,\n    connectionManager: ILSPDocumentConnectionManager\n  ) => {\n    const settings = new FeatureSettings<LSPHighlightsSettings>(\n      settingRegistry,\n      HighlightsFeature.id\n    );\n    await settings.ready;\n    if (settings.composite.disable) {\n      return;\n    }\n    const feature = new HighlightsFeature({\n      settings,\n      connectionManager\n    });\n    featureManager.register(feature);\n  }\n};\n","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\n// (Parts of the FreeTooltip code are copy-paste from Tooltip, ideally this would be PRed be merged)\nimport { HoverBox } from '@jupyterlab/apputils';\nimport { CodeEditor } from '@jupyterlab/codeeditor';\nimport { IDocumentWidget } from '@jupyterlab/docregistry';\nimport { IEditorPosition, isEqual, WidgetLSPAdapter } from '@jupyterlab/lsp';\nimport {\n  IRenderMime,\n  MimeModel,\n  IRenderMimeRegistry\n} from '@jupyterlab/rendermime';\nimport { Tooltip } from '@jupyterlab/tooltip';\nimport { Widget } from '@lumino/widgets';\nimport * as lsProtocol from 'vscode-languageserver-protocol';\n\nimport { PositionConverter } from '../converter';\n\nconst MIN_HEIGHT = 20;\nconst MAX_HEIGHT = 250;\n\nconst CLASS_NAME = 'lsp-tooltip';\n\ninterface IFreeTooltipOptions extends Tooltip.IOptions {\n  /**\n   * Position at which the tooltip should be placed, or null (default) to use the current cursor position.\n   */\n  position: CodeEditor.IPosition | undefined;\n  /**\n   * HoverBox privilege.\n   */\n  privilege?: 'above' | 'below' | 'forceAbove' | 'forceBelow';\n  /**\n   * Alignment with respect to the current token.\n   */\n  alignment?: 'start' | 'end' | undefined;\n  /**\n   * default: true; ESC will always hide\n   */\n  hideOnKeyPress?: boolean;\n}\n\ntype Bundle = { 'text/plain': string } | { 'text/markdown': string };\n\n/**\n * Tooltip which can be placed  at any character, not only at the current position (derived from getCursorPosition)\n */\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nexport class FreeTooltip extends Tooltip {\n  constructor(protected options: IFreeTooltipOptions) {\n    super(options);\n    this._setGeometry();\n  }\n\n  setBundle(bundle: Bundle) {\n    const model = new MimeModel({ data: bundle });\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    const content: IRenderMime.IRenderer = this._content;\n    content\n      .renderModel(model)\n      .then(() => this._setGeometry())\n      .catch(console.warn);\n  }\n\n  handleEvent(event: Event): void {\n    if (this.isHidden || this.isDisposed) {\n      return;\n    }\n\n    const { node } = this;\n    const target = event.target as HTMLElement;\n\n    switch (event.type) {\n      case 'keydown': {\n        const keyCode = (event as KeyboardEvent).keyCode;\n        // ESC or Backspace cancel anyways\n        if (\n          node.contains(target) ||\n          (!this.options.hideOnKeyPress && keyCode != 27 && keyCode != 8)\n        ) {\n          return;\n        }\n        this.dispose();\n        break;\n      }\n      default:\n        super.handleEvent(event);\n        break;\n    }\n  }\n\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  private _setGeometry(): void {\n    // Find the start of the current token for hover box placement.\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    const editor = this._editor as CodeEditor.IEditor;\n    const cursor: CodeEditor.IPosition =\n      this.options.position == null\n        ? editor.getCursorPosition()\n        : this.options.position;\n    let position: CodeEditor.IPosition | undefined;\n\n    if (this.options.alignment) {\n      const end = editor.getOffsetAt(cursor);\n      const line = editor.getLine(cursor.line);\n\n      if (!line) {\n        return;\n      }\n\n      switch (this.options.alignment) {\n        case 'start': {\n          const tokens = line.substring(0, end).split(/\\W+/);\n          const last = tokens[tokens.length - 1];\n          const start = last ? end - last.length : end;\n          position = editor.getPositionAt(start);\n          break;\n        }\n        case 'end': {\n          const tokens = line.substring(0, end).split(/\\W+/);\n          const last = tokens[tokens.length - 1];\n          const start = last ? end - last.length : end;\n          position = editor.getPositionAt(start);\n          break;\n        }\n      }\n    } else {\n      position = cursor;\n    }\n\n    if (!position) {\n      return;\n    }\n\n    const anchor = editor.getCoordinateForPosition(position) as ClientRect;\n    const style = window.getComputedStyle(this.node);\n    const paddingLeft = parseInt(style.paddingLeft!, 10) || 0;\n\n    // When the editor is attached to the main area, contain the hover box\n    // to the full area available (rather than to the editor itself); the available\n    // area excludes the toolbar, hence the first Widget child between MainAreaWidget\n    // and editor is preferred.\n    const host =\n      (editor.host.closest('.jp-MainAreaWidget > .lm-Widget') as HTMLElement) ||\n      editor.host;\n\n    // Calculate the geometry of the tooltip.\n    HoverBox.setGeometry({\n      anchor,\n      host: host,\n      maxHeight: MAX_HEIGHT,\n      minHeight: MIN_HEIGHT,\n      node: this.node,\n      offset: { horizontal: -1 * paddingLeft },\n      privilege: this.options.privilege || 'below',\n      style: style,\n      outOfViewDisplay: {\n        left: 'stick-inside',\n        right: 'stick-outside',\n        top: 'stick-outside',\n        bottom: 'stick-inside'\n      }\n    });\n  }\n\n  setPosition(position: CodeEditor.IPosition) {\n    this.options.position = position;\n    this._setGeometry();\n  }\n}\n\nexport namespace EditorTooltip {\n  export interface IOptions {\n    id?: string;\n    markup: lsProtocol.MarkupContent;\n    ceEditor: CodeEditor.IEditor;\n    position: IEditorPosition;\n    adapter: WidgetLSPAdapter<IDocumentWidget>;\n    className?: string;\n    tooltip?: Partial<IFreeTooltipOptions>;\n  }\n}\n\nfunction markupToBundle(markup: lsProtocol.MarkupContent): Bundle {\n  return markup.kind === 'plaintext'\n    ? { 'text/plain': markup.value }\n    : { 'text/markdown': markup.value };\n}\n\nexport class EditorTooltipManager {\n  private currentTooltip: FreeTooltip | null = null;\n  private currentOptions: EditorTooltip.IOptions | null;\n\n  constructor(private rendermimeRegistry: IRenderMimeRegistry) {}\n\n  create(options: EditorTooltip.IOptions): FreeTooltip {\n    this.remove();\n    this.currentOptions = options;\n    let { markup, position, adapter } = options;\n    let widget = adapter.widget;\n    const bundle = markupToBundle(markup);\n    const tooltip = new FreeTooltip({\n      ...(options.tooltip || {}),\n      anchor: widget.content,\n      bundle: bundle,\n      editor: options.ceEditor,\n      rendermime: this.rendermimeRegistry,\n      position: PositionConverter.cm_to_ce(position)\n    });\n    tooltip.addClass(CLASS_NAME);\n    if (options.className) {\n      tooltip.addClass(options.className);\n    }\n    Widget.attach(tooltip, document.body);\n    this.currentTooltip = tooltip;\n    return tooltip;\n  }\n\n  showOrCreate(options: EditorTooltip.IOptions): FreeTooltip {\n    const samePosition =\n      this.currentOptions &&\n      isEqual(this.currentOptions.position, options.position);\n    const sameMarkup =\n      this.currentOptions &&\n      this.currentOptions.markup.value === options.markup.value &&\n      this.currentOptions.markup.kind === options.markup.kind;\n    if (\n      this.currentTooltip !== null &&\n      !this.currentTooltip.isDisposed &&\n      this.currentOptions &&\n      this.currentOptions.adapter === options.adapter &&\n      (samePosition || sameMarkup) &&\n      this.currentOptions.ceEditor === options.ceEditor &&\n      this.currentOptions.id === options.id\n    ) {\n      // we only allow either position or markup change, because if both changed,\n      // then we may get into problematic race condition in sizing after bundle update.\n      if (!sameMarkup) {\n        this.currentOptions.markup = options.markup;\n        this.currentTooltip.setBundle(markupToBundle(options.markup));\n      }\n      if (!samePosition) {\n        // setting geometry only works when visible\n        this.currentTooltip.setPosition(\n          PositionConverter.cm_to_ce(options.position)\n        );\n      }\n      this.show();\n      return this.currentTooltip;\n    } else {\n      this.remove();\n      return this.create(options);\n    }\n  }\n\n  get position(): IEditorPosition {\n    return this.currentOptions!.position;\n  }\n\n  isShown(id?: string): boolean {\n    if (id && this.currentOptions && this.currentOptions?.id !== id) {\n      return false;\n    }\n    return (\n      this.currentTooltip !== null &&\n      !this.currentTooltip.isDisposed &&\n      this.currentTooltip.isVisible\n    );\n  }\n\n  hide() {\n    if (this.currentTooltip !== null) {\n      this.currentTooltip.hide();\n    }\n  }\n\n  show() {\n    if (this.currentTooltip !== null) {\n      this.currentTooltip.show();\n    }\n  }\n\n  remove() {\n    if (this.currentTooltip !== null) {\n      this.currentTooltip.dispose();\n      this.currentTooltip = null as any;\n    }\n  }\n}\n","import { EditorView } from '@codemirror/view';\nimport {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\nimport { CodeEditor } from '@jupyterlab/codeeditor';\nimport {\n  CodeMirrorEditor,\n  EditorExtensionRegistry\n} from '@jupyterlab/codemirror';\nimport {\n  IRootPosition,\n  IVirtualPosition,\n  IEditorPosition,\n  ProtocolCoordinates,\n  ILSPFeatureManager,\n  isEqual,\n  ILSPDocumentConnectionManager,\n  WidgetLSPAdapter,\n  Document\n} from '@jupyterlab/lsp';\nimport { IRenderMimeRegistry } from '@jupyterlab/rendermime';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { LabIcon } from '@jupyterlab/ui-components';\nimport { Throttler } from '@lumino/polling';\nimport type * as lsProtocol from 'vscode-languageserver-protocol';\n\nimport hoverSvg from '../../style/icons/hover.svg';\nimport { CodeHover as LSPHoverSettings, ModifierKey } from '../_hover';\nimport { EditorTooltipManager, FreeTooltip } from '../components/free_tooltip';\nimport { ContextAssembler } from '../context';\nimport {\n  PositionConverter,\n  documentAtRootPosition,\n  rootPositionToVirtualPosition,\n  rootPositionToEditorPosition,\n  editorPositionToRootPosition,\n  rangeToEditorRange,\n  IEditorRange\n} from '../converter';\nimport { FeatureSettings, Feature } from '../feature';\nimport { createMarkManager, ISimpleMarkManager } from '../marks';\nimport { PLUGIN_ID } from '../tokens';\nimport { getModifierState } from '../utils';\nimport { BrowserConsole } from '../virtual/console';\nimport { VirtualDocument } from '../virtual/document';\n\nexport const hoverIcon = new LabIcon({\n  name: 'lsp:hover',\n  svgstr: hoverSvg\n});\n\ninterface IResponseData {\n  response: lsProtocol.Hover;\n  document: VirtualDocument;\n  editorRange: IEditorRange;\n  ceEditor: CodeEditor.IEditor;\n}\n\n/**\n * Check whether mouse is close to given element (within a specified number of pixels)\n * @param what target element\n * @param who mouse event determining position and target\n * @param cushion number of pixels on each side defining \"closeness\" boundary\n */\nfunction isCloseTo(what: HTMLElement, who: MouseEvent, cushion = 50): boolean {\n  const target = who.type === 'mouseleave' ? who.relatedTarget : who.target;\n\n  if (what === target || what.contains(target as HTMLElement)) {\n    return true;\n  }\n  const whatRect = what.getBoundingClientRect();\n  return !(\n    who.x < whatRect.left - cushion ||\n    who.x > whatRect.right + cushion ||\n    who.y < whatRect.top - cushion ||\n    who.y > whatRect.bottom + cushion\n  );\n}\n\nclass ResponseCache {\n  protected _data: Array<IResponseData>;\n  get data() {\n    return this._data;\n  }\n\n  constructor(public maxSize: number) {\n    this._data = [];\n  }\n\n  store(item: IResponseData) {\n    const previousIndex = this._data.findIndex(\n      previous =>\n        previous.document === item.document &&\n        isEqual(previous.editorRange.start, item.editorRange.start) &&\n        isEqual(previous.editorRange.end, item.editorRange.end) &&\n        previous.editorRange.editor === item.editorRange.editor\n    );\n    if (previousIndex !== -1) {\n      this._data[previousIndex] = item;\n      return;\n    }\n\n    if (this._data.length >= this.maxSize) {\n      this._data.shift();\n    }\n    this._data.push(item);\n  }\n\n  clean() {\n    this._data = [];\n  }\n}\n\nfunction toMarkup(\n  content: string | lsProtocol.MarkedString\n): lsProtocol.MarkupContent {\n  if (typeof content === 'string') {\n    // coerce deprecated MarkedString to an MarkupContent; if given as a string it is markdown too,\n    // quote: \"It is either a markdown string or a code-block that provides a language and a code snippet.\"\n    // (https://microsoft.github.io/language-server-protocol/specifications/specification-3-17/#markedString)\n    return {\n      kind: 'markdown',\n      value: content\n    };\n  } else {\n    return {\n      kind: 'markdown',\n      value: '```' + content.language + '\\n' + content.value + '\\n```'\n    };\n  }\n}\n\ninterface IContext {\n  adapter: WidgetLSPAdapter<any>;\n  token: CodeEditor.IToken;\n  editor: CodeEditor.IEditor;\n  editorAccessor: Document.IEditor;\n}\n\nexport class HoverFeature extends Feature {\n  readonly capabilities: lsProtocol.ClientCapabilities = {\n    textDocument: {\n      hover: {\n        dynamicRegistration: true,\n        contentFormat: ['markdown', 'plaintext']\n      }\n    }\n  };\n  readonly id = HoverFeature.id;\n  tooltipManager: EditorTooltipManager;\n\n  protected console = new BrowserConsole().scope('Hover');\n  protected settings: FeatureSettings<LSPHoverSettings>;\n  protected lastHoverCharacter: IRootPosition | null = null;\n  private lastHoverResponse: lsProtocol.Hover | null;\n  protected hasMarker: boolean = false;\n  protected markManager: ISimpleMarkManager<'hover'>;\n  private virtualPosition: IVirtualPosition;\n  protected cache: ResponseCache;\n  protected contextAssembler: ContextAssembler;\n\n  private debouncedGetHover: Throttler<\n    Promise<lsProtocol.Hover | null>,\n    void,\n    [VirtualDocument, IVirtualPosition, IContext]\n  >;\n  private tooltip: FreeTooltip;\n  private _previousHoverRequest: Promise<\n    Promise<lsProtocol.Hover | null>\n  > | null = null;\n\n  constructor(options: HoverFeature.IOptions) {\n    super(options);\n    this.settings = options.settings;\n    this.tooltipManager = new EditorTooltipManager(options.renderMimeRegistry);\n    this.contextAssembler = options.contextAssembler;\n\n    this.cache = new ResponseCache(10);\n\n    this.markManager = createMarkManager({\n      hover: { class: 'cm-lsp-hover-available' }\n    });\n\n    this.extensionFactory = {\n      name: 'lsp:hover',\n      factory: factoryOptions => {\n        const { widgetAdapter: adapter } = factoryOptions;\n\n        const updateListener = EditorView.updateListener.of(viewUpdate => {\n          if (viewUpdate.docChanged) {\n            this.afterChange();\n          }\n        });\n        const eventListeners = EditorView.domEventHandlers({\n          mousemove: event => {\n            // this is used to hide the tooltip on leaving cells in notebook\n            this.updateUnderlineAndTooltip(event, adapter)\n              ?.then(keepTooltip => {\n                if (!keepTooltip) {\n                  this.maybeHideTooltip(event);\n                }\n              })\n              .catch(this.console.warn);\n          },\n          mouseleave: event => {\n            this.onMouseLeave(event);\n          },\n          // show hover after pressing the modifier key\n          keydown: event => {\n            this.onKeyDown(event, adapter);\n          }\n        });\n        return EditorExtensionRegistry.createImmutableExtension([\n          eventListeners,\n          updateListener\n        ]);\n      }\n    };\n\n    this.debouncedGetHover = this.createThrottler();\n\n    this.settings.changed.connect(() => {\n      this.cache.maxSize = this.settings.composite.cacheSize;\n      this.debouncedGetHover = this.createThrottler();\n    });\n  }\n\n  protected createThrottler() {\n    return new Throttler<\n      Promise<lsProtocol.Hover | null>,\n      void,\n      [VirtualDocument, IVirtualPosition, IContext]\n    >(this.getHover, {\n      limit: this.settings.composite.throttlerDelay || 0,\n      edge: 'trailing'\n    });\n  }\n\n  protected get modifierKey(): ModifierKey {\n    return this.settings.composite.modifierKey;\n  }\n\n  protected get isHoverAutomatic(): boolean {\n    return this.settings.composite.autoActivate;\n  }\n\n  protected restoreFromCache(\n    document: VirtualDocument,\n    virtualPosition: IVirtualPosition\n  ): IResponseData | null {\n    const { line, ch } = virtualPosition;\n    const matchingItems = this.cache.data.filter(cacheItem => {\n      if (cacheItem.document !== document) {\n        return false;\n      }\n      let range = cacheItem.response.range!;\n      return ProtocolCoordinates.isWithinRange({ line, character: ch }, range);\n    });\n    if (matchingItems.length > 1) {\n      this.console.warn(\n        'Potential hover cache malfunction: ',\n        virtualPosition,\n        matchingItems\n      );\n    }\n    return matchingItems.length != 0 ? matchingItems[0] : null;\n  }\n\n  protected onKeyDown = (\n    event: KeyboardEvent,\n    adapter: WidgetLSPAdapter<any>\n  ) => {\n    if (\n      getModifierState(event, this.modifierKey) &&\n      this.lastHoverCharacter !== null\n    ) {\n      // does not need to be shown if it is already visible (otherwise we would be creating an identical tooltip again!)\n      if (this.tooltip && this.tooltip.isVisible && !this.tooltip.isDisposed) {\n        return;\n      }\n      const document = documentAtRootPosition(adapter, this.lastHoverCharacter);\n      let responseData = this.restoreFromCache(document, this.virtualPosition);\n      if (responseData == null) {\n        return;\n      }\n      event.stopPropagation();\n      this.handleResponse(adapter, responseData, this.lastHoverCharacter, true);\n    }\n  };\n\n  protected onMouseLeave = (event: MouseEvent) => {\n    this.removeRangeHighlight();\n    this.maybeHideTooltip(event);\n  };\n\n  protected maybeHideTooltip(mouseEvent: MouseEvent) {\n    if (\n      typeof this.tooltip !== 'undefined' &&\n      !isCloseTo(this.tooltip.node, mouseEvent)\n    ) {\n      this.tooltip.dispose();\n    }\n  }\n\n  afterChange() {\n    // reset cache on any change in the document\n    this.cache.clean();\n    this.lastHoverCharacter = null;\n    this.removeRangeHighlight();\n  }\n\n  protected getHover = async (\n    virtualDocument: VirtualDocument,\n    virtualPosition: IVirtualPosition,\n    context: IContext\n  ): Promise<lsProtocol.Hover | null> => {\n    const connection = this.connectionManager.connections.get(\n      virtualDocument.uri\n    )!;\n    if (!(connection.isReady && connection.serverCapabilities.hoverProvider)) {\n      return null;\n    }\n    let response = await connection.clientRequests[\n      'textDocument/hover'\n    ].request({\n      textDocument: {\n        uri: virtualDocument.documentInfo.uri\n      },\n      position: {\n        line: virtualPosition.line,\n        character: virtualPosition.ch\n      }\n    });\n\n    if (response == null) {\n      return null;\n    }\n\n    if (typeof response.range !== 'undefined') {\n      return response;\n    }\n    // Harmonise response by adding range\n    const editorRange = this._getEditorRange(\n      context.adapter,\n      response,\n      context.token,\n      context.editor,\n      virtualDocument\n    );\n    return this._addRange(\n      context.adapter,\n      response,\n      editorRange,\n      context.editorAccessor\n    );\n  };\n\n  protected static getMarkupForHover(\n    response: lsProtocol.Hover\n  ): lsProtocol.MarkupContent {\n    let contents = response.contents;\n\n    if (typeof contents === 'string') {\n      contents = [contents as lsProtocol.MarkedString];\n    }\n\n    if (!Array.isArray(contents)) {\n      return contents as lsProtocol.MarkupContent;\n    }\n\n    let markups = contents.map(toMarkup);\n    if (markups.every(markup => markup.kind == 'plaintext')) {\n      return {\n        kind: 'plaintext',\n        value: markups.map(markup => markup.value).join('\\n')\n      };\n    } else {\n      return {\n        kind: 'markdown',\n        value: markups.map(markup => markup.value).join('\\n\\n')\n      };\n    }\n  }\n\n  /**\n   * marks the word if a tooltip is available.\n   * Displays tooltip if asked to do so.\n   *\n   * Returns true is the tooltip was shown.\n   */\n  public handleResponse = (\n    adapter: WidgetLSPAdapter<any>,\n    responseData: IResponseData,\n    rootPosition: IRootPosition,\n    showTooltip: boolean\n  ): boolean => {\n    let response = responseData.response;\n\n    // testing for object equality because the response will likely be reused from cache\n    if (this.lastHoverResponse != response) {\n      this.removeRangeHighlight();\n\n      const range = responseData.editorRange;\n      const editorView = (range.editor as CodeMirrorEditor).editor;\n      const from = range.editor.getOffsetAt(\n        PositionConverter.cm_to_ce(range.start)\n      );\n      const to = range.editor.getOffsetAt(\n        PositionConverter.cm_to_ce(range.end)\n      );\n      this.markManager.putMarks(editorView, [{ from, to, kind: 'hover' }]);\n      this.hasMarker = true;\n    }\n\n    this.lastHoverResponse = response;\n\n    if (showTooltip) {\n      const markup = HoverFeature.getMarkupForHover(response);\n      let editorPosition = rootPositionToEditorPosition(adapter, rootPosition);\n\n      this.tooltip = this.tooltipManager.showOrCreate({\n        markup,\n        position: editorPosition,\n        ceEditor: responseData.ceEditor,\n        adapter: adapter,\n        className: 'lsp-hover'\n      });\n      return true;\n    }\n    return false;\n  };\n\n  protected isTokenEmpty(token: CodeEditor.IToken) {\n    return token.value.length === 0;\n    // TODO  || token.type.length === 0? (sometimes the underline is shown on meaningless tokens)\n  }\n\n  protected isEventInsideVisible(event: MouseEvent) {\n    let target = event.target as HTMLElement;\n    return target.closest('.cm-scroller') != null;\n  }\n\n  protected isResponseUseful(response: lsProtocol.Hover) {\n    return (\n      response &&\n      response.contents &&\n      !(Array.isArray(response.contents) && response.contents.length === 0)\n    );\n  }\n\n  /**\n   * Returns true if the tooltip should stay.\n   */\n  protected async _updateUnderlineAndTooltip(\n    event: MouseEvent,\n    adapter: WidgetLSPAdapter<any>\n  ): Promise<boolean> {\n    const target = event.target;\n    // if over an empty space in a line (and not over a token) then not worth checking\n    if (\n      target == null\n      // TODO this no longer works in CodeMirror6 as it tires to avoid wrapping\n      // html elements as much as possible.\n      // || (target as HTMLElement).classList.contains('cm-line')\n    ) {\n      this.removeRangeHighlight();\n      return false;\n    }\n\n    const showTooltip =\n      this.isHoverAutomatic || getModifierState(event, this.modifierKey);\n\n    // Filtering is needed to determine in hovered character belongs to this virtual document\n\n    // TODO: or should the adapter be derived from model and passed as an argument? Or maybe we should try both?\n    // const adapter = this.contextAssembler.adapterFromNode(target as HTMLElement);\n\n    if (!adapter) {\n      this.removeRangeHighlight();\n      return false;\n    }\n\n    // We cannot just use:\n    // > const editorAccessor = adapter.activeEditor\n    // as it relies on the editor under the cursor being the active editor, which is not the case in notebook,\n    // especially for actions invoked using mouse (hover, rename from context menu).\n    const accessorFromNode = this.contextAssembler.editorFromNode(\n      adapter,\n      target as HTMLElement\n    );\n    if (!accessorFromNode) {\n      this.console.warn(\n        'Editor accessor not found from node, falling back to activeEditor'\n      );\n    }\n    const editorAccessor = accessorFromNode\n      ? accessorFromNode\n      : adapter.activeEditor;\n\n    if (!editorAccessor) {\n      this.removeRangeHighlight();\n      this.console.warn('Could not find editor accessor');\n      return false;\n    }\n\n    const rootPosition = this.contextAssembler.positionFromCoordinates(\n      event.clientX,\n      event.clientY,\n      adapter,\n      editorAccessor\n    );\n\n    // happens because some regions of the editor (between lines) have no characters\n    if (rootPosition == null) {\n      this.removeRangeHighlight();\n      return false;\n    }\n\n    const editor = editorAccessor.getEditor();\n    if (!editor) {\n      this.console.warn('Editor not available from accessor');\n      this.removeRangeHighlight();\n      return false;\n    }\n\n    const editorPosition = rootPositionToEditorPosition(adapter, rootPosition);\n\n    const offset = editor.getOffsetAt(\n      PositionConverter.cm_to_ce(editorPosition)\n    );\n    const token = editor.getTokenAt(offset);\n\n    const document = documentAtRootPosition(adapter, rootPosition);\n\n    if (\n      this.isTokenEmpty(token) ||\n      //document !== this.virtualDocument ||\n      !this.isEventInsideVisible(event)\n    ) {\n      this.removeRangeHighlight();\n      return false;\n    }\n\n    if (\n      !this.lastHoverCharacter ||\n      !isEqual(rootPosition, this.lastHoverCharacter)\n    ) {\n      let virtualPosition = rootPositionToVirtualPosition(\n        adapter,\n        rootPosition\n      );\n      this.virtualPosition = virtualPosition;\n      this.lastHoverCharacter = rootPosition;\n\n      // if we already sent a request, maybe it already covers the are of interest?\n      // not harm waiting as the server won't be able to help us anyways\n      if (this._previousHoverRequest) {\n        await Promise.race([\n          this._previousHoverRequest,\n          // just in case if the request stalled, set a timeout so we do not\n          // get stuck indefinitely\n          new Promise(resolve => {\n            return setTimeout(resolve, 1000);\n          })\n        ]);\n      }\n      let responseData = this.restoreFromCache(document, virtualPosition);\n      let delayMilliseconds = this.settings.composite.delay;\n\n      if (responseData == null) {\n        //const ceEditor =\n        //  editorAtRootPosition(adapter, rootPosition).getEditor()!;\n        const promise = this.debouncedGetHover.invoke(\n          document,\n          virtualPosition,\n          {\n            adapter,\n            token,\n            editor,\n            editorAccessor\n          }\n        );\n        this._previousHoverRequest = promise;\n        let response = await promise;\n        if (this._previousHoverRequest === promise) {\n          this._previousHoverRequest = null;\n        }\n        if (\n          response &&\n          response.range &&\n          ProtocolCoordinates.isWithinRange(\n            { line: virtualPosition.line, character: virtualPosition.ch },\n            response.range\n          ) &&\n          this.isResponseUseful(response)\n        ) {\n          // TODO: I am reconstructing the range anyways - do I really want to ensure it in getHover?\n          const editorRange = this._getEditorRange(\n            adapter,\n            response,\n            token,\n            editor,\n            document\n          );\n          responseData = {\n            response: response,\n            document: document,\n            editorRange: editorRange,\n            ceEditor: editor\n          };\n\n          this.cache.store(responseData);\n          delayMilliseconds = Math.max(\n            0,\n            this.settings.composite.delay -\n              this.settings.composite.throttlerDelay\n          );\n        } else {\n          this.removeRangeHighlight();\n          return false;\n        }\n      }\n\n      if (this.isHoverAutomatic) {\n        await new Promise(resolve => setTimeout(resolve, delayMilliseconds));\n      }\n\n      return this.handleResponse(\n        adapter,\n        responseData,\n        rootPosition,\n        showTooltip\n      );\n    } else {\n      return true;\n    }\n  }\n\n  protected updateUnderlineAndTooltip = (\n    event: MouseEvent,\n    adapter: WidgetLSPAdapter<any>\n  ) => {\n    try {\n      return this._updateUnderlineAndTooltip(event, adapter);\n    } catch (e) {\n      this.console.warn(e);\n      return undefined;\n    }\n  };\n\n  protected removeRangeHighlight = () => {\n    if (this.hasMarker) {\n      this.markManager.clearAllMarks();\n      this.hasMarker = false;\n      this.lastHoverResponse = null;\n      this.lastHoverCharacter = null;\n    }\n  };\n\n  remove(): void {\n    this.cache.clean();\n    this.removeRangeHighlight();\n    this.debouncedGetHover.dispose();\n  }\n\n  /**\n   * Construct the range to underline manually using the token information.\n   */\n  private _getEditorRange(\n    adapter: WidgetLSPAdapter<any>,\n    response: lsProtocol.Hover,\n    token: CodeEditor.IToken,\n    editor: CodeEditor.IEditor,\n    document: VirtualDocument\n  ): IEditorRange {\n    if (typeof response.range !== 'undefined') {\n      return rangeToEditorRange(adapter, response.range, editor, document);\n    }\n\n    const startInEditor = editor.getPositionAt(token.offset);\n    const endInEditor = editor.getPositionAt(token.offset + token.value.length);\n\n    if (!startInEditor || !endInEditor) {\n      throw Error(\n        'Could not reconstruct editor range: start or end of token in editor do not resolve to a position'\n      );\n    }\n\n    return {\n      start: PositionConverter.ce_to_cm(startInEditor) as IEditorPosition,\n      end: PositionConverter.ce_to_cm(endInEditor) as IEditorPosition,\n      editor\n    };\n  }\n\n  private _addRange(\n    adapter: WidgetLSPAdapter<any>,\n    response: lsProtocol.Hover,\n    editorEange: IEditorRange,\n    editorAccessor: Document.IEditor\n  ): lsProtocol.Hover {\n    return {\n      ...response,\n      range: {\n        start: PositionConverter.cm_to_lsp(\n          rootPositionToVirtualPosition(\n            adapter,\n            editorPositionToRootPosition(\n              adapter,\n              editorAccessor,\n              editorEange.start\n            )!\n          )\n        ),\n        end: PositionConverter.cm_to_lsp(\n          rootPositionToVirtualPosition(\n            adapter,\n            editorPositionToRootPosition(\n              adapter,\n              editorAccessor,\n              editorEange.end\n            )!\n          )\n        )\n      }\n    };\n  }\n}\n\nexport namespace HoverFeature {\n  export interface IOptions extends Feature.IOptions {\n    settings: FeatureSettings<LSPHoverSettings>;\n    renderMimeRegistry: IRenderMimeRegistry;\n    contextAssembler: ContextAssembler;\n  }\n  export const id = PLUGIN_ID + ':hover';\n}\n\nexport const HOVER_PLUGIN: JupyterFrontEndPlugin<void> = {\n  id: HoverFeature.id,\n  requires: [\n    ILSPFeatureManager,\n    ISettingRegistry,\n    IRenderMimeRegistry,\n    ILSPDocumentConnectionManager\n  ],\n  autoStart: true,\n  activate: async (\n    app: JupyterFrontEnd,\n    featureManager: ILSPFeatureManager,\n    settingRegistry: ISettingRegistry,\n    renderMimeRegistry: IRenderMimeRegistry,\n    connectionManager: ILSPDocumentConnectionManager\n  ) => {\n    const contextAssembler = new ContextAssembler({ app, connectionManager });\n    const settings = new FeatureSettings<LSPHoverSettings>(\n      settingRegistry,\n      HoverFeature.id\n    );\n    await settings.ready;\n    if (settings.composite.disable) {\n      return;\n    }\n    const feature = new HoverFeature({\n      settings,\n      renderMimeRegistry,\n      connectionManager,\n      contextAssembler\n    });\n    featureManager.register(feature);\n  }\n};\n","import {\n  IVirtualPosition,\n  offsetAtPosition,\n  WidgetLSPAdapter,\n  Document,\n  IPosition\n} from '@jupyterlab/lsp';\nimport type * as lsProtocol from 'vscode-languageserver-protocol';\n\nimport { PositionConverter } from './converter';\nimport { DefaultMap, urisEqual } from './utils';\nimport { VirtualDocument } from './virtual/document';\n\nexport interface IEditOutcome {\n  appliedChanges: number | null;\n  modifiedCells: number;\n  wasGranular: boolean;\n  errors: string[];\n}\n\nfunction offsetFromLsp(position: lsProtocol.Position, lines: string[]) {\n  return offsetAtPosition(PositionConverter.lsp_to_ce(position), lines);\n}\n\nfunction toDocumentChanges(changes: {\n  [uri: string]: lsProtocol.TextEdit[];\n}): lsProtocol.TextDocumentEdit[] {\n  let documentChanges = [];\n  for (let uri of Object.keys(changes)) {\n    documentChanges.push({\n      textDocument: { uri },\n      edits: changes[uri]\n    } as lsProtocol.TextDocumentEdit);\n  }\n  return documentChanges;\n}\n\nexport class EditApplicator {\n  constructor(\n    protected virtualDocument: VirtualDocument,\n    protected adapter: WidgetLSPAdapter<any>\n  ) {\n    // no-op\n  }\n\n  async applyEdit(\n    workspaceEdit: lsProtocol.WorkspaceEdit\n  ): Promise<IEditOutcome> {\n    let currentUri = this.virtualDocument.documentInfo.uri;\n\n    // Specs: documentChanges are preferred over changes\n    let changes = workspaceEdit.documentChanges\n      ? workspaceEdit.documentChanges.map(\n          change => change as lsProtocol.TextDocumentEdit\n        )\n      : toDocumentChanges(workspaceEdit.changes!);\n    let appliedChanges = 0;\n    let editedCells: number = 0;\n    let isWholeDocumentEdit: boolean = false;\n    let errors: string[] = [];\n\n    for (let change of changes) {\n      let uri = change.textDocument.uri;\n\n      if (!urisEqual(uri, currentUri)) {\n        errors.push(\n          `Workspace-wide edits not implemented: ${uri} != ${currentUri}`\n        );\n      } else {\n        isWholeDocumentEdit =\n          change.edits.length === 1 &&\n          this._isWholeDocumentEdit(change.edits[0]);\n\n        let edit: lsProtocol.TextEdit;\n\n        if (!isWholeDocumentEdit) {\n          appliedChanges = 0;\n          let value = this.virtualDocument.value;\n          // TODO: make sure that it was not changed since the request was sent (using the returned document version)\n          let lines = value.split('\\n');\n\n          let editsByOffset = new Map<number, lsProtocol.TextEdit>();\n          for (let e of change.edits) {\n            let offset = offsetFromLsp(e.range.start, lines);\n            if (editsByOffset.has(offset)) {\n              console.warn(\n                'Edits should not overlap, ignoring an overlapping edit'\n              );\n            } else {\n              editsByOffset.set(offset, e);\n              appliedChanges += 1;\n            }\n          }\n\n          // TODO make use of oldToNewLine for edits which add of remove lines:\n          //  this is crucial to preserve cell boundaries in notebook in such cases\n          let oldToNewLine = new DefaultMap<number, number[]>(() => []);\n          let newText = '';\n          let lastEnd = 0;\n          let currentOldLine = 0;\n          let currentNewLine = 0;\n          // going over the edits in descending order of start points:\n          let startOffsets = [...editsByOffset.keys()].sort((a, b) => a - b);\n          for (let start of startOffsets) {\n            let edit = editsByOffset.get(start)!;\n            let prefix = value.slice(lastEnd, start);\n            for (let i = 0; i < prefix.split('\\n').length; i++) {\n              let newLines = oldToNewLine.getOrCreate(currentOldLine);\n              newLines.push(currentNewLine);\n              currentOldLine += 1;\n              currentNewLine += 1;\n            }\n            newText += prefix + edit.newText;\n            let end = offsetFromLsp(edit.range.end, lines);\n            let replacedFragment = value.slice(start, end);\n            for (let i = 0; i < edit.newText.split('\\n').length; i++) {\n              if (i < replacedFragment.length) {\n                currentOldLine += 1;\n              }\n              currentNewLine += 1;\n              let newLines = oldToNewLine.getOrCreate(currentOldLine);\n              newLines.push(currentNewLine);\n            }\n            lastEnd = end;\n          }\n          newText += value.slice(lastEnd, value.length);\n\n          edit = {\n            range: {\n              start: { line: 0, character: 0 },\n              end: {\n                line: lines.length - 1,\n                character: lines[lines.length - 1].length\n              }\n            },\n            newText: newText\n          };\n          console.assert(this._isWholeDocumentEdit(edit));\n        } else {\n          edit = change.edits[0];\n          appliedChanges += 1;\n        }\n        editedCells = this._applySingleEdit(edit);\n      }\n    }\n    const allEmpty = changes.every(change => change.edits.length === 0);\n    return {\n      appliedChanges: appliedChanges,\n      modifiedCells: editedCells,\n      wasGranular: !isWholeDocumentEdit && !allEmpty,\n      errors: errors\n    };\n  }\n\n  /**\n   * Does the edit cover the entire document?\n   */\n  private _isWholeDocumentEdit(edit: lsProtocol.TextEdit) {\n    let value = this.virtualDocument.value;\n    let lines = value.split('\\n');\n    let range = edit.range;\n    let lsp_to_ce = PositionConverter.lsp_to_ce;\n    return (\n      offsetAtPosition(lsp_to_ce(range.start), lines) === 0 &&\n      offsetAtPosition(lsp_to_ce(range.end), lines) === value.length\n    );\n  }\n\n  private _replaceFragment(\n    newText: string,\n    editorAccessor: Document.IEditor,\n    fragmentStart: IPosition,\n    fragmentEnd: IPosition,\n    start: IPosition,\n    end: IPosition,\n    isWholeDocumentEdit = false\n  ): number {\n    let document = this.virtualDocument;\n    let newFragmentText = newText\n      .split('\\n')\n      .slice(fragmentStart.line - start.line, fragmentEnd.line - start.line)\n      .join('\\n');\n\n    if (newFragmentText.endsWith('\\n')) {\n      newFragmentText = newFragmentText.slice(0, -1);\n    }\n\n    const editor = editorAccessor.getEditor();\n    if (!editor) {\n      throw Error('Editor is not accessible');\n    }\n    if (editor.host.closest('.jp-MarkdownCell')) {\n      // Workaround for https://github.com/jupyter-lsp/jupyterlab-lsp/issues/1008\n      // briefly, the rewrite for JupyterLab 4.0 added Markdown cell support, but they\n      // are extracted without trace in the top-level document. Here we avoid editing\n      // any markdown cell. Instead the clean solution would be to add an anchor marker\n      // to the top-level document.\n      return 0;\n    }\n    // TODO: should accessor present the model even if editor is not created yet?\n    const model = editor.model;\n\n    let rawValue = model.sharedModel.source;\n    // extract foreign documents and substitute magics,\n    // as it was done when the shadow virtual document was being created\n    let { lines } = document.prepareCodeBlock({\n      value: rawValue,\n      ceEditor: editorAccessor,\n      type: 'code'\n    });\n    let oldValue = lines.join('\\n');\n\n    if (isWholeDocumentEdit) {\n      // partial edit\n      let cm_to_ce = PositionConverter.cm_to_ce;\n      let upToOffset = offsetAtPosition(cm_to_ce(start), lines);\n      let fromOffset = offsetAtPosition(cm_to_ce(end), lines);\n      newFragmentText =\n        oldValue.slice(0, upToOffset) + newText + oldValue.slice(fromOffset);\n    }\n\n    if (oldValue === newFragmentText) {\n      return 0;\n    }\n\n    let newValue = document.decodeCodeBlock(newFragmentText);\n\n    const cursor = editor.getCursorPosition();\n\n    model.sharedModel.updateSource(\n      editor.getOffsetAt({ line: 0, column: 0 }),\n      oldValue.length,\n      newValue\n    );\n\n    try {\n      // try to restore the cursor to the position prior to the edit\n      // (this might not be the best UX, but definitely better than\n      // the cursor jumping to the very end of the cell/file).\n      editor.setSelection({ start: cursor, end: cursor });\n      // note: this does not matter for actions invoke from context menu\n      // as those loose focus anyways (this might be addressed elsewhere)\n    } catch (e) {\n      console.log('Could not place the cursor back', e);\n    }\n\n    return 1;\n  }\n\n  private _applySingleEdit(edit: lsProtocol.TextEdit): number {\n    let document = this.virtualDocument;\n    let appliedChanges = 0;\n    let start = PositionConverter.lsp_to_cm(edit.range.start);\n    let end = PositionConverter.lsp_to_cm(edit.range.end);\n\n    let startEditor = document.getEditorAtVirtualLine(\n      start as IVirtualPosition\n    );\n    let endEditor = document.getEditorAtVirtualLine(end as IVirtualPosition);\n    if (startEditor !== endEditor) {\n      let lastEditor = startEditor;\n      let fragmentStart = start;\n      let fragmentEnd = { ...start };\n\n      let line = start.line;\n      let recentlyReplaced = false;\n      while (line <= end.line) {\n        line++;\n        let editor = document.getEditorAtVirtualLine({\n          line: line,\n          ch: 0\n        } as IVirtualPosition);\n\n        if (editor === lastEditor) {\n          fragmentEnd.line = line;\n          fragmentEnd.ch = 0;\n          recentlyReplaced = false;\n        } else {\n          appliedChanges += this._replaceFragment(\n            edit.newText,\n            lastEditor,\n            fragmentStart,\n            fragmentEnd,\n            start,\n            end\n          );\n          recentlyReplaced = true;\n          fragmentStart = {\n            line: line,\n            ch: 0\n          };\n          fragmentEnd = {\n            line: line,\n            ch: 0\n          };\n          lastEditor = editor;\n        }\n      }\n      if (!recentlyReplaced) {\n        appliedChanges += this._replaceFragment(\n          edit.newText,\n          lastEditor,\n          fragmentStart,\n          fragmentEnd,\n          start,\n          end\n        );\n      }\n    } else {\n      appliedChanges += this._replaceFragment(\n        edit.newText,\n        startEditor,\n        start,\n        end,\n        start,\n        end\n      );\n    }\n    return appliedChanges;\n  }\n}\n","import { IEditorPosition, WidgetLSPAdapter, Document } from '@jupyterlab/lsp';\nimport { Token } from '@lumino/coreutils';\nimport * as lsProtocol from 'vscode-languageserver-protocol';\n\nimport { PLUGIN_ID } from '../../tokens';\n\n/**\n * Diagnostic which is localized at a specific editor (cell) within a notebook\n * (if used in the context of a FileEditor, then there is just a single editor)\n */\nexport interface IEditorDiagnostic {\n  diagnostic: lsProtocol.Diagnostic;\n  editorAccessor: Document.IEditor;\n  range: {\n    start: IEditorPosition;\n    end: IEditorPosition;\n  };\n}\n\nexport interface IReadonlyDiagnosticsDatabase {\n  /**\n   * @alpha\n   */\n  get all(): IEditorDiagnostic[];\n}\n\nexport interface IDiagnosticsFeature {\n  /**\n   * @alpha\n   */\n  getDiagnosticsDB(\n    adapter: WidgetLSPAdapter<any>\n  ): IReadonlyDiagnosticsDatabase;\n}\n\nexport const IDiagnosticsFeature = new Token<IDiagnosticsFeature>(\n  PLUGIN_ID + ':IDiagnosticsFeature'\n);\n","import {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\nimport {\n  InputDialog,\n  Notification,\n  ICommandPalette\n} from '@jupyterlab/apputils';\nimport {\n  ILSPFeatureManager,\n  ILSPDocumentConnectionManager,\n  WidgetLSPAdapter\n} from '@jupyterlab/lsp';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport {\n  ITranslator,\n  nullTranslator,\n  TranslationBundle\n} from '@jupyterlab/translation';\nimport { LabIcon } from '@jupyterlab/ui-components';\nimport * as lsProtocol from 'vscode-languageserver-protocol';\n\nimport renameSvg from '../../style/icons/rename.svg';\nimport { CodeRename as LSPRenameSettings } from '../_rename';\nimport { ContextAssembler } from '../context';\nimport {\n  PositionConverter,\n  editorAtRootPosition,\n  rootPositionToEditorPosition\n} from '../converter';\nimport { EditApplicator, IEditOutcome } from '../edits';\nimport { FeatureSettings, Feature } from '../feature';\nimport { PLUGIN_ID } from '../tokens';\nimport { BrowserConsole } from '../virtual/console';\nimport { VirtualDocument } from '../virtual/document';\n\nimport { IDiagnosticsFeature } from './diagnostics/tokens';\n\nexport const renameIcon = new LabIcon({\n  name: 'lsp:rename',\n  svgstr: renameSvg\n});\n\nconst FEATURE_ID = PLUGIN_ID + ':rename';\n\nexport class RenameFeature extends Feature {\n  readonly id = RenameFeature.id;\n  readonly capabilities: lsProtocol.ClientCapabilities = {\n    textDocument: {\n      rename: {\n        prepareSupport: false,\n        honorsChangeAnnotations: false\n      }\n    }\n  };\n  protected console = new BrowserConsole().scope('Rename');\n\n  private _trans: TranslationBundle;\n\n  constructor(options: RenameFeature.IOptions) {\n    super(options);\n    this._trans = options.trans;\n  }\n\n  async handleRename(\n    workspaceEdit: lsProtocol.WorkspaceEdit,\n    oldValue: string,\n    newValue: string,\n    adapter: WidgetLSPAdapter<any>,\n    document: VirtualDocument\n  ) {\n    let outcome: IEditOutcome;\n    const applicator = new EditApplicator(document, adapter);\n\n    try {\n      outcome = await applicator.applyEdit(workspaceEdit);\n    } catch (error) {\n      Notification.emit(this._trans.__('Rename failed: %1', error), 'error');\n      return;\n    }\n\n    try {\n      let status: string;\n      const changeText = this._trans.__('%1 to %2', oldValue, newValue);\n      let severity: 'success' | 'warning' | 'error' = 'success';\n\n      if (outcome.appliedChanges === 0) {\n        status = this._trans.__(\n          'Could not rename %1 - consult the language server documentation',\n          changeText\n        );\n        severity = 'warning';\n      } else if (outcome.wasGranular) {\n        status = this._trans._n(\n          'Renamed %2 in %3 place',\n          'Renamed %2 in %3 places',\n          outcome.appliedChanges!,\n          changeText,\n          outcome.appliedChanges\n        );\n      } else if (adapter.hasMultipleEditors) {\n        status = this._trans._n(\n          'Renamed %2 in %3 cell',\n          'Renamed %2 in %3 cells',\n          outcome.modifiedCells,\n          changeText,\n          outcome.modifiedCells\n        );\n      } else {\n        status = this._trans.__('Renamed %1', changeText);\n      }\n\n      if (outcome.errors.length !== 0) {\n        status += this._trans.__(' with errors: %1', outcome.errors);\n        severity = 'error';\n      }\n\n      Notification.emit(status, severity, {\n        autoClose: (severity === 'error' ? 5 : 3) * 1000\n      });\n    } catch (error) {\n      this.console.warn(error);\n    }\n\n    return outcome;\n  }\n}\n\n/**\n * In #115 an issue with rename for Python (when using pyls) was identified:\n * rename was failing with an obscure message when the source code could\n * not be parsed correctly by rope (due to a user's syntax error).\n *\n * This function detects such a condition using diagnostics feature\n * and provides a nice error message to the user.\n */\nfunction guessFailureReason(\n  error: Error,\n  adapter: WidgetLSPAdapter<any>,\n  diagnostics: IDiagnosticsFeature,\n  trans: TranslationBundle\n): string | null {\n  let hasIndexError = false;\n  try {\n    hasIndexError = error.message.includes('IndexError');\n  } catch (e) {\n    return null;\n  }\n  if (!hasIndexError) {\n    return null;\n  }\n  let direPythonErrors = (\n    diagnostics.getDiagnosticsDB(adapter).all || []\n  ).filter(\n    diagnostic =>\n      diagnostic.diagnostic.message.includes('invalid syntax') ||\n      diagnostic.diagnostic.message.includes('SyntaxError') ||\n      diagnostic.diagnostic.message.includes('IndentationError')\n  );\n\n  if (direPythonErrors.length === 0) {\n    return null;\n  }\n\n  let direErrors = [\n    ...new Set(\n      direPythonErrors.map(diagnostic => {\n        let message = diagnostic.diagnostic.message;\n        let start = diagnostic.range.start;\n        if (adapter.hasMultipleEditors) {\n          let editorIndex = adapter.editors.findIndex(\n            e => e.ceEditor === diagnostic.editorAccessor\n          );\n          let cellNumber = editorIndex === -1 ? '(?)' : editorIndex + 1;\n          return trans.__(\n            '%1 in cell %2 at line %3',\n            message,\n            cellNumber,\n            start.line\n          );\n        } else {\n          return trans.__('%1 at line %2', message, start.line);\n        }\n      })\n    )\n  ].join(', ');\n  return trans.__('Syntax error(s) prevents rename: %1', direErrors);\n}\n\nexport namespace RenameFeature {\n  export interface IOptions extends Feature.IOptions {\n    trans: TranslationBundle;\n  }\n  export const id = FEATURE_ID;\n}\n\nexport namespace CommandIDs {\n  export const renameSymbol = 'lsp:rename-symbol';\n}\n\nexport const RENAME_PLUGIN: JupyterFrontEndPlugin<void> = {\n  id: FEATURE_ID,\n  requires: [\n    ILSPFeatureManager,\n    ISettingRegistry,\n    ILSPDocumentConnectionManager\n  ],\n  optional: [ICommandPalette, IDiagnosticsFeature, ITranslator],\n  autoStart: true,\n  activate: async (\n    app: JupyterFrontEnd,\n    featureManager: ILSPFeatureManager,\n    settingRegistry: ISettingRegistry,\n    connectionManager: ILSPDocumentConnectionManager,\n    palette: ICommandPalette,\n    diagnostics: IDiagnosticsFeature,\n    translator: ITranslator\n  ) => {\n    const trans = (translator || nullTranslator).load('jupyterlab_lsp');\n    const settings = new FeatureSettings<LSPRenameSettings>(\n      settingRegistry,\n      RenameFeature.id\n    );\n    await settings.ready;\n\n    if (settings.composite.disable) {\n      return;\n    }\n    const feature = new RenameFeature({\n      trans,\n      connectionManager\n    });\n    featureManager.register(feature);\n\n    const assembler = new ContextAssembler({\n      app,\n      connectionManager\n    });\n\n    app.commands.addCommand(CommandIDs.renameSymbol, {\n      execute: async () => {\n        const context = assembler.getContext();\n        if (!context) {\n          return;\n        }\n        const { adapter, connection, virtualPosition, rootPosition, document } =\n          context;\n\n        const editorAccessor = editorAtRootPosition(adapter, rootPosition);\n        const editor = editorAccessor?.getEditor();\n        if (!editor) {\n          console.log('Could not rename - no editor');\n          return;\n        }\n        const editorPosition = rootPositionToEditorPosition(\n          adapter,\n          rootPosition\n        );\n        const offset = editor.getOffsetAt(\n          PositionConverter.cm_to_ce(editorPosition)\n        );\n        let oldValue = editor.getTokenAt(offset).value;\n        let handleFailure = (error: Error) => {\n          let status: string | null = '';\n\n          if (diagnostics) {\n            status = guessFailureReason(error, adapter, diagnostics, trans);\n          }\n\n          if (!status) {\n            Notification.error(trans.__(`Rename failed: %1`, error), {\n              autoClose: 5 * 1000\n            });\n          } else {\n            Notification.warning(status, { autoClose: 3 * 1000 });\n          }\n        };\n\n        const dialogValue = await InputDialog.getText({\n          title: trans.__('Rename to'),\n          text: oldValue,\n          okLabel: trans.__('Rename'),\n          cancelLabel: trans.__('Cancel')\n        });\n\n        try {\n          const newValue = dialogValue.value;\n          if (dialogValue.button.accept != true || newValue == null) {\n            // the user has cancelled the rename action or did not provide new value\n            return;\n          }\n          Notification.info(\n            trans.__('Renaming %1 to %2…', oldValue, newValue),\n            { autoClose: 3 * 1000 }\n          );\n          const edit = await connection!.clientRequests[\n            'textDocument/rename'\n          ].request({\n            position: {\n              line: virtualPosition.line,\n              character: virtualPosition.ch\n            },\n            textDocument: {\n              uri: document.documentInfo.uri\n            },\n            newName: newValue\n          });\n          if (edit) {\n            await feature.handleRename(\n              edit,\n              oldValue,\n              newValue,\n              adapter,\n              document\n            );\n          } else {\n            handleFailure(new Error('no edit from server'));\n          }\n        } catch (error) {\n          handleFailure(error);\n        }\n      },\n      isVisible: () => {\n        const context = assembler.getContext();\n        if (!context) {\n          return false;\n        }\n        const { connection } = context;\n        return (\n          connection != null &&\n          connection.isReady &&\n          connection.provides('renameProvider')\n        );\n      },\n      isEnabled: () => {\n        return assembler.isContextMenuOverToken() ? true : false;\n      },\n      label: trans.__('Rename symbol'),\n      icon: renameIcon\n    });\n\n    // add to menus\n    app.contextMenu.addItem({\n      selector: '.jp-Notebook .jp-CodeCell .jp-Editor',\n      command: CommandIDs.renameSymbol,\n      rank: 10\n    });\n\n    app.contextMenu.addItem({\n      selector: '.jp-FileEditor',\n      command: CommandIDs.renameSymbol,\n      rank: 0\n    });\n\n    palette.addItem({\n      command: CommandIDs.renameSymbol,\n      category: trans.__('Language Server Protocol')\n    });\n  }\n};\n","import { Language } from '@codemirror/language';\nimport { ChangeSet, Text } from '@codemirror/state';\nimport { EditorView } from '@codemirror/view';\nimport {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\nimport {\n  EditorExtensionRegistry,\n  IEditorLanguageRegistry,\n  jupyterHighlightStyle\n} from '@jupyterlab/codemirror';\nimport {\n  IEditorPosition,\n  IRootPosition,\n  offsetAtPosition,\n  positionAtOffset,\n  ILSPFeatureManager,\n  ILSPDocumentConnectionManager,\n  WidgetLSPAdapter\n} from '@jupyterlab/lsp';\nimport { IRenderMimeRegistry } from '@jupyterlab/rendermime';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { highlightTree } from '@lezer/highlight';\nimport * as lsProtocol from 'vscode-languageserver-protocol';\n\nimport { CodeSignature as LSPSignatureSettings } from '../_signature';\nimport { EditorTooltipManager } from '../components/free_tooltip';\nimport {\n  PositionConverter,\n  rootPositionToVirtualPosition,\n  editorPositionToRootPosition\n} from '../converter';\nimport { FeatureSettings, Feature } from '../feature';\nimport { ILogConsoleCore, PLUGIN_ID } from '../tokens';\nimport { escapeMarkdown } from '../utils';\nimport { BrowserConsole } from '../virtual/console';\n\nconst TOOLTIP_ID = 'signature';\nconst CLASS_NAME = 'lsp-signature-help';\n\nfunction getMarkdown(item: string | lsProtocol.MarkupContent) {\n  if (typeof item === 'string') {\n    return escapeMarkdown(item);\n  } else {\n    if (item.kind === 'markdown') {\n      return item.value;\n    } else {\n      return escapeMarkdown(item.value);\n    }\n  }\n}\n\ninterface ISplit {\n  lead: string;\n  remainder: string;\n}\n\nexport function extractLead(lines: string[], size: number): ISplit | null {\n  // try to split after paragraph\n  const leadLines = [];\n  let splitOnParagraph = false;\n\n  for (const line of lines.slice(0, size + 1)) {\n    const isEmpty = line.trim() == '';\n    if (isEmpty) {\n      splitOnParagraph = true;\n      break;\n    }\n    leadLines.push(line);\n  }\n  // see if we got something which does not include Markdown formatting\n  // (so it won't lead to broken formatting if we split after it);\n  const leadCandidate = leadLines.join('\\n');\n\n  if (splitOnParagraph && leadCandidate.search(/[\\\\*#[\\]<>_]/g) === -1) {\n    return {\n      lead: leadCandidate,\n      remainder: lines.slice(leadLines.length + 1).join('\\n')\n    };\n  }\n  return null;\n}\n\n/**\n * Represent signature as a Markdown element.\n */\nexport function signatureToMarkdown(\n  item: lsProtocol.SignatureInformation,\n  language: Language | undefined,\n  codeHighlighter: (\n    source: string,\n    variable: lsProtocol.ParameterInformation,\n    language: Language | undefined\n  ) => string,\n  logger: ILogConsoleCore,\n  activeParameterFallback?: number | null,\n  maxLinesBeforeCollapse: number = 4\n): string {\n  const activeParameter: number | undefined | null =\n    typeof item.activeParameter !== 'undefined'\n      ? item.activeParameter\n      : activeParameterFallback;\n  let markdown: string;\n  let label = item.label;\n  if (item.parameters && activeParameter != null) {\n    if (activeParameter > item.parameters.length) {\n      logger.error(\n        'LSP server returned wrong number for activeSignature for: ',\n        item\n      );\n      markdown = '```' + language?.name + '\\n' + label + '\\n```';\n    } else {\n      const parameter = item.parameters[activeParameter];\n      markdown = codeHighlighter(label, parameter, language);\n    }\n  } else {\n    markdown = '```' + language?.name + '\\n' + label + '\\n```';\n  }\n  let details = '';\n  if (item.documentation) {\n    if (\n      typeof item.documentation === 'string' ||\n      item.documentation.kind === 'plaintext'\n    ) {\n      const plainTextDocumentation =\n        typeof item.documentation === 'string'\n          ? item.documentation\n          : item.documentation.value;\n      // TODO: make use of the MarkupContent object instead\n      for (let line of plainTextDocumentation.split('\\n')) {\n        if (line.trim() === item.label.trim()) {\n          continue;\n        }\n\n        details += getMarkdown(line) + '\\n';\n      }\n    } else {\n      if (item.documentation.kind !== 'markdown') {\n        logger.warn('Unknown MarkupContent kind:', item.documentation.kind);\n      }\n      details += item.documentation.value;\n    }\n  } else if (item.parameters) {\n    details +=\n      '\\n\\n' +\n      item.parameters\n        .filter(parameter => parameter.documentation)\n        .map(parameter => '- ' + getMarkdown(parameter.documentation!))\n        .join('\\n');\n  }\n  if (details) {\n    const lines = details.trim().split('\\n');\n    if (lines.length > maxLinesBeforeCollapse) {\n      const split = extractLead(lines, maxLinesBeforeCollapse);\n      if (split) {\n        details =\n          split.lead + '\\n<details>\\n' + split.remainder + '\\n</details>';\n      } else {\n        details = '<details>\\n' + details + '\\n</details>';\n      }\n    }\n    markdown += '\\n\\n' + details;\n  } else {\n    markdown += '\\n';\n  }\n  return markdown;\n}\n\nexport function highlightCode(\n  source: string,\n  parameter: lsProtocol.ParameterInformation,\n  language: Language | undefined\n) {\n  const pre = document.createElement('pre');\n  const code = document.createElement('code');\n  pre.appendChild(code);\n  code.className =\n    'cm-s-jupyter' + language ? `language-${language?.name}` : '';\n\n  const substring: string =\n    typeof parameter.label === 'string'\n      ? parameter.label\n      : source.slice(parameter.label[0], parameter.label[1]);\n  const start = source.indexOf(substring);\n  const end = start + substring.length;\n  if (!language) {\n    code.innerText = source;\n  } else {\n    runMode(\n      source,\n      language,\n      (token: string, className: string, from: number, to: number) => {\n        let populated = false;\n        // In CodeMirror6 variables are not necessarily tokenized,\n        // we need to split them manually\n        if (from <= end && start <= to) {\n          const a = Math.max(start, from);\n          const b = Math.min(to, end);\n          if (a != b) {\n            const prefix = source.slice(from, a);\n            const content = source.slice(a, b);\n            const suffix = source.slice(b, to);\n\n            const mark = document.createElement('mark');\n            if (className) {\n              mark.className = className;\n            }\n            mark.appendChild(document.createTextNode(content));\n            code.appendChild(document.createTextNode(prefix));\n            code.appendChild(mark);\n            code.appendChild(document.createTextNode(suffix));\n            populated = true;\n          }\n        }\n        if (!populated) {\n          if (className) {\n            const element = document.createElement('span');\n            element.classList.add(className);\n            element.textContent = token;\n            code.appendChild(element);\n          } else {\n            code.appendChild(document.createTextNode(token));\n          }\n        }\n      }\n    );\n  }\n\n  return pre.outerHTML;\n}\n\nfunction extractLastCharacter(changes: ChangeSet): string {\n  // TODO test with pasting, maybe rewrite to retrieve based on cursor position.\n  let last = '';\n  changes.iterChanges(\n    (\n      fromA: number,\n      toA: number,\n      fromB: number,\n      toB: number,\n      inserted: Text\n    ) => {\n      last = inserted.sliceString(-1);\n    }\n  );\n  return last ? last[0] : '';\n}\n\nfunction runMode(\n  source: string,\n  language: Language,\n  callback: (\n    text: string,\n    style: string | null,\n    from: number,\n    to: number\n  ) => void\n): void {\n  const tree = language.parser.parse(source);\n  let pos = 0;\n  highlightTree(tree, jupyterHighlightStyle, (from, to, token) => {\n    if (from > pos) {\n      callback(source.slice(pos, from), null, pos, from);\n    }\n    callback(source.slice(from, to), token, from, to);\n    pos = to;\n  });\n  if (pos != tree.length) {\n    callback(source.slice(pos, tree.length), null, pos, tree.length);\n  }\n}\n\nexport class SignatureFeature extends Feature {\n  readonly id = SignatureFeature.id;\n  readonly capabilities: lsProtocol.ClientCapabilities = {\n    textDocument: {\n      signatureHelp: {\n        dynamicRegistration: true,\n        signatureInformation: {\n          documentationFormat: ['markdown', 'plaintext']\n        }\n      }\n    }\n  };\n  tooltip: EditorTooltipManager;\n\n  protected signatureCharacter: IRootPosition;\n  protected _signatureCharacters: string[];\n  protected console = new BrowserConsole().scope('Signature');\n  protected settings: FeatureSettings<LSPSignatureSettings>;\n  protected languageRegistry: IEditorLanguageRegistry;\n\n  constructor(options: SignatureFeature.IOptions) {\n    super(options);\n    this.settings = options.settings;\n    this.tooltip = new EditorTooltipManager(options.renderMimeRegistry);\n    this.languageRegistry = options.languageRegistry;\n    this.extensionFactory = {\n      name: 'lsp:codeSignature',\n      factory: factoryOptions => {\n        const { editor: editorAccessor, widgetAdapter: adapter } =\n          factoryOptions;\n\n        const updateListener = EditorView.updateListener.of(viewUpdate => {\n          const editor = editorAccessor!.getEditor();\n\n          if (!editor) {\n            // see https://github.com/jupyter-lsp/jupyterlab-lsp/issues/984\n            // TODO: should not be needed once https://github.com/jupyterlab/jupyterlab/pull/14920 is in\n            return;\n          }\n\n          // TODO: or should it come from viewUpdate instead?!\n          // especially on copy paste this can be problematic.\n          const position = editor.getCursorPosition();\n\n          const editorPosition = PositionConverter.ce_to_cm(\n            position\n          ) as IEditorPosition;\n\n          // Delay handling by moving on top of the stack\n          // so that virtual document is updated.\n          setTimeout(() => {\n            // be careful: updateListener also fires after blur, so we\n            // need to carefully check what changed to avoid invalidating\n            // user clicking on the hover box.\n            if (viewUpdate.docChanged) {\n              this.afterChange(\n                viewUpdate.changes,\n                adapter,\n                editorPosition\n              ).catch(this.console.warn);\n            } else if (viewUpdate.selectionSet) {\n              this.onCursorActivity(adapter, editorPosition).catch(\n                this.console.warn\n              );\n            }\n          }, 0);\n        });\n\n        const focusListener = EditorView.domEventHandlers({\n          focus: () => {\n            // TODO\n            // this.onCursorActivity()\n          },\n          blur: event => {\n            this.onBlur(event);\n          }\n        });\n\n        return EditorExtensionRegistry.createImmutableExtension([\n          updateListener,\n          focusListener\n        ]);\n      }\n    };\n  }\n\n  get _closeCharacters(): string[] {\n    if (!this.settings) {\n      return [];\n    }\n    return this.settings.composite.closeCharacters;\n  }\n\n  onBlur(event: FocusEvent) {\n    // hide unless the focus moved to the signature itself\n    // (allowing user to select/copy from signature)\n    const target = event.relatedTarget as Element | null;\n    if (\n      this.isSignatureShown() &&\n      (target ? target.closest('.' + CLASS_NAME) === null : true)\n    ) {\n      this._removeTooltip();\n    }\n  }\n\n  async onCursorActivity(\n    adapter: WidgetLSPAdapter<any>,\n    newEditorPosition: IEditorPosition\n  ) {\n    if (!this.isSignatureShown()) {\n      return;\n    }\n\n    const initialPosition = this.tooltip.position;\n    if (\n      newEditorPosition.line === initialPosition.line &&\n      newEditorPosition.ch < initialPosition.ch\n    ) {\n      // close tooltip if receded beyond starting position\n      this._removeTooltip();\n    } else {\n      // otherwise, update the signature as the active parameter could have changed,\n      // or the server may want us to close the tooltip\n      await this._requestSignature(adapter, newEditorPosition, initialPosition);\n    }\n  }\n\n  protected getMarkupForSignatureHelp(\n    response: lsProtocol.SignatureHelp,\n    language: Language | undefined\n  ): lsProtocol.MarkupContent {\n    let signatures = new Array<string>();\n\n    if (response.activeSignature != null) {\n      if (response.activeSignature >= response.signatures.length) {\n        this.console.error(\n          'LSP server returned wrong number for activeSignature for: ',\n          response\n        );\n      } else {\n        const item = response.signatures[response.activeSignature];\n        return {\n          kind: 'markdown',\n          value: this.signatureToMarkdown(\n            item,\n            language,\n            response.activeParameter\n          )\n        };\n      }\n    }\n\n    response.signatures.forEach(item => {\n      let markdown = this.signatureToMarkdown(item, language);\n      signatures.push(markdown);\n    });\n\n    return {\n      kind: 'markdown',\n      value: signatures.join('\\n\\n')\n    };\n  }\n\n  /**\n   * Represent signature as a Markdown element.\n   */\n  protected signatureToMarkdown(\n    item: lsProtocol.SignatureInformation,\n    language: Language | undefined,\n    activeParameterFallback?: number | null\n  ): string {\n    return signatureToMarkdown(\n      item,\n      language,\n      highlightCode,\n      this.console,\n      activeParameterFallback,\n      this.settings.composite.maxLines\n    );\n  }\n\n  private _removeTooltip() {\n    this.tooltip.remove();\n  }\n\n  private _hideTooltip() {\n    this.tooltip.hide();\n  }\n\n  private handleSignature(\n    response: lsProtocol.SignatureHelp,\n    adapter: WidgetLSPAdapter<any>,\n    positionAtRequest: IRootPosition,\n    displayPosition: IEditorPosition | null = null\n  ) {\n    this.console.debug('Signature received', response);\n\n    // TODO: this might wrong connection!\n    // we need to find the correct documentAtRootPosition\n    const virtualDocument = adapter.virtualDocument!;\n    const connection = this.connectionManager.connections.get(\n      virtualDocument.uri\n    )!;\n\n    const signatureCharacters: string[] =\n      connection.serverCapabilities.signatureHelpProvider?.triggerCharacters ??\n      [];\n\n    if (response === null) {\n      // do not hide on undefined as it simply indicates that no new info is available\n      // (null means close, undefined means no update, response means update)\n      this._removeTooltip();\n    } else if (response) {\n      this._hideTooltip();\n    }\n\n    if (!this.signatureCharacter || !response || !response.signatures.length) {\n      if (response) {\n        this._removeTooltip();\n      }\n      this.console.debug(\n        'Ignoring signature response: cursor lost or response empty'\n      );\n      return;\n    }\n\n    // TODO: helper?\n    const editorAccessor = adapter.activeEditor!;\n    const editor = editorAccessor.getEditor()!;\n    const pos = editor.getCursorPosition();\n    const editorPosition = PositionConverter.ce_to_cm(pos) as IEditorPosition;\n\n    // TODO should I just shove it into Feature class and have an adapter getter in there?\n    const rootPosition = editorPositionToRootPosition(\n      adapter,\n      editorAccessor,\n      editorPosition\n    );\n\n    if (!rootPosition) {\n      this.console.warn(\n        'Signature failed: could not map editor position to root position.'\n      );\n      this._removeTooltip();\n      return;\n    }\n\n    // if the cursor advanced in the same line, the previously retrieved signature may still be useful\n    // if the line changed or cursor moved backwards then no reason to keep the suggestions\n    if (\n      positionAtRequest.line != rootPosition.line ||\n      rootPosition.ch < positionAtRequest.ch\n    ) {\n      this.console.debug(\n        'Ignoring signature response: cursor has receded or changed line'\n      );\n      this._removeTooltip();\n      return;\n    }\n\n    //const virtualPosition = rootPositionToVirtualPosition(adapter, rootPosition);\n\n    //let editorAccessor = adapter.editors[adapter.getEditorIndexAt(virtualPosition)].ceEditor;\n    //const editor = editorAccessor.getEditor();\n    if (!editor) {\n      this.console.debug(\n        'Ignoring signature response: the corresponding editor is not loaded'\n      );\n      return;\n    }\n    if (!editor.hasFocus()) {\n      this.console.debug(\n        'Ignoring signature response: the corresponding editor lost focus'\n      );\n      this._removeTooltip();\n      return;\n    }\n\n    const editorLanguage = this.languageRegistry.findByMIME(\n      editor.model.mimeType\n    );\n    const language = editorLanguage?.support?.language;\n    let markup = this.getMarkupForSignatureHelp(response, language);\n\n    this.console.debug(\n      'Signature will be shown',\n      language,\n      markup,\n      rootPosition,\n      response\n    );\n    if (displayPosition === null) {\n      // try to find last occurrence of trigger character to position the tooltip\n      const content = editor.model.sharedModel.getSource();\n      const lines = content.split('\\n');\n      const offset = offsetAtPosition(\n        PositionConverter.cm_to_ce(editorPosition!),\n        lines\n      );\n      // maybe?\n      // const offset = cm_editor.getOffsetAt(PositionConverter.cm_to_ce(editorPosition));\n      const subset = content.substring(0, offset);\n      const lastTriggerCharacterOffset = Math.max(\n        ...signatureCharacters.map(character => subset.lastIndexOf(character))\n      );\n      if (lastTriggerCharacterOffset !== -1) {\n        displayPosition = PositionConverter.ce_to_cm(\n          positionAtOffset(lastTriggerCharacterOffset, lines)\n        ) as IEditorPosition;\n      } else {\n        displayPosition = editorPosition;\n      }\n    }\n    this.tooltip.showOrCreate({\n      markup,\n      position: displayPosition!,\n      id: TOOLTIP_ID,\n      ceEditor: editor,\n      adapter: adapter,\n      className: CLASS_NAME,\n      tooltip: {\n        privilege: 'forceAbove',\n        // do not move the tooltip to match the token to avoid drift of the\n        // tooltip due the simplicity of token matching rules; instead we keep\n        // the position constant manually via `displayPosition`.\n        alignment: undefined,\n        hideOnKeyPress: false\n      }\n    });\n  }\n\n  protected isSignatureShown() {\n    return this.tooltip.isShown(TOOLTIP_ID);\n  }\n\n  async afterChange(\n    change: ChangeSet,\n    adapter: WidgetLSPAdapter<any>,\n    editorPosition: IEditorPosition\n  ) {\n    const lastCharacter = extractLastCharacter(change);\n\n    const isSignatureShown = this.isSignatureShown();\n    let previousPosition: IEditorPosition | null = null;\n    await adapter.updateFinished;\n\n    if (isSignatureShown) {\n      previousPosition = this.tooltip.position;\n      if (this._closeCharacters.includes(lastCharacter)) {\n        // remove just in case but do not short-circuit in case if we need to re-trigger\n        this._removeTooltip();\n      }\n    }\n\n    // TODO: use connection for virtual document from root position!\n    const virtualDocument = adapter.virtualDocument;\n    if (!virtualDocument) {\n      this.console.warn('Could not access virtual document');\n      return;\n    }\n    const connection = this.connectionManager.connections.get(\n      virtualDocument.uri\n    )!;\n    if (!connection.isReady) {\n      return;\n    }\n\n    const signatureCharacters =\n      connection.serverCapabilities.signatureHelpProvider?.triggerCharacters ??\n      [];\n\n    // only proceed if: trigger character was used or the signature is/was visible immediately before\n    if (!(signatureCharacters.includes(lastCharacter) || isSignatureShown)) {\n      return;\n    }\n\n    await this._requestSignature(adapter, editorPosition, previousPosition);\n  }\n\n  private async _requestSignature(\n    adapter: WidgetLSPAdapter<any>,\n    newEditorPosition: IEditorPosition,\n    previousPosition: IEditorPosition | null\n  ) {\n    // TODO: why would virtual document be missing?\n    const virtualDocument = adapter.virtualDocument!;\n    const connection = this.connectionManager.connections.get(\n      virtualDocument.uri\n    )!;\n\n    if (\n      !(\n        connection.isReady &&\n        connection.serverCapabilities.signatureHelpProvider\n      )\n    ) {\n      return;\n    }\n\n    // TODO: why missing\n    const rootPosition = virtualDocument.transformFromEditorToRoot(\n      adapter.activeEditor!,\n      newEditorPosition\n    )!;\n\n    this.signatureCharacter = rootPosition;\n\n    const virtualPosition = rootPositionToVirtualPosition(\n      adapter,\n      rootPosition\n    );\n\n    const help = await connection.clientRequests[\n      'textDocument/signatureHelp'\n    ].request({\n      position: {\n        line: virtualPosition.line,\n        character: virtualPosition.ch\n      },\n      textDocument: {\n        uri: virtualDocument.documentInfo.uri\n      }\n    });\n    return this.handleSignature(help, adapter, rootPosition, previousPosition);\n  }\n}\n\nexport namespace SignatureFeature {\n  export interface IOptions extends Feature.IOptions {\n    settings: FeatureSettings<LSPSignatureSettings>;\n    renderMimeRegistry: IRenderMimeRegistry;\n    languageRegistry: IEditorLanguageRegistry;\n  }\n  export const id = PLUGIN_ID + ':signature';\n}\n\nexport const SIGNATURE_PLUGIN: JupyterFrontEndPlugin<void> = {\n  id: SignatureFeature.id,\n  requires: [\n    ILSPFeatureManager,\n    ISettingRegistry,\n    IRenderMimeRegistry,\n    ILSPDocumentConnectionManager,\n    IEditorLanguageRegistry\n  ],\n  autoStart: true,\n  activate: async (\n    app: JupyterFrontEnd,\n    featureManager: ILSPFeatureManager,\n    settingRegistry: ISettingRegistry,\n    renderMimeRegistry: IRenderMimeRegistry,\n    connectionManager: ILSPDocumentConnectionManager,\n    languageRegistry: IEditorLanguageRegistry\n  ) => {\n    const settings = new FeatureSettings<LSPSignatureSettings>(\n      settingRegistry,\n      SignatureFeature.id\n    );\n    await settings.ready;\n    if (settings.composite.disable) {\n      return;\n    }\n    const feature = new SignatureFeature({\n      settings,\n      connectionManager,\n      renderMimeRegistry,\n      languageRegistry\n    });\n    featureManager.register(feature);\n    // return feature;\n  }\n};\n","import {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\nimport { IEditorExtensionRegistry } from '@jupyterlab/codemirror';\nimport { DocumentRegistry, IDocumentWidget } from '@jupyterlab/docregistry';\nimport { IEditorTracker, FileEditor } from '@jupyterlab/fileeditor';\nimport {\n  ILSPFeatureManager,\n  ILSPDocumentConnectionManager,\n  WidgetLSPAdapter,\n  VirtualDocument\n} from '@jupyterlab/lsp';\nimport { IRenderMimeRegistry } from '@jupyterlab/rendermime';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport {\n  ITableOfContentsRegistry,\n  TableOfContents,\n  TableOfContentsModel,\n  TableOfContentsFactory\n} from '@jupyterlab/toc';\nimport { Throttler } from '@lumino/polling';\nimport { Widget } from '@lumino/widgets';\nimport type * as lsProtocol from 'vscode-languageserver-protocol';\n\nimport { CodeSymbols as LSPSymbolSettings } from '../_symbol';\nimport { ContextAssembler } from '../context';\nimport { FeatureSettings, Feature } from '../feature';\nimport { SymbolTag } from '../lsp';\nimport { PLUGIN_ID } from '../tokens';\nimport { BrowserConsole } from '../virtual/console';\n\n/**\n * Interface describing a LSP heading.\n */\ninterface IEditorHeading extends TableOfContents.IHeading {\n  /**\n   * LSP symbol data.\n   */\n  symbol: lsProtocol.DocumentSymbol;\n}\n\n/**\n * Table of content model using LSP.\n */\nclass LSPTableOfContentsModel extends TableOfContentsModel<\n  IEditorHeading,\n  IDocumentWidget<FileEditor, DocumentRegistry.IModel>\n> {\n  constructor(\n    protected widget: IDocumentWidget<FileEditor, DocumentRegistry.IModel>,\n    protected symbolFeature: SymbolFeature,\n    protected connectionManager: ILSPDocumentConnectionManager,\n    configuration?: TableOfContents.IConfig\n  ) {\n    super(widget, configuration);\n  }\n\n  /**\n   * Type of document supported by the model.\n   *\n   * #### Notes\n   * A `data-document-type` attribute with this value will be set\n   * on the tree view `.jp-TableOfContents-content[data-document-type=\"...\"]`\n   */\n  get documentType(): string {\n    return 'lsp';\n  }\n\n  /**\n   * List of configuration options supported by the model.\n   */\n  get supportedOptions(): (keyof TableOfContents.IConfig)[] {\n    return ['maximalDepth', 'numberHeaders'];\n  }\n\n  /**\n   * Produce the headings for a document.\n   *\n   * @returns The list of new headings or `null` if nothing needs to be updated.\n   */\n  protected async getHeadings(): Promise<IEditorHeading[] | null> {\n    if (!this.isActive) {\n      return null;\n    }\n\n    const adapter = [...this.connectionManager.adapters.values()].find(\n      adapter => adapter.widget.node.contains(this.widget.node)\n    );\n    if (!adapter?.virtualDocument) {\n      return null;\n    }\n\n    const headings = new Array<IEditorHeading>();\n\n    const symbols = await this.symbolFeature.getSymbols.invoke(\n      adapter,\n      adapter.virtualDocument\n    );\n    if (!symbols) {\n      return null;\n    }\n\n    const processBreadthFirst = (\n      elements: lsProtocol.DocumentSymbol[],\n      level = 1\n    ) => {\n      for (const symbol of elements) {\n        headings.push({\n          text: symbol.name,\n          level,\n          symbol\n        });\n        if (symbol.children) {\n          processBreadthFirst(symbol.children, level + 1);\n        }\n      }\n    };\n    processBreadthFirst(symbols);\n\n    return headings;\n  }\n}\n\nclass LSPEditorTableOfContentsFactory extends TableOfContentsFactory<\n  IDocumentWidget<FileEditor>,\n  IEditorHeading\n> {\n  constructor(\n    tracker: IEditorTracker,\n    protected symbolFeature: SymbolFeature,\n    protected connectionManager: ILSPDocumentConnectionManager\n  ) {\n    super(tracker);\n  }\n  /**\n   * Whether the factory can handle the widget or not.\n   *\n   * @param widget - widget\n   * @returns boolean indicating a ToC can be generated\n   */\n  isApplicable(widget: Widget): boolean {\n    const isApplicable = super.isApplicable(widget);\n\n    if (isApplicable) {\n      return this.symbolFeature.isApplicable(widget);\n    }\n    return false;\n  }\n\n  /**\n   * Create a new table of contents model for the widget\n   *\n   * @param widget - widget\n   * @param configuration - Table of contents configuration\n   * @returns The table of contents model\n   */\n  createNew(\n    widget: IDocumentWidget<FileEditor, DocumentRegistry.IModel>,\n    configuration?: TableOfContents.IConfig\n  ): TableOfContentsModel<\n    IEditorHeading,\n    IDocumentWidget<FileEditor, DocumentRegistry.IModel>\n  > {\n    const model = super.createNew(widget, configuration);\n\n    const onActiveHeadingChanged = (\n      model: TableOfContentsModel<\n        IEditorHeading,\n        IDocumentWidget<FileEditor, DocumentRegistry.IModel>\n      >,\n      heading: IEditorHeading | null\n    ) => {\n      if (heading) {\n        widget.content.editor.setCursorPosition({\n          line: heading.symbol.selectionRange.start.line,\n          column: heading.symbol.selectionRange.start.character\n        });\n      }\n    };\n\n    model.activeHeadingChanged.connect(onActiveHeadingChanged);\n    widget.disposed.connect(() => {\n      model.activeHeadingChanged.disconnect(onActiveHeadingChanged);\n    });\n\n    return model;\n  }\n\n  /**\n   * Create a new table of contents model for the widget\n   *\n   * @param widget - widget\n   * @param configuration - Table of contents configuration\n   * @returns The table of contents model\n   */\n  protected _createNew(\n    widget: IDocumentWidget<FileEditor, DocumentRegistry.IModel>,\n    configuration?: TableOfContents.IConfig\n  ): LSPTableOfContentsModel {\n    return new LSPTableOfContentsModel(\n      widget,\n      this.symbolFeature,\n      this.connectionManager,\n      configuration\n    );\n  }\n}\nfunction isSymbolInformationArray(\n  response: lsProtocol.DocumentSymbol[] | lsProtocol.SymbolInformation[]\n): response is lsProtocol.SymbolInformation[] {\n  return (\n    response.length > 0 &&\n    !!(response[0] as lsProtocol.SymbolInformation).location\n  );\n}\n\nexport class SymbolFeature extends Feature {\n  readonly capabilities: lsProtocol.ClientCapabilities = {\n    textDocument: {\n      documentSymbol: {\n        dynamicRegistration: true,\n        tagSupport: {\n          valueSet: [SymbolTag.Deprecated]\n        },\n        hierarchicalDocumentSymbolSupport: true\n      }\n    }\n  };\n  readonly id = SymbolFeature.id;\n\n  protected console = new BrowserConsole().scope('Symbol');\n  protected settings: FeatureSettings<LSPSymbolSettings>;\n  protected cache: WeakMap<WidgetLSPAdapter<any>, lsProtocol.DocumentSymbol>;\n  protected contextAssembler: ContextAssembler;\n  public getSymbols: Throttler<\n    lsProtocol.DocumentSymbol[] | null,\n    void,\n    [WidgetLSPAdapter<any>, VirtualDocument]\n  >;\n\n  constructor(options: SymbolFeature.IOptions) {\n    super(options);\n    this.settings = options.settings;\n    this.contextAssembler = options.contextAssembler;\n    const { tocRegistry, editorTracker } = options;\n    this.connectionManager = options.connectionManager;\n\n    if (tocRegistry && editorTracker) {\n      tocRegistry.add(\n        new LSPEditorTableOfContentsFactory(\n          editorTracker,\n          this,\n          this.connectionManager\n        )\n      );\n    }\n\n    this.cache = new WeakMap();\n\n    this.getSymbols = this.createThrottler();\n\n    this.settings.changed.connect(() => {\n      this.getSymbols = this.createThrottler();\n    });\n  }\n\n  isApplicable(widget: Widget): boolean {\n    const adapter = [...this.connectionManager.adapters.values()].find(\n      adapter => adapter.widget.node.contains(widget.node)\n    );\n    if (!adapter?.virtualDocument) {\n      return false;\n    }\n    const connection = this.connectionManager.connections.get(\n      adapter.virtualDocument.uri\n    );\n\n    if (\n      !(\n        connection &&\n        connection.isReady &&\n        connection.serverCapabilities.documentSymbolProvider\n      )\n    ) {\n      return false;\n    }\n    return true;\n  }\n\n  protected createThrottler() {\n    return new Throttler<\n      lsProtocol.DocumentSymbol[] | null,\n      void,\n      [WidgetLSPAdapter<any>, VirtualDocument]\n    >(this._getSymbols.bind(this), {\n      limit: this.settings.composite.throttlerDelay || 0,\n      edge: 'trailing'\n    });\n  }\n\n  private async _getSymbols(\n    adapter: WidgetLSPAdapter<any>,\n    virtualDocument: VirtualDocument\n  ): Promise<lsProtocol.DocumentSymbol[] | null> {\n    // TODO: return from cache\n    await adapter.ready;\n\n    const connection = this.connectionManager.connections.get(\n      virtualDocument.uri\n    )!;\n\n    if (\n      !(\n        connection.isReady &&\n        connection.serverCapabilities.documentSymbolProvider\n      )\n    ) {\n      return null;\n    }\n\n    // for popup use\n    // 'workspace/symbol'\n\n    const response = await connection.clientRequests[\n      'textDocument/documentSymbol'\n    ].request({\n      textDocument: {\n        uri: virtualDocument.documentInfo.uri\n      }\n    });\n    // TODO: for some reason after reloading JupyterLab server errors out\n    // unless a file in project gets opened. This may indicate that open\n    // notifications are not sent out properly.\n    return this._handleSymbols(response);\n  }\n\n  private _handleSymbols(\n    response:\n      | lsProtocol.DocumentSymbol[]\n      | lsProtocol.SymbolInformation[]\n      | null\n  ): lsProtocol.DocumentSymbol[] | null {\n    if (!response) {\n      return null;\n    }\n    if (isSymbolInformationArray(response)) {\n      return response.map(s => {\n        return {\n          name: s.name,\n          kind: s.kind,\n          tags: s.tags,\n          deprecated: s.deprecated,\n          range: s.location.range,\n          selectionRange: s.location.range\n        };\n      });\n    }\n    return response;\n  }\n}\n\nexport namespace SymbolFeature {\n  export interface IOptions extends Feature.IOptions {\n    settings: FeatureSettings<LSPSymbolSettings>;\n    renderMimeRegistry: IRenderMimeRegistry;\n    editorExtensionRegistry: IEditorExtensionRegistry;\n    contextAssembler: ContextAssembler;\n    tocRegistry: ITableOfContentsRegistry | null;\n    editorTracker: IEditorTracker | null;\n  }\n  export const id = PLUGIN_ID + ':symbol';\n}\n\nexport const SYMBOL_PLUGIN: JupyterFrontEndPlugin<void> = {\n  id: SymbolFeature.id,\n  requires: [\n    ILSPFeatureManager,\n    ISettingRegistry,\n    IRenderMimeRegistry,\n    IEditorExtensionRegistry,\n    ILSPDocumentConnectionManager\n  ],\n  optional: [ITableOfContentsRegistry, IEditorTracker],\n  autoStart: true,\n  activate: async (\n    app: JupyterFrontEnd,\n    featureManager: ILSPFeatureManager,\n    settingRegistry: ISettingRegistry,\n    renderMimeRegistry: IRenderMimeRegistry,\n    editorExtensionRegistry: IEditorExtensionRegistry,\n    connectionManager: ILSPDocumentConnectionManager,\n    tocRegistry: ITableOfContentsRegistry | null,\n    editorTracker: IEditorTracker | null\n  ) => {\n    const contextAssembler = new ContextAssembler({ app, connectionManager });\n    const settings = new FeatureSettings<LSPSymbolSettings>(\n      settingRegistry,\n      PLUGIN_ID + ':hover'\n      //   SymbolFeature.id\n    );\n    await settings.ready;\n    if (settings.composite.disable) {\n      return;\n    }\n    const feature = new SymbolFeature({\n      settings,\n      renderMimeRegistry,\n      editorExtensionRegistry,\n      connectionManager,\n      contextAssembler,\n      tocRegistry,\n      editorTracker\n    });\n    featureManager.register(feature);\n  }\n};\n","import { EditorView } from '@codemirror/view';\nimport {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\nimport {\n  IEditorMimeTypeService,\n  IEditorServices\n} from '@jupyterlab/codeeditor';\nimport {\n  CodeMirrorEditor,\n  IEditorLanguageRegistry,\n  EditorExtensionRegistry\n} from '@jupyterlab/codemirror';\nimport {\n  ILSPFeatureManager,\n  ILSPDocumentConnectionManager,\n  WidgetLSPAdapter,\n  Document\n} from '@jupyterlab/lsp';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { LabIcon } from '@jupyterlab/ui-components';\n\nimport syntaxSvg from '../../style/icons/syntax-highlight.svg';\nimport { CodeSyntax as LSPSyntaxHighlightingSettings } from '../_syntax_highlighting';\nimport { FeatureSettings, Feature } from '../feature';\nimport { PLUGIN_ID } from '../tokens';\nimport { VirtualDocument } from '../virtual/document';\n\nexport const syntaxHighlightingIcon = new LabIcon({\n  name: 'lsp:syntax-highlighting',\n  svgstr: syntaxSvg\n});\n\nexport class SyntaxHighlightingFeature extends Feature {\n  readonly id = SyntaxHighlightingFeature.id;\n  // note: semantic highlighting could be implemented here\n  readonly capabilities = {};\n  protected originalModes = new Map<CodeMirrorEditor, string>();\n\n  constructor(protected options: SyntaxHighlightingFeature.IOptions) {\n    super(options);\n\n    this.extensionFactory = {\n      name: 'lsp:syntaxHighlighting',\n      factory: factoryOptions => {\n        const { editor: editorAccessor, widgetAdapter: adapter } =\n          factoryOptions;\n        const allReady = Promise.all([editorAccessor.ready, adapter.ready]);\n\n        const updateHandler = async (awaitUpdate = true) => {\n          await allReady;\n          await this.updateMode(adapter, editorAccessor, awaitUpdate);\n        };\n\n        const updateListener = EditorView.updateListener.of(async () => {\n          await updateHandler();\n        });\n        allReady.then(() => updateHandler(false)).catch(console.warn);\n\n        // update the mode at first update even if no changes to ensure the\n        // correct mode gets applied on load.\n        return EditorExtensionRegistry.createImmutableExtension([\n          updateListener\n        ]);\n      }\n    };\n  }\n\n  private getMode(language: string): string | undefined {\n    const mimetype = this.options.mimeTypeService.getMimeTypeByLanguage({\n      name: language\n    });\n\n    if (!mimetype || mimetype == 'text/plain') {\n      // if a mimetype cannot be found it will be 'text/plain', therefore do\n      // not change mode to text/plain, as this could be a step backwards for\n      // the user experience\n      return;\n    }\n\n    const editorLanguage = this.options.languageRegistry.findByMIME(mimetype);\n\n    if (!editorLanguage) {\n      return;\n    }\n\n    if (Array.isArray(mimetype)) {\n      // Contrarily to what types say, mimetype can be an array.\n      // https://github.com/jupyterlab/jupyterlab/issues/15100\n      return mimetype[0];\n    }\n\n    return mimetype;\n  }\n\n  async updateMode(\n    adapter: WidgetLSPAdapter<any>,\n    editorAccessor: Document.IEditor,\n    awaitUpdate = true\n  ) {\n    const topDocument = adapter.virtualDocument as VirtualDocument;\n\n    if (!topDocument) {\n      return;\n    }\n    if (awaitUpdate) {\n      await topDocument.updateManager.updateDone;\n    }\n\n    const editor = editorAccessor.getEditor() as CodeMirrorEditor | null;\n    if (!editor) {\n      return;\n    }\n    const totalArea = editor.state.doc.length;\n\n    const overrides = new Map();\n    for (const map of topDocument.getForeignDocuments(editorAccessor)) {\n      for (const [range, block] of map.entries()) {\n        const blockEditor = block.editor.getEditor()! as CodeMirrorEditor;\n        if (blockEditor != editor) {\n          continue;\n        }\n        const coveredArea =\n          editor.getOffsetAt(range.end) - editor.getOffsetAt(range.start);\n        const coverage = coveredArea / totalArea;\n\n        const language = block.virtualDocument.language;\n        const mode = this.getMode(language);\n\n        // if not highlighting mode available, skip this editor\n        if (typeof mode === 'undefined') {\n          continue;\n        }\n\n        // change the mode if the majority of the code is the foreign code\n        if (coverage > this.options.settings.composite.foreignCodeThreshold) {\n          const original = editor.model.mimeType;\n          // this will trigger a side effect of switching language by updating\n          // private language compartment (implementation detail).\n          editor.model.mimeType = mode;\n          overrides.set(editor, original);\n        }\n      }\n    }\n    // restore mode on the editor if it no longer over the threshold\n    // (but only those which belong to this adapter).\n    if (!overrides.has(editor)) {\n      const originalMode = this.originalModes.get(editor);\n      if (originalMode) {\n        editor.model.mimeType = originalMode;\n      }\n    }\n    // add new overrides to remember the original mode\n    for (const [editor, mode] of overrides) {\n      if (!this.originalModes.has(editor)) {\n        this.originalModes.set(editor, mode);\n      }\n    }\n  }\n}\n\nexport namespace SyntaxHighlightingFeature {\n  export interface IOptions extends Feature.IOptions {\n    settings: FeatureSettings<LSPSyntaxHighlightingSettings>;\n    mimeTypeService: IEditorMimeTypeService;\n    languageRegistry: IEditorLanguageRegistry;\n  }\n  export const id = PLUGIN_ID + ':syntax_highlighting';\n}\n\nexport const SYNTAX_HIGHLIGHTING_PLUGIN: JupyterFrontEndPlugin<void> = {\n  id: SyntaxHighlightingFeature.id,\n  requires: [\n    ILSPFeatureManager,\n    IEditorServices,\n    ISettingRegistry,\n    IEditorLanguageRegistry,\n    ILSPDocumentConnectionManager\n  ],\n  autoStart: true,\n  activate: async (\n    app: JupyterFrontEnd,\n    featureManager: ILSPFeatureManager,\n    editorServices: IEditorServices,\n    settingRegistry: ISettingRegistry,\n    languageRegistry: IEditorLanguageRegistry,\n    connectionManager: ILSPDocumentConnectionManager\n  ) => {\n    const settings = new FeatureSettings<LSPSyntaxHighlightingSettings>(\n      settingRegistry,\n      SyntaxHighlightingFeature.id\n    );\n    await settings.ready;\n    if (settings.composite.disable) {\n      return;\n    }\n    const feature = new SyntaxHighlightingFeature({\n      settings,\n      connectionManager,\n      mimeTypeService: editorServices.mimeTypeService,\n      languageRegistry\n    });\n    featureManager.register(feature);\n    // return feature;\n  }\n};\n","import { JupyterFrontEndPlugin } from '@jupyterlab/application';\n\nimport {\n  ICodeOverridesRegistry,\n  ILSPCodeOverridesManager,\n  IScopedCodeOverride\n} from './tokens';\n\nexport class CodeOverridesManager implements ILSPCodeOverridesManager {\n  private readonly _overrides: ICodeOverridesRegistry;\n\n  get registry() {\n    return this._overrides;\n  }\n\n  constructor() {\n    this._overrides = {};\n  }\n\n  register(override: IScopedCodeOverride, language: string) {\n    if (!(language in this._overrides)) {\n      this._overrides[language] = { cell: [], line: [] };\n    }\n    let overrides = this._overrides[language];\n    switch (override.scope) {\n      case 'cell':\n        overrides.cell.push(override);\n        break;\n      case 'line':\n        overrides.line.push(override);\n        break;\n    }\n  }\n}\n\nexport const CODE_OVERRIDES_MANAGER: JupyterFrontEndPlugin<ILSPCodeOverridesManager> =\n  {\n    id: ILSPCodeOverridesManager.name,\n    requires: [],\n    activate: app => {\n      return new CodeOverridesManager();\n    },\n    provides: ILSPCodeOverridesManager,\n    autoStart: true\n  };\n","import { ILanguageServerManager, LanguageServerManager } from '@jupyterlab/lsp';\nimport {\n  ISettingRegistry,\n  ISchemaValidator\n} from '@jupyterlab/settingregistry';\nimport { TranslationBundle } from '@jupyterlab/translation';\nimport { FormComponent } from '@jupyterlab/ui-components';\nimport { ReadonlyPartialJSONObject } from '@lumino/coreutils';\nimport { IChangeEvent } from '@rjsf/core';\nimport {\n  FieldProps,\n  ObjectFieldTemplateProps,\n  TemplatesType\n} from '@rjsf/utils';\nimport validatorAjv8 from '@rjsf/validator-ajv8';\nimport React, { useState } from 'react';\n\nimport { TLanguageServerId, TLanguageServerSpec } from '../tokens';\n\nimport { ServerLinksList } from './utils';\n\nnamespace LanguageServerSettingsEditor {\n  export interface IProps extends FieldProps {\n    settingRegistry: ISettingRegistry;\n    languageServerManager: ILanguageServerManager;\n    trans: TranslationBundle;\n    validationErrors: ISchemaValidator.IError[];\n  }\n  // TODO\n  export type IState = any;\n}\nexport const renderCollapseConflicts = (props: {\n  conflicts: Record<string, Record<string, any[]>>;\n  trans: TranslationBundle;\n}) => {\n  const conflicts = Object.entries(props.conflicts).map(\n    ([server, serverConflicts]) => {\n      if (Object.keys(serverConflicts).length === 0) {\n        return null;\n      }\n      const listing = Object.entries(serverConflicts).map(([key, values]) => (\n        <li key={'lsp-server-setting-conflict-' + key}>\n          <code>{key}</code>: <code>{JSON.stringify(values)}</code>\n        </li>\n      ));\n      return (\n        <div key={'lsp-server-setting-conflict-' + server}>\n          <h4>{server}</h4>\n          <ul>{listing}</ul>\n        </div>\n      );\n    }\n  );\n  return (\n    <div>\n      {props.trans.__('Multiple distinct values detected for:')}\n      {conflicts}\n      {props.trans.__(\n        'Retaining the last value for each of the settings. Please remove the additional values in JSON Settings Editor.'\n      )}\n    </div>\n  );\n};\n\nexport const renderLanguageServerSettings = (\n  props: LanguageServerSettingsEditor.IProps\n) => {\n  return <LanguageServerSettings {...props} />;\n};\n\nexport class LanguageServerSettings extends React.Component<\n  LanguageServerSettingsEditor.IProps,\n  LanguageServerSettingsEditor.IState\n> {\n  constructor(props: LanguageServerSettingsEditor.IProps) {\n    super(props);\n    this.state = { ...props.formData };\n    this._objectTemplate = TabbedObjectTemplateFactory({\n      baseTemplate: this.props.registry.templates.ObjectFieldTemplate,\n      objectSelector: props => {\n        return (\n          props.title === this.props.schema.title &&\n          props.description === this.props.schema.description\n        );\n      },\n      trans: this.props.trans,\n      languageServerManager: this.props.languageServerManager\n    });\n  }\n\n  render(): JSX.Element {\n    this.props.schema.description = undefined;\n    // hide the boilerplate title/description from schema definitions\n    for (const serverSchema of Object.values(this.props.schema.properties!)) {\n      // note: have to be strings.\n      (serverSchema as any).title = '';\n      (serverSchema as any).description = '';\n    }\n\n    const validationErrors = this.props.validationErrors.map(error => (\n      <li key={'lsp-validation-error-' + error.instancePath}>\n        <b>{error.keyword}</b>: {error.message} in{' '}\n        <code>{error.instancePath}</code>\n        {error.params && 'allowedValues' in error.params\n          ? this.props.trans.__(\n              'allowed values: %1',\n              JSON.stringify(error.params.allowedValues)\n            )\n          : null}\n      </li>\n    ));\n    const templates = {\n      ...this.props.registry.templates,\n      ObjectFieldTemplate: this._objectTemplate\n    };\n    // remove self field to avoid infinite recursion\n    const fields = Object.fromEntries(\n      Object.entries(this.props.registry.fields).filter(\n        f => f[0] != 'language_servers'\n      )\n    );\n\n    return (\n      <div className=\"lsp-ServerSettings\">\n        <h3 className=\"lsp-ServerSettings-title\">\n          {this.props.trans.__('Language servers')}\n        </h3>\n        {validationErrors.length > 0 ? (\n          <div className=\"lsp-ServerSettings-validationError\">\n            <h4>\n              {this.props.trans.__(\n                'Validation of user settings for language server failed'\n              )}\n            </h4>\n            <p>\n              {this.props.trans.__(\n                'Your language server settings do not follow current schema. The LSP configuration graphical interface will run in schema-free mode to enable you to continue using the current settings as-is (in case if the schema is outdated). If this is however an earlier configuration mistake (settings were not validated in earlier versions of jupyterlab-lsp), please correct the following validation errors in JSON Settings Editor, save, and reload application:'\n              )}\n            </p>\n            <ul>{validationErrors}</ul>\n          </div>\n        ) : null}\n        <FormComponent\n          schema={this.props.schema}\n          formData={this.state}\n          validator={validatorAjv8}\n          // note: default JupyterLab `FieldTemplate` cannot correctly distinguish fields\n          // modified relative to programatically populated (transformed) schema >of objects<;\n          // the issue is in lines: https://github.com/jupyterlab/jupyterlab/blob/c2907074e58725942946a73a823fc60e1795da39/packages/settingeditor/src/SettingsFormEditor.tsx#L254-L272\n          // this is because 1) the schemaIds does not include the object key\n          // 2) the code assumes all objects on the same have the same defaults\n          // Probably the solution is to perform modification check on the level of ObjectFieldTemplate instead; this should be implemented upstream in JupyterLab.\n          // TODO\n          templates={templates}\n          uiSchema={this.props.uiSchema}\n          fields={fields}\n          formContext={this.props.formContext}\n          liveValidate\n          idPrefix={this.props.idPrefix + '_language_servers'}\n          onChange={this._onChange.bind(this)}\n        />\n      </div>\n    );\n  }\n\n  private _onChange(event: IChangeEvent<ReadonlyPartialJSONObject>): void {\n    if (event.errors.length) {\n      console.error('Errors in form validation:', event.errors);\n    }\n    this.setState(event.formData, () => this.props.onChange(this.state));\n  }\n\n  private _objectTemplate: React.FC<ObjectFieldTemplateProps>;\n}\n\n/**\n * Template for tabbed interface.\n */\nconst TabbedObjectTemplateFactory = (options: {\n  baseTemplate: TemplatesType['ObjectFieldTemplate'];\n  languageServerManager: ILanguageServerManager;\n  objectSelector: (props: ObjectFieldTemplateProps) => boolean;\n  trans: TranslationBundle;\n}): React.FC<ObjectFieldTemplateProps> => {\n  const factory = (props: ObjectFieldTemplateProps) => {\n    if (!options.objectSelector(props)) {\n      const BaseTemplate = options.baseTemplate;\n      return <BaseTemplate {...props} />;\n    }\n    const [tab, setTab] = useState(\n      props.properties.length > 0 ? props.properties[0].name : null\n    );\n\n    const renderServerLabels = (options: {\n      properties: typeof props.properties;\n      filter: (name: TLanguageServerId) => boolean;\n      title: string;\n    }) => {\n      const retained = options.properties.filter(property =>\n        options.filter(property.name as TLanguageServerId)\n      );\n      if (retained.length == 0) {\n        return null;\n      }\n      return (\n        <>\n          <h4 className={'lsp-ServerSettings-list-group'}>{options.title}</h4>\n          <ul>\n            {retained.map(property => {\n              return (\n                <li\n                  onClick={() => setTab(property.name)}\n                  key={'tab-' + property.name}\n                  data-tab={property.name}\n                  className={property.name === tab ? 'lsp-selected' : undefined}\n                >\n                  {property.name}\n                </li>\n              );\n            })}\n          </ul>\n        </>\n      );\n    };\n    const renderServerMetadata = (spec: TLanguageServerSpec) => {\n      const workspaceConfig = spec.workspace_configuration as Record<\n        string,\n        any\n      >;\n      return (\n        <div>\n          <h4 className={'lsp-ServerSettings-content-name'}>\n            {spec.display_name}\n          </h4>\n          <ServerLinksList specification={spec} />\n          {workspaceConfig ? (\n            <p className={'lsp-ServerSettings-content-specOverrides'}>\n              {trans.__('Default values set programatically for: ') +\n                Object.keys(workspaceConfig).join(', ')}\n            </p>\n          ) : null}\n        </div>\n      );\n    };\n    const manager = options.languageServerManager;\n    const trans = options.trans;\n\n    // TODO: expose `specs` upstream\n    return (\n      <fieldset id={props.idSchema.$id}>\n        <div className={'lsp-ServerSettings-tabs'}>\n          <div className={'lsp-ServerSettings-list'}>\n            {renderServerLabels({\n              properties: props.properties,\n              filter: name => manager.sessions.has(name),\n              title: trans.__('Available')\n            })}\n            {renderServerLabels({\n              properties: props.properties,\n              filter: name => !manager.sessions.has(name),\n              title: trans.__('Not installed')\n            })}\n          </div>\n          <div className={'lsp-ServerSettings-content'}>\n            {(manager as LanguageServerManager).specs.has(\n              tab as TLanguageServerId\n            )\n              ? renderServerMetadata(\n                  (manager as LanguageServerManager).specs.get(\n                    tab as TLanguageServerId\n                  )!\n                )\n              : null}\n            {props.properties\n              .filter(property => property.name === tab)\n              .map(property => property.content)}\n          </div>\n        </div>\n      </fieldset>\n    );\n  };\n  factory.displayName = 'TabbedObjectTemplate';\n  return factory;\n};\n","import { showDialog, Dialog } from '@jupyterlab/apputils';\nimport { ILanguageServerManager, LanguageServerManager } from '@jupyterlab/lsp';\nimport {\n  ISettingRegistry,\n  ISchemaValidator\n} from '@jupyterlab/settingregistry';\nimport { TranslationBundle, nullTranslator } from '@jupyterlab/translation';\nimport {\n  JSONExt,\n  ReadonlyPartialJSONObject,\n  ReadonlyJSONObject,\n  PartialJSONObject,\n  PromiseDelegate\n} from '@lumino/coreutils';\nimport { Signal, ISignal } from '@lumino/signaling';\nimport { FieldProps } from '@rjsf/utils';\n\nimport { LanguageServers } from './_plugin';\nimport {\n  renderLanguageServerSettings,\n  renderCollapseConflicts\n} from './components/serverSettings';\nimport { ILSPLogConsole } from './tokens';\nimport { collapseToDotted, expandDottedPaths } from './utils';\n\ntype ValueOf<T> = T[keyof T];\ntype ServerSchemaWrapper = ValueOf<\n  Required<LanguageServers>['language_servers']\n>;\n\n/**\n * Only used for TypeScript type coercion, not meant to represent a property fully.\n */\ninterface IJSONProperty {\n  type?: string | string[];\n  description?: string;\n  $ref?: string;\n}\n\nfunction isJSONProperty(obj: unknown): obj is IJSONProperty {\n  return (\n    typeof obj === 'object' && obj !== null && ('type' in obj || '$ref' in obj)\n  );\n}\n\n/**\n * Settings keyed by language server name with values including\n * multiple properties, such as priority or workspace configuration\n */\ntype LanguageServerSettings = Record<string, ServerSchemaWrapper>;\n\n/**\n * Default server priority; this should match the value defined in `plugin.json` schema.\n */\nconst DEAULT_SERVER_PRIORITY = 50;\n\n/**\n * Get default values from JSON Schema properties field.\n */\nfunction getDefaults(\n  properties: ReadonlyPartialJSONObject | undefined\n): Record<string, any> {\n  if (properties == null) {\n    return {};\n  }\n  // TODO: also get defaults from ref?\n  const defaults: Record<string, any> = {};\n  const entries = Object.entries(properties)\n    .map(([key, value]) => [key, (value as any)?.default])\n    .filter(([key, value]) => typeof value !== 'undefined');\n  // TODO: use Object.fromEntries once we switch target\n  for (let [key, value] of entries) {\n    defaults[key] = value;\n  }\n  return defaults;\n}\n\n/**\n * Get a mutable property matching a dotted key and a properly nested value.\n *\n * Most LSP server schema properties are flattened using dotted convention,\n * e.g. a key for {pylsp: {plugins: {flake8: {enabled: true}}}}` is stored\n * as `pylsp.plugins.flake8.enabled`. However, some servers (e.g. pyright)\n * define specific properties as only partially doted, for example\n * `python.analysis.diagnosticSeverityOverrides` is an object with\n * properties like `reportGeneralTypeIssues` or `reportPropertyTypeMismatch`.\n * Only one level of nesting (on the finale level) is supported.\n */\nfunction nestInSchema(\n  properties: PartialJSONObject,\n  key: string,\n  value: PartialJSONObject\n): { property: PartialJSONObject; value: PartialJSONObject } | null {\n  if (properties.hasOwnProperty(key)) {\n    return { property: properties[key] as PartialJSONObject, value };\n  }\n  const parts = key.split('.');\n  const prefix = parts.slice(0, -1).join('.');\n  const suffix = parts[parts.length - 1];\n  if (properties.hasOwnProperty(prefix)) {\n    const parent = properties[prefix] as PartialJSONObject;\n    if (parent.type !== 'object') {\n      return null;\n    }\n    const parentProperties = parent.properties as PartialJSONObject;\n    if (parentProperties.hasOwnProperty(suffix)) {\n      return {\n        property: parent,\n        value: { [suffix]: value }\n      };\n    }\n  }\n  return null;\n}\n\nfunction mergePropertyDefault(\n  property: PartialJSONObject,\n  value: PartialJSONObject\n) {\n  if (\n    property.type === 'object' &&\n    typeof property.default === 'object' &&\n    typeof value === 'object'\n  ) {\n    property.default = {\n      ...property.default,\n      ...value\n    };\n  } else {\n    property.default = value;\n  }\n}\n\n/**\n * Schema and user data that for validation\n */\ninterface IValidationData {\n  rawUserSettings: string;\n  schema: ISettingRegistry.ISchema;\n}\n\n/**\n * Conflicts encountered when dot-collapsing settings\n * organised by server ID, and then as a mapping between\n * (dotted) setting ID and list of encountered values.\n * The last encountered values is preferred for use.\n */\ntype SettingsMergeConflicts = Record<string, Record<string, any[]>>;\n\ninterface ISettingsCollapseResult {\n  settings: LanguageServerSettings;\n  conflicts: SettingsMergeConflicts;\n}\n\nexport class SettingsUIManager {\n  constructor(\n    protected options: {\n      settingRegistry: ISettingRegistry;\n      languageServerManager: ILanguageServerManager;\n      console: ILSPLogConsole;\n      trans: TranslationBundle;\n      schemaValidated: ISignal<\n        SettingsSchemaManager,\n        ISchemaValidator.IError[]\n      >;\n    }\n  ) {\n    options.schemaValidated.connect((_, errors) => {\n      this._validationErrors = errors;\n    });\n    this._validationErrors = [];\n  }\n\n  renderForm(props: FieldProps) {\n    return renderLanguageServerSettings({\n      settingRegistry: this.options.settingRegistry,\n      languageServerManager: this.options.languageServerManager,\n      trans: this.options.trans,\n      validationErrors: this._validationErrors,\n      ...props\n    });\n  }\n\n  private _validationErrors: ISchemaValidator.IError[];\n}\n\n/**\n * Harmonize settings from schema, defaults from specification, and values set by user.\n */\nexport class SettingsSchemaManager {\n  constructor(\n    protected options: {\n      settingRegistry: ISettingRegistry;\n      languageServerManager: ILanguageServerManager;\n      console: ILSPLogConsole;\n      trans: TranslationBundle;\n      /**\n       * Promise resolved when JupyterLab splash screen disappears.\n       */\n      restored: Promise<void>;\n    }\n  ) {\n    this._schemaValidated = new Signal(this);\n    this._defaults = {};\n    this._canonical = null;\n    this._original = null;\n    this._validationAttempt = 0;\n    this._lastValidation = null;\n    this._lastUserServerSettings = null;\n    this._lastUserServerSettingsDoted = null;\n    this._validationErrors = [];\n  }\n\n  get schemaValidated(): ISignal<\n    SettingsSchemaManager,\n    ISchemaValidator.IError[]\n  > {\n    return this._schemaValidated;\n  }\n\n  protected get console(): ILSPLogConsole {\n    return this.options.console;\n  }\n\n  /**\n   * Add schema for individual language servers into JSON schema.\n   * This method has to be called before any other action\n   * is performed on settingRegistry with regard to pluginId.\n   */\n  async setupSchemaTransform(pluginId: string): Promise<void> {\n    const languageServerManager = this.options.languageServerManager;\n    // To populate defaults we require specs to be available, so we need to\n    // wait for until after the `languageServerManager` is ready.\n    await languageServerManager.ready;\n\n    // Transform the plugin object to return different schema than the default.\n    this.options.settingRegistry.transform(pluginId, {\n      fetch: plugin => {\n        // Profiling data (earlier version):\n        // Initial fetch: 61-64 ms\n        // Subsequent without change: <1ms\n        // Session change: 642 ms.\n        // 91% spent on `validateData()` of which 10% in addSchema().\n        // 1.8% spent on `deepCopy()`\n        // 1.79% spend on other tasks in `populate()`\n        // There is a limit on the transformation time, and failing to transform\n        // in the default 1 second means that no settings whatsoever are available.\n        // Therefore validation in `populate()` was moved into an async function;\n        // this means that we need to trigger re-load of settings\n        // if there validation errors.\n\n        // Only store the original schema the first time.\n        if (!this._original) {\n          this._original = JSONExt.deepCopy(plugin.schema);\n        }\n        // Only override the canonical schema the first time (or after reset).\n        if (!this._canonical) {\n          this._canonical = JSONExt.deepCopy(plugin.schema);\n          this._populate(plugin, this._canonical);\n          this._defaultsPopulated.resolve(void 0);\n        }\n\n        return {\n          data: plugin.data,\n          id: plugin.id,\n          raw: plugin.raw,\n          schema: this._validationErrors.length\n            ? this._original\n            : this._canonical,\n          version: plugin.version\n        };\n      }\n    });\n\n    // note: has to be after transform is called for the first time to avoid\n    // race condition, see https://github.com/jupyterlab/jupyterlab/issues/12978\n    languageServerManager.sessionsChanged.connect(async () => {\n      this._canonical = null;\n      this._defaultsPopulated = new PromiseDelegate();\n      await this.options.settingRegistry.reload(pluginId);\n    });\n  }\n\n  /**\n   * Populate the plugin's schema defaults, transform descriptions.\n   */\n  private _populate(\n    plugin: ISettingRegistry.IPlugin,\n    schema: ISettingRegistry.ISchema\n  ) {\n    const languageServerManager = this.options.languageServerManager;\n\n    const { properties, defaults } = SettingsSchemaManager.transformSchemas({\n      schema,\n      // TODO: expose `specs` upstream and use `ILanguageServerManager` instead\n      specs: (languageServerManager as LanguageServerManager).specs,\n      sessions: languageServerManager.sessions,\n      console: this.console,\n      trans: this.options.trans\n    });\n\n    schema.properties!.language_servers.properties = properties;\n    schema.properties!.language_servers.default = defaults;\n\n    this._validateSchemaLater(plugin, schema).catch(this.console.warn);\n    this._defaults = defaults;\n  }\n\n  /**\n   * Transform the plugin schema defaults, properties and descriptions\n   */\n  static transformSchemas(options: {\n    schema: ISettingRegistry.ISchema;\n    specs: LanguageServerManager['specs'];\n    sessions: ILanguageServerManager['sessions'];\n    console?: ILSPLogConsole;\n    trans?: TranslationBundle;\n  }) {\n    const { schema, sessions, specs } = options;\n    const trans = options.trans ?? nullTranslator.load('jupyterlab-lsp');\n    const console = options.console ?? window.console;\n    const baseServerSchema = (schema.definitions as any)['language-server'] as {\n      description: string;\n      title: string;\n      definitions: Record<string, any>;\n      properties: ServerSchemaWrapper;\n    };\n\n    const defaults: Record<string, any> = {};\n    const knownServersConfig: Record<string, any> = {};\n    // `sharedDefaults` may be empty as we do not define/receive custom\n    // per-property defaults in schema as of the day of writing.\n    const sharedDefaults = getDefaults(\n      schema.properties!.language_servers.properties\n    );\n    const defaultsOverrides = schema.properties!.language_servers.default as\n      | Record<string, any>\n      | undefined;\n\n    for (let [serverKey, serverSpec] of specs.entries()) {\n      if ((serverKey as string) === '') {\n        console.warn(\n          `Empty server key - skipping transformation for ${serverSpec}`\n        );\n        continue;\n      }\n\n      const configSchema = serverSpec.config_schema;\n      if (!configSchema) {\n        console.warn(\n          `No config schema - skipping transformation for ${serverKey}`\n        );\n        continue;\n      }\n      if (!configSchema.properties) {\n        console.warn(\n          `No properties in config schema - skipping transformation for ${serverKey}`\n        );\n        continue;\n      }\n\n      // let user know if server not available (installed, etc)\n      if (!sessions.has(serverKey)) {\n        configSchema.description = trans.__(\n          'Settings that would be passed to `%1` server (this server was not detected as installed during startup) in `workspace/didChangeConfiguration` notification.',\n          serverSpec.display_name\n        );\n      } else {\n        configSchema.description = trans.__(\n          'Settings to be passed to %1 in `workspace/didChangeConfiguration` notification.',\n          serverSpec.display_name\n        );\n      }\n      configSchema.title = trans.__('Workspace Configuration');\n\n      // resolve refs\n      for (let [key, value] of Object.entries(configSchema.properties)) {\n        if (!isJSONProperty(value)) {\n          continue;\n        }\n        if (typeof value.$ref === 'undefined') {\n          continue;\n        }\n        if (value.$ref.startsWith('#/definitions/')) {\n          const definitionID = value['$ref'].substring(14);\n          const definition = configSchema.definitions[definitionID];\n          if (definition == null) {\n            console.warn('Definition not found');\n          }\n          for (let [defKey, defValue] of Object.entries(definition)) {\n            configSchema.properties[key][defKey] = defValue;\n          }\n          delete value.$ref;\n        } else {\n          console.warn('Unsupported $ref', value['$ref']);\n        }\n      }\n\n      // add default overrides from server-side spec (such as defined in `jupyter_server_config.py`)\n      const workspaceConfigurationDefaults =\n        serverSpec.workspace_configuration as Record<string, any> | undefined;\n      if (workspaceConfigurationDefaults) {\n        for (const [key, value] of Object.entries(\n          workspaceConfigurationDefaults\n        )) {\n          const nested = nestInSchema(configSchema.properties, key, value);\n          if (!nested) {\n            console.warn(\n              `\"workspace_configuration\" includes an override for \"${key}\" key which was not found in ${serverKey} schema'`\n            );\n            continue;\n          }\n          mergePropertyDefault(nested.property, nested.value);\n        }\n      }\n      // add server-specific default overrides from `overrides.json` (and pre-defined in schema)\n      const serverDefaultsOverrides =\n        defaultsOverrides && defaultsOverrides.hasOwnProperty(serverKey)\n          ? defaultsOverrides[serverKey]\n          : {};\n      if (serverDefaultsOverrides.serverSettings) {\n        for (const [key, value] of Object.entries(\n          serverDefaultsOverrides.serverSettings\n        )) {\n          const nested = nestInSchema(\n            configSchema.properties,\n            key,\n            value as any\n          );\n          if (!nested) {\n            console.warn(\n              `\"overrides.json\" includes an override for \"${key}\" key which was not found in ${serverKey} schema`\n            );\n            continue;\n          }\n          mergePropertyDefault(nested.property, nested.value);\n        }\n      }\n\n      const defaultMap = getDefaults(configSchema.properties);\n\n      const baseSchemaCopy = JSONExt.deepCopy(baseServerSchema);\n      baseSchemaCopy.properties.serverSettings = configSchema;\n      knownServersConfig[serverKey] = baseSchemaCopy;\n      defaults[serverKey] = {\n        ...sharedDefaults,\n        ...serverDefaultsOverrides,\n        serverSettings: defaultMap\n      };\n    }\n\n    return {\n      properties: knownServersConfig,\n      defaults\n    };\n  }\n\n  /**\n   * Expands dotted values into nested properties when the server config schema\n   * indicates that this is needed. The schema is passed within the specs.\n   *\n   * This is needed because some settings, specifically pright's\n   * `python.analysis.diagnosticSeverityOverrides` are defined as nested.\n   */\n  static expandDottedAsNeeded(options: {\n    dottedSettings: LanguageServerSettings;\n    specs: LanguageServerManager['specs'];\n  }): LanguageServerSettings {\n    const specs = options.specs;\n    const partiallyUncollapsed = JSONExt.deepCopy(options.dottedSettings);\n\n    for (let [serverKey, serverSpec] of specs.entries()) {\n      const configSchema = serverSpec.config_schema;\n      if (!partiallyUncollapsed.hasOwnProperty(serverKey)) {\n        continue;\n      }\n      const settings = partiallyUncollapsed[serverKey].serverSettings;\n      if (!configSchema || !settings) {\n        continue;\n      }\n      const expanded = expandDottedPaths(settings);\n\n      for (const [path, property] of Object.entries<PartialJSONObject>(\n        configSchema.properties\n      )) {\n        if (property.type === 'object') {\n          let value = expanded;\n          for (const part of path.split('.')) {\n            value = value[part] as ReadonlyJSONObject;\n            if (typeof value === 'undefined') {\n              break;\n            }\n          }\n          if (typeof value === 'undefined') {\n            continue;\n          }\n          // Add the uncollapsed value\n          settings[path] = value;\n          // Remove the collapsed values\n          for (const k of Object.keys(value)) {\n            const key = path + '.' + k;\n            if (!settings.hasOwnProperty(key)) {\n              throw Error(\n                'Internal inconsistency: collapsed settings state does not match expanded object'\n              );\n            }\n            delete settings[key];\n          }\n        }\n      }\n    }\n    return partiallyUncollapsed;\n  }\n\n  /**\n   * Normalize settings by dotted and nested specs, and merging with defaults.\n   */\n  async normalizeSettings(\n    composite: Required<LanguageServers>\n  ): Promise<Required<LanguageServers>> {\n    await this._defaultsPopulated.promise;\n    // Cache collapsed settings for speed and to only show dialog once.\n    // Note that JupyterLab attempts to transform in \"preload\" step (before splash screen end)\n    // and then again for deferred extensions if the initial transform in preload timed out.\n    // We are hitting the timeout in preload step.\n    if (\n      this._lastUserServerSettings === null ||\n      this._lastUserServerSettingsDoted === null ||\n      !JSONExt.deepEqual(\n        this._lastUserServerSettings,\n        composite.language_servers\n      )\n    ) {\n      this._lastUserServerSettings = composite.language_servers;\n\n      const collapsedDefaults = this._collapseServerSettingsDotted(\n        this._defaults\n      );\n      const collapsedUser = this._collapseServerSettingsDotted(\n        composite.language_servers\n      );\n\n      const merged = SettingsSchemaManager.mergeByServer(\n        collapsedDefaults.settings,\n        collapsedUser.settings\n      );\n\n      // Uncollapse settings which need to be in the expanded form\n      const languageServerManager = this.options.languageServerManager;\n      const uncollapsed = SettingsSchemaManager.expandDottedAsNeeded({\n        dottedSettings: merged,\n        specs: (languageServerManager as LanguageServerManager).specs\n      });\n\n      composite.language_servers = uncollapsed;\n      this._lastUserServerSettingsDoted = uncollapsed;\n\n      if (Object.keys(collapsedUser.conflicts).length > 0) {\n        this._warnConflicts(\n          collapsedUser.conflicts,\n          'Conflicts in user settings'\n        ).catch(this.console.warn);\n      }\n      if (Object.keys(collapsedDefaults.conflicts).length > 0) {\n        this._warnConflicts(\n          collapsedDefaults.conflicts,\n          'Conflicts in defaults'\n        ).catch(this.console.warn);\n      }\n    } else {\n      composite.language_servers = this._lastUserServerSettingsDoted;\n    }\n\n    // We do not filter out defaults at this level,\n    // as it does not provide an obvious benefit:\n    // - we would need to explicitly save the updated settings\n    //   to get a clean version in JSON Setting Editor.\n    // - if default changed on the LSP server side but schema did not get\n    //   updated, LSP server would be using a different value than communicated\n    //   to the user. It would be optimal to filter out defaults from\n    //   user data and always keep them in composite,\n    // - making Jupyter server-side `workspace_configuration` work would\n    //   be more difficult\n\n    // TODO: trigger update of settings to ensure that UI uses the same settings as collapsed?\n    return composite;\n  }\n\n  private _wasPreviouslyValidated(\n    plugin: ISettingRegistry.IPlugin,\n    schema: ISettingRegistry.ISchema\n  ) {\n    return (\n      this._lastValidation !== null &&\n      this._lastValidation.rawUserSettings === plugin.raw &&\n      JSONExt.deepEqual(this._lastValidation.schema, schema)\n    );\n  }\n\n  /**\n   * Validate user settings from plugin against provided schema,\n   * asynchronously to avoid blocking the main thread.\n   * Stores validation result in `this._validationErrors`.\n   */\n  private async _validateSchemaLater(\n    plugin: ISettingRegistry.IPlugin,\n    schema: ISettingRegistry.ISchema\n  ) {\n    // Ensure the subsequent code runs asynchronously; also reduce the CPU load on startup.\n    await this.options.restored;\n\n    // Do not re-validate if neither schema, nor user settings changed\n    if (this._wasPreviouslyValidated(plugin, schema)) {\n      return;\n    }\n    // Test if we can apply the schema without causing validation error\n    // (is the configuration held by the user compatible with the schema?)\n    this._validationAttempt += 1;\n    // the validator will parse raw plugin data into this object;\n    // we do not do anything with those right now.\n    const parsedData = { composite: {}, user: {} };\n    const validationErrors =\n      this.options.settingRegistry.validator.validateData(\n        {\n          // The plugin schema is cached so we have to provide a dummy ID;\n          // can be simplified once https://github.com/jupyterlab/jupyterlab/issues/12978 is fixed.\n          id: `lsp-validation-attempt-${this._validationAttempt}`,\n          raw: plugin.raw,\n          data: parsedData,\n          version: plugin.version,\n          schema: schema\n        },\n        true\n      );\n\n    this._lastValidation = {\n      rawUserSettings: plugin.raw,\n      schema: schema\n    };\n\n    if (validationErrors) {\n      console.error(\n        'LSP server settings validation failed; graphical interface for settings will run in schema-free mode; errors:',\n        validationErrors\n      );\n      this._validationErrors = validationErrors;\n      this._schemaValidated.emit(validationErrors);\n      if (!this._original) {\n        console.error(\n          'Original language servers schema not available to restore non-transformed values.'\n        );\n      } else {\n        if (!this._original.properties!.language_servers.properties) {\n          delete schema.properties!.language_servers.properties;\n        }\n        if (!this._original.properties!.language_servers.default) {\n          delete schema.properties!.language_servers.default;\n        }\n      }\n\n      // Reload settings to use non-restrictive schema; this requires fixing\n      // https://github.com/jupyterlab/jupyterlab/issues/12978 upstream to work.\n      await this.options.settingRegistry.reload(plugin.id);\n    }\n  }\n\n  private async _warnConflicts(\n    conflicts: SettingsMergeConflicts,\n    title: string\n  ) {\n    // Ensure the subsequent code runs asynchronously, and delay\n    // showing the dialog until the splash screen disappeared.\n    await this.options.restored;\n\n    showDialog({\n      body: renderCollapseConflicts({\n        conflicts: conflicts,\n        trans: this.options.trans\n      }),\n      title: title,\n      buttons: [Dialog.okButton()]\n    }).catch(console.warn);\n  }\n\n  private _collapseServerSettingsDotted(\n    settings: LanguageServerSettings\n  ): ISettingsCollapseResult {\n    const conflicts: Record<string, Record<string, any[]>> = {};\n    const result = JSONExt.deepCopy(settings) as LanguageServerSettings;\n    for (let [serverKey, serverSettingsGroup] of Object.entries(settings)) {\n      if (!serverSettingsGroup || !serverSettingsGroup.serverSettings) {\n        continue;\n      }\n      const collapsed = collapseToDotted(\n        serverSettingsGroup.serverSettings as ReadonlyJSONObject\n      );\n      if (Object.keys(collapsed.conflicts).length) {\n        conflicts[serverKey] = collapsed.conflicts;\n      }\n      result[serverKey]!.serverSettings = collapsed.result;\n    }\n    return {\n      settings: result,\n      conflicts: conflicts\n    };\n  }\n\n  static mergeByServer(\n    defaults: LanguageServerSettings,\n    userSettings: LanguageServerSettings\n  ): LanguageServerSettings {\n    const result = JSONExt.deepCopy(defaults) as LanguageServerSettings;\n    for (let [serverKey, serverSettingsGroup] of Object.entries(userSettings)) {\n      if (!serverSettingsGroup || !serverSettingsGroup.serverSettings) {\n        continue;\n      }\n      if (typeof result[serverKey] === 'undefined') {\n        // nothing to merge with\n        result[serverKey] = JSONExt.deepCopy(serverSettingsGroup);\n      } else {\n        // priority should come from (a) user (b) overrides (c) fallback default;\n        // unfortunately the user and default values get merged in the form so we\n        // cannot distinguish (a) from (c); as a workaround we can compare its value\n        // with the default value.\n        const userOrDefaultPriority = serverSettingsGroup.priority;\n        const isPriorityUserSet =\n          typeof userOrDefaultPriority !== 'undefined' &&\n          userOrDefaultPriority !== DEAULT_SERVER_PRIORITY;\n        const priority = isPriorityUserSet\n          ? userOrDefaultPriority\n          : result[serverKey].priority ?? DEAULT_SERVER_PRIORITY;\n        const merged: Required<ServerSchemaWrapper> = {\n          priority,\n          // `serverSettings` entries are expected to be flattened to dot notation here.\n          serverSettings: {\n            ...(result[serverKey].serverSettings || {}),\n            ...(serverSettingsGroup.serverSettings || {})\n          }\n        };\n        result[serverKey] = merged;\n      }\n    }\n    return result;\n  }\n\n  private _defaults: LanguageServerSettings;\n  private _defaultsPopulated = new PromiseDelegate();\n  private _validationErrors: ISchemaValidator.IError[];\n  private _schemaValidated: Signal<\n    SettingsSchemaManager,\n    ISchemaValidator.IError[]\n  >;\n  private _validationAttempt: number;\n  private _lastValidation: IValidationData | null;\n  private _lastUserServerSettings: LanguageServerSettings | null;\n  private _lastUserServerSettingsDoted: LanguageServerSettings | null;\n  private _canonical: ISettingRegistry.ISchema | null;\n  private _original: ISettingRegistry.ISchema | null;\n}\n","import { IForeignCodeExtractor } from '@jupyterlab/lsp';\n\nimport { RegExpForeignCodeExtractor } from '../../extractors/regexp';\n\nexport interface IForeignCodeExtractorsRegistry {\n  [host_language: string]: IForeignCodeExtractor[];\n}\n\nexport let foreignCodeExtractors: IForeignCodeExtractorsRegistry = {\n  // general note: to match new lines use [^] instead of dot, unless the target is ES2018, then use /s\n  python: [\n    //\n    // Standalone IPython magics\n    // (script magics are standalone, i.e. consecutive code cells with the same magic create two different namespaces)\n    //\n    new RegExpForeignCodeExtractor({\n      language: 'python',\n      pattern: '^%%(python|python2|python3|pypy)( .*?)?\\n([^]*)',\n      foreignCaptureGroups: [3],\n      isStandalone: true,\n      fileExtension: 'py'\n    }),\n    new RegExpForeignCodeExtractor({\n      language: 'perl',\n      pattern: '^%%(perl)( .*?)?\\n([^]*)',\n      foreignCaptureGroups: [3],\n      isStandalone: true,\n      fileExtension: 'pl'\n    }),\n    new RegExpForeignCodeExtractor({\n      language: 'ruby',\n      pattern: '^%%(ruby)( .*?)?\\n([^]*)',\n      foreignCaptureGroups: [3],\n      isStandalone: true,\n      fileExtension: 'rb'\n    }),\n    new RegExpForeignCodeExtractor({\n      language: 'sh',\n      pattern: '^%%(sh|bash)( .*?)?\\n([^]*)',\n      foreignCaptureGroups: [3],\n      isStandalone: true,\n      fileExtension: 'sh'\n    }),\n    new RegExpForeignCodeExtractor({\n      language: 'html',\n      pattern: '^%%(html --isolated)( .*?)?\\n([^]*)',\n      foreignCaptureGroups: [3],\n      isStandalone: true,\n      fileExtension: 'html'\n    }),\n    //\n    // IPython magics producing continuous documents (non-standalone):\n    //\n    new RegExpForeignCodeExtractor({\n      language: 'javascript',\n      pattern: '^%%(js|javascript)( .*?)?\\n([^]*)',\n      foreignCaptureGroups: [3],\n      isStandalone: false,\n      fileExtension: 'js'\n    }),\n    new RegExpForeignCodeExtractor({\n      language: 'html',\n      pattern: '^%%(?!html --isolated)(html)( .*?)?\\n([^]*)',\n      foreignCaptureGroups: [3],\n      isStandalone: false,\n      fileExtension: 'html'\n    }),\n    new RegExpForeignCodeExtractor({\n      language: 'latex',\n      pattern: '^%%(latex)( .*?)?\\n([^]*)',\n      foreignCaptureGroups: [3],\n      isStandalone: false,\n      fileExtension: 'tex'\n    }),\n    new RegExpForeignCodeExtractor({\n      language: 'markdown',\n      pattern: '^%%(markdown)( .*?)?\\n([^]*)',\n      foreignCaptureGroups: [3],\n      isStandalone: false,\n      fileExtension: 'md'\n    })\n  ]\n};\n","import { IScopedCodeOverride } from '../../overrides/tokens';\n\nfunction escape(x: string) {\n  return x.replace(/([\"\\\\])/g, '\\\\$1');\n}\n\nfunction unescape(x: string) {\n  return x.replace(/\\\\([\\\\\"])/g, '$1');\n}\n\nfunction emptyOrEscaped(x: string) {\n  if (!x) {\n    return '';\n  } else {\n    return escape(x);\n  }\n}\n\nconst MAGICS_TO_UNWRAP = ['time', 'capture'];\n\nfunction unwrapCellMagic(name: string, firstLine: string, content: string) {\n  return `# START_CELL_MAGIC(\"${name}\", \"${firstLine}\")\n${content}\n# END_CELL_MAGIC`;\n}\n\n/**\n * Line magics do not have to start with the new line, for example:\n *    x = !ls\n *    x = %ls\n *    x =%ls\n * are all valid.\n *\n * The percent may also appear in strings, e.g. ls('%').\n *\n * IPython allows magics on start of a line or in assignments (but only there!), thus:\n *    x = (!ls)\n * is invalid syntax!\n *\n * Therefore we can require that the match starts with either:\n * - zero or more whitespaces right after the beginning of a line, or\n * - variable then equals (with optional whitespaces)\n *\n * This will not always work: e.g.:\n *    x['a = !ls'] = !ls\n * is perfectly valid IPython, but regular expressions cannot help here.\n *\n * Look behind could be used to avoid capturing the group,\n * but at the time of writing support is only at 77%.\n */\nexport const LINE_MAGIC_PREFIX = '^(\\\\s*|\\\\s*\\\\S+\\\\s*=\\\\s*)';\n\nexport const PYTHON_IDENTIFIER = '([^?\\\\s\\'\"\\\\(\\\\)-\\\\+\\\\/#]+)';\n\nexport let overrides: IScopedCodeOverride[] = [\n  /**\n   * Line magics\n   */\n  // filter out IPython line magics and shell assignments:\n  //  keep the content, keep magic/command name and new line at the end\n  {\n    pattern: LINE_MAGIC_PREFIX + '!([^=\\\\s]+)(.*)(\\n)?',\n    replacement: '$1get_ipython().getoutput(\"$2$3\")$4',\n    scope: 'line',\n    reverse: {\n      pattern: 'get_ipython\\\\(\\\\).getoutput\\\\(\"(.*?)\"\\\\)(\\n)?',\n      replacement: '!$1$2',\n      scope: 'line'\n    }\n  },\n  {\n    // note: assignments of pinfo/pinfo2 are not supported by IPython\n    // and only \"simple\" identifiers are supported, i.e.\n    //    ?x['a']\n    // would not be solved, leading to \"Object `x['a']` not found.\"\n    pattern: '^(\\\\s*)' + '(\\\\?{1,2})' + PYTHON_IDENTIFIER + '(\\n)?$',\n    replacement: (match, prefix, marks, name, lineBreak) => {\n      const cmd = marks == '?' ? 'pinfo' : 'pinfo2';\n      lineBreak = lineBreak || '';\n      // trick: use single quotes to distinguish\n      return `${prefix}get_ipython().run_line_magic(\\'${cmd}\\', \\'${name}\\')${lineBreak}`;\n    },\n    scope: 'line',\n    reverse: {\n      pattern:\n        \"get_ipython\\\\(\\\\).run_line_magic\\\\('(pinfo2?)', '(.*?)'\\\\)(\\n)?\",\n      replacement: (match, cmd, name) => {\n        const marks = cmd == 'pinfo' ? '?' : '??';\n        return `${marks}${name}`;\n      },\n      scope: 'line'\n    }\n  },\n  {\n    pattern: '^(\\\\s*)' + PYTHON_IDENTIFIER + '(\\\\?{1,2})(\\n)?',\n    replacement: (match, prefix, name, marks, lineBreak) => {\n      const cmd = marks == '?' ? 'pinfo' : 'pinfo2';\n      lineBreak = lineBreak || '';\n      // trick: use two spaces to distinguish pinfo using suffix (int?) from the one using prefix (?int)\n      return `${prefix}get_ipython().run_line_magic(\\'${cmd}\\',  \\'${name}\\')${lineBreak}`;\n    },\n    scope: 'line',\n    reverse: {\n      pattern:\n        \"get_ipython\\\\(\\\\).run_line_magic\\\\('(pinfo2?)',  '(.*?)'\\\\)(\\n)?\",\n      replacement: (match, cmd, name) => {\n        const marks = cmd == 'pinfo' ? '?' : '??';\n        return `${name}${marks}`;\n      },\n      scope: 'line'\n    }\n  },\n  {\n    pattern: LINE_MAGIC_PREFIX + '%(\\\\S+)(.*)(\\n)?',\n    replacement: (match, prefix, name, args, lineBreak) => {\n      args = emptyOrEscaped(args);\n      lineBreak = lineBreak || '';\n      return `${prefix}get_ipython().run_line_magic(\"${name}\", \"${args}\")${lineBreak}`;\n    },\n    scope: 'line',\n    reverse: {\n      pattern: 'get_ipython\\\\(\\\\).run_line_magic\\\\(\"(.*?)\", \"(.*?)\"\\\\)(\\n)?',\n      replacement: (match, name, args) => {\n        args = unescape(args);\n        return `%${name}${args}`;\n      },\n      scope: 'line'\n    }\n  },\n  /**\n   * Cell magics\n   */\n  {\n    pattern: '^%%(\\\\S+)(.*\\n)([\\\\s\\\\S]*)',\n    replacement: (match, name, firstLine, content, offset, entire) => {\n      firstLine = emptyOrEscaped(firstLine);\n      if (firstLine) {\n        // remove the new line\n        firstLine = firstLine.slice(0, -1);\n      }\n      content = content.replace(/\"\"\"/g, '\\\\\"\\\\\"\\\\\"');\n\n      let replaced: string;\n      if (MAGICS_TO_UNWRAP.includes(name)) {\n        replaced = unwrapCellMagic(name, firstLine, content);\n      } else {\n        replaced = `get_ipython().run_cell_magic(\"${name}\", \"${firstLine}\", \"\"\"${content}\"\"\")`;\n      }\n      return replaced;\n    },\n    scope: 'cell',\n    reverse: {\n      pattern: '^get_ipython[\\\\s\\\\S]*|^# START_CELL_MAGIC[\\\\s\\\\S]*',\n      replacement: code => {\n        const regCellMagic = RegExp(\n          '^get_ipython\\\\(\\\\).run_cell_magic\\\\(\"(.*?)\", \"(.*?)\", \"\"\"([\\\\s\\\\S]*)\"\"\"\\\\)'\n        );\n        const regUnwrapped = RegExp(\n          '^# START_CELL_MAGIC\\\\(\"(.*?)\", \"(.*?)\"\\\\)\\\\n([\\\\s\\\\S]*)\\\\n# END_CELL_MAGIC$'\n        );\n        let m = code.match(regCellMagic) || code.match(regUnwrapped);\n        let [name, line, content] = m?.slice(1, 4) || ['', '', ''];\n        content = content.replace(/\\\\\"\\\\\"\\\\\"/g, '\"\"\"');\n        line = unescape(line);\n        return `%%${name}${line}\\n${content}`;\n      },\n      scope: 'cell'\n    }\n  }\n];\n","import { JupyterFrontEndPlugin } from '@jupyterlab/application';\nimport { ILSPCodeExtractorsManager } from '@jupyterlab/lsp';\n\nimport { ILSPCodeOverridesManager } from '../../overrides/tokens';\nimport { PLUGIN_ID } from '../../tokens';\n\nimport { foreignCodeExtractors } from './extractors';\nimport { overrides } from './overrides';\n\nexport const IPYTHON_TRANSCLUSIONS: JupyterFrontEndPlugin<void> = {\n  id: PLUGIN_ID + ':ipython',\n  requires: [ILSPCodeExtractorsManager, ILSPCodeOverridesManager],\n  activate: (\n    app,\n    extractorsManager: ILSPCodeExtractorsManager,\n    overrideManager: ILSPCodeOverridesManager\n  ) => {\n    for (let language of Object.keys(foreignCodeExtractors)) {\n      for (let extractor of foreignCodeExtractors[language]) {\n        extractorsManager.register(extractor, language);\n      }\n    }\n    for (let override of overrides) {\n      overrideManager.register(override, 'python');\n    }\n  },\n  autoStart: true\n};\n","import { RegExpForeignCodeExtractor } from '../../extractors/regexp';\nimport { IForeignCodeExtractorsRegistry } from '../../extractors/types';\n\nexport const SQL_URL_PATTERN = '(?:(?:.*?)://(?:.*))';\n// note: -a/--connection_arguments and -f/--file are not supported yet\nconst singleArgumentOptions = [\n  '--destination_table',\n  '--project',\n  '--use_bqstorage_api',\n  '--use_rest_api',\n  '--use_legacy_sql',\n  '--verbose',\n  '--params'\n];\nconst zeroArgumentOptions = ['-l', '--connections'];\n\nconst COMMAND_PATTERN =\n  '(?:' +\n  (zeroArgumentOptions.join('|') +\n    '|' +\n    singleArgumentOptions.map(command => command + ' \\\\w+').join('|')) +\n  ')';\n\nexport let foreignCodeExtractors: IForeignCodeExtractorsRegistry = {\n  // general note: to match new lines use [^] instead of dot, unless the target is ES2018, then use /s\n  python: [\n    new RegExpForeignCodeExtractor({\n      language: 'sql',\n      pattern: `^%%bigquery(?: (?:${SQL_URL_PATTERN}|${COMMAND_PATTERN}|(?:\\\\w+ << )|(?:\\\\w+@\\\\w+)))?\\n?((?:.+\\n)?(?:[^]*))`,\n      foreignCaptureGroups: [1],\n      isStandalone: true,\n      fileExtension: 'sql'\n    })\n  ]\n};\n","import { JupyterFrontEndPlugin } from '@jupyterlab/application';\nimport { ILSPCodeExtractorsManager } from '@jupyterlab/lsp';\n\nimport { PLUGIN_ID } from '../../tokens';\n\nimport { foreignCodeExtractors } from './extractors';\n\n/**\n * Implements extraction of code for IPython Magics for BigQuery, see:\n * https://googleapis.dev/python/bigquery/latest/magics.html.\n */\nexport const IPYTHON_BIGQUERY_TRANSCLUSIONS: JupyterFrontEndPlugin<void> = {\n  id: PLUGIN_ID + ':ipython-bigquery',\n  requires: [ILSPCodeExtractorsManager],\n  activate: (app, extractorsManager: ILSPCodeExtractorsManager) => {\n    for (let language of Object.keys(foreignCodeExtractors)) {\n      for (let extractor of foreignCodeExtractors[language]) {\n        extractorsManager.register(extractor, language);\n      }\n    }\n  },\n  autoStart: true\n};\n","export const RPY2_MAX_ARGS = 10;\n\nexport function extractArgs(args: string[], contentPosition: number) {\n  let inputs = [];\n  let outputs = [];\n  let others = [];\n  for (let i = 0; i < args.length; i = i + 2) {\n    let arg = args[i];\n    let variable = args[i + 1];\n    if (arg == null) {\n      break;\n    } else if (arg === 'i' || arg === '-input') {\n      inputs.push(variable);\n    } else if (arg === 'o' || arg === '-output') {\n      outputs.push(variable);\n    } else {\n      others.push('-' + arg + ' ' + variable);\n    }\n  }\n  return {\n    inputs: inputs,\n    outputs: outputs,\n    rest: args[args.length + contentPosition],\n    others: others\n  };\n}\n\nexport function parseArgs(args: string[], contentPosition: number) {\n  let { inputs, outputs, rest, others } = extractArgs(args, contentPosition);\n  let inputVariables = inputs.join(', ');\n  if (inputVariables) {\n    inputVariables = ', ' + inputVariables;\n  }\n  let outputVariables = outputs.join(', ');\n  if (outputVariables) {\n    outputVariables = outputVariables + ' = ';\n  }\n  return {\n    content: rest,\n    others: others.join(' '),\n    inputs: inputVariables,\n    outputs: outputVariables\n  };\n}\n\nexport function reversePattern(\n  quote = '\"',\n  multiLine = false,\n  magic = 'R'\n): string {\n  return (\n    '(\\\\S+)?' +\n    '(?:, (\\\\S+))?'.repeat(9) +\n    '( = )?rpy2\\\\.ipython\\\\.rmagic\\\\.RMagics.' +\n    magic +\n    '\\\\(' +\n    quote +\n    (multiLine ? '([\\\\s\\\\S]*)' : '(.*?)') +\n    quote +\n    ', \"(.*?)\"' +\n    '(?:, (\\\\S+))?'.repeat(10) +\n    '\\\\)'\n  );\n}\n\nexport function reverseReplacement(match: string, ...args: string[]) {\n  let outputs = [];\n  for (let i = 0; i < 10; i++) {\n    if (args[i] == null) {\n      break;\n    }\n    outputs.push(args[i]);\n  }\n  let inputs = [];\n  for (let i = 13; i < 23; i++) {\n    if (args[i] == null) {\n      break;\n    }\n    inputs.push(args[i]);\n  }\n  let inputVariables = inputs.join(' -i ');\n  if (inputVariables) {\n    inputVariables = ' -i ' + inputVariables;\n  }\n  let outputVariables = outputs.join(' -o ');\n  if (outputVariables) {\n    outputVariables = ' -o ' + outputVariables;\n  }\n  let contents = args[11];\n  let otherArgs = args[12];\n  if (otherArgs) {\n    otherArgs = ' ' + otherArgs;\n  }\n  return {\n    input: inputVariables,\n    output: outputVariables,\n    other: otherArgs,\n    contents: contents\n  };\n}\n\nexport function argsPattern(maxN: number) {\n  return '(?: -(\\\\S+) (\\\\S+))?'.repeat(maxN);\n}\n","import { RegExpForeignCodeExtractor } from '../../extractors/regexp';\nimport { IForeignCodeExtractorsRegistry } from '../../extractors/types';\n\nimport { RPY2_MAX_ARGS, extractArgs, argsPattern } from './rpy2';\n\nfunction createExtractor(stripLeadingSpace: boolean) {\n  function codeExtractor(match: string, ...args: string[]) {\n    let r = extractArgs(args, -3);\n    let code: string;\n    if (r.rest == null) {\n      code = '';\n    } else if (stripLeadingSpace) {\n      code = r.rest.startsWith(' ') ? r.rest.slice(1) : r.rest;\n    } else {\n      code = r.rest;\n    }\n    return code;\n  }\n\n  return codeExtractor;\n}\n\nconst extractorNonStripping = createExtractor(false);\n\nfunction args(match: string, ...args: string[]) {\n  let r = extractArgs(args, -3);\n  // define dummy input variables using empty data frames\n  let inputs = r.inputs.map(i => i + ' <- data.frame();').join(' ');\n  let code = extractorNonStripping(match, ...args);\n  if (inputs !== '' && code) {\n    inputs += ' ';\n  }\n  return inputs;\n}\n\nexport let foreignCodeExtractors: IForeignCodeExtractorsRegistry = {\n  // general note: to match new lines use [^] instead of dot, unless the target is ES2018, then use /s\n  python: [\n    //\n    // R magics (non-standalone: the R code will always be in the same, single R-namespace)\n    //\n    new RegExpForeignCodeExtractor({\n      language: 'r',\n      pattern: '^%%R' + argsPattern(RPY2_MAX_ARGS) + '\\n([^]*)',\n      foreignCaptureGroups: [RPY2_MAX_ARGS * 2 + 1],\n      // it is important to not strip any leading spaces\n      foreignReplacer: extractorNonStripping,\n      extractArguments: args,\n      isStandalone: false,\n      fileExtension: 'R'\n    }),\n    new RegExpForeignCodeExtractor({\n      language: 'r',\n      // it is very important to not include the space which will be trimmed in the capture group,\n      // otherwise the offset will be off by one and the R language server will crash\n      pattern: '(?:^|\\n)%R' + argsPattern(RPY2_MAX_ARGS) + '(?: (.*))?(?:\\n|$)',\n      foreignCaptureGroups: [RPY2_MAX_ARGS * 2 + 1],\n      foreignReplacer: createExtractor(true),\n      extractArguments: args,\n      isStandalone: false,\n      fileExtension: 'R'\n    })\n  ]\n};\n","import { IScopedCodeOverride } from '../../overrides/tokens';\nimport { LINE_MAGIC_PREFIX } from '../ipython/overrides';\n\nimport {\n  RPY2_MAX_ARGS,\n  parseArgs,\n  argsPattern,\n  reversePattern,\n  reverseReplacement\n} from './rpy2';\n\nexport let overrides: IScopedCodeOverride[] = [\n  {\n    // support up to 10 arguments\n    pattern:\n      LINE_MAGIC_PREFIX + '%R' + argsPattern(RPY2_MAX_ARGS) + '( .*)?(\\n|$)',\n    replacement: (match, prefix, ...args) => {\n      let r = parseArgs(args, -4);\n      // note: only supports assignment or -o/--output, not both\n      // TODO assignment like in x = %R 1 should be distinguished from -o\n      return `${prefix}${r.outputs}rpy2.ipython.rmagic.RMagics.R(\"${\n        r.content || ''\n      }\", \"${r.others}\"${r.inputs})`;\n    },\n    scope: 'line',\n    reverse: {\n      pattern: reversePattern(),\n      replacement: (match, ...args) => {\n        let r = reverseReplacement(match, ...args);\n        return '%R' + r.input + r.output + r.other + r.contents;\n      },\n      scope: 'line'\n    }\n  },\n  // rpy2 extension R magic - this should likely go as an example to the user documentation, rather than being a default\n  //   only handles simple one input - one output case\n  {\n    pattern: '^%%R' + argsPattern(RPY2_MAX_ARGS) + '(\\n)?([\\\\s\\\\S]*)',\n    replacement: (match, ...args) => {\n      let r = parseArgs(args, -3);\n      return `${r.outputs}rpy2.ipython.rmagic.RMagics.R(\"\"\"${r.content}\"\"\", \"${r.others}\"${r.inputs})`;\n    },\n    scope: 'cell',\n    reverse: {\n      pattern: reversePattern('\"\"\"', true),\n      replacement: (match, ...args) => {\n        let r = reverseReplacement(match, ...args);\n        return '%%R' + r.input + r.output + r.other + '\\n' + r.contents;\n      },\n      scope: 'cell'\n    }\n  },\n  {\n    pattern: LINE_MAGIC_PREFIX + '%Rdevice( .*)?(\\n|$)',\n    replacement: (match, prefix, ...args) => {\n      return `${prefix}rpy2.ipython.rmagic.RMagics.Rdevice(\"${args[0]}\", \"\")`;\n    },\n    scope: 'line',\n    reverse: {\n      pattern: reversePattern('\"', false, 'Rdevice'),\n      replacement: (match, ...args) => {\n        let r = reverseReplacement(match, ...args);\n        return '%Rdevice' + r.input + r.output + r.other + r.contents;\n      },\n      scope: 'line'\n    }\n  }\n];\n","import { JupyterFrontEndPlugin } from '@jupyterlab/application';\nimport { ILSPCodeExtractorsManager } from '@jupyterlab/lsp';\n\nimport { ILSPCodeOverridesManager } from '../../overrides/tokens';\nimport { PLUGIN_ID } from '../../tokens';\n\nimport { foreignCodeExtractors } from './extractors';\nimport { overrides } from './overrides';\n\nexport const IPYTHON_RPY2_TRANSCLUSIONS: JupyterFrontEndPlugin<void> = {\n  id: PLUGIN_ID + ':ipython-rpy2',\n  requires: [ILSPCodeExtractorsManager, ILSPCodeOverridesManager],\n  activate: (\n    app,\n    extractorsMmanager: ILSPCodeExtractorsManager,\n    overridesManager: ILSPCodeOverridesManager\n  ) => {\n    for (let language of Object.keys(foreignCodeExtractors)) {\n      for (let extractor of foreignCodeExtractors[language]) {\n        extractorsMmanager.register(extractor, language);\n      }\n    }\n    for (let override of overrides) {\n      overridesManager.register(override, 'python');\n    }\n  },\n  autoStart: true\n};\n","import { RegExpForeignCodeExtractor } from '../../extractors/regexp';\nimport { IForeignCodeExtractorsRegistry } from '../../extractors/types';\n\nexport const SQL_URL_PATTERN = '(?:(?:.*?)://(?:.*))';\n// note: -a/--connection_arguments and -f/--file are not supported yet\nconst singleArgumentOptions = [\n  '-x',\n  '--close',\n  '-c',\n  '--creator',\n  '-p',\n  '--persist',\n  '--append'\n];\nconst zeroArgumentOptions = ['-l', '--connections'];\n\nconst COMMAND_PATTERN =\n  '(?:' +\n  (zeroArgumentOptions.join('|') +\n    '|' +\n    singleArgumentOptions.map(command => command + ' \\\\w+').join('|')) +\n  ')';\n\nexport let foreignCodeExtractors: IForeignCodeExtractorsRegistry = {\n  // general note: to match new lines use [^] instead of dot, unless the target is ES2018, then use /s\n  python: [\n    new RegExpForeignCodeExtractor({\n      language: 'sql',\n      pattern: `^%%sql(?: (?:${SQL_URL_PATTERN}|${COMMAND_PATTERN}|(?:\\\\w+ << )|(?:\\\\w+@\\\\w+)))?\\n?((?:.+\\n)?(?:[^]*))`,\n      foreignCaptureGroups: [1],\n      isStandalone: true,\n      fileExtension: 'sql'\n    }),\n    new RegExpForeignCodeExtractor({\n      language: 'sql',\n      pattern: `(?:^|\\n)%sql (?:${SQL_URL_PATTERN}|${COMMAND_PATTERN}|(.*))\\n?`,\n      foreignCaptureGroups: [1],\n      isStandalone: false,\n      fileExtension: 'sql'\n    })\n  ]\n};\n","import { JupyterFrontEndPlugin } from '@jupyterlab/application';\nimport { ILSPCodeExtractorsManager } from '@jupyterlab/lsp';\n\nimport { PLUGIN_ID } from '../../tokens';\n\nimport { foreignCodeExtractors } from './extractors';\n\n/**\n * Implements extraction of code for ipython-sql, see:\n * https://github.com/catherinedevlin/ipython-sql.\n * No dedicated code overrides are provided (but the default IPython\n * overrides should prevent any syntax errors in the virtual documents)\n */\nexport const IPYTHON_SQL_TRANSCLUSIONS: JupyterFrontEndPlugin<void> = {\n  id: PLUGIN_ID + ':ipython-sql',\n  requires: [ILSPCodeExtractorsManager],\n  activate: (app, extractorsManager: ILSPCodeExtractorsManager) => {\n    for (let language of Object.keys(foreignCodeExtractors)) {\n      for (let extractor of foreignCodeExtractors[language]) {\n        extractorsManager.register(extractor, language);\n      }\n    }\n  },\n  autoStart: true\n};\n","import { JupyterFrontEndPlugin } from '@jupyterlab/application';\n\nimport { IPYTHON_TRANSCLUSIONS } from './ipython';\nimport { IPYTHON_BIGQUERY_TRANSCLUSIONS } from './ipython-bigquery';\nimport { IPYTHON_RPY2_TRANSCLUSIONS } from './ipython-rpy2';\nimport { IPYTHON_SQL_TRANSCLUSIONS } from './ipython-sql';\n\nexport const DEFAULT_TRANSCLUSIONS: JupyterFrontEndPlugin<void>[] = [\n  IPYTHON_RPY2_TRANSCLUSIONS,\n  IPYTHON_SQL_TRANSCLUSIONS,\n  IPYTHON_BIGQUERY_TRANSCLUSIONS,\n  IPYTHON_TRANSCLUSIONS\n];\n","/** The Public API, as exposed in the `main` field of package.json */\n\n/** General public tokens, including lumino Tokens and namespaces */\nexport * from './tokens';\n\n/** Generated JSON Schema types for server responses and settings */\nexport * as SCHEMA from './_schema';\n\n/** Component- and feature-specific APIs */\nexport * from './api';\n\nimport { COMPLETION_THEME_MANAGER } from '@jupyter-lsp/completion-theme';\nimport { plugin as THEME_MATERIAL } from '@jupyter-lsp/theme-material';\nimport { plugin as THEME_VSCODE } from '@jupyter-lsp/theme-vscode';\nimport {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\nimport { ILoggerRegistry } from '@jupyterlab/logconsole';\nimport {\n  ILSPDocumentConnectionManager,\n  DocumentConnectionManager,\n  ILanguageServerManager\n} from '@jupyterlab/lsp';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { IStatusBar } from '@jupyterlab/statusbar';\nimport { ITranslator, nullTranslator } from '@jupyterlab/translation';\nimport { IFormRendererRegistry } from '@jupyterlab/ui-components';\nimport { JSONExt } from '@lumino/coreutils';\n\nimport '../style/index.css';\n\nimport { LanguageServers } from './_plugin';\nimport { FILEEDITOR_ADAPTER_PLUGIN } from './adapters/fileeditor';\nimport { NOTEBOOK_ADAPTER_PLUGIN } from './adapters/notebook';\nimport { StatusButtonExtension } from './components/statusbar';\nimport {\n  COMPLETION_PLUGIN,\n  COMPLETION_FALLBACK_PLUGIN\n} from './features/completion';\nimport { DIAGNOSTICS_PLUGIN } from './features/diagnostics';\nimport { HIGHLIGHTS_PLUGIN } from './features/highlights';\nimport { HOVER_PLUGIN } from './features/hover';\nimport { JUMP_PLUGIN } from './features/jump_to';\nimport { RENAME_PLUGIN } from './features/rename';\nimport { SIGNATURE_PLUGIN } from './features/signature';\nimport { SYMBOL_PLUGIN } from './features/symbol';\nimport { SYNTAX_HIGHLIGHTING_PLUGIN } from './features/syntax_highlighting';\nimport { CODE_OVERRIDES_MANAGER } from './overrides';\nimport { SettingsUIManager, SettingsSchemaManager } from './settings';\nimport {\n  ILSPLogConsole,\n  PLUGIN_ID as PLUGIN_ID_BASE,\n  TLanguageServerConfigurations\n} from './tokens';\nimport { DEFAULT_TRANSCLUSIONS } from './transclusions/defaults';\nimport { LOG_CONSOLE } from './virtual/console';\n\nconst PLUGIN_ID = PLUGIN_ID_BASE + ':plugin';\n\nexport class LSPExtension {\n  get connectionManager(): ILSPDocumentConnectionManager {\n    return this._connectionManager;\n  }\n  private _connectionManager: DocumentConnectionManager;\n  languageServerManager: ILanguageServerManager;\n  private _settingsSchemaManager: SettingsSchemaManager;\n\n  private _isAnyActive(): boolean {\n    const adapters = [...this._connectionManager.adapters.values()];\n    return (\n      this.app.shell.currentWidget !== null &&\n      adapters.some(adapter => adapter.widget == this.app.shell.currentWidget)\n    );\n  }\n\n  constructor(\n    public app: JupyterFrontEnd,\n    private settingRegistry: ISettingRegistry,\n    connectionManager: DocumentConnectionManager,\n    public console: ILSPLogConsole,\n    public translator: ITranslator,\n    public userConsole: ILoggerRegistry | null,\n    statusBar: IStatusBar | null,\n    formRegistry: IFormRendererRegistry | null\n  ) {\n    const trans = (translator || nullTranslator).load('jupyterlab_lsp');\n    this.languageServerManager = connectionManager.languageServerManager;\n    this._connectionManager = connectionManager;\n\n    const statusButtonExtension = new StatusButtonExtension({\n      languageServerManager: this.languageServerManager,\n      connectionManager: this.connectionManager,\n      translatorBundle: trans,\n      shell: app.shell\n    });\n\n    if (statusBar !== null) {\n      statusBar.registerStatusItem(PLUGIN_ID_BASE + ':language-server-status', {\n        item: statusButtonExtension.createItem(),\n        align: 'left',\n        rank: 1,\n        isActive: () => this._isAnyActive()\n      });\n    } else {\n      app.docRegistry.addWidgetExtension('Notebook', statusButtonExtension);\n    }\n\n    this._settingsSchemaManager = new SettingsSchemaManager({\n      settingRegistry: this.settingRegistry,\n      languageServerManager: this.languageServerManager,\n      trans: trans,\n      console: this.console.scope('SettingsSchemaManager'),\n      restored: app.restored\n    });\n\n    if (formRegistry != null) {\n      const settingsUI = new SettingsUIManager({\n        settingRegistry: this.settingRegistry,\n        console: this.console.scope('SettingsUIManager'),\n        languageServerManager: this.languageServerManager,\n        trans: trans,\n        schemaValidated: this._settingsSchemaManager.schemaValidated\n      });\n      // register custom UI field for `language_servers` property\n      formRegistry.addRenderer(`${PLUGIN_ID}.language_servers`, {\n        fieldRenderer: settingsUI.renderForm.bind(settingsUI)\n      });\n    }\n\n    this._settingsSchemaManager\n      .setupSchemaTransform(plugin.id)\n      .then(this._activate.bind(this))\n      .catch(this._activate.bind(this));\n  }\n\n  private _activate(): void {\n    this.settingRegistry\n      .load(plugin.id)\n      .then(async settings => {\n        await this._updateOptions(settings, false);\n        settings.changed.connect(async () => {\n          await this._updateOptions(settings, true);\n        });\n      })\n      .catch((reason: Error) => {\n        console.error(reason.message);\n      });\n  }\n\n  private async _updateOptions(\n    settings: ISettingRegistry.ISettings,\n    afterInitialization = false\n  ) {\n    const options = await this._settingsSchemaManager.normalizeSettings(\n      settings.composite as Required<LanguageServers>\n    );\n    // Store the initial server settings, to be sent asynchronously\n    // when the servers are initialized.\n    let languageServerSettings = (options.language_servers ||\n      {}) as TLanguageServerConfigurations;\n\n    // Rename `serverSettings` to `configuration` to work with changed name upstream,\n    // rename `priority` to `rank` for the same reason.\n    languageServerSettings = Object.fromEntries(\n      Object.entries(languageServerSettings).map(([key, value]) => {\n        const copy = JSONExt.deepCopy(value);\n        copy.configuration = copy.serverSettings;\n        copy.rank = copy.priority;\n        delete copy.priority;\n        delete copy.serverSettings;\n        return [key, copy];\n      })\n    );\n\n    const previousInitialConfig = this._connectionManager.initialConfigurations;\n    this._connectionManager.initialConfigurations = languageServerSettings;\n    // TODO: if priorities changed reset connections\n\n    // update the server-independent part of configuration immediately\n    this.connectionManager.updateConfiguration(languageServerSettings);\n    if (afterInitialization) {\n      this.connectionManager.updateServerConfigurations(languageServerSettings);\n    } else {\n      // This would not be needed if we controlled the connection manager, but because\n      // it is now an independent plugin it may have started and finished initialization\n      // earlier, so it potentially sent wrong `initialConfigurations` and we have no way\n      // to avoid this, so we need to send a reconfiguration request instead.\n      //\n      // TODO: this is comparing objects which is always false,\n      // we should have a proper comparison to avoid redundant calls,\n      // but in practice because upstream never populates defaults and\n      // we always do, this means it would be false anyways,\n      // so for now the comparison serves more as a comment than logic.\n      if (previousInitialConfig != languageServerSettings) {\n        this.connectionManager.ready\n          .then(() => {\n            this.connectionManager.updateServerConfigurations(\n              languageServerSettings\n            );\n          })\n          .catch(console.error);\n      }\n    }\n    this._connectionManager.updateLogging(\n      options.logAllCommunication,\n      options.setTrace!\n    );\n  }\n}\n\n/**\n * The plugin registration information.\n */\nconst plugin: JupyterFrontEndPlugin<void> = {\n  id: PLUGIN_ID,\n  requires: [\n    ISettingRegistry,\n    ILSPDocumentConnectionManager,\n    ILSPLogConsole,\n    ITranslator\n  ],\n  optional: [ILoggerRegistry, IStatusBar, IFormRendererRegistry],\n  activate: (app, ...args) => {\n    new LSPExtension(\n      app,\n      ...(args as [\n        ISettingRegistry,\n        DocumentConnectionManager,\n        ILSPLogConsole,\n        ITranslator,\n        ILoggerRegistry | null,\n        IStatusBar | null,\n        IFormRendererRegistry | null\n      ])\n    );\n  },\n  autoStart: true\n};\n\nconst DEFAULT_FEATURES: JupyterFrontEndPlugin<any>[] = [\n  JUMP_PLUGIN,\n  COMPLETION_PLUGIN,\n  SIGNATURE_PLUGIN,\n  HOVER_PLUGIN,\n  RENAME_PLUGIN,\n  HIGHLIGHTS_PLUGIN,\n  DIAGNOSTICS_PLUGIN,\n  SYNTAX_HIGHLIGHTING_PLUGIN,\n  SYMBOL_PLUGIN\n];\nconst plugins: JupyterFrontEndPlugin<any>[] = [\n  LOG_CONSOLE,\n  COMPLETION_THEME_MANAGER,\n  THEME_VSCODE,\n  THEME_MATERIAL,\n  CODE_OVERRIDES_MANAGER,\n  NOTEBOOK_ADAPTER_PLUGIN,\n  FILEEDITOR_ADAPTER_PLUGIN,\n  plugin,\n  ...DEFAULT_TRANSCLUSIONS,\n  ...DEFAULT_FEATURES,\n  COMPLETION_FALLBACK_PLUGIN\n];\n\n/**\n * Export the plugins as default.\n */\nexport default plugins;\n"],"names":["___CSS_LOADER_EXPORT___","push","module","id","i","PLUGIN_ID","ILSPLogConsole","Token","getIndexOfCaptureGroup","expression","matchedString","valueOfCapturedGroup","capturedGroups","exec","console","warn","offsetInMatch","fullMatched","group","slice","indexOf","groupEndOffset","length","RegExpForeignCodeExtractor","constructor","options","cellType","this","language","globalExpression","RegExp","pattern","testExpression","standalone","isStandalone","fileExtension","hasForeignCode","code","result","test","lastIndex","extractForeignCode","lines","split","extracts","Array","hostCodeFragment","chosenReplacer","startedFrom","match","isNewApiReplacer","foreignReplacer","foreignCaptureGroups","join","extractToForeign","positionShift","foreignCodeFragment","replace","prefix","extractArguments","positionAtOffset","endIndex","keepInHost","substring","index","foreignCodeGroupValue","Math","min","foreignGroupIndexInMatch","startOffset","start","end","hostCode","foreignCode","range","virtualShift","finalHostCodeFragment","ILSPCodeOverridesManager","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","c","locals","OverridesMap","Map","magicOverrides","super","map","m","replacement","_overrideFor","key","value","ReversibleOverridesMap","overrides","reverse","type","filter","override","overrideFor","cell","replaceAll","rawLines","substitutedLines","skipInspect","line","reverseReplaceAll","VirtualDocument","overridesRegistry","cellMagicsOverrides","lineMagicsOverrides","decodeCodeBlock","rawCode","cellOverride","prepareCodeBlock","block","editorShift","column","cellCodeKept","foreignDocumentsMap","cellCode","_line","idPath","skip","appendCodeBlock","ceEditor","isDisposed","sourceCellLines","virtualLines","set","lastVirtualLine","editor","sourceLine","lastSourceLine","sourceLines","editorLine","virtualLine","lineBlocks","blankLinesBetweenCells","transformVirtualToRoot","position","get","editorPosition","transformVirtualToEditor","root","transformFromEditorToRoot","getForeignDocuments","editorAccessor","maps","Set","values","add","FileEditorAdapter","editorWidget","emitted","emit","_editorAdded","args","call","initOnceReady","activeEditor","createVirtualDocument","foreignCodeExtractors","foreignCodeExtractorsManager","path","documentPath","languageFileExtension","hasLspSupportedFile","codeOverridesManager","registry","FILEEDITOR_ADAPTER_PLUGIN","description","requires","IEditorTracker","ILSPDocumentConnectionManager","ILSPFeatureManager","ILSPCodeExtractorsManager","activate","app","editors","connectionManager","featureManager","extractorManager","widgetAdded","connect","async","_","adapter","docRegistry","registerAdapter","context","autoStart","NotebookAdapter","_blockUpdates","onForeignDocumentOpened","virtualDocument","updateDocuments","Promise","resolve","NOTEBOOK_ADAPTER_PLUGIN","INotebookTracker","notebooks","codeExtractorManager","notebook","externalLink","url","label","href","target","rel","className","SERVER_EXTENSION_404","codeWarningIcon","LabIcon","name","svgstr","codeClockIcon","codeCheckIcon","DocumentLocator","props","document","hasMultipleEditors","firstLine","breadcrumbs","trans","collapse","nullTranslator","load","ancestry","parent","endsWith","fullPath","parts","uri","title","size","lastLine","firstCell","getEditorIndex","lastCell","cellLocator","__","e","getBreadcrumbs","onClick","accessor","reveal","getEditor","focus","focusEditor","ServerLinksList","Object","entries","specification","urls","serverId","okButton","Dialog","ServerStatus","list","server","spec","languages","display_name","CollapsibleList","handleClick","setState","state","isCollapsed","startCollapsed","render","collapseExpandIcon","caretDownIcon","caretUpIcon","react","tag","LanguageServerInfo","specs","troubleshoot","install","command","HelpButton","showDialog","body","servers","_n","buttons","catch","LSPPopup","VDomRenderer","model","addClass","serversAvailable","serversAvailableNotInUse","session","runningServers","documentsByLanguage","documentsByServer","documentsHtml","documents","connection","connections","status","isInitialized","isConnected","icon","circleIcon","circleEmptyIcon","elementSize","missingLanguages","specsForMissing","languageServerManager","getMatchingSpecs","LSPStatus","displayText","shell","Model","_popup","dispose","showPopup","anchor","align","hasDynamicSize","caption","GroupItem","spacing","longMessage","statusIcon","top","stylesheet","TextItem","source","shortMessage","StatusButtonExtension","createItem","statusBarItem","translatorBundle","createNew","panel","item","toolbar","insertAfter","classByStatus","noServerExtension","waiting","initialized","initializing","initializedButSomeMissing","connecting","iconByStatus","VDomModel","_shell","_onChange","stateChanged","_shortMessageByStatus","availableServers","sessions","supportedLanguages","toLocaleLowerCase","_isServerRunning","detectedLanguages","matchedServers","getMatchingServers","data","mainDocument","collectDocuments","serverIds","_connectionManager","has","documentsMap","collectLanguages","detectedDocuments","allDocuments","detectedDocumentsSet","doc","connectedDocuments","initializedDocuments","absentDocuments","documentsWithAvailableServers","documentsWithKnownServers","forEach","openConnections","statusCode","bindprops","stopIcon","msg","uninitialized","delete","_np","unconnected","connected","adapters","find","widget","currentWidget","disconnect","disconnected","closed","documentsChanged","DiagnosticSeverity","DiagnosticTag","SymbolTag","CompletionItemTag","CompletionItemKind","DocumentHighlightKind","CompletionTriggerKind","AdditionalCompletionTriggerKinds","Languages","Feature","extensionFactory","undefined","FeatureSettings","settingRegistry","featureID","_ready","PromiseDelegate","changed","Signal","plugins","then","settings","reject","ready","promise","composite","setting","PositionConverter","lsp_to_cm","ch","character","cm_to_lsp","lsp_to_ce","cm_to_ce","ce_to_cm","documentAtRootPosition","rootAsSource","Error","documentAtSourcePosition","editorAtRootPosition","getEditorAtSourceLine","rootPositionToVirtualPosition","virtualPositionAtDocument","rootPositionToEditorPosition","transformSourceToEditor","editorPositionToRootPosition","rangeToEditorRange","startInRoot","prototype","candidate","EnhancedContextCompleterProvider","ContextCompleterProvider","fetch","request","items","order","iconFor","sortText","String","fromCharCode","iconsThemeManager","getIcon","EnhancedKernelCompleterProvider","KernelCompleterProvider","KernelKind","isApplicable","upstream","manager","error","getCursorPosition","rootPosition","arg","textual","JSON","stringify","k","FloatingConsole","scope","element","createElement","appendChild","bindThis","remove","append","text","kind","entry","innerHTML","scrollTop","scrollHeight","debug","log","BrowserConsole","window","bind","ConsoleWrapper","singleton","_scope","_rebindFunctions","noOp","bindArg","implementation","verbosity","ConsoleSingleton","updateSettings","loggingConsole","loggingLevel","LOG_CONSOLE","ISettingRegistry","provides","CompletionItem","isDocumentationMarkdown","_isDocumentationMarkdown","_setDocumentation","documentation","_resolved","_detail","detail","_match","self","makeGetterEnumerable","insertText","_currentInsertText","_currentSortText","filterText","needsResolution","_supportsResolution","isResolved","resolvedCompletionItem","clientRequests","_documentation","deprecated","tags","some","Deprecated","is","serverCapabilities","completionProvider","resolveProvider","instance","generatedDescriptor","desc","getOwnPropertyDescriptor","getPrototypeOf","findDescriptor","defineProperty","enumerable","escapeHTML","node","textContent","GenericCompleterModel","CompleterModel","defaultOptions","completionItems","query","unfilteredItems","harmoniseItem","_sortAndFilter","_markFragment","getFilterText","getHighlightableLabelRegion","createPatch","patch","subsetMatch","resolveQuery","userQuery","_item","results","matched","filterMatch","lowerCaseQuery","toLowerCase","caseSensitive","StringExt","matchSumOfSquares","includePerfectMatches","score","labelMatch","labelPrefix","highlight","indices","itemClone","create","getOwnPropertyDescriptors","sort","compareMatches","x","a","b","delta","localeCompare","kernelCompletionsFirst","LSPCompleterModel","_preFilterQuery","setCompletionItems","newValue","current","cursor","original","queryRange","trim","linePrefix","trimmedQuotes","startsWith","preFilterMatches","sourceOrder","LSP","kernel","LSPCompletionRenderer","Completer","Renderer","ITEM_PLACEHOLDER_CLASS","EXTRA_INFO_CLASS","LABEL_CLASS","elementToItem","WeakMap","visibilityObserver","IntersectionObserver","isIntersecting","li","threshold","getExtraInfo","labelExtra","updateExtraInfo","extraText","getElementsByClassName","_elideMark","createCompletionItemNode","orderedTypes","lspItem","observe","labelElement","originalHTMLLabel","childNodes","hasMark","HTMLElement","tagName","elidableElement","setAttribute","replaceChildren","classList","wrapper","createDocumentationNode","markdownRenderer","renderModel","trusted","metadata","setData","latexTypesetter","includes","typeset","itemWidthHeuristic","labelSize","extra","extraTextSize","proposedElipsed","layout","max","CompletionProvider","identifier","rank","modelFactory","renderMimeRegistry","createRenderer","renderer","completionItem","shouldShowContinuousHint","completerIsVisible","triggerCharacters","sourceChange","token","getTokenAtCursor","continuousHinting","suppressContinuousHintingIn","suppressTriggerCharacterIn","trigger","getPositionAt","offset","getTokenAt","positionInToken","typedCharacter","virtualPosition","lspCompletionReply","textDocument","documentInfo","triggerKind","Invoked","triggerCharacter","TriggerCharacter","lspCompletionItems","createCompletionItem","suffix","anyPrefixed","intendedText","pathPrefix","response","transformLSPCompletions","isArray","isIncomplete","disable","ICompletionFeature","CompletionFeature","capabilities","completion","dynamicRegistration","snippetSupport","commitCharactersSupport","documentationFormat","deprecatedSupport","preselectSupport","tagSupport","valueSet","contextSupport","_configure","provider","completionProviderManager","registerProvider","completionThemeManager","setTheme","dataset","lspCompleterLayout","theme","setIconsOverrides","typesMap","COMPLETION_PLUGIN","ICompletionProviderManager","ILSPCompletionThemeManager","IRenderMimeRegistry","feature","register","COMPLETION_FALLBACK_PLUGIN","optional","completionFeature","ContextAssembler","_wasOverToken","getContext","getContextFromContextMenu","_contextFromActiveDocument","message","isContextMenuOverToken","getOffsetAt","isOverToken","ceCursor","cmCursor","_contextFromRoot","adapterFromNode","leafNode","contains","positionFromCoordinates","left","editorPositionFromCoordinates","getPositionForCoordinate","right","bottom","y","width","height","editorFromNode","cmContent","closest","cmView","view","contextMenuHitTest","getBoundingClientRect","event","_contextMenuEvent","clientX","clientY","stopPropagation","accessorFromNode","RE_PATH_ANCHOR","getModifierState","modifierKey","shiftKey","altKey","ctrlKey","metaKey","DefaultMap","defaultFactory","getOrCreate","v","urisEqual","isWinPath","normalizeWinPath","decodeURI","it","expandPath","obj","curr","prop","expandDottedPaths","parsed","collapseToDotted","conflicts","keys","hasOwnProperty","escapeMarkdown","span","jumpToIcon","jumpBackIcon","NavigationFeature","declaration","linkSupport","definition","typeDefinition","_trans","contextAssembler","factory","factoryOptions","widgetAdapter","clickListener","EditorView","domEventHandlers","mouseup","_jumpOnMouseUp","EditorExtensionRegistry","createImmutableExtension","_jumpers","fileEditorTracker","notebookTracker","documentManager","content","CodeMirrorEditor","jumper","FileEditorJumper","NotebookJumper","getJumper","_jumpToDefinitionOrRefernce","addEventListener","mouseUpEvent","once","button","positionParams","targets","handleJump","includeDeclaration","preventDefault","_harmonizeLocations","locationData","locationOrLink","targetUri","targetRange","location","_chooseTarget","locations","choices","_resolvePath","getItemOptions","okLabel","choice","InputDialog","getItem","choiceIndex","contentsPath","child","PageConfig","getOption","decodeURIComponent","targetInfo","Notification","info","autoClose","editorIndex","findIndex","ProtocolCoordinates","isWithinRange","globalJump","isSymlink","sourcePosition","jumpData","services","contents","err","URLExt","CommandIDs","jumpToDefinition","jumpToReference","jumpBack","JUMP_PLUGIN","IDocumentManager","ICommandPalette","ITranslator","palette","translator","commands","addCommand","execute","warning","isEnabled","globalJumpBack","commandID","contextMenu","addItem","selector","category","DIAGNOSTICS_LISTING_CLASS","DIAGNOSTICS_PLACEHOLDER_CLASS","DiagnosticsDatabase","all","concat","apply","Column","isVisible","renderCell","isAvailable","renderHeader","listing","SortableTH","isSortKey","sortKey","sortIcon","sortDirection","DiagnosticsListing","severityTranslations","Warning","Information","Hint","columns","row","db","diagnostic","codeString","messageWithoutCode","severity","cellNumber","update","diagnosticsDatabase","diagnostics","byDocument","from","diagnosticData","flattened","_diagnostics","sortedColumn","sorter","sorted","columnsToDisplay","elements","cells","jumpTo","columnsHeaders","getDiagnostic","setCursorPosition","diagnosticsIcon","CMD_COLUMN_VISIBILITY","CMD_JUMP_TO_DIAGNOSTIC","CMD_COPY_DIAGNOSTIC","CMD_IGNORE_DIAGNOSTIC_CODE","CMD_IGNORE_DIAGNOSTIC_MSG","diagnosticsPanel","_content","_widget","isRegistered","initWidget","MainAreaWidget","closable","isAttached","getColumn","columnsMenu","Menu","isToggled","submenu","ignoreDiagnosticsMenu","getRow","tr","ignoreCodes","refreshDiagnostics","ignoreMessagesPatterns","string","navigator","clipboard","writeText","prompt","copyIcon","underline","color","attrs","encodeURIComponent","svg","SeverityMap","DiagnosticsFeature","publishDiagnostics","Unnecessary","_firstResponseReceived","_diagnosticsDatabases","switchDiagnosticsPanelSource","getDiagnosticsDB","handleDiagnostic","_lastResponse","_lastDocument","_lastAdapter","setDiagnostics","done","setTimeout","_styleElement","connectionData","serverNotifications","foreignDocumentClosed","clearDocumentDiagnostics","foreignDocument","_invalidate","StateEffect","define","_invalidationCounter","StateField","effects","currentChanged","attemptsLeft","retry","themeManager","_reconfigureTheme","head","themeChanged","extensions","field","updateFinished","database","editorDiagnostics","editorDiagnostic","lastLineLength","to","classNames","markClass","delay","debounceDelay","needsRefresh","startState","gutter","style","getComputedStyle","lintTheme","backgroundImage","getPropertyValue","getRules","diagnosticsByRange","rangeIdToRange","rangeIdToDiagnostics","rangeId","getRangeId","rangeDiagnostics","defaultSeverity","filterDiagnostics","ignoredDiagnosticsCodes","ignoredSeverities","ignoreSeverities","severityName","ignoredMessagesRegExp","toString","diagnosticsList","lastLineNumber","getEditorAtVirtualLine","startInEditor","endInEditor","diagnosticsDB","previousList","editorsWhichHadDiagnostics","d","editorsWithDiagnostics","dispatch","of","showPanel","DIAGNOSTICS_PLUGIN","IEditorExtensionRegistry","ILayoutRestorer","IThemeManager","editorExtensionRegistry","restorer","assembler","namespace","tracker","WidgetTracker","ref","widgetId","panelWidget","mode","activateById","save","restore","Private","createMarkManager","specId","specCounter","kindToMark","fromEntries","Decoration","mark","_id","addMark","change","mapPos","removeMark","markField","none","marks","changes","newDoc","provide","f","decorations","views","putMarks","positions","appendConfig","clearAllMarks","clearEditorMarks","clear","HighlightsFeature","documentHighlight","_lastToken","requestHighlights","isReady","documentHighlightProvider","_versionSent","version","markManager","Text","class","Read","Write","_debouncedGetHighlight","createDebouncer","updateListener","viewUpdate","docChanged","selectionSet","onCursorActivity","eventListeners","blur","onBlur","keydown","removeOnBlur","handleHighlight","highlightsByEditor","optionsList","markerDefinitions","editorView","Debouncer","debouncerDelay","updateManager","updateDone","_virtualPosition","highlights","invoke","versionAfter","HIGHLIGHTS_PLUGIN","FreeTooltip","Tooltip","_setGeometry","setBundle","bundle","MimeModel","handleEvent","isHidden","keyCode","hideOnKeyPress","_editor","alignment","getLine","tokens","last","getCoordinateForPosition","paddingLeft","parseInt","host","HoverBox","setGeometry","maxHeight","minHeight","horizontal","privilege","outOfViewDisplay","setPosition","markupToBundle","markup","EditorTooltipManager","rendermimeRegistry","currentTooltip","currentOptions","tooltip","rendermime","Widget","attach","showOrCreate","samePosition","isEqual","sameMarkup","show","isShown","hide","ResponseCache","_data","maxSize","store","previousIndex","previous","editorRange","shift","clean","toMarkup","HoverFeature","hover","contentFormat","lastHoverCharacter","hasMarker","_previousHoverRequest","onKeyDown","responseData","restoreFromCache","handleResponse","onMouseLeave","removeRangeHighlight","maybeHideTooltip","getHover","hoverProvider","_getEditorRange","_addRange","showTooltip","lastHoverResponse","getMarkupForHover","tooltipManager","updateUnderlineAndTooltip","_updateUnderlineAndTooltip","cache","afterChange","mousemove","keepTooltip","mouseleave","debouncedGetHover","createThrottler","cacheSize","Throttler","limit","throttlerDelay","edge","isHoverAutomatic","autoActivate","matchingItems","cacheItem","mouseEvent","what","who","cushion","relatedTarget","whatRect","isCloseTo","markups","every","isTokenEmpty","isEventInsideVisible","isResponseUseful","race","delayMilliseconds","editorEange","HOVER_PLUGIN","offsetFromLsp","offsetAtPosition","EditApplicator","applyEdit","workspaceEdit","currentUri","documentChanges","edits","toDocumentChanges","appliedChanges","editedCells","isWholeDocumentEdit","errors","edit","_isWholeDocumentEdit","editsByOffset","oldToNewLine","newText","lastEnd","currentOldLine","currentNewLine","startOffsets","replacedFragment","assert","_applySingleEdit","allEmpty","modifiedCells","wasGranular","_replaceFragment","fragmentStart","fragmentEnd","newFragmentText","rawValue","sharedModel","oldValue","upToOffset","fromOffset","updateSource","setSelection","startEditor","lastEditor","recentlyReplaced","IDiagnosticsFeature","renameIcon","FEATURE_ID","RenameFeature","rename","prepareSupport","honorsChangeAnnotations","handleRename","outcome","applicator","changeText","renameSymbol","RENAME_PLUGIN","handleFailure","hasIndexError","direPythonErrors","direErrors","guessFailureReason","dialogValue","getText","cancelLabel","accept","newName","TOOLTIP_ID","getMarkdown","highlightCode","parameter","pre","callback","tree","parser","parse","pos","highlightTree","jupyterHighlightStyle","runMode","populated","createTextNode","innerText","outerHTML","SignatureFeature","signatureHelp","signatureInformation","languageRegistry","focusListener","_closeCharacters","closeCharacters","isSignatureShown","_removeTooltip","newEditorPosition","initialPosition","_requestSignature","getMarkupForSignatureHelp","signatures","activeSignature","signatureToMarkdown","activeParameter","markdown","activeParameterFallback","codeHighlighter","logger","maxLinesBeforeCollapse","parameters","details","plainTextDocumentation","leadLines","splitOnParagraph","leadCandidate","search","lead","remainder","extractLead","maxLines","_hideTooltip","handleSignature","positionAtRequest","displayPosition","signatureCharacters","signatureHelpProvider","signatureCharacter","hasFocus","editorLanguage","findByMIME","mimeType","support","getSource","subset","lastTriggerCharacterOffset","lastIndexOf","lastCharacter","iterChanges","fromA","toA","fromB","toB","inserted","sliceString","extractLastCharacter","previousPosition","help","SIGNATURE_PLUGIN","IEditorLanguageRegistry","LSPTableOfContentsModel","TableOfContentsModel","symbolFeature","configuration","documentType","supportedOptions","getHeadings","isActive","headings","symbols","getSymbols","processBreadthFirst","level","symbol","children","LSPEditorTableOfContentsFactory","TableOfContentsFactory","onActiveHeadingChanged","heading","selectionRange","activeHeadingChanged","disposed","_createNew","SymbolFeature","documentSymbol","hierarchicalDocumentSymbolSupport","tocRegistry","editorTracker","documentSymbolProvider","_getSymbols","_handleSymbols","isSymbolInformationArray","s","SYMBOL_PLUGIN","ITableOfContentsRegistry","SyntaxHighlightingFeature","originalModes","allReady","updateHandler","awaitUpdate","updateMode","getMode","mimetype","mimeTypeService","getMimeTypeByLanguage","topDocument","totalArea","coverage","foreignCodeThreshold","originalMode","SYNTAX_HIGHLIGHTING_PLUGIN","IEditorServices","editorServices","CodeOverridesManager","_overrides","CODE_OVERRIDES_MANAGER","renderCollapseConflicts","serverConflicts","LanguageServerSettings","formData","_objectTemplate","TabbedObjectTemplateFactory","baseTemplate","templates","ObjectFieldTemplate","objectSelector","schema","serverSchema","properties","validationErrors","instancePath","keyword","params","allowedValues","fields","FormComponent","validator","uiSchema","formContext","liveValidate","idPrefix","onChange","BaseTemplate","tab","setTab","useState","renderServerLabels","retained","property","idSchema","$id","workspaceConfig","workspace_configuration","renderServerMetadata","displayName","getDefaults","defaults","default","nestInSchema","mergePropertyDefault","SettingsUIManager","schemaValidated","_validationErrors","renderForm","renderLanguageServerSettings","SettingsSchemaManager","_defaultsPopulated","_schemaValidated","_defaults","_canonical","_original","_validationAttempt","_lastValidation","_lastUserServerSettings","_lastUserServerSettingsDoted","setupSchemaTransform","pluginId","transform","plugin","JSONExt","deepCopy","_populate","raw","sessionsChanged","reload","transformSchemas","language_servers","_validateSchemaLater","baseServerSchema","definitions","knownServersConfig","sharedDefaults","defaultsOverrides","serverKey","serverSpec","configSchema","config_schema","$ref","definitionID","defKey","defValue","workspaceConfigurationDefaults","nested","serverDefaultsOverrides","serverSettings","defaultMap","baseSchemaCopy","expandDottedAsNeeded","partiallyUncollapsed","dottedSettings","expanded","part","normalizeSettings","deepEqual","collapsedDefaults","_collapseServerSettingsDotted","collapsedUser","merged","mergeByServer","uncollapsed","_warnConflicts","_wasPreviouslyValidated","rawUserSettings","restored","validateData","user","serverSettingsGroup","collapsed","userSettings","userOrDefaultPriority","priority","python","emptyOrEscaped","MAGICS_TO_UNWRAP","LINE_MAGIC_PREFIX","PYTHON_IDENTIFIER","lineBreak","cmd","entire","replaced","unwrapCellMagic","regCellMagic","regUnwrapped","IPYTHON_TRANSCLUSIONS","extractorsManager","overrideManager","extractor","COMMAND_PATTERN","IPYTHON_BIGQUERY_TRANSCLUSIONS","extractArgs","contentPosition","inputs","outputs","others","variable","rest","parseArgs","inputVariables","outputVariables","reversePattern","quote","multiLine","magic","repeat","reverseReplacement","otherArgs","input","output","other","argsPattern","maxN","createExtractor","stripLeadingSpace","r","extractorNonStripping","RPY2_MAX_ARGS","IPYTHON_RPY2_TRANSCLUSIONS","extractorsMmanager","overridesManager","DEFAULT_TRANSCLUSIONS","LSPExtension","_isAnyActive","userConsole","statusBar","formRegistry","statusButtonExtension","registerStatusItem","addWidgetExtension","_settingsSchemaManager","settingsUI","addRenderer","fieldRenderer","_activate","_updateOptions","reason","afterInitialization","languageServerSettings","copy","previousInitialConfig","initialConfigurations","updateConfiguration","updateServerConfigurations","updateLogging","logAllCommunication","setTrace","ILoggerRegistry","IStatusBar","IFormRendererRegistry","DEFAULT_FEATURES","COMPLETION_THEME_MANAGER"],"sourceRoot":""}