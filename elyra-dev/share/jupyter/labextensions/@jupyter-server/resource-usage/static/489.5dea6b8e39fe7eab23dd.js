"use strict";(self.webpackChunk_jupyter_server_resource_usage=self.webpackChunk_jupyter_server_resource_usage||[]).push([[489],{489:(e,t,r)=>{r.r(t),r.d(t,{default:()=>X});var s=r(765),n=r(352),a=r(381),i=r(37),l=r(655),o=r(491),c=r(144),u=r(717),m=r(882),d=r(29),_=r.n(d),h=r(4),p=r(651);const v={B:1,KB:1024,MB:1048576,GB:1073741824,TB:1099511627776,PB:0x4000000000000};function g(e,t){const r=k(e,t);return r[0].toFixed(2)+" "+r[1]}function k(e,t){return e?t&&t in v?[e/v[t],t]:e<v.KB?[e,"B"]:v.KB===e||e<v.MB?[e/v.KB,"KB"]:v.MB===e||e<v.GB?[e/v.MB,"MB"]:v.GB===e||e<v.TB?[e/v.GB,"GB"]:v.TB===e||e<v.PB?[e/v.TB,"TB"]:[e/v.PB,"PB"]:[0,"B"]}let b=null;const y=e=>{const{reason:t}=e;return"not_supported"===t.reason?_().createElement("div",{className:"jp-KernelUsage-section-separator"},e.trans.__("Please check with your system administrator that you are running IPyKernel version 6.10.0 or above."),t.kernel_version?e.trans.__("Detected IPyKernel version: %1",t.kernel_version):e.trans.__("No IPyKernel installation detected.")):"no_kernel_widget"===t.reason?_().createElement("div",{className:"jp-KernelUsage-section-separator"},e.trans.__("Switch to a notebook or console to see kernel usage details.")):"no_kernel"===t.reason?_().createElement("div",{className:"jp-KernelUsage-section-separator"},e.trans.__("No active kernel found.")):_().createElement("div",{className:"jp-KernelUsage-section-separator"},e.trans.__("Reason: %1.",t.reason))},C=e=>{var t;const{panel:r}=e,[s,n]=(0,d.useState)(),[a,i]=(0,d.useState)(),[l,o]=(0,d.useState)(),[c,u]=(0,d.useState)({reason:"loading"});((e,t)=>{const r=(0,d.useRef)();(0,d.useEffect)((()=>{r.current=e}),[e]),(0,d.useEffect)((()=>{if(null!==t){const e=setInterval((function(){r.current&&r.current()}),t);return()=>{clearInterval(e)}}}),[e,t])})((async()=>{s&&r.isVisible&&v(s).catch((()=>{console.warn(`Request failed for ${s}. Kernel restarting?`)}))}),5e3);const m=(0,d.useRef)(s);m.current=s;const v=e=>async function(e="",t={}){const r=p.ServerConnection.makeSettings(),s=h.URLExt.join(r.baseUrl,"api/metrics/v1/kernel_usage",e);let n;try{n=await p.ServerConnection.makeRequest(s,t,r)}catch(e){throw new p.ServerConnection.NetworkError(e)}let a=await n.text();if(a.length>0)try{a=JSON.parse(a)}catch(e){console.log("Not a JSON response body.",n)}if(!n.ok)throw new p.ServerConnection.ResponseError(n,a.message||a);return a}(`get_usage/${e}`).then((t=>{var r;if(e!==m.current)return;if(null===(r=t.content)||void 0===r?void 0:r.reason){const e=t.content;return void u(e)}u(void 0);const s={...t.content,timestamp:new Date,kernel_id:e};o(s)}));return(0,d.useEffect)((()=>{const t=e=>(t,r)=>{var s,a;const l=null===(s=r.newValue)||void 0===s?void 0:s.id;if(l){n(l);const t=null===(a=null==e?void 0:e.sessionContext.session)||void 0===a?void 0:a.model.path;i(t),v(l)}else u({reason:"no_kernel"}),n(l)},r=(e,r)=>{var a,l,c,m,d;if(null===r)return n(void 0),void u({reason:"no_kernel_widget"});if(b&&b.panel.sessionContext.kernelChanged.disconnect(b.callback),b={callback:t(r),panel:r},r.sessionContext.kernelChanged.connect(b.callback),(null===(l=null===(a=r.sessionContext.session)||void 0===a?void 0:a.kernel)||void 0===l?void 0:l.id)!==s){const e=null===(m=null===(c=r.sessionContext.session)||void 0===c?void 0:c.kernel)||void 0===m?void 0:m.id;if(e){n(e);const t=null===(d=r.sessionContext.session)||void 0===d?void 0:d.model.path;i(t),o(void 0),u({reason:"loading"}),v(e)}else n(void 0),u({reason:"no_kernel"})}};return e.tracker.currentChanged.connect(r),e.tracker.currentWidget&&r(e.tracker,e.tracker.currentWidget),()=>{e.tracker.currentChanged.disconnect(r)}}),[s]),c&&"timeout"!==(null==c?void 0:c.reason)&&"loading"!==(null==c?void 0:c.reason)?_().createElement(_().Fragment,null,_().createElement("h3",{className:"jp-KernelUsage-section-separator"},e.trans.__("Kernel usage not available")),_().createElement(y,{trans:e.trans,reason:c})):s?_().createElement(_().Fragment,null,_().createElement("h3",{className:"jp-KernelUsage-section-separator"},e.trans.__("Kernel usage")),"timeout"===(null==c?void 0:c.reason)?_().createElement("strong",null,e.trans.__("Timed out in: %1 ms",c.timeout_ms)):null,_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Notebook:")," ",a),_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Kernel ID:")," ",s),_().createElement("div",{className:"timeout"===(null==c?void 0:c.reason)?"jp-KernelUsage-timedOut":""},l?_().createElement(_().Fragment,null,_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Kernel Host:")," ",l.hostname),_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Timestamp:")," ",null===(t=l.timestamp)||void 0===t?void 0:t.toLocaleString()),_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Process ID:")," ",l.pid),_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("CPU:")," ",l.kernel_cpu),_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Memory:")," ",g(l.kernel_memory)),_().createElement("hr",{className:"jp-KernelUsage-section-separator"}),(null==l?void 0:l.host_usage_flag)?_().createElement(_().Fragment,null,_().createElement("h4",{className:"jp-KernelUsage-section-separator"},e.trans.__("Host CPU")),l.host_cpu_percent&&_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans._n("%2%% used on %1 CPU","%2%% used on %1 CPUs",l.cpu_count,l.host_cpu_percent.toFixed(1))),_().createElement("h4",{className:"jp-KernelUsage-section-separator"},e.trans.__("Host Virtual Memory")),_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Active:")," ",g(l.host_virtual_memory.active)),_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Available:")," ",g(l.host_virtual_memory.available)),_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Free:")," ",g(l.host_virtual_memory.free)),_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Inactive:")," ",g(l.host_virtual_memory.inactive)),l.host_virtual_memory.percent&&_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Percent used:")," ",l.host_virtual_memory.percent.toFixed(1),"%"),_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Total:")," ",g(l.host_virtual_memory.total)),_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Wired:")," ",g(l.host_virtual_memory.wired))):null):"loading"===(null==c?void 0:c.reason)?_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Loadingâ€¦")):_().createElement("div",{className:"jp-KernelUsage-separator"},e.trans.__("Usage data is missing")))):_().createElement("h3",null,e.trans.__("Kernel usage is missing"))};class f extends n.ReactWidget{constructor(e){super(),this._tracker=e.tracker,this._panel=e.panel,this._trans=e.trans,this.addClass("jp-KernelUsage-content")}render(){return _().createElement(C,{tracker:this._tracker,panel:this._panel,trans:this._trans})}}const E='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\r\n  <g class="jp-icon3" fill="#616161">\r\n    <path d="m256 43c-141 0-256 115-256 256 0 62 22 118 59 163l6 8h383l6-8c37-44 59-101 59-163-0.1-141-115-256-256-256zm0 43c118 0 213 95 213 213 0 48-17 92-44 128h-339c-27-36-44-80-44-128 0-118 95-213 213-213zm0 21c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.5-21-21-21zm-85 23c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.6-21-21-21zm171 0c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.5-21-21-21zm-233 63c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.5-21-21-21zm290 0.7-121 69c-6.3-3.7-14-6-21-6-24 0-43 19-43 43s19 43 43 43c23 0 42-19 43-42v-0.7l121-69-21-37zm-313 85c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.5-21-21-21zm341 0c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.6-21-21-21zm-319 85c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.5-21-21-21zm296 0c-12 0-21 9.6-21 21s9.6 21 21 21 21-9.6 21-21-9.5-21-21-21z"/>\r\n  </g>\r\n</svg>\r\n\x3c!-- Downloaded from https://seekicon.com/free-icon/tachometer-alt_1 under MIT License. --\x3e\r\n';class U extends m.StackedPanel{constructor(e){super(),this.addClass("jp-KernelUsage-view"),this.id="kernelusage-panel-id",this.title.caption=e.trans.__("Kernel Usage"),this.title.icon=new l.LabIcon({name:"jupyterlab-kernel-usage:icon",svgstr:E});const t=new f({tracker:e.tracker,panel:this,trans:e.trans});this.addWidget(t)}dispose(){super.dispose()}onCloseRequest(e){super.onCloseRequest(e),this.dispose()}}var w=r(797),x=r(686);const L=({percentage:e,color:t})=>_().createElement("div",{className:"jp-IndicatorFiller",style:{width:100*e+"%",background:`${t}`}}),j=({values:e,percentage:t,baseColor:r})=>{const[s,n]=(0,d.useState)(!1),a=t>.5?t>.8?"red":"orange":r;return _().createElement("div",{className:"jp-IndicatorBar",onClick:()=>{n(!s)}},s&&_().createElement(x.Sparklines,{data:e,min:0,max:1,limit:e.length,margin:0},_().createElement(x.SparklinesLine,{style:{stroke:a,strokeWidth:4,fill:a,fillOpacity:1}}),_().createElement(x.SparklinesSpots,null)),!s&&_().createElement(L,{percentage:t,color:a}))},K=({enabled:e,values:t,label:r,color:s,text:n})=>{const a=t[t.length-1];return _().createElement(_().Fragment,null,e&&_().createElement("div",{className:"jp-IndicatorContainer"},_().createElement("div",{className:"jp-IndicatorText"},r),null!==a&&_().createElement("div",{className:"jp-IndicatorWrapper"},_().createElement(j,{values:t,percentage:a,baseColor:s})),_().createElement("div",{className:"jp-IndicatorText"},n)))},B="CPU: ",A=({model:e,label:t})=>{const[r,s]=(0,d.useState)(""),[n,a]=(0,d.useState)([]),i=()=>{const{cpuLimit:t,currentCpuPercent:r}=e,n=e.values.map((e=>Math.min(1,e.cpuPercent/(t||1)))),i=`${(100*r).toFixed(0)}%`;s(i),a(n)};return(0,d.useEffect)((()=>(e.stateChanged.connect(i),()=>{e.stateChanged.disconnect(i)})),[e]),_().createElement(K,{enabled:e.cpuAvailable,values:n,label:t,color:"#0072B3",text:r})};var S;!function(e){e.createCpuView=(e,t)=>n.ReactWidget.create(_().createElement(A,{model:e,label:t}))}(S||(S={}));const N="Disk: ",P=({model:e,label:t})=>{const[r,s]=(0,d.useState)(""),[n,a]=(0,d.useState)([]),i=()=>{const{maxDisk:t,currentDisk:r,diskUnits:n}=e,i=["B","KB","MB"].indexOf(n)>0?0:2,l=`${r.toFixed(i)} / ${t.toFixed(i)} ${n}`,o=e.values.map((e=>e.diskPercent));s(l),a(o)};return(0,d.useEffect)((()=>(e.stateChanged.connect(i),()=>{e.stateChanged.disconnect(i)})),[e]),_().createElement(K,{enabled:e.diskAvailable,values:n,label:t,color:"#c27ba0",text:r})};var D;!function(e){e.createDiskView=(e,t)=>n.ReactWidget.create(_().createElement(P,{model:e,label:t}))}(D||(D={}));const M="Mem: ",I=({model:e,label:t})=>{const[r,s]=(0,d.useState)(""),[n,a]=(0,d.useState)([]),i=()=>{const{memoryLimit:t,currentMemory:r,memUnits:n}=e,i=["B","KB","MB","GB"].indexOf(n)>0?0:3,l=`${r.toFixed(i)} ${t?"/ "+t.toFixed(i):""} ${n}`,o=e.values.map((e=>e.memoryPercent));s(l),a(o)};return(0,d.useEffect)((()=>(e.stateChanged.connect(i),()=>{e.stateChanged.disconnect(i)})),[e]),_().createElement(K,{enabled:e.memoryAvailable,values:n,label:t,color:"#00B35B",text:r})};var W,F,R;!function(e){e.createMemoryView=(e,t)=>n.ReactWidget.create(_().createElement(I,{model:e,label:t}))}(W||(W={})),function(e){class t{constructor(e=!1,t=!1,r=!1){this._memory=!1,this._cpu=!1,this._disk=!1,this._memory=e,this._cpu=t,this._disk=r}get hasWarning(){return this._memory||this._cpu||this._disk}}e.ResourceUsageWarning=t;class r extends n.VDomModel{constructor(e){super(),this._cpuLabel=B,this._memLabel=M,this._diskLabel=N,this._memoryAvailable=!1,this._cpuAvailable=!1,this._diskAvailable=!1,this._currentMemory=0,this._currentDisk=0,this._maxDisk=0,this._currentCpuPercent=0,this._memoryLimit=null,this._cpuLimit=null,this._memUnits="B",this._diskUnits="B",this._warn=new t,this._values=[];for(let e=0;e<20;e++)this._values.push({memoryPercent:0,cpuPercent:0,diskPercent:0});this._poll=new w.Poll({factory:()=>R.factory(),frequency:{interval:e.refreshRate,backoff:!0},name:"@jupyterlab/statusbar:ResourceUsage#metrics"}),this._poll.ticked.connect((e=>{const{payload:t,phase:r}=e.state;if("resolved"!==r){if("rejected"===r){const e=this._memoryAvailable,t=this._cpuAvailable;return this._memoryAvailable=!1,this._cpuAvailable=!1,this._diskAvailable=!1,this._currentMemory=0,this._currentDisk=0,this._maxDisk=0,this._memoryLimit=null,this._cpuLimit=null,this._memUnits="B",void((e||t)&&this.stateChanged.emit())}}else this._updateMetricsValues(t)}))}async refresh(){await this._poll.refresh(),await this._poll.tick}get cpuLabel(){return this._cpuLabel}get memLabel(){return this._memLabel}get diskLabel(){return this._diskLabel}get metricsAvailable(){return this._memoryAvailable||this._cpuAvailable}get memoryAvailable(){return this._memoryAvailable}get cpuAvailable(){return this._cpuAvailable}get diskAvailable(){return this._diskAvailable}get currentMemory(){return this._currentMemory}get currentDisk(){return this._currentDisk}get maxDisk(){return this._maxDisk}get memoryLimit(){return this._memoryLimit}get cpuLimit(){return this._cpuLimit}get memUnits(){return this._memUnits}get diskUnits(){return this._diskUnits}get currentCpuPercent(){return this._currentCpuPercent}get values(){return this._values}get usageWarnings(){return this._warn}dispose(){super.dispose(),this._poll.dispose()}_updateMetricsValues(e){var r,s,n,a,i,l;if(null===e)return this._memoryAvailable=!1,this._cpuAvailable=!1,this._currentMemory=0,this._currentDisk=0,this._maxDisk=0,this._memoryLimit=null,this._memUnits="B",this._diskUnits="B",void(this._warn=new t);const o=null!==(r=e.pss)&&void 0!==r?r:e.rss,c=e.limits.memory,u=null!==(n=null!==(s=null==c?void 0:c.pss)&&void 0!==s?s:null==c?void 0:c.rss)&&void 0!==n?n:null,[m,d]=k(o),_=new t(null===(a=e.limits.memory)||void 0===a?void 0:a.warn,null===(i=e.limits.cpu)||void 0===i?void 0:i.warn,null===(l=e.limits.disk)||void 0===l?void 0:l.warn);this._memoryAvailable=void 0!==o,this._currentMemory=m,this._memUnits=d,this._memoryLimit=u?u/v[d]:null;const h=this.memoryLimit?Math.min(this._currentMemory/this.memoryLimit,1):0;this._warn=_,this._cpuLimit=e.limits.cpu?e.limits.cpu.cpu:null,this._cpuAvailable=void 0!==e.cpu_percent,this._currentCpuPercent=void 0!==e.cpu_percent?e.cpu_percent/100:0;const p=e.disk_total;this._diskAvailable=!!p;const g=e.disk_used;let b=0,y=0,C="B";[b,C]=k(p),[y,C]=k(g,C),this._currentDisk=y,this._maxDisk=b,this._diskUnits=C;const f=Math.min(this._currentDisk/this._maxDisk,1);this._values.push({memoryPercent:h,cpuPercent:this._currentCpuPercent,diskPercent:f}),this._values.shift(),this.stateChanged.emit(void 0)}}e.Model=r}(F||(F={})),function(e){const t=p.ServerConnection.makeSettings(),r=h.URLExt.join(t.baseUrl,"api/metrics/v1");e.factory=async()=>{const e=p.ServerConnection.makeRequest(r,{},t),s=await e;return s.ok?await s.json():null}}(R||(R={}));const T=(0,r(95).style)({fontSize:"var(--jp-ui-font-size1)",fontFamily:"var(--jp-ui-font-family)"},{backgroundColor:"#FFD2D2",color:"#D8000C"});class $ extends n.VDomRenderer{constructor(e){super(new F.Model({refreshRate:5e3})),this._trans=e}render(){if(!this.model)return _().createElement("div",null);let e;return e=null===this.model.memoryLimit?this._trans.__("%1 %2 %3",this.model.memLabel,this.model.currentMemory.toFixed(V.DECIMAL_PLACES),this.model.memUnits):this._trans.__("%1 %2 / %3 %4",this.model.memLabel,this.model.currentMemory.toFixed(V.DECIMAL_PLACES),this.model.memoryLimit.toFixed(V.DECIMAL_PLACES),this.model.memUnits),this.model.cpuAvailable&&(e=`${this.model.cpuLabel} ${(100*this.model.currentCpuPercent).toFixed(V.DECIMAL_PLACES)} % | ${e}`),this.model.diskAvailable&&(e=`${this.model.diskLabel} ${this.model.currentDisk.toFixed(V.DECIMAL_PLACES)} / ${this.model.maxDisk.toFixed(V.DECIMAL_PLACES)} ${this.model.diskUnits} | ${e}`),this.model.usageWarnings.hasWarning?_().createElement(c.TextItem,{title:this._trans.__("Current resource usage"),source:e,className:T}):_().createElement(c.TextItem,{title:this._trans.__("Current resource usage"),source:e})}}var V;!function(e){e.DECIMAL_PLACES=2}(V||(V={}));var z,q=r(901);function G(e){return e instanceof o.ConsolePanel||e instanceof i.NotebookPanel}class O{constructor(e){var t,r;this._currentWidget=null;const{labShell:s,notebookTracker:n,consoleTracker:a}=e;this._currentChanged=new q.Signal(this),s?s.currentChanged.connect(((e,t)=>{const r=t.newValue;r&&G(r)?(this._currentChanged.emit(r),this._currentWidget=r):(this._currentChanged.emit(null),this._currentWidget=null)})):(n.currentChanged.connect(((e,t)=>{this._currentChanged.emit(t),this._currentWidget=t})),a&&a.currentChanged.connect(((e,t)=>{this._currentChanged.emit(t),this._currentWidget=t}))),(null==s?void 0:s.currentWidget)&&G(null==s?void 0:s.currentWidget)?this._currentWidget=s.currentWidget:this._currentWidget=null!==(r=null!==(t=n.currentWidget)&&void 0!==t?t:null==a?void 0:a.currentWidget)&&void 0!==r?r:null}get currentChanged(){return this._currentChanged}get currentWidget(){return this._currentWidget}}!function(e){e.getKernelUsage="kernel-usage:get"}(z||(z={}));const H={id:"@jupyter-server/resource-usage:status-item",autoStart:!0,requires:[u.ITranslator],optional:[c.IStatusBar],activate:(e,t,r)=>{const s=t.load("jupyter-resource-usage"),n=new $(s);r&&r.registerStatusItem(H.id,{item:n,align:"left",rank:2,isActive:()=>n.model.metricsAvailable,activeStateChanged:n.model.stateChanged})}},J={id:"@jupyter-server/resource-usage:topbar-item",autoStart:!0,requires:[n.IToolbarWidgetRegistry],optional:[a.ISettingRegistry],activate:async(e,t,r)=>{let s=!1,n=5e3,a=B,i=M,l=N;if(r){const e=await r.load(J.id);s=e.get("enable").composite,n=e.get("refreshRate").composite;const t=e.get("cpu").composite;a=t.label;const o=e.get("memory").composite;i=o.label;const c=e.get("disk").composite;l=c.label}const o=new F.Model({refreshRate:n});await o.refresh(),s&&o.cpuAvailable&&t.addFactory("TopBar","cpu",(()=>S.createCpuView(o,a))),s&&o.memoryAvailable&&t.addFactory("TopBar","memory",(()=>W.createMemoryView(o,i))),s&&o.diskAvailable&&t.addFactory("TopBar","disk",(()=>D.createDiskView(o,l)))}},Q={id:"@jupyter-server/resource-usage:kernel-panel-item",autoStart:!0,optional:[n.ICommandPalette,s.ILabShell,o.IConsoleTracker],requires:[u.ITranslator,i.INotebookTracker],activate:(e,t,r,s,n,a)=>{const i=t.load("jupyter-resource-usage"),{commands:o,shell:c}=e,u=i.__("Kernel Resource");let m=null;function d(){if(!m||m.isDisposed){const e=new O({notebookTracker:r,labShell:n,consoleTracker:a});m=new U({tracker:e,trans:i}),c.add(m,"right",{rank:200})}}o.addCommand(z.getKernelUsage,{label:i.__("Kernel Usage"),caption:i.__("Kernel Usage"),icon:new l.LabIcon({name:"jupyterlab-kernel-usage:icon",svgstr:E}),execute:d}),s&&s.addItem({command:z.getKernelUsage,category:u}),d()}},X=[H,J,Q]}}]);